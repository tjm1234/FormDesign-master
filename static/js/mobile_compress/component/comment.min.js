define(function(l, B, C) {
    B = Backbone.View.extend({
        initialize: function(a) {
            this.container = "#edit-comment";
            this.el = (this.parentEl = a.parentEl) ? this.parentEl + " " + this.container : this.container;
            this.targetId = a.targetId;
            this.subtargetId = a.subtargetId || "";
            this.module = a.module;
            this.appId = a.appId;
            this.userIds = a.userIds || [];
            this.visittype = a.visittype;
            this.contactTypes = a.contactTypes;
            this.formId = a.formId;
            this.formData = a.formData;
            this.isDeleted = a.isDeleted;
            this.renderCommentCallback = a.renderCommentCallback;
            this.formpluginUrl = "develop" == TEAMS.runMode ? "form/form-plugin" : "form.js"
        },
        bindDelegateEvents: function() {
            var a = this;
            $el = $(a.parentEl);
            $el.on("tap.commentview", ".j_load-comment-more", function(e) {
                e = $(this).attr("data-pageNo");
                "ebgform" == a.module ? a.searchFormComment(e) : a.searchComment(e)
            });
            $el.on("tap.commentview", ".j_comt-input", "#comt-input", function(e) {
                if (a.targetId || !a.targetId && "customer" == a.module && a.subtargetId)
                    if (utils.setWebTitle("\u8bc4\u8bba"),
                    a.parent = $(this).parents(".j_page-view"),
                    a.parent.addClass("hide"),
                    $("body").append(utils.template(a.editTpl)),
                    "ebgform" == a.module ? ($(".js_inputareaBar").find(".comment-atme-i").remove(),
                    $(".js_inputareaBar").find("#comment-attach").remove(),
                    $(".js_inputareaBar").find("#relevance-entity").remove()) : "app" == a.module && $(".js_inputareaBar #comment-attach,.js_inputareaBar #relevance-entity").hide(),
                    $("#comment-position").addClass("hide"),
                    window.inFetionClient ? a.getLocationByFetion() : a.getLocationByBaidu(),
                    window.setInterval(function() {
                        "" != $("#comment-position-app").html() && ($("#comment-position").removeClass("hide"),
                        $(".j_position-delete").removeClass("hide"),
                        $(".j_position-info").css("margin-right", "56px"),
                        $(".j_position-delete").click(function(a) {
                            $("#comment-position-app").empty();
                            $(".j_position-delete").addClass("hide");
                            $("#comment-position").addClass("hide")
                        }))
                    }, 500),
                    "ebgform" == a.module && $(this).hasClass("reply") && (e = $(this).parents(".j_comt-item").attr("id"),
                    $(".j_comment-create").addClass("reply").attr("p_comment_id", e)),
                    $(this).hasClass("reply") || "saleChance" != a.module && "customer" != a.module || (a.property && (a.property.remove(),
                    a.property = null),
                    l.async("crmjs/component/ContactTypeDictionaryProperty" + seajsClip, function(b) {
                        a.property = new b({
                            targetId: a.targetId,
                            preEl: "#edit-comment",
                            contactType: "#contactType",
                            preView: a
                        });
                        $("#contactType").show();
                        a.property.render()
                    })),
                    a.commentpostEvent(),
                    $("#edit-comment").removeClass("hide"),
                    a.parentId = $(this).data("parentId"),
                    $("#comment-content").focus(),
                    $("html,body").animate({
                        scrollTop: 0
                    }, 200),
                    // $("#comment-content").emojiarea({
                    //     buttonClass: "a-emoji",
                    //     buttonParent: ".js_inputareaBar",
                    //     buttonLabel: '\x3ci class\x3d"icon-smile"\x3e\x3c/i\x3e',
                    //     buttonStyle: "color:#666;font-size:15px"
                    // }),
                    "blog" != a.module && "ebgform" != a.module && (e = !0,
                    "workflow" == a.module && (e = !1),
                    a.atmeview = new a.atme({
                        $input: $("#comment-content"),
                        inputId: "#comment-content",
                        componentId: "edit-comment"
                    }),
                    $("#comment-content").atmearea({
                        buttonClass: "comment-atme-i",
                        buttonLabel: '\x3ci class\x3d"icon-at"\x3e\x3c/i\x3e',
                        needTargetMember: e,
                        buttonParent: ".inputarea-toolbar",
                        viewModule: a.module,
                        atmeview: a.atmeview
                    })),
                    "ebgform" != a.module) {
                        if ("function" == typeof a.Attachment || "undefined" == typeof a.Attachment)
                            a.Attachment = new a.attachment({
                                module: a.module,
                                el: "#comment-attach",
                                preEl: "#edit-comment"
                            });
                        e = [];
                        a.Attachment.render(e)
                    }
            });
            $(window).on("scroll.commentview", function() {
                if (!a.isLoading) {
                    var e = $el.find(".j_load-comment-more");
                    if (e.is(":visible")) {
                        var b = $(document)
                          , d = $(window).height();
                        $(window).scrollTop() + d + 100 >= b.height() && (e.trigger("tap"),
                        console.log("\u5230\u8fbe\u5e95\u90e8"))
                    }
                }
            });
            $el.on("tap.commentview", ".j_to-new-task", function(e) {
                if (a.targetId || "customer" == a.module && a.subtargetId) {
                    var b = $(this).parents(".j_comt-item").find(".j_com-content-body").text();
                    "" != b && (b = b.replace(SPECIAL_REGEX["emoji.h5.filter"], ""),
                    b = 100 < b.length ? b.substring(0, 100) : b);
                    var d = $(this)
                      , f = [];
                    if ((e = $(this).parents(".j_comt-item").find(".j_comt-attach-list .item")) && 0 < e.length) {
                        var h, k, n, m;
                        _.each(e, function(a) {
                            m = $(a).find("a:first");
                            h = m.attr("id");
                            k = m.attr("name") || "";
                            n = m.attr("type");
                            h && f.push({
                                id: h,
                                name: k,
                                type: n
                            })
                        })
                    }
                    l.async("teamsjs/task/taskadd" + seajsClip, function(e) {
                        a.taskadd = new e({
                            group: "today",
                            title: $.trim(b),
                            preEl: "#" + d.parents(".j_page-view").attr("id"),
                            isurl: !0,
                            attachments: f
                        });
                        a.taskadd.requireRender();
                        ROUTER.navigate("/mobile/task/add/today", {
                            trigger: !1
                        })
                    })
                }
            });
            $el.on("tap.commentview", ".j_employee-info", function(a) {
                "user" == $(this).attr("atType") && (a = $(this).attr("userId"),
                ROUTER.navigate("/mobile/employee/info/" + a, {
                    trigger: !0
                }))
            });
            $el.on("tap.commentview", ".j_position-delete", function(a) {
                $("#comment-position-app").empty();
                $(".j_position-delete").addClass("hide");
                $("#comment-position").addClass("hide")
            })
        },
        getLocationByFetion: function() {
            var a = this;
            utils.fetionLocation(function(e) {
                0 == e.status ? (window.HOST_TYPE = "2",
                window.BMap_loadScriptTime = (new Date).getTime(),
                TEAMS.service.base.toLowerCase().indexOf("https://"),
                l.async(["https://api.map.baidu.com/getscript?v\x3d2.0\x26ak\x3d5QlDX8l9izc0mHeDEsRQe1mIEGjs9nE9\x26services\x3d\x26t\x3d" + TEAMS.version], function() {
                    var b = new BMap.Point(e.lng,e.lat);
                    a.renderAfterTranslate(b)
                })) : utils.notify("\u5b9a\u4f4d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01")
            })
        },
        getLocationByBaidu: function() {
            var a = this;
            window.HOST_TYPE = "2";
            window.BMap_loadScriptTime = (new Date).getTime();
            var e = -1 != TEAMS.service.base.toLowerCase().indexOf("https://") ? "https://" : "http://";
            l.async([e + "api.map.baidu.com/getscript?v\x3d2.0\x26ak\x3d5QlDX8l9izc0mHeDEsRQe1mIEGjs9nE9\x26services\x3d\x26t\x3d" + TEAMS.version], function() {
                (new BMap.Geolocation).getCurrentPosition(function(b) {
                    this.getStatus() == BMAP_STATUS_SUCCESS ? a.renderAfterTranslate(b.point) : utils.notify("\u5b9a\u4f4d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01")
                }, {
                    enableHighAccuracy: !0
                })
            })
        },
        render: function() {
            var a = this;
        },
        getLocation: function() {
            window.qdgps = this;
            navigator.geolocation ? navigator.geolocation.getCurrentPosition(this.showPosition, this.errorBack, {
                enableHighAccuracy: !0
            }) : utils.notify("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5730\u7406\u5b9a\u4f4d")
        },
        errorBack: function(a) {},
        showPosition: function(a) {
            var e = window.qdgps;
            window.HOST_TYPE = "2";
            window.BMap_loadScriptTime = (new Date).getTime();
            var b = -1 != TEAMS.service.base.toLowerCase().indexOf("https://") ? "https://" : "http://";
            l.async([b + "api.map.baidu.com/getscript?v\x3d2.0\x26ak\x3d5QlDX8l9izc0mHeDEsRQe1mIEGjs9nE9\x26services\x3d\x26t\x3d" + TEAMS.version], function() {
                e.renderPoint(a.coords.longitude, a.coords.latitude)
            })
        },
        renderPoint: function(a, e) {
            var b = this
              , d = [new BMap.Point(a,e)];
            (new BMap.Convertor).translate(d, 1, 5, function(a) {
                0 === a.status && b.renderAfterTranslate(a.points[0])
            })
        },
        renderAfterTranslate: function(a) {
            var e = -1 != TEAMS.service.base.toLowerCase().indexOf("https://") ? "https://" : "http://";
            $.ajax({
                url: e + "api.map.baidu.com/geocoder/v2/?callback\x3drenderReverse\x26location\x3d" + a.lat + "," + a.lng + "\x26output\x3djson\x26pois\x3d1\x26ak\x3d5QlDX8l9izc0mHeDEsRQe1mIEGjs9nE9",
                type: "GET",
                dataType: "jsonp",
                success: function(b) {
                    if (0 == b.status && b.result) {
                        var d = b.result.formatted_address;
                        d && (d += b.result.sematic_description);
                        $("#comment-position-app").html(d);
                        $("#comment-position-app").attr("lng", a.lng);
                        $("#comment-position-app").attr("lat", a.lat)
                    }
                }
            })
        },
        translate: function(a, e, b) {
            var d = "cbk_" + Math.round(1E4 * Math.random());
            a = (-1 != TEAMS.service.base.toLowerCase().indexOf("https://") ? "https://" : "http://") + "api.map.baidu.com/ag/coord/convert?from\x3d" + e + "\x26to\x3d4\x26x\x3d" + a.lng + "\x26y\x3d" + a.lat + "\x26callback\x3dBMap.Convertor." + d;
            this.load_script(a);
            BMap.Convertor[d] = function(a) {
                delete BMap.Convertor[d];
                a = new BMap.Point(a.x,a.y);
                b && b(a)
            }
        },
        load_script: function(a, e) {
            var b = document.getElementsByTagName("head")[0]
              , d = document.createElement("script");
            d.type = "text/javascript";
            d.src = a;
            d.onload = d.onreadystatechange = function() {
                this.readyState && "loaded" !== this.readyState && "complete" !== this.readyState || (e && e(),
                d.onload = d.onreadystatechange = null,
                b && d.parentNode && b.removeChild(d))
            }
            ;
            b.insertBefore(d, b.firstChild)
        },
        commentpostEvent: function() {
            var a = this;
            $("#edit-comment").off(".edit");
            $("#edit-comment").on("tap.edit", "#j_a-back", function(e) {
                $("#attachment-container.comment-atta").remove();
                $(a.parentEl).parents(".j_page-view").removeClass("hide");
                $("#edit-comment").remove();
                $(".j_page_relevance_component.comment-relevance").remove();
                $("#edit-comment-relevance").remove();
                $(".a-emoji").remove();
                utils.setWebTitle(a.orititle)
            });
            $("#edit-comment").on("tap.edit", ".j_comment-create", function(e) {
                e = $(this).attr("unlocked");
                var b = $(this);
                if (!e) {
                    b.attr("unlocked", !0);
                    var d = $(a.container).find("#comment-content").data("userData")
                      , f = []
                      , h = []
                      , k = []
                      , n = $(a.container).find("#comment-content").val()
                      , m = e = n
                      , A = n
                      , t = $("#comment-position-app").html()
                      , v = $("#comment-position-app").attr("lng")
                      , w = $("#comment-position-app").attr("lat");
                    if (t && 66 < t.length)
                        utils.notify("\u5730\u7406\u4f4d\u7f6e\u5185\u5bb9\u8fc7\u957f"),
                        $(this).attr("unlocked", !0);
                    else {
                        if (d) {
                            e = a.processImAtUser(e, d);
                            for (var q = 0; q < d.length; q++)
                                if (-1 != n.indexOf(d[q].userName)) {
                                    var u = "@" + d[q].userName + " ";
                                    if (-1 != n.indexOf(u)) {
                                        f.push(d[q].userId);
                                        var s = m.indexOf(u) + 1;
                                        s == d[q].atIndex ? (h.push(d[q].userId + "-" + d[q].atIndex),
                                        s = d[q].atIndex) : h.push(d[q].userId + "-" + s);
                                        k = k.concat({
                                            atIndex: s,
                                            userId: d[q].userId,
                                            atType: d[q].atType
                                        })
                                    }
                                    for (var n = n.replace(u, " "), s = "", x = 0; x < u.length; x++)
                                        s += "X";
                                    m = m.replace(u, s)
                                }
                        }
                        d = (new Date).getTime();
                        if ((f = $(this).attr("ctime")) && 500 > d - f)
                            return !1;
                        $(this).attr("ctime", d);
                        if (a.module && "customer" == a.module) {
                            var y = !0
                              , z = !0;
                            l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(c) {
                                a.crmRemindView = new c({});
                                y = a.crmRemindView.validateCrmCommentForm($(".j_commentRemindFreeForm"));
                                z = a.crmRemindView.validateCrmCommentForm($(".j_commentFreeForm"));
                                if (y)
                                    if (z)
                                        if (!n || n.isBlank())
                                            utils.notify("\u8bf7\u8f93\u5165\u5185\u5bb9"),
                                            b.removeAttr("unlocked");
                                        else {
                                            c = $("#contactType").data();
                                            var d;
                                            c.property && (d = c.property.markValue);
                                            var e = ""
                                              , e = a.targetId && "null" != a.targetId && "undefined" != a.targetId ? a.targetId : 0;
                                            c = a.buildRelevance($("#edit-comment-relevance"));
                                            e = {
                                                "comment.address": t,
                                                "comment.longitude": v,
                                                "comment.latitude": w,
                                                "comment.targetId": e,
                                                "comment.module": a.module,
                                                "comment.content": n,
                                                "comment.userIds": a.userIds.join(","),
                                                "comment.parent.id": a.parentId,
                                                "comment.visitType": d || a.visittype,
                                                "comment.subtargetId": a.subtargetId,
                                                formId: a.formId,
                                                formData: a.formData
                                            };
                                            e.relevanceListParams = JSON.stringify(c);
                                            e.atLinkListParams = JSON.stringify(k);
                                            e.isAtGroup = !0;
                                            "app" == a.module && (e.appId = a.appId);
                                            $.ajax({
                                                type: "post",
                                                url: "/app/comment.json",
                                                dataType: "json",
                                                data: e,
                                                success: function(c) {
                                                    if (c.actionMsg)
                                                        utils.notify(c.actionMsg.message),
                                                        b.removeAttr("unlocked");
                                                    else if (a.relevanceList = c.comment.relevanceList && 0 != c.comment.relevanceList.length ? c.comment.relevanceList : null,
                                                    c && c.comment && c.comment.id) {
                                                        if (a.module && "customer" == a.module) {
                                                            var d = !0;
                                                            l.async(this.formpluginUrl, function() {
                                                                l.async("form/form-plugin", function() {
                                                                    d = formPlugin.isContainContent($("#commentFreeForm"))
                                                                })
                                                            });
                                                            var e = !0;
                                                            l.async(this.formpluginUrl, function() {
                                                                l.async("form/form-plugin", function() {
                                                                    e = formPlugin.isContainContent($("#commentRemindFreeForm"))
                                                                })
                                                            });
                                                            "block" == $("#commentFreeForm").css("display") && d && l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(b) {
                                                                a.crmCommentFreeFormViewes = new b({
                                                                    module: a.module,
                                                                    entityId: c.comment.id
                                                                });
                                                                a.crmCommentFreeFormViewes.renderFormCallback()
                                                            });
                                                            var f = $("#commentRemindFreeForm").attr("targetid");
                                                            "block" == $("#commentRemindFreeForm").css("display") && e && l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(b) {
                                                                a.crmCommentView = new b({
                                                                    module: a.module,
                                                                    entityId: c.comment.id,
                                                                    typeId: f
                                                                });
                                                                a.crmCommentView.renderFormCommentCallback()
                                                            })
                                                        }
                                                        0 != $("#attachment-container.comment-atta").find("#attachment-list").find(".attachment-item").length ? ($("#edit-comment").find(".masklayer").removeClass("hide"),
                                                        $("#attachment-container.comment-atta").find("#fileToUpload").trigger("propertychange", [c.comment.id, function() {
                                                            $.ajax({
                                                                type: "get",
                                                                url: "/app/comment/queryCommentById.json?commentId\x3d" + c.comment.id + "\x26module\x3d" + a.module,
                                                                dataType: "json",
                                                                success: function(c) {
                                                                    $("#edit-comment").find(".masklayer").addClass("hide");
                                                                    a.relevanceList && (c.comment.relevanceList = a.relevanceList);
                                                                    $("#edit-comment").remove();
                                                                    $("#attachment-container.comment-atta").remove();
                                                                    a.parent.removeClass("hide");
                                                                    $(".a-emoji").remove();
                                                                    a.addNewComment(c.comment);
                                                                    a.parentId = null;
                                                                    utils.notify("\u8bc4\u8bba\u6210\u529f");
                                                                    utils.setWebTitle(a.orititle);
                                                                    $("#comt_wrapper").removeClass("hide comt-wrapper-nodata");
                                                                    $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1);
                                                                    $("#attachment-container.comment-atta").find("#attachment-list").empty();
                                                                    $("#edit-comment-relevance").remove();
                                                                    $(".j_page_relevance_component.comment-relevance").remove();
                                                                    b.removeAttr("unlocked")
                                                                }
                                                            })
                                                        }
                                                        ])) : ($("#edit-comment").remove(),
                                                        $("#attachment-container.comment-atta").remove(),
                                                        a.parent.removeClass("hide"),
                                                        $(".a-emoji").remove(),
                                                        a.addNewComment(c.comment),
                                                        a.parentId = null,
                                                        utils.notify("\u8bc4\u8bba\u6210\u529f"),
                                                        utils.setWebTitle(a.orititle),
                                                        $("#comt_wrapper").removeClass("hide comt-wrapper-nodata"),
                                                        $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1),
                                                        $("#attachment-container.comment-atta").find("#attachment-list").empty(),
                                                        $("#edit-comment-relevance").remove(),
                                                        $(".j_page_relevance_component.comment-relevance").remove(),
                                                        b.removeAttr("unlocked"));
                                                        $("#load-tip-allcomt").addClass("hide");
                                                        $(".j_nocomment").addClass("hide")
                                                    } else
                                                        utils.notify("\u8bc4\u8bba\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"),
                                                        b.removeAttr("unlocked")
                                                }
                                            })
                                        }
                                    else
                                        b.removeAttr("unlocked");
                                else
                                    b.removeAttr("unlocked")
                            })
                        } else if (a.module && "ebgform" == a.module) {
                            if (!n || n.isBlank()) {
                                utils.notify("\u8bf7\u8f93\u5165\u5185\u5bb9");
                                b.removeAttr("unlocked");
                                return
                            }
                            if (200 < n.length) {
                                utils.notify("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7200\u4e2a\u5b57\u7b26");
                                b.removeAttr("unlocked");
                                return
                            }
                            var r = {};
                            e = {};
                            e.formID = a.targetId;
                            e.content = n;
                            $(this).hasClass("reply") && (A = $(this).attr("p_comment_id"),
                            e.parent = {
                                id: A
                            });
                            r.formComment = e;
                            $.ajax({
                                contentType: "application/json;charset\x3dUTF-8",
                                type: "post",
                                url: TEAMS.service.formreport + "/biaoge/createFormcomment.json",
                                dataType: "json",
                                data: JSON.stringify(r),
                                success: function(c) {
                                    formPlugin && (c = formPlugin.sensitiveWords(c, "json"));
                                    console.log(c);
                                    c.formComment ? ($("#edit-comment").remove(),
                                    a.parent.removeClass("hide"),
                                    a.addNewComment(c.formComment),
                                    a.parentId = null,
                                    utils.notify("\u8bc4\u8bba\u6210\u529f"),
                                    utils.setWebTitle(a.orititle),
                                    $("#comt_wrapper").removeClass("hide comt-wrapper-nodata"),
                                    $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1)) : utils.notify("\u8bc4\u8bba\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01");
                                    b.removeAttr("unlocked")
                                }
                            })
                        } else {
                            if (!n || n.isBlank()) {
                                utils.notify("\u8bf7\u8f93\u5165\u5185\u5bb9");
                                b.removeAttr("unlocked");
                                return
                            }
                            d = $("#contactType").data();
                            d.property && (r = d.property.markValue);
                            d = "";
                            h = a.targetId && "null" != a.targetId && "undefined" != a.targetId ? a.targetId : 0;
                            f = a.buildRelevance($("#edit-comment-relevance"));
                            d = {};
                            r = {
                                address: t,
                                longitude: v,
                                latitude: w,
                                targetId: h,
                                module: a.module,
                                content: n,
                                imAtContent: e,
                                userIds: a.userIds.join(","),
                                parent: {
                                    id: a.parentId
                                },
                                visitType: r || a.visittype,
                                subtargetId: a.subtargetId,
                                weChatAtContent: A
                            };
                            d.comment = r;
                            d.formId = a.formId;
                            d.formData = a.formData;
                            d.relevanceListParams = JSON.stringify(f);
                            d.atLinkListParams = JSON.stringify(k);
                            d.isAtGroup = !0;
                            "app" == a.module && (d.appId = a.appId,
                            d.comment.appId = a.appId);
                            TEAMS.currentEnvironment ? (r = utils.getCommonServerUrl("/common/comment", a.module),
                            r = r + "/app/createComment.common",
                            $.ajax({
                                url: r,
                                type: "post",
                                dataType: "json",
                                contentType: "application/json;charset\x3dUTF-8",
                                data: JSON.stringify(d),
                                success: function(c) {
                                    if (0 != c.actionMsg.code)
                                        utils.notify(c.actionMsg.message),
                                        b.removeAttr("unlocked");
                                    else if (c = {
                                        comment: c.data
                                    },
                                    "saleChance" == c.comment.module && l.async("crmjs/warning/WarningModel" + seajsClip, function(a) {
                                        (new a).saveCommentWarning(c.comment.module, c.comment.targetId, c.comment.content)
                                    }),
                                    a.relevanceList = c.comment.relevanceList && 0 != c.comment.relevanceList.length ? c.comment.relevanceList : null,
                                    c && c.comment && c.comment.id) {
                                        if (a.module && "customer" == a.module) {
                                            var d = !0;
                                            l.async(this.formpluginUrl, function() {
                                                l.async("form/form-plugin", function() {
                                                    d = formPlugin.isContainContent($("#commentFreeForm"))
                                                })
                                            });
                                            var e = !0;
                                            l.async(this.formpluginUrl, function() {
                                                l.async("form/form-plugin", function() {
                                                    e = formPlugin.isContainContent($("#commentRemindFreeForm"))
                                                })
                                            });
                                            "block" == $("#commentFreeForm").css("display") && d && l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(b) {
                                                a.crmCommentFreeFormViewes = new b({
                                                    module: a.module,
                                                    entityId: c.comment.id
                                                });
                                                a.crmCommentFreeFormViewes.renderFormCallback()
                                            });
                                            var f = $("#commentRemindFreeForm").attr("targetid");
                                            "block" == $("#commentRemindFreeForm").css("display") && e && l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(b) {
                                                a.crmCommentView = new b({
                                                    module: a.module,
                                                    entityId: c.comment.id,
                                                    typeId: f
                                                });
                                                a.crmCommentView.renderFormCommentCallback()
                                            })
                                        }
                                        0 != $("#attachment-container.comment-atta").find("#attachment-list").find(".attachment-item").length ? ($("#edit-comment").find(".masklayer").removeClass("hide"),
                                        $("#attachment-container.comment-atta").find("#fileToUpload").trigger("propertychange", [c.comment.id, function() {
                                            $.ajax({
                                                type: "get",
                                                url: "/app/comment/queryCommentById.json?commentId\x3d" + c.comment.id + "\x26module\x3d" + a.module,
                                                dataType: "json",
                                                success: function(c) {
                                                    $("#edit-comment").find(".masklayer").addClass("hide");
                                                    a.relevanceList && (c.comment.relevanceList = a.relevanceList);
                                                    $("#edit-comment").remove();
                                                    $("#attachment-container.comment-atta").remove();
                                                    a.parent.removeClass("hide");
                                                    $(".a-emoji").remove();
                                                    a.addNewComment(c.comment);
                                                    a.parentId = null;
                                                    utils.notify("\u8bc4\u8bba\u6210\u529f");
                                                    utils.setWebTitle(a.orititle);
                                                    $("#comt_wrapper").removeClass("hide comt-wrapper-nodata");
                                                    $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1);
                                                    $("#attachment-container.comment-atta").find("#attachment-list").empty();
                                                    $("#edit-comment-relevance").remove();
                                                    $(".j_page_relevance_component.comment-relevance").remove();
                                                    b.removeAttr("unlocked")
                                                }
                                            })
                                        }
                                        ])) : ($("#edit-comment").remove(),
                                        $("#attachment-container.comment-atta").remove(),
                                        a.parent.removeClass("hide"),
                                        $(".a-emoji").remove(),
                                        a.addNewComment(c.comment),
                                        a.parentId = null,
                                        utils.notify("\u8bc4\u8bba\u6210\u529f"),
                                        utils.setWebTitle(a.orititle),
                                        $("#comt_wrapper").removeClass("hide comt-wrapper-nodata"),
                                        $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1),
                                        $("#attachment-container.comment-atta").find("#attachment-list").empty(),
                                        $("#edit-comment-relevance").remove(),
                                        $(".j_page_relevance_component.comment-relevance").remove(),
                                        b.removeAttr("unlocked"));
                                        $("#load-tip-allcomt").addClass("hide");
                                        $(".j_nocomment").addClass("hide")
                                    } else
                                        utils.notify("\u8bc4\u8bba\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"),
                                        b.removeAttr("unlocked")
                                }
                            })) : $.ajax({
                                type: "post",
                                url: "/app/comment.json",
                                dataType: "json",
                                data: d,
                                success: function(c) {
                                    if (c.actionMsg)
                                        utils.notify(c.actionMsg.message),
                                        b.removeAttr("unlocked");
                                    else if ("saleChance" == c.comment.module && l.async("crmjs/warning/WarningModel" + seajsClip, function(a) {
                                        (new a).saveCommentWarning(c.comment.module, c.comment.targetId, c.comment.content)
                                    }),
                                    a.relevanceList = c.comment.relevanceList && 0 != c.comment.relevanceList.length ? c.comment.relevanceList : null,
                                    c && c.comment && c.comment.id) {
                                        if (a.module && "customer" == a.module) {
                                            var d = !0;
                                            l.async(this.formpluginUrl, function() {
                                                l.async("form/form-plugin", function() {
                                                    d = formPlugin.isContainContent($("#commentFreeForm"))
                                                })
                                            });
                                            var e = !0;
                                            l.async(this.formpluginUrl, function() {
                                                l.async("form/form-plugin", function() {
                                                    e = formPlugin.isContainContent($("#commentRemindFreeForm"))
                                                })
                                            });
                                            "block" == $("#commentFreeForm").css("display") && d && l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(b) {
                                                a.crmCommentFreeFormViewes = new b({
                                                    module: a.module,
                                                    entityId: c.comment.id
                                                });
                                                a.crmCommentFreeFormViewes.renderFormCallback()
                                            });
                                            var f = $("#commentRemindFreeForm").attr("targetid");
                                            "block" == $("#commentRemindFreeForm").css("display") && e && l.async("crmjs/component/freeform/CrmCommentFreeFormView" + seajsClip, function(b) {
                                                a.crmCommentView = new b({
                                                    module: a.module,
                                                    entityId: c.comment.id,
                                                    typeId: f
                                                });
                                                a.crmCommentView.renderFormCommentCallback()
                                            })
                                        }
                                        0 != $("#attachment-container.comment-atta").find("#attachment-list").find(".attachment-item").length ? ($("#edit-comment").find(".masklayer").removeClass("hide"),
                                        $("#attachment-container.comment-atta").find("#fileToUpload").trigger("propertychange", [c.comment.id, function() {
                                            $.ajax({
                                                type: "get",
                                                url: "/app/comment/queryCommentById.json?commentId\x3d" + c.comment.id + "\x26module\x3d" + a.module,
                                                dataType: "json",
                                                success: function(c) {
                                                    $("#edit-comment").find(".masklayer").addClass("hide");
                                                    a.relevanceList && (c.comment.relevanceList = a.relevanceList);
                                                    $("#edit-comment").remove();
                                                    $("#attachment-container.comment-atta").remove();
                                                    a.parent.removeClass("hide");
                                                    $(".a-emoji").remove();
                                                    a.addNewComment(c.comment);
                                                    a.parentId = null;
                                                    utils.notify("\u8bc4\u8bba\u6210\u529f");
                                                    utils.setWebTitle(a.orititle);
                                                    $("#comt_wrapper").removeClass("hide comt-wrapper-nodata");
                                                    $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1);
                                                    $("#attachment-container.comment-atta").find("#attachment-list").empty();
                                                    $("#edit-comment-relevance").remove();
                                                    $(".j_page_relevance_component.comment-relevance").remove();
                                                    b.removeAttr("unlocked")
                                                }
                                            })
                                        }
                                        ])) : ($("#edit-comment").remove(),
                                        $("#attachment-container.comment-atta").remove(),
                                        a.parent.removeClass("hide"),
                                        $(".a-emoji").remove(),
                                        a.addNewComment(c.comment),
                                        a.parentId = null,
                                        utils.notify("\u8bc4\u8bba\u6210\u529f"),
                                        utils.setWebTitle(a.orititle),
                                        $("#comt_wrapper").removeClass("hide comt-wrapper-nodata"),
                                        $(".j_comtCount").text(parseInt($(".j_comtCount").text()) + 1),
                                        $("#attachment-container.comment-atta").find("#attachment-list").empty(),
                                        $("#edit-comment-relevance").remove(),
                                        $(".j_page_relevance_component.comment-relevance").remove(),
                                        b.removeAttr("unlocked"));
                                        $("#load-tip-allcomt").addClass("hide")
                                    } else
                                        utils.notify("\u8bc4\u8bba\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"),
                                        b.removeAttr("unlocked")
                                }
                            })
                        }
                        a.module && utils.isCrmModule(a.module) && ($("#load-tip-allcomt").addClass("hide"),
                        $("#comt_wrapper").removeClass("comt-wrapper-nodata"))
                    }
                }
            });
            $("#edit-comment").on("tap.commentview", "#relevance-entity", function(e) {
                $("#edit-comment").addClass("hide");
                $("#edit-comment-relevance").removeClass("hide");
                a.relevanceViews = [];
                _.each([{
                    targetModule: "mainline"
                }, {
                    targetModule: "task"
                }, {
                    targetModule: "document"
                }, {
                    targetModule: "customer"
                }, {
                    targetModule: "clue"
                }, {
                    targetModule: "saleChance"
                }, {
                    targetModule: "workflow"
                }, {
                    targetModule: "calendar"
                }, {
                    targetModule: "formdatareport"
                }, {
                    targetModule: "biaoge"
                }, {
                    targetModule: "contract"
                }, {
                    targetModule: "production"
                }, {
                    targetModule: "competitor"
                }, {
                    targetModule: "contact"
                }, {
                    targetModule: "marketactivity"
                }, {
                    targetModule: "workreport"
                }], function(b) {
                    this.relevanceView = new a.relevance({
                        targetId: a.id,
                        targetModule: b.targetModule,
                        module: "comment",
                        perModule: a.module,
                        pel: "#comment-relevance",
                        preEl: "#edit-comment-relevance"
                    });
                    this.relevanceView.render()
                })
            })
        },
        saveNewComment: function(a) {
            $.ajax({
                type: "post",
                url: "/app/comment.json",
                dataType: "json",
                data: {
                    "comment.targetId": this.targetId,
                    "comment.module": this.module,
                    "comment.content": a
                },
                success: function(a) {}
            })
        },
        searchFormComment: function(a) {
            var e = this
              , b = {};
            isNaN(e.targetId) || (b.formId = e.targetId,
            b.pageNo = a,
            b.pageSize = 10,
            e.isLoading = !0,
            1 != a && $el.find(".j_commentLoading").removeClass("hide"),
            $.ajax({
                contentType: "application/json;charset\x3dUTF-8",
                type: "post",
                url: TEAMS.service.formreport + "/biaoge/searchFormcomment.json",
                dataType: "json",
                data: JSON.stringify(b),
                success: function(b) {
                    window.formPlugin && (b = formPlugin.sensitiveWords(b, "json"));
                    $el.find(".j_commentLoading").addClass("hide");
                    b = b.pageFormComment;
                    0 == b.totalCount ? $("#comt_wrapper").addClass("hide") : $("#comt_wrapper").removeClass("hide");
                    $("#comt_wrapper").find(".j_comtCount").text(b.totalCount);
                    e.renderComment(b, a);
                    e.isLoading = !1
                }
            }))
        },
        searchComment: function(a) {
            var e = this;
            e.isLoading = !0;
            $el = $(e.parentEl);
            var b;
            b = e.targetId && "null" != e.targetId && "undefined" != e.targetId ? e.targetId : 0;
            if (1 == a)
                $("#comt_wrapper").addClass("hide");
            else {
                $el.find(".j_commentLoading").removeClass("hide");
                var d = $(window).scrollTop();
                $("html,body").animate({
                    scrollTop: d + 100
                }, 200)
            }
            TEAMS.currentEnvironment ? (d = utils.getCommonServerUrl("/common/comment", e.module),
            d = d + "/app/commentPage.common",
            $.ajax({
                url: d,
                type: "post",
                dataType: "json",
                contentType: "application/json;charset\x3dUTF-8",
                data: JSON.stringify({
                    pageNo: a,
                    pageSize: 5,
                    "comment.subtargetId": e.subtargetId,
                    module: e.module,
                    appId: e.appId,
                    targetId: b
                }),
                success: function(b) {
                    $el.find(".j_commentLoading").addClass("hide");
                    0 != b.actionMsg.code ? utils.notify(b.actionMsg.message) : (b = b.page,
                    0 == b.totalCount ? e.module && utils.isCrmModule(e.module) ? ($("#load-tip-allcomt").removeClass("hide"),
                    $("#comt_wrapper").removeClass("hide"),
                    $("#comt_wrapper").addClass("comt-wrapper-nodata")) : e.module && "mainline" == e.module ? $(".j_nocomment").removeClass("hide") : $("#comt_wrapper").addClass("hide") : $("#comt_wrapper").removeClass("hide"),
                    $("#comt_wrapper").find(".j_comtCount").text(b.totalCount),
                    e.renderComment(b, a),
                    e.isLoading = !1)
                }
            })) : $.ajax({
                type: "get",
                url: "/app/comment/" + b + ".json",
                dataType: "json",
                data: {
                    pageNo: a,
                    pageSize: 5,
                    "comment.subtargetId": e.subtargetId,
                    module: e.module,
                    appId: e.appId
                },
                success: function(b) {
                    $el.find(".j_commentLoading").addClass("hide");
                    b = b.page;
                    0 == b.totalCount ? e.module && utils.isCrmModule(e.module) ? ($("#load-tip-allcomt").removeClass("hide"),
                    $("#comt_wrapper").removeClass("hide"),
                    $("#comt_wrapper").addClass("comt-wrapper-nodata")) : e.module && "mainline" == e.module ? $(".j_nocomment").removeClass("hide") : $("#comt_wrapper").addClass("hide") : $("#comt_wrapper").removeClass("hide");
                    $("#comt_wrapper").find(".j_comtCount").text(b.totalCount);
                    e.renderComment(b, a);
                    e.isLoading = !1
                }
            })
        },
        renderComment: function(a, e) {
            var b = [];
            $("#comment-list").find(".comt-item").each(function() {
                var a = $(this).attr("id");
                b.push(a)
            });
            if (a && 0 < a.result.length)
                for (var d = "", f = 0; f < a.result.length; f++) {
                    var h = a.result[f];
                    -1 == b.indexOf(h.id) && ("ebgform" == this.module ? this.renderOneFormComment(h) : this.renderOneComment(h),
                    d = d + h.id + ",")
                }
            1 != e && a && !a.hasNext && $("#comment-list").append($("#load-tip-clone").removeAttr("id").removeClass("hide"));
            f = $("#comment-list").find(".j_load-comment-more");
            a && a.hasNext ? (f && 1 == f.size() && f.remove(),
            $("#comment-list").append($("#load-more-clone").clone().removeAttr("id").removeClass("hide").attr("data-type", "stream").addClass("j_load-comment-more"))) : f.remove();
            a && a.pageNo && $("#comment-list .j_load-comment-more").attr("data-pageNo", a.pageNo + 1);
            "customer" != this.module && "contract" != this.module && "clue" != this.module && "competitor" != this.module && "marketactivity" != this.module && "saleChance" != this.module && "production" != this.module || $("#showExtend").trigger("tap");
            this.module && "customer" == this.module && d && this.commentFreeFormRender(d);
            this.module && "app" == this.module && this.renderCommentCallback && this.renderCommentCallback()
        },
        addNewComment: function(a) {
            "ebgform" == this.module ? this.renderOneFormComment(a, !0) : this.renderOneComment(a, !0);
            a = parseInt($(this.parentEl).find(".j_comment-count").data("count"));
            a++;
            $(this.parentEl).find(".j_comment-count").data("count", a).html(a)
        },
        renderOneFormComment: function(a, e) {
            a.operator && (a.commentor = a.operator,
            a.addTime = a.createTime);
            var b = $("#comment-clone").clone().removeAttr("id");
            b.find(".j_to-new-task").remove();
            b.attr("id", a.id);
            if (a.operator) {
                a.operator.username && b.find(".j_comt-user").text(a.operator.username).attr("userId", a.operator.id);
                var d = {};
                d.userId = a.commentor.id;
                $.ajax({
                    type: "post",
                    url: TEAMS.service.formreport + "/biaoge/queryByUserId.json",
                    dataType: "json",
                    data: d,
                    success: function(d) {
                        d = d.tkey;
                        a.commentor.avatar && a.commentor.avatar.p3 && TEAMS.currentTenant && d.toUpperCase() == TEAMS.currentTenant.tenantKey.toUpperCase() && b.find(".j_avatar img").attr("src", "/base/download/" + a.commentor.avatar.p3)
                    }
                })
            } else
                b.find(".j_comt-user").text("\u6e38\u5ba2");
            d = utils.initFormMessage(a.content);
            if (a.parent) {
                a.parent.operator && (a.parent.commentor = a.parent.operator);
                var f = a.parent.content;
                a.parent && a.parent.commentor ? b.find(".j_parent-content-body .j_parent-username").text("\u56de\u590d" + a.parent.commentor.username + "\uff1a").attr("userId", a.parent.commentor.id) : b.find(".j_parent-content-body .j_parent-username").text("\u56de\u590d\u6e38\u5ba2\uff1a");
                if (a.parent.userData) {
                    var h = [];
                    if (h = eval(a.parent.userData))
                        for (var k = 0; k < h.length; k++)
                            if (h[k])
                                if (h[k].userIdIndex && 0 != h[k].userIdIndex)
                                    var n = formpreview.getAtUserClass(h[k].atType)
                                      , f = f.substring(0, h[k].userIdIndex - 1) + "@" + h[k].userName + f.substring(h[k].userIdIndex - 1);
                                else
                                    "null" != h[k].userId && b.find(".j_com-content-body").prepend("\x3ca class\x3d'" + n + "' userId\x3d'" + h[k].userId + "'\x3e@" + h[k].userName + " \x3c/a\x3e")
                }
                f = utils.initFormMessage(f);
                b.find(".j_parent-content-body").removeClass("hide");
                b.find(".j_parent-content-body .j_parent-content").html($.faceConvert(f))
            }
            if (a.userData && (f = [],
            f = eval(a.userData)))
                for (k = 0; k < f.length; k++)
                    f[k] && (f[k].userIdIndex && 0 != f[k].userIdIndex ? (n = formpreview.getAtUserClass(f[k].atType),
                    d = d.substring(0, f[k].userIdIndex - 1) + "@" + f[k].userName + d.substring(f[k].userIdIndex - 1)) : "null" != f[k].userId && b.find(".j_com-content-body").prepend("\x3ca class\x3d'" + n + "' userId\x3d'" + f[k].userId + "'\x3e@" + f[k].userName + " \x3c/a\x3e"));
            b.find(".j_com-content-body").html($.faceConvert(d));
            b.find(".j_comt-date").text((new Date(a.addTime)).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
            e ? $("#comment-list").prepend(b) : $("#comment-list").append(b)
        },
        renderOneComment: function(a, e) {
            console.log(a);
            var b = $("#comment-clone").clone().removeAttr("id").attr("id", a.id);
            a.commentor ? (a.commentor.avatar && b.find(".j_avatar img").attr("src", "/base/download/" + a.commentor.avatar.p5),
            a.commentor.username && b.find(".j_comt-user").html(a.commentor.username)) : b.find(".j_comt-user").html("\u6e38\u5ba2");
            if ("customer" == this.module) {
                for (var d = this.options.contactTypes, f = "", h = 0; h < d.length; h++)
                    if (d[h].markValue == a.visitType) {
                        f = "  \u3010" + d[h].name + "\u3011";
                        break
                    }
                f && b.find(".j_comt-user").append(f);
                a.subtargetId && b.find(".j_comt-user").append("\u8054\u7cfb\u3010" + a.targetName + "\u3011");
                "saleChance" == a.module && b.find(".j_comt-user").append("   \u6765\u81ea\u5546\u673a\u3010" + a.saleChanceName + "\u3011");
                b.find(".j_comt-user").removeClass("comt-user")
            }
            if ("saleChance" == this.module) {
                d = this.options.contactTypes;
                f = "";
                for (h = 0; h < d.length; h++)
                    if (d[h].markValue == a.visitType) {
                        f = "  \u3010" + d[h].name + "\u3011";
                        break
                    }
                f && b.find(".j_comt-user").append(f)
            }
            "workflow" == a.module && a.commentType && 0 != a.commentType.trim().length && (b.find(".js_stepName").html("\u3010" + (a.stepName + "\uff1a" + this.flowOperationType(a.commentType) || "") + "\u3011"),
            a.entruster && (a.merge ? b.find(".js_entruster").html("(" + a.entruster.username + "\u59d4\u6258\u53ca\u672c\u4eba)") : b.find(".js_entruster").html("(" + a.entruster.username + "\u59d4\u6258)")));
            b.find(".j_comt-date").html(Date.create(a.addTime).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));
            d = this.processCommentDetail(a.content, a.userData);
            b.find(".j_com-content-body").html(d);
            b.find(".j_comt-input").data("parentId", a.id);
            if (a.parent) {
                d = a.parent;
                f = "";
                d.commentType && 0 != d.commentType.trim().length && (f = "\u3010" + d.stepName + "\uff1a" + this.flowOperationType(d.commentType) + "\u3011" || "");
                var k = h = "";
                d.commentor && d.commentor.username ? (h = d.commentor.username,
                k = d.commentor.id) : h = "\u6e38\u5ba2";
                b.find(".j_parent-content-body .j_parent-username").html("\u56de\u590d" + h + f + ": ").attr("title", h).attr("userId", k);
                f = this.processCommentDetail(d.content, d.userData);
                b.find(".j_parent-content-body .j_parent-content").html(f).attr("title", $.faceConvert(d.content));
                b.find(".j_parent-content-body").removeClass("hide")
            }
            a.address && (b.find("#comment-address").removeClass("hide"),
            b.find(".j_com-content-address").text(a.address).addClass("router"),
            b.find(".j_com-content-address").attr("lng", a.longitude).attr("lat", a.latitude).attr("href", "/mobile/comment/position/" + a.longitude + "/" + a.latitude + "/" + a.address));
            a.simpleImageFile && a.simpleImageFile.smallUrl && b.find(".j_com-content-body").append('\x3cbr/\x3e\x3cimg class\x3d"sign-image" src\x3d"/base/download/' + a.simpleImageFile.smallUrl + '"\x3e');
            if (a.relevanceList && 0 != a.relevanceList.length) {
                b.find(".j_comt-relevance").removeClass("hide");
                for (var n = k = h = f = d = 0, m = 0, l = 0, t = 0, v = 0, w = 0, q = 0, u = 0, s = 0, x = 0, y = 0, z = 0, r = 0; r < a.relevanceList.length; r++) {
                    var c = a.relevanceList[r];
                    if (c) {
                        var g = c.targetModule
                          , p = "marketactivity" == g ? "\u5173\u8054\u6d3b\u52a8\uff1a" : "\u5173\u8054" + this.mcUtils.queryModuleName(g, !1) + "\uff1a";
                        "document" == g ? (d++,
                        1 == d ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-document"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/documents/' + TEAMS.currentUser.id + "/" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-document").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/documents/' + TEAMS.currentUser.id + "/" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "task" == g ? (k++,
                        1 == k ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-task"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/task/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-task").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/task/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "workflow" == g ? (f++,
                        1 == f ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label  ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-workflow"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/workflows/' + TEAMS.currentUser.id + "/" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-workflow").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/workflows/' + TEAMS.currentUser.id + "/" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "mainline" == g ? (h++,
                        1 == h ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-mainline"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/mainline/cover/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-mainline").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/mainline/cover/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "customer" == g ? (n++,
                        1 == n ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-customer"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_customer\x26info\x3dview_CustomerCover|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-customer").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_customer\x26info\x3dview_CustomerCover|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "clue" == g ? (m++,
                        1 == m ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-clue"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_clue\x26info\x3dview_ClueView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-clue").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_clue\x26info\x3dview_ClueView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "saleChance" == g ? (l++,
                        1 == l ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-saleChance"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_salechance\x26info\x3dview_SaleChanceView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-saleChance").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_salechance\x26info\x3dview_SaleChanceView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "contract" == g ? (t++,
                        1 == t ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-contract"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_contract\x26info\x3dview_ContractView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-contract").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_contract\x26info\x3dview_ContractView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "production" == g ? (v++,
                        1 == v ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label  ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-production"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_production\x26info\x3dview_ProductionView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-production").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_production\x26info\x3dview_ProductionView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "competitor" == g ? (w++,
                        1 == w ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-competitor"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_competitor\x26info\x3dview_CompetitorView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list  .j_relation-competitor").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_competitor\x26info\x3dview_CompetitorView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "contact" == g ? (q++,
                        1 == q ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls relevance-contact j_relation-contact"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_contact\x26info\x3dview_contactView|id_" + c.targetId + '|customerId_null|preView_ContactListView" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-contact").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_contact\x26info\x3dview_contactView|id_" + c.targetId + '|customerId_null|preView_ContactListView" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "marketactivity" == g ? (y++,
                        1 == y ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls relevance-marketactivity j_relation-marketactivity"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_marketactivity\x26info\x3dview_MarketactivityView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-marketactivity").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/crms/' + c.targetId + "?module\x3dkey_marketactivity\x26info\x3dview_MarketactivityView|id_" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "calendar" == g ? (u++,
                        1 == u ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-calendar"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis  item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/calendar/' + TEAMS.currentUser.id + "/" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list .j_relation-calendar").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis  item"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/calendar/' + TEAMS.currentUser.id + "/" + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "biaoge" == g ? (x++,
                        1 == x ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-biaoge"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item style\x3d"margin-left:98px;"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/formstatdata/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list  .j_relation-biaoge").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item style\x3d"margin-left:98px;"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/formstatdata/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "formdatareport" == g ? (s++,
                        1 == s ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-formdatareport"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item style\x3d"margin-left:98px;"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/formdatadetail/formdatareport/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list  .j_relation-formdatareport").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item style\x3d"margin-left:98px;"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/formdatadetail/formdatareport/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e")) : "workreport" == g && (z++,
                        1 == z ? (b.find(".j_comt-relevance-list").append('\x3cdiv id\x3d"' + g + '" class\x3d"relevance-label ellipsis item"\x3e\x3cspan class\x3d"j_relevanceTitle-' + g + '"\x3e' + p + "\x3c/span\x3e\x3c/div\x3e"),
                        b.find(".j_comt-relevance-list").append('\x3cdiv class\x3d"relevance-controls j_relation-workreport"\x3e\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item style\x3d"margin-left:98px;"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/workreport/info/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e")) : b.find(".j_comt-relevance-list  .j_relation-workreport").append('\x3cdiv id\x3d"' + g + '" class\x3d"ellipsis item style\x3d"margin-left:98px;"\x3e\x3ca onclick\x3d"return false;" href\x3d"/mobile/workreport/info/' + c.targetId + '" class\x3d"router build ellipsis" id\x3d"' + c.targetId + '"\x3e' + c.targetName + "\x3c/a\x3e\x3c/div\x3e"))
                    }
                }
            } else
                b.find(".j_comt-relevance").addClass("hide");
            if (a.attachments && 0 < a.attachments.length)
                for (b.find(".j_comt-attach").removeClass("hide"),
                d = 0; d < a.attachments.length; d++)
                    f = a.attachments[d],
                    f.image ? 0 == b.find(".j_comt-attach-list .item.image").length ? b.find(".j_comt-attach-list").prepend('\x3cdiv class\x3d"item"\x3e\x3ca id\x3d"' + f.id + '" name\x3d"' + f.name + '" type\x3d"' + f.docType + '"\x3e' + f.name + "\x3c/a\x3e\x3c/div\x3e") : b.find(".j_comt-attach-list .item.image:last").after('\x3cdiv class\x3d"item"\x3e\x3ca id\x3d"' + f.id + '" name\x3d"' + f.name + '" type\x3d"' + f.docType + '"\x3e' + f.name + "\x3c/a\x3e\x3c/div\x3e") : b.find(".j_comt-attach-list").append('\x3cdiv class\x3d"ellipsis item"\x3e\x3ca class\x3d"build ellipsis fl" id\x3d"' + f.id + '" name\x3d"' + f.name + '" type\x3d"' + f.docType + '"\x3e' + f.name + "\x3c/a\x3e\x3c/div\x3e"),
                    (new this.PreViewCons({
                        container: b,
                        afterJqObj: b.find("#" + f.id),
                        fileObj: f,
                        isComment: !0
                    })).render();
            else
                b.find(".j_comt-attach").addClass("hide");
            e ? $("#comment-list").prepend(b) : $("#comment-list").append(b);
            a && a.simpleEmailInfo && (d = a.simpleEmailInfo.receverName,
            f = a.simpleEmailInfo.fromBox,
            h = "",
            d && 10 < d.length && (d = d.substr(0, 10) + "..."),
            "SENDMSG" == f ? (h = a.commentor.username,
            b.find(".j_comt-user").html(""),
            a.commentor.username ? b.find(".j_comt-user").append(h + "\u3010\u90ae\u4ef6\u3011 \u8054\u7cfb \x3cspan style\x3d'color: #5d9cec;'\x3e" + d + "\uff08" + a.simpleEmailInfo.receiver + "\uff09\x3c/span\x3e") : b.find(".j_comt-user").append("\u6e38\u5ba2 \u3010\u90ae\u4ef6\u3011 \u8054\u7cfb \x3cspan style\x3d'color: #5d9cec;'\x3e" + d + "\uff08" + a.simpleEmailInfo.receiver + "\uff09\x3c/span\x3e"),
            h = "from_sendmessage") : h = "from_inbox",
            (k = a.simpleEmailInfo.content) && 500 < k.length && (k = k.substr(0, 500) + "......"),
            b.find(".j_com-content-body").html(""),
            b.find(".j_com-content-body").html(k),
            b.find(".j_com-content-body").before("\x3cdiv id\x3d" + a.simpleEmailInfo.id + "_theme\x3e\x3cspan style\x3d'font-weight: bold;margin-top:10px;'\x3e" + a.simpleEmailInfo.theme + "\x3c/span\x3e\x3c/div\x3e"),
            "SENDMSG" != f && b.find("#" + a.simpleEmailInfo.id + "_theme").before("\x3cdiv\x3e\x3cspan\x3e\u6536\u5230  " + d + "\uff08" + a.simpleEmailInfo.receiver + "\uff09\u90ae\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a\x3c/span\x3e\x3c/div\x3e"),
            b.find(".j_com-content-body").css("margin-top", "10px"),
            b.find(".j_com-content-body").append("\x3cdiv class\x3d'router' style\x3d'margin-top: 10px;color: #5d9cec;' href\x3d'mobile/bulksms?module\x3dkey_email\x26isOther\x3disOther_comment\x26info\x3dview_emailinfo\x26from\x3d" + h + "\x26id\x3did_" + a.simpleEmailInfo.id + "'\x3e\u70b9\u51fb\u67e5\u770b\u90ae\u4ef6\u539f\u6587\x3c/div\x3e"));
            this.module && "customer" == this.module && b.find(".j_com-content-body").before("\x3cdiv class\x3d'webcomment_form j_formpreview hide' id\x3d" + a.id + "_commentForm\x3e\x3c/div\x3e \x3cdiv class\x3d'webcomment_form j_formpreview hide' id\x3d" + a.id + "_commentRemindForm\x3e\x3c/div\x3e")
        },
        processCommentDetail: function(a, e) {
            var b = a
              , d = []
              , d = eval(e)
              , f = {};
            if (d)
                for (var h = 0; h < d.length; h++)
                    d[h] && d[h].userIdIndex && 0 != d[h].userIdIndex && (b = b.substring(0, d[h].userIdIndex - 1) + "@" + d[h].userName + b.substring(d[h].userIdIndex - 1),
                    f["@" + d[h].userName] = "\x3ca class\x3d'j_employee-info at-user' userId\x3d'" + d[h].userId + "' atType\x3d'" + d[h].atType + "'\x3e@" + d[h].userName + "\x3c/a\x3e");
            b = utils.initMessage(b);
            b = $.faceConvert(b);
            for (h in f)
                b = b.replace(h, f[h]);
            return b
        },
        commentFreeFormRender: function(a) {
            var e = this;
            $.ajax({
                type: "post",
                url: TEAMS.service.crm + "/mobile/freeform/getCrmRelFormData",
                dataType: "json",
                data: {
                    module: e.module,
                    entityId: a
                },
                success: function(a) {
                    if (0 == a.actionMsg.code) {
                        if (a.data && 0 < a.data.length) {
                            for (var d = "_commentForm", f = "", h = "", k = [], l = [], m = 0; m < a.data.length; m++)
                                "1" == a.data[m].typeId ? (d = "_commentRemindForm",
                                $("#" + a.data[m].entityId + d).attr("formDataId", a.data[m].formDataId),
                                $("#" + a.data[m].entityId + d).addClass("j_commentRemindForm_view"),
                                f = $(".j_commentRemindForm_view"),
                                h = a.data[m].form) : (d = "_commentForm",
                                $("#" + a.data[m].entityId + d).attr("formDataId", a.data[m].formDataId),
                                $("#" + a.data[m].entityId + d).addClass("j_commentForm_" + a.data[m].typeId),
                                null == k || 0 >= k.length ? k.push(a.data[m].form.id) : 0 > $.inArray(a.data[m].form.id, k) && k.push(a.data[m].form.id),
                                d = {},
                                d.formId = a.data[m].form.id,
                                d.typeId = a.data[m].typeId,
                                l.push(d));
                            e.crmCommentFreeForm = new e.crmCommentFreeFormView({
                                commentRemindEl: f,
                                module: e.module,
                                form: h,
                                readOnly: !0,
                                commentList: k,
                                commentArr: l
                            });
                            e.crmCommentFreeForm.render()
                        }
                    } else
                        CrmUtils.notify(a.actionMsg.message)
                }
            })
        },
        processImAtUser: function(a, e) {
            if (e)
                for (var b = 0; b < e.length; b++)
                    -1 != a.indexOf(e[b].userName) && (a = a.replace("@" + e[b].userName + " ", ":@" + e[b].userId + "; "));
            return a
        },
        buildRelevance: function(a) {
            var e = [];
            0 < a.find("#relevanceDetailList li").length && a.find("#relevanceDetailList li").each(function() {
                var a = $(this).find("span").attr("data-id") || $(this).attr("data-id")
                  , d = $(this).parents(".r-acl-disabled").attr("data-module") || $(this).attr("datamodule")
                  , f = $(this).find("span").attr("data-title") || $(this).find(".j_formTitle").text();
                if (a && d && f) {
                    var h = {};
                    h.targetId = a;
                    h.targetModule = d;
                    h.targetName = f;
                    e.push(h)
                }
            });
            return e
        },
        flowOperationType: function(a) {
            var e = "";
            switch (a) {
            case "addStep":
                e = "\u52a0\u7b7e";
                break;
            case "approve":
                e = "\u540c\u610f";
                break;
            case "verify":
                e = "\u786e\u8ba4";
                break;
            case "reject":
                e = "\u9000\u56de";
                break;
            case "joinStep":
                e = "\u4f1a\u7b7e";
                break;
            case "reSubmit":
                e = "\u91cd\u65b0\u63d0\u4ea4";
                break;
            case "takeBack":
                e = "\u6536\u56de";
                break;
            case "entrust":
                e = "\u59d4\u6258";
                break;
            case "ccfeedBack":
                e = "\u6279\u793a";
                break;
            case "carboncopy":
                e = "\u6284\u9001";
                break;
            case "applicationReturn":
                e = "\u53d1\u8d77\u9000\u56de\u7533\u8bf7";
                break;
            case "rejectedReturn":
                e = "\u62d2\u7edd\u9000\u56de\u7533\u8bf7";
                break;
            case "agreeReturn":
                e = "\u540c\u610f\u9000\u56de\u7533\u8bf7";
                break;
            default:
                e = ""
            }
            return e
        },
        remove: function() {
            $(this.parentEl).off(".commentview");
            this.property && (this.property.remove(),
            this.property = null)
        }
    });
    C.exports = B
});
