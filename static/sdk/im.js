define("im/minichat/miniChatPage","im/minichat/ImFrameView im/component/imContants im/component/imUtils im/chat/history/imChatHistoryView im/component/imChatComponent im/component/imKickOffNotifyView im/component/imUserSelectorPanel im/component/imCommonModel".split(" "),function(n,s,p){var m=n("im/minichat/ImFrameView"),l=n("im/component/imContants"),h=n("im/component/imUtils"),g=n("im/chat/history/imChatHistoryView"),f=n("im/component/imChatComponent"),a=n("im/component/imKickOffNotifyView"),d=
n("im/component/imUserSelectorPanel"),b=n("im/component/imCommonModel");n=Backbone.View.extend({initialize:function(c){var a=this;this.remindFlag=0;this.allowFastOpen=!0;this.resizing=!1;this.el="#"+l.IM_MINI_PAGE;this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;this.supportSgroups=window.imEteamsJsService.ImRecentListCBService.supportSgroups;c=TEAMS.service.imWebapp+"/static/img/shake.wav";var e=$("\x3caudio id\x3d'shakeVoice' class\x3d'hide-im'\x3e\x3c/audio\x3e");e.attr("src",
c);1>$("#shakeVoice").length&&$("body").append(e);$("body #im-chat-mini").html(h.template("imchat.minichat"));this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;window.imCurrentUser.hideChat&&this.isHide();this.imSessionCacheManager.initMsgReminderCache(function(){a.queryAllChatUnreadCounts()});this.initImFrameSize();TEAMS.perLang&&$(this.el).find(".j_open-im-frame").attr("title",l.ImFrametitleWords[TEAMS.perLang.toLocaleLowerCase()]);var b="hidden"in document?"hidden":"webkitHidden"in
document?"webkitHidden":"mozHidden"in document?"mozHidden":null;c=b.replace(/hidden/i,"visibilitychange");document.addEventListener(c,function(){if(document[b])a.offlineUserStatus();else a.onlineUserStatus()})},delegateEvents:function(){var c=this,k=$(this.el);c.initImRemindList();$("body").off("singleChatNotifyBell").on("singleChatNotifyBell",function(e,a){e.stopPropagation();c.queryAllChatUnreadCounts();var b=!1,k=a.message.datas;window.imCurrentUser.hideChat||$(c.el).removeClass("hide");k&&window.imCurrentUser.uid==
k.from_uid&&(b=!0);b||c.show("1-"+k.from_uid)});$("body").off("mouseenter.miniChatPage").on("mouseenter.miniChatPage",function(e){c.onlineUserStatus()});$("body").off("mouseleave.miniChatPage").on("mouseleave.miniChatPage",function(e){c.offlineUserStatus()});$("body").off("groupChatNotifyBell").on("groupChatNotifyBell",function(e,a){c.queryAllChatUnreadCounts();var b=!1,k=a.message.datas;window.imCurrentUser.hideChat||$(c.el).removeClass("hide");k&&window.imCurrentUser.uid==k.from_uid&&(b=!0);b||
c.show("2-"+a.message.group_id)});$("body").off("serviceGroupChatBell").on("serviceGroupChatBell",function(e,a){c.queryAllChatUnreadCounts();var b=!1,k=a.message.datas;window.imCurrentUser.hideChat||$(c.el).removeClass("hide");k&&window.imCurrentUser.uid==k.from_uid&&(b=!0);b||c.show("3-serviceGroup")});$("body").off("sysMsgNotifyBell").on("sysMsgNotifyBell",function(e,a){var b=a.message.datas.msg_type.group;$(c.el).removeClass("hide");h.sgroupFilter(b)&&(c.queryAllChatUnreadCounts(),c.show("4-sgroup-"+
b))});k.on("imFrameShake.miniChatPage",function(e,a){var b=a.isSelf,k=$("#im-shake-div");k.addClass("im-div-shake");$("#shakeVoice")[0].play();b||$("#"+l.IM_ADDRLIST_EL).trigger("markShakeSession.ImAddrList",a);setTimeout(function(){k.removeClass("im-div-shake")},300);$(c.el).find(".j_im-reminds").addClass("hide-im");$(c.el).find(".j_open-im-frame").addClass("im-div-shake");setTimeout(function(){$(c.el).find(".j_im-reminds").removeClass("hide-im");$(c.el).find(".j_open-im-frame").removeClass("im-div-shake")},
300)});k.off("openEntityUserSelector.miniChatPage").on("openEntityUserSelector.miniChatPage",function(e,a){var u=a.entity,f;switch(a.flag){case "create":b.checkEntityGroup({entityId:u.id,uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid},function(e){switch(e.actionMsg.code){case 1:b.queryEntityShareEntry({entityId:u.id,name:u.name,module:u.module,shareTypes:["creater","primary","participants"]},function(e){var a={entityId:u.id,entityName:u.name};20<a.entityName.length&&(a.entityName=a.entityName.substring(0,
19)+"...");e=e.map.resultShareEntry;for(var c={},w=[{uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid}],d=0;d<e.length;d++){var f=e[d];"primary"==f.shareType&&(c={uid:f.sid,cid:window.imCurrentUser.cid});"user"==f.entryType&&f.sid!=window.imCurrentUser.uid&&w.push({uid:f.sid,cid:window.imCurrentUser.cid})}a.owner=c;a.users=w;b.createAndJoinEntityGroup(a,function(e){k.trigger("imFastChat.miniChatPage",{chatType:"groupChat",groupId:e.data});setTimeout(function(){$("#"+l.IM_CHATWIN_EL).trigger("fastSendEntityMessage.ImChatWin",
u)},1500)})});break;case 10:b.joinEntityGroup({entityId:u.id,uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid},function(e){k.trigger("imFastChat.miniChatPage",{chatType:"groupChat",groupId:e.data})});break;case 100:k.trigger("imFastChat.miniChatPage",{chatType:"groupChat",groupId:e.data})}$("#entitybox").trigger("closeView")});break;case "send":f=function(e){$("#"+l.IM_MINI_PAGE).trigger("forwardEntityMsg.miniChatPage",{entity:u,selectedObjArray:e})},c.imUserSelectorPanel=new d({selectType:0,
limitUserCount:10,componentType:void 0,entity:u,existUsers:[window.imCurrentUser],confirmFunc:function(e){e&&0<e.length&&f(e)}}),c.imUserSelectorPanel.render()}});$(c.el).find(".j_im-resize-window").resizable({handles:"n,w,nw",minWidth:600,minHeight:400,maxWidth:$(window).width()-50,maxHeight:$(window).height()-75,resize:function(e,a){c.resizing=!0;390>=$(c.el).find(".j_im-size-mainview:visible").width()&&($(c.el).find(".j_im-size-sideview").width(a.size.width-390),window.localStorage&&localStorage.setItem("imdragsize_listbox_w_"+
window.imCurrentUser.uid,a.size.width-390));k.find(".scrollwrapper").trigger("resizeSroll",{resizeImScroll:!0})},stop:function(e,a){setTimeout(function(){c.resizing=!1},300);window.localStorage&&(localStorage.setItem("imdragsize_chatbox_h_"+window.imCurrentUser.uid,a.size.height),localStorage.setItem("imdragsize_chatbox_w_"+window.imCurrentUser.uid,a.size.width))}}).on("resize",function(e){e.stopPropagation()});$(c.el).find(".j_im-size-sideview").resizable({handles:"e",minWidth:180,maxWidth:350,resize:function(e,
a){390>=$(c.el).find(".j_im-size-mainview:visible").width()&&($(c.el).find(".j_im-resize-window").width(a.size.width+390),window.localStorage&&localStorage.setItem("imdragsize_chatbox_w_"+window.imCurrentUser.uid,a.size.width+390));k.find(".scrollwrapper").trigger("resizeSroll",{resizeImScroll:!0})},stop:function(e,a){window.localStorage&&localStorage.setItem("imdragsize_listbox_w_"+window.imCurrentUser.uid,a.size.width)}}).on("resize",function(e){e.stopPropagation()});$(window).off("resize.miniChatPage").on("resize.miniChatPage",
function(){var e=$(window).width()-50,a=$(window).height()-75;$(c.el).find(".j_im-resize-window").resizable("option","maxWidth",$(window).width()-50);$(c.el).find(".j_im-resize-window").resizable("option","maxHeight",$(window).height()-75);var b=localStorage.getItem("imdragsize_chatbox_h_"+window.imCurrentUser.uid),k=localStorage.getItem("imdragsize_chatbox_w_"+window.imCurrentUser.uid);b&&b>a&&400<a&&localStorage.setItem("imdragsize_chatbox_h_"+window.imCurrentUser.uid,a);k&&k>e&&741<e&&localStorage.setItem("imdragsize_chatbox_w_"+
window.imCurrentUser.uid,e);c.initImFrameSize()});$("body").off("imRefresh").on("imRefresh",function(e){window.imCurrentUser.hideChat&&($("body").data("imCacheData").sessionCacheDatas.hasSysSession?$(c.el).removeClass("hide"):$(c.el).addClass("hide"))});k.off("click.miniChatPage",".j_open-im-frame").on("click.miniChatPage",".j_open-im-frame",function(e){c.openImView({})});k.off("openImView.miniChatPage").on("openImView.miniChatPage",function(e){c.openImView({})});k.off("openHistoryBySearch.miniChatPage").on("openHistoryBySearch.miniChatPage",
function(e,a){if(a&&a.chatType){var b=a.msgId;-1<b.indexOf("_")&&(b=b.substring(0,b.indexOf("_")),a.msgId=b);c.imChatHistoryView=new g(a);c.imChatHistoryView.searchByMsgId(a)}});k.off("click.miniChatPage",".j_im-reminds-list .j_im-remind-item").on("click.miniChatPage",".j_im-reminds-list .j_im-remind-item",function(e){e=$(this).attr("sgroup");var a={};e&&"chat"!=e&&(a.imFastSys=!0,a.sgroup=e);c.openImView(a)});k.off("miniChatAllCountNotify.miniChatPage").on("miniChatAllCountNotify.miniChatPage",function(e,
a){c.queryAllChatUnreadCounts()});$("body").on("click.miniChatPage",function(e){e=$(e.target);null==e.parents(".j_mini-chat-group-member-field").get(0)&&!e.hasClass("chat-name")&&null==e.parents(".chat-name").get(0)&&$(".j_mini-chat-head-angle").data("open")&&($(".j_mini-chat-head-angle").removeClass("on").data("open",!1),$(".j_mini-chat-group-member-field").slideUp("fast"));0<e.parents(".j_im-frame-show-panel").length||e.hasClass("j_im-frame-show-panel")||null==e.parents(".modal-dialog").get(0)&&
null==e.parents(".j_chat_filterSlip_js").get(0)&&(e.hasClass("modal")||0<e.parents(".modal").length||$("#entitybox")&&0<$("#entitybox").length||"\u8bf7\u8f93\u5165\u5fae\u4fe1\u6d88\u606f"!=e.parents(".modal-dialog").find(".modal-body").text()&&(e.hasClass("wechat-toggle")||c.resizing||$("#im-frame-container").trigger("toMinSize")))});k.off("imFastChat.miniChatPage").on("imFastChat.miniChatPage",function(e,a){e.stopPropagation();if(!window.imCurrentUser.hideChat){$(c.el).find(".j_open-im-frame").removeClass("im-ui-highlight");
switch(a.chatType){case "singleChat":var b=a.id;a.imChatUser?a.imChatUser.id||(a.imChatUser.id=a.imChatUser.uid):a.imChatUser={id:a.id};b=a.imChatUser.id;a.imChatUser.uid=b;a.imChatUser.cid||(a.imChatUser.cid=window.imCurrentUser.cid);break;case "groupChat":if(b=a.groupId,!a.imChatGroup){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(b,function(e){a.imChatGroup=e;c.imFastOpenImFrame(a)});return}}c.imFastOpenImFrame(a)}});k.off("imMarkReadNotifyBell.miniChatPage").on("imMarkReadNotifyBell.miniChatPage",
function(e,a){c.clear();c.queryAllChatUnreadCounts()});$("body").off("keyup.ImChatWin").on("keyup.ImChatWin",function(e){if(c.allowFastOpen){var a=e.which;e.altKey&&90==a&&(c.allowFastOpen=!1,(e=$(c.el).find(".j_im-frame-container"))&&e.hasClass("off")?c.openImView({}):$("#im-frame-container").trigger("toMinSize"),setTimeout(function(){c.allowFastOpen=!0},500))}else TEAMS.imLogSwitch&&console.log("Switch too frequently")});k.off("ImWindowNotify.miniChatPage").on("ImWindowNotify.miniChatPage",function(e){c.show()});
k.off("imLogout.miniChatPage").on("imLogout.miniChatPage",function(e){window.imWebsocketSdk.imJsonRequestMethods.logoutReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid})});k.off("imKickOffNotify").on("imKickOffNotify",function(e,b){$("body").trigger("mainSystemLogout.kickOutNotify");c.imKickOffNotifyView=new a(b);"4"!=b.flag&&c.imKickOffNotifyView.render()});k.off("forwardEntityMsg.miniChatPage").on("forwardEntityMsg.miniChatPage",function(e,a){e.stopPropagation();var b=a.entity,c=a.selectedObjArray,
k={uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,dev:window.imClientDev,sname:window.imCurrentUser.name,ver:"1.0"},d={id:b.id,name:b.name,module:b.module,etype:b.stype,stype:b.stype,ups:{}};d.ups.targetId=b.id;k.entity=d;k.msgType="8";k.msgTypeConf="8000";c&&0<c.length&&(f.sendForwardMsgBase({selectedObjArray:c,msgObjOrigin:void 0,msgType:"8",sendParams:k}),h.notify("\u4e8b\u9879\u8f6c\u53d1\u6210\u529f"))})},render:function(){},isHide:function(){$("body").data("imCacheData").sessionCacheDatas.hasSysSession?
$(this.el).removeClass("hide"):$(this.el).addClass("hide")},queryAllChatUnreadCounts:function(){var a=$(this.el).find(".j_im-reminds-list"),b=0,e=0,b=0,w=this.imSessionCacheManager.getAllMsgRemindCache();if(!window.imCurrentUser.hideChat){var u=f.getImChatNoReadAllCounts();u&&(_.each(u,function(a){if(0<a.count){var b;switch(a.type){case "1":b="1-"+a.user.uid;break;case "2":b="2-"+a.group_id;break;case "3":b="3-serviceGroup"}switch(h.getMsgReminderStatus(w,a,b)){case "1":break;default:e+=parseInt(a.count)}}}),
a.find(".j_im-remind-item[sgroup\x3d'chat']").find(".j_item-badge").attr("count",0).text(""),0<e&&a.find(".j_im-remind-item[sgroup\x3d'chat']").find(".j_item-badge").attr("count",e).text(e))}if(u=f.getImMsgNoReadCountsAll())for(var d in u){var g=u[d];if(h.sgroupFilter(g.sgroup)){var r=a.find(".j_im-remind-item[sgroup\x3d'"+g.sgroup+"']");r&&0<r.length&&r.find(".j_item-badge").attr("count",0).text("");if(0<g.count){var x=parseInt(g.count),b=b+x;switch(h.getMsgReminderStatus(w,g,"4-sgroup-"+g.sgroup)){case "1":b-=
x;break;default:r&&0<r.length&&r.find(".j_item-badge").attr("count",x).text(x)}}}}(b=e+b)&&0<b?(a=b,99<b&&(a="99+"),$(this.el).find(".j_im-mini-msg-number").text(a)):$(this.el).find(".j_im-mini-msg-number").text("");$("body").data("imCacheData").sessionCacheDatas.imAllCounts=b;$("#"+l.IM_ADDRLIST_EL).trigger("imSessionAllCount.ImAddrList")},openImFrameView:function(a){a||(a={});this.imFrameView=new m(a);this.imFrameView.render()},show:function(a){var b=this;if(a&&(a=b.imSessionCacheManager.getAllMsgRemindCache()[a])&&
"1"==a.reminder)return;$(b.el).find(".j_open-im-frame").addClass("im-ui-highlight");window.newMsgRemindId||"5"!=window.imClientDev||(window.newMsgRemindId=setInterval(function(){var e=document.title.replace("\u3010\u3000\u3000\u3000\u3011","").replace("\u3010\u65b0\u6d88\u606f\u3011","");switch(b.remindFlag){case 0:document.title="\u3010\u3000\u3000\u3000\u3011"+e;b.remindFlag=1;break;case 1:document.title="\u3010\u65b0\u6d88\u606f\u3011"+e,b.remindFlag=0}},800))},clear:function(){$(this.el).find(".j_open-im-frame").removeClass("im-ui-highlight");
window.clearInterval(window.newMsgRemindId);window.newMsgRemindId=void 0;0==document.title.indexOf("\u3010")&&(document.title=document.title.slice(document.title.indexOf("\u3011")+1))},openImView:function(a){$.imReconnectFunc.checkImRetryTime();var b=this,e=a.sgroup,w=a.imFastSys,u=$(b.el);b.clear();u.find(".j_open-im-frame").removeClass("im-ui-highlight");u.find(".j_im-frame-container").removeClass("off");a=250;navigator.userAgent.toLowerCase().indexOf("firefox")&&(a=250);setTimeout(function(){b.imFrameView?
(b.imFrameView.imAddrListView.render(),u.find(".scrollwrapper").trigger("resizeSroll",{resizeImScroll:!0}),$("#"+l.IM_CHATWIN_EL).trigger("openFrameTrigger.ImChatWin")):b.openImFrameView();b.imFrameView.openImFrameView();if(w){var a={imSysMsg:{sgroup:e}};$("#"+l.IM_ADDRLIST_EL).trigger("imFastSys.ImAddrList",a)}},a)},initImRemindList:function(){for(var a=$(this.el).find(".j_im-reminds-list .j_im-remind-item"),b=0;b<a.length;b++){var e=$(a[b]),w=e.attr("sgroup"),u=TEAMS.service.imWebapp+"/static/img/mobile/sysmsg/sgroup_108.png";
w&&"chat"!=w&&(u=TEAMS.service.imWebapp+"/static/img/mobile/sysmsg/sgroup_"+w+".png");e.find(".j_item-brand img").attr("src",u)}},initImFrameSize:function(a){a=$(this.el);if(!this.initsizegot){var b=.85*(window.innerHeight-50),e=.7*window.innerWidth;646>=e&&(e=646);400>=b&&(b=400);a.find(".j_im-resize-window").width(e);a.find(".j_im-resize-window").height(b);this.initsizegot=!0}window.localStorage&&(localStorage.getItem("imdragsize_chatbox_w_"+window.imCurrentUser.uid)&&(a.find(".j_im-resize-window").width(localStorage.getItem("imdragsize_chatbox_w_"+
window.imCurrentUser.uid)),a.find(".j_im-resize-window").height(localStorage.getItem("imdragsize_chatbox_h_"+window.imCurrentUser.uid))),localStorage.getItem("imdragsize_listbox_w_"+window.imCurrentUser.uid)&&a.find(".j_im-size-sideview").width(localStorage.getItem("imdragsize_listbox_w_"+window.imCurrentUser.uid)));window.imMainloaded=!0},offlineUserStatus:function(){window.imLeaveStatus=setTimeout(function(){window.imPCcomponent.statusChangeReq(2);window.imUserStatus="2"},3E5)},onlineUserStatus:function(){window.clearTimeout(window.imLeaveStatus);
"2"==window.imUserStatus&&(window.imPCcomponent.statusChangeReq(1),window.imUserStatus="1")},imFastOpenImFrame:function(a){var b=this,e=$(b.el);$(b.el).find(".j_im-frame-container").removeClass("off");var w=300;navigator.userAgent.toLowerCase().indexOf("firefox")&&(w=300);setTimeout(function(){b.imFrameView?(b.imFrameView.imAddrListView.render(),e.find(".scrollwrapper").trigger("resizeSroll",{resizeImScroll:!0})):b.openImFrameView({type:"imFastChat"});b.imFrameView.openImFrameView();var w={imChatUser:a.imChatUser,
imChatGroup:a.imChatGroup,chatType:a.chatType,isHelper:a.isHelper};$("#"+l.IM_ADDRLIST_EL).trigger("imFastChat.ImAddrList",w)},w)},getRule:function(){for(var a,b=document.styleSheets,e=0;e<b.length;++e)for(var w=0;w<b[e].cssRules.length;++w)if(a=b[e].cssRules[w],"enterPiece"==a.name&&a.type==CSSRule.KEYFRAMES_RULE)return a},remove:function(){this.atmeview&&(this.atmeview.remove(),this.atmeview=null)}});p.exports=n});
define("im/minichat/ImThirdWinView",["im/component/imUtils","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants");n=Backbone.View.extend({initialize:function(h){this.el="#"+l.IM_THIRDWIN_EL;this.targetEl=h.parentEl;this.params=h;this.sgroup=h.sgroup;this.ImRecentListCBService=window.imEteamsJsService.ImRecentListCBService;$(this.el).html(m.template("imchat.imthirdwin"))},delegateEvents:function(){var h=this,g=$(h.el);g.off("click.ImThirdWin",".j_im-thirdMsg-read-all").on("click.ImThirdWin",
".j_im-thirdMsg-read-all",function(f){$(h.targetEl).trigger("readAllBlog.BlogView",{blogEl:h.targetEl})});g.off("readAllBlog.ImThirdWin").on("readAllBlog.ImThirdWin",function(f){$.ajax({type:"post",contentType:"application/json;charset\x3dUTF-8",url:"/blog/readAll.json",dataType:"json",data:JSON.stringify(param),success:function(a){$("#sgroup-112").attr("count",0);$("#sgroup-112 .j_count").text("")}})})},render:function(){switch(this.sgroup){case "112":$(this.el).find(".j_view-head .j_name").text("\u672a\u8bfb\u65e5\u62a5"),
$(this.el).addClass("module-blog-view")}this.ImRecentListCBService.openThirdWin(this.params)},remove:function(){$(this.el).off(".ImSysWin");$(this.el).empty()}});p.exports=n});
define("im/minichat/ImAddrListView","im/component/imUtils im/component/imContants im/minichat/ImWinComView im/component/imChatComponent im/component/imRecentListComponent im/component/imCommonSysMsgView im/component/emojiarea im/component/imFuncPanel im/component/imUserSelectorPanel im/component/group/anonymous".split(" "),function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/minichat/ImWinComView"),g=n("im/component/imChatComponent"),f=n("im/component/imRecentListComponent"),
a=n("im/component/imCommonSysMsgView"),d=n("im/component/emojiarea"),b=n("im/component/imFuncPanel"),c=n("im/component/imUserSelectorPanel"),k=n("im/component/group/anonymous");n=Backbone.View.extend({initialize:function(e){var b=this;this.el="#"+l.IM_ADDRLIST_EL;this.sgroupId=e.sgroupId;this.imWinComView;this.ImRecentListCBService=window.imEteamsJsService.ImRecentListCBService;this.customListConfig=window.imEteamsJsService.ImRecentListCBService.customListConfig;this.sysMsgListConfig=window.imEteamsJsService.ImRecentListCBService.sysMsgListConfig;
this.supportSgroups=window.imEteamsJsService.ImRecentListCBService.supportSgroups;this.singleChatListConfig=window.imEteamsJsService.ImRecentListCBService.singleChatListConfig;this.addressPageNo=1;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imRecentListComponent=new f({});this.imCommonSysMsgView=new a({});this.pageDownAddTime;this.minSessionId;this.isOnline=!0;this.createType=e.type;this.chatIndexSessionType=this.chatIndexType="session";this.wheelPageUnlLocked=!0;this.serviceGroupId;
this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;this.imGroupCacheManager=window.imCacheData.imGroupCacheManager;$("#"+l.IM_ADDRLIST_EL).html(m.template("imchat.imaddrlist"));window.imCurrentUser.hideChat&&($(b.el).find(".j_panel-search").addClass("hide-im"),$(b.el).find(".j_im-addrlist-tab-container").addClass("hide-im"));$(".j_im-addrlist-scrollbar").trigger("resizeSroll",{resizeImScroll:!0});d($);m.layout(this.el+" .j_im-addrlist-scrollbar",{whileScrolling:function(){b.mcsTopPct=
this.mcs.topPct;90<b.mcsTopPct&&b.wheelPageUnlLocked&&!b.isSearchList&&(b.wheelPageUnlLocked=!1,b.turnPage(function(){b.wheelPageUnlLocked=!0}))}},[{scrollInertia:500,mouseWheel:{scrollAmount:300},gotoTopButton:!1}])},delegateEvents:function(){var e=this,a=$(this.el);a.off("imFastChat.ImAddrList").on("imFastChat.ImAddrList",function(a,b){$("#"+l.IM_CHATWIN_EL).trigger("saveImChatDraft.ImChatWin");b.imMsgModule="chat";e.imFastTrigger(b)});a.off("imSessionAllCount.ImAddrList").on("imSessionAllCount.ImAddrList",
function(a,b){e.imSessionAllCount()});a.off("imFastSys.ImAddrList").on("imFastSys.ImAddrList",function(a,b){$("#"+l.IM_CHATWIN_EL).trigger("saveImChatDraft.ImChatWin");b.imMsgModule="sys";e.imFastTrigger(b)});a.off("checkChatUnreadNum.ImAddrList").on("checkChatUnreadNum.ImAddrList",function(a,b){var c=b.imChatUser,k=b.imChatGroup,d;switch(b.chatType){case "singleChat":d=c.id;break;case "groupChat":d=k.id}(c=$(e.el).find(".j_im-session-container").find(".j_im-session-list").find("#"+d))&&0<c.length&&
0<c.attr("count")&&$("#"+l.IM_CHATWIN_EL).trigger("triggerImChatRead.ImChatWin")});a.off("updateUnreadNumOne.ImAddrList").on("updateUnreadNumOne.ImAddrList",function(a,b){e.updateNoReadMsgCount(b)});a.off("updateLastMessage.ImAddrList").on("updateLastMessage.ImAddrList",function(a,b){e.updateLastMessage(b)});a.off("markShakeSession.ImAddrList").on("markShakeSession.ImAddrList",function(a,b){var c=b.msgData,k=c.from_uid;if(c.from_uid!=window.imCurrentUser.uid||c.from_cid!=window.imCurrentUser.cid){var c=
$(e.el).find(".j_im-session-container").find(".j_im-session-list"),k="#"+k,d=c.find(k);d.addClass("im-div-flash");0<$(e.el+" .j_im-addrlist-scrollbar").length&&$(e.el+" .j_im-addrlist-scrollbar").mCustomScrollbar("scrollTo",k);setTimeout(function(){d.removeClass("im-div-flash")},2E3)}});a.off("createImChatGroup.ImAddrList").on("createImChatGroup.ImAddrList",function(a,b){$(this);var c=b.callback,k=b.resDatas;e.imRecentListComponent.getGroupInfoUcReq(b.imChatGroup.id,function(a){e.imSessionCacheManager.receiveGroupChatMsg({group_id:a.id,
imChatGroup:a});if("group"==e.chatIndexType)a=$(e.el).find(".j_im-addrgroup-container .j_im-addrgroup-list"),a=e.renderGroupListOne(k,a),$(e.el).find(".j_im-addrgroup-container").find(".j_no-result").addClass("hide-im"),e.openMsgWindowBefore(a),a=a.data("imChatGroup");else{var b=$(e.el).find(".j_im-session-container").find(".j_im-session-list"),u=$(e.el).find("#im-addrlist-clone-field #im-session-one-clone").clone();u.removeClass("hide-im");u.attr("id",a.id);u.addClass("j_im-groupChat");u.find(".info .j_name").text(a.name);
u.find(".j_avatar img").attr("src",TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png");u.data("chatType","groupChat");u.data("imChatGroup",a);var d=m.confirmDate((new Date).getTime());u.find(".j_date").text(d);b.append(u);e.showTop(a.id);e.openMsgWindowBefore(u)}b={imMsgModule:"chat",chatType:"groupChat"};b.imChatGroup=a;b.count="0";e.imWinComView=new h(b);e.imWinComView.render(c)})});a.off("exitImChatGroup.ImAddrList").on("exitImChatGroup.ImAddrList",function(a,b){$(e.el).find(".j_im-addrgroup-container .j_im-addrgroup-list");
$(e.el).find(".j_im-session-container").find(".j_im-session-list");"GROUPTYPE_N"==b.type&&$(e.el).find(".j_im-service-session-container .j_im-service-list")});a.off("click.ImAddrList",".j_create-chat-group").on("click.ImAddrList",".j_create-chat-group",function(a){e.imUserSelectorPanel=new c({selectType:0,limitUserCount:30,componentType:1,existUsers:[window.imCurrentUser],confirmFunc:function(e){if(e&&0<e.length){var a=[];e.forEach(function(e){e&&"singleChat"==e.chatType&&a.push(e.imChatUser)});g.createImGroup({users:a},
function(e){e={imChatGroup:{id:e.message.group_id,name:e.message.name,userNum:a.length,exist:"1"},resDatas:e.message,users:a};$("#"+l.IM_ADDRLIST_EL).trigger("createImChatGroup",e)})}}});e.imUserSelectorPanel.render()});a.off("click.ImAddrList",".j_im-singleChat").on("click.ImAddrList",".j_im-singleChat",function(a){a=$(this);if(!a.hasClass("active")){$("#"+l.IM_CHATWIN_EL).trigger("saveImChatDraft.ImChatWin");a.find(".j_draft").addClass("hide-im");a.find(".j_draft-text").addClass("hide-im");a.find(".j_info").removeClass("hide-im");
var b=a.data("imChatUser");a.hasClass("j_im-eteams-helper")&&(b.flag="1",a.data("imChatUser",b));e.openSingleChatWindow(a);a.attr("count",0);a.find(".j_count").text("");if(a.hasClass("j_im-addr-searchone")){var c={},b=a.data("imChatUser");c.chatType=a.data("chatType");c.imChatUser=b;e.changeToSessionList(c)}}});a.off("click.ImAddrList",".j_im-groupChat").on("click.ImAddrList",".j_im-groupChat",function(a){var b=$(this);b.hasClass("active")||($("#"+l.IM_CHATWIN_EL).trigger("saveImChatDraft.ImChatWin"),
b.find(".j_draft").addClass("hide-im"),b.find(".j_draft-text").addClass("hide-im"),b.find(".j_info").removeClass("hide-im"),a=b.data("imChatGroup"),$("#"+l.IM_CHATWIN_EL).trigger("beforeSwitchSession",{type:"group",data:a}),e.imRecentListComponent.getGroupInfoUcReq(a.id,function(a){var c={imMsgModule:"chat"};c.chatType=b.data("chatType");c.imChatGroup=a;c.count=b.attr("count");b.find(".j_atme").hasClass("hide-im")&&(c.isHideAtView=!0);b.hasClass("j_im-eteamsService")?(c.isHelper=!0,e.openMsgWindowBefore(b,
"serviceGroup"),e.$activeSession=b):(e.afterClickRemember("2",c),e.$activeSession=b,e.activeSessionType="chat");e.openMsgWindowBefore(b);e.imWinComView=new h(c);e.imWinComView.render();b.attr("count",0);b.find(".j_count").text("");$("#"+l.IM_CHATWIN_EL).trigger("afterSwitchSession",{type:"group",data:a})}),b.hasClass("j_im-addr-searchone")&&(a={},a.chatType=b.data("chatType"),a.imChatGroup=b.data("imChatGroup"),e.changeToSessionList(a)))});a.off("click.ImAddrList",".j_im-customMsg-trigger").on("click.ImAddrList",
".j_im-customMsg-trigger",function(a){a.stopPropagation();var b=$(this);a=b.attr("count");b.addClass("active");b.nextAll().removeClass("active");b.prevAll().removeClass("active");b=b.data("customData");switch(b.id){case "serviceGroup":e.switchToEteamsGroupSession("open",a);break;default:e.ImRecentListCBService.triggerCustomData(b)}});a.off("click.ImAddrList",".j_im-sysmsg").on("click.ImAddrList",".j_im-sysmsg",function(a){a=$(this);$("#"+l.IM_CHATWIN_EL).trigger("saveImChatDraft.ImChatWin");e.openMsgWindowBefore(a);
e.$activeSession=a;var b={imMsgModule:"sys"};b.imSysMsg=a.data("imSysMsg");b.count=a.attr("count");e.openSysWinView(b);e.ImRecentListCBService.clickSysMsgCallback()});a.off("click.ImAddrList",".j_im-return-service-session").on("click.ImAddrList",".j_im-return-service-session",function(a){a.stopPropagation();e.switchToEteamsGroupSession("return")});a.off("click.ImAddrList",".j_im-addrlist-tab").on("click.ImAddrList",".j_im-addrlist-tab",function(b,c){b.stopPropagation();var k=$(this);k.find("div").hasClass("active")||
(a.find(".j_im-addrlist-tab div").removeClass("active"),k.find("div").addClass("active"),k=k.attr("type"),e.renderByTab(k))});a.off("keyup.ImAddrList",".j_im-addrlist-search-input").on("keyup.ImAddrList",".j_im-addrlist-search-input",function(a){var b=$(this);a=a.keyCode;b=$.trim(b.val());13==a?!b||1>b.length?m.notify("\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u5b57"):($(e.el).find(".j_im-addrlist-tab-container").addClass("hide-im"),$(e.el).find(".j_im-list-body .j_im-member-list").addClass("hide-im"),
$(e.el).find(".j_im-addrsearch-container").removeClass("hide-im"),b&&0<b.length&&(e.isSearchList=!0,e.renderSearchList(b))):8!=a&&46!=a||0!=b.length||(e.isSearchList=!1,$(e.el).find(".j_im-addrlist-tab-container").removeClass("hide-im"),$(e.el).find(".j_im-list-body .j_im-member-list").addClass("hide-im"),$(e.el).find(".j_im-list-body .j_im-member-list[type\x3d"+e.chatIndexType+"]").removeClass("hide-im"))});a.off("imSessionDelete.ImAddrList").on("imSessionDelete.ImAddrList",function(a,b){a.stopPropagation();
$(this);var c=b.sessionData,k;switch(c.session_type){case "1":k=c.fuser.uid;break;case "2":case "7":k=c.group_id}var d=$(e.el).find(".j_im-session-container").find(".j_im-session-list");"7"==c.session_type&&(d=$(e.el).find(".j_im-service-session-container .j_im-service-list"));c=d.find("#"+k);e.deleteRecentItem(c);c.remove();m.notify("\u5220\u9664\u6210\u529f")});a.off("click.ImAddrList",".j_address-group-list dl .j_group-list-switch").on("click.ImAddrList",".j_address-group-list dl .j_group-list-switch",
function(a){a.stopPropagation();a=$(this).parents("dl.group");a.hasClass("on")?(a.removeClass("on"),$(e.el).find(".j_groupInviteTip").addClass("hide-im"),$(e.el).find(".j_group-more").addClass("hide-im")):(a.addClass("on"),e.syncAndRenderGroupList())});a.off("recentToTop.ImAddrList").on("recentToTop.ImAddrList",function(a){"#memberlist-wrapper"==$(e.el+" .j_memberTab a.active").data("show")&&e.recentToTop()});a.off("click.ImAddrList",".j_group-more").on("click.ImAddrList",".j_group-more",function(a){a.stopPropagation();
e.turnPageGroup()});a.off("singleChatNotify.ImAddrList").on("singleChatNotify.ImAddrList",function(a,b){a.stopPropagation();var c=b.message,k=c.from_uid;k==window.imCurrentUser.uid&&(k=c.to_uid);var d="1-"+k,w=!1;c.datas.from_uid!=window.imCurrentUser.uid?e.updateRecentByNotify("1",d,c):(d=g.getImChatNoReadCounts(d),d||(d={},d.user={uid:k},d.type="1"),e.updateChatTimeAndSubtitle(d,c.datas),w=!0);e.showTop(k,void 0,void 0,w)});a.off("groupChatNotify.ImAddrList").on("groupChatNotify.ImAddrList",function(a,
b){a.stopPropagation();var c=b.message,k="2-"+c.group_id,d=!1;c.datas.from_uid!=window.imCurrentUser.uid?e.updateRecentByNotify("2",k,c):(k=g.getImChatNoReadCounts(k),k||(k={},k.group_id=c.group_id,k.type="2"),e.updateChatTimeAndSubtitle(k,c.datas),d=!0);e.showTop(c.group_id,void 0,void 0,d)});a.off("serviceGroupChatNotify.ImAddrList").on("serviceGroupChatNotify.ImAddrList",function(a,b){a.stopPropagation();var c=b.message;e.updateServiceGroupSubtitle(c);var k="7-"+c.group_id,d=!1;c.datas.from_uid!=
window.imCurrentUser.uid?e.updateRecentByNotify("7",k,c):(k=g.getImChatNoReadCounts(k),k||(k={},k.group_id=c.group_id,k.type="7"),e.updateChatTimeAndSubtitle(k,c.datas),d=!0);e.showTop(c.group_id,void 0,void 0,d,"7")});a.off("sysMsgNotify.ImAddrList").on("sysMsgNotify.ImAddrList",function(a,b){a.stopPropagation();var c=b.message,k=c.datas.msg_type.group;m.sgroupFilter(k)&&(e.updateRecentByNotify("4","4-sgroup-"+k,c),e.showTop("sgroup-"+k))});a.off("markReadNotify.ImAddrList").on("markReadNotify.ImAddrList",
function(a,b){a.stopPropagation();e.updateNoReadMsgCount(b)});a.off("setTopNotify.ImAddrList").on("setTopNotify.ImAddrList",function(a,b){a.stopPropagation();e.setTopNotify(b)});a.off("showTop.ImAddrList").on("showTop.ImAddrList",function(a,b){a.stopPropagation();e.showTop(b.cloneId)});a.off("imRefreshCount.ImAddrList").on("imRefreshCount.ImAddrList",function(a,b){a.stopPropagation();e.refreshImUnreadCount()});a.off("imSysMsgShowTop.ImAddrList").on("imSysMsgShowTop.ImAddrList",function(a,b){a.stopPropagation();
if(b&&b.sgroupId){var c=$(e.el).find(".j_im-session-container").find(".j_im-session-list");c.find(".j_list-item").removeClass("active");var k="sgroup-"+b.sgroupId,c=c.find("#"+k);0<c.length&&(c=e.showTop(k));e.openMsgWindowBefore(c);e.openSysMsgWindow(b.sgroupId,!0)}});a.off("imChatCorrect.ImAddrList").on("imChatCorrect.ImAddrList",function(a,b){a.stopPropagation();var c=b.chatTypeNo,k={};k.type=c;switch(c){case "1":window.imCurrentUser.uid==b.from_uid?k.user={uid:b.from_uid,cid:b.from_cid}:window.imCurrentUser.uid==
b.to_uid&&(k.user={uid:b.to_uid,cid:b.to_cid});break;case "2":k.group_id=b.group_id}e.updateChatTimeAndSubtitle(k,b)});a.off("updateMarkBackTitle.ImAddrList").on("updateMarkBackTitle.ImAddrList",function(a,b){switch(b.type){case 1:e.updateMarkBackTitle(b);break;case 2:e.updateMarkBackTitle(b)}});a.off("onMasGroupkMsg.ImAddrList").on("onMaskGroupMsg.ImAddrList",e.onMaskGroupMsg);a.off("mousedown.ImAddrList",".j_im-session-opt").on("mousedown.ImAddrList",".j_im-session-opt",function(e){var a=$(this);
3==e.which&&($("#imFuncPanel").trigger("closePanel"),(new b({targetEl:a,pointX:e.pageX,pointY:e.pageY,targetEl:a,funcType:"sessionOpt",sessionData:a.data("data")})).render())});a.off("contextmenu.ImAddrList",".j_im-session-opt").on("contextmenu.ImAddrList",".j_im-session-opt",function(e){e.stopPropagation();e.preventDefault();return!1});a.off("setSessionTop.ImAddrList").on("setSessionTop.ImAddrList",function(a,b){var c=b.sessionData;e.setSessionTop(c,function(a){e.renderSessionTop(c)})});a.off("setUnreadSession.ImAddrList").on("setUnreadSession.ImAddrList",
function(a,b){var c=b.sessionData;e.imRecentListComponent.setUnreadSession(c,function(a){var b;a=!1;switch(c.session_type){case "1":b=c.fuser.uid;break;case "2":b=c.group_id;break;case "7":b=c.group_id,a=!0}e.setUnreadSessionUpdate({sessionType:c.session_type,objId:b,unreadCount:1},!0);a&&(e.imSessionCacheManager.sumServiceSessionUnread(),$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage"))})});a.off("setMsgNoReminder.ImAddrList").on("setMsgNoReminder.ImAddrList",function(a,b){var c=
b.sessionData,k=b.remindFlag;e.setMsgNoReminder(c,k,function(a){e.renderMsgNoReminder(c,k)})});a.off("setMsgNoReminderNotify.ImAddrList").on("setMsgNoReminderNotify.ImAddrList",function(a,b){e.renderMsgNoReminder(b.sessionData,b.remindFlag)});a.off("setUnreadSessionUpdate.ImAddrList").on("setUnreadSessionUpdate.ImAddrList",function(a,b){e.setUnreadSessionUpdate(b)});a.off("setUnreadSessionNotify.ImAddrList").on("setUnreadSessionNotify.ImAddrList",function(a,b){var c=b.info,k,d=!1;switch(c.session_type){case "1":k=
c.fuser.uid;break;case "2":k=c.group_id;break;case "7":k=c.group_id,d=!0}e.setUnreadSessionUpdate({sessionType:c.session_type,objId:k,unreadCount:1},!0);d&&(e.imSessionCacheManager.sumServiceSessionUnread(),$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage"))});a.off("setSysMsgUnreadNotify.ImAddrList").on("setSysMsgUnreadNotify.ImAddrList",function(a,b){$(this);var c=b.data.unread_count,k={sessionType:"4"};k.objId=b.group;k.unreadCount=c;e.setUnreadSessionUpdate(k,!0)});a.off("click.ImAddrList",
".j_im-clear-search-value").on("click.ImAddrList",".j_im-clear-search-value",function(a,b){a.stopPropagation();a.preventDefault();var c=$(this),k=$(e.el).find(".j_panel-search .j_im-addrlist-search-input");k.val("");k.text("");$(e.el).find(".j_im-addrlist-tab-container").removeClass("hide-im");$(e.el).find(".j_im-list-body .j_im-member-list").addClass("hide-im");$(e.el).find(".j_im-list-body .j_im-member-list[type\x3d"+e.chatIndexType+"]").removeClass("hide-im");c.css("display","none");e.isSearchList=
!1});a.off("click.ImAddrList",".j_im-addrlist-search-input").on("click.ImAddrList",".j_im-addrlist-search-input",function(a,b){a.stopPropagation();a.preventDefault();$(e.el).find(".j_im-clear-search-value").css("display","block")});a.off("sysMsgUpdateNotify.ImAddrList").on("sysMsgUpdateNotify.ImAddrList",function(a,b){a.stopPropagation();a.preventDefault();e.sysMsgUpdateNotify(b)});a.off("updateImGroupDetailNotify.ImAddrList").on("updateImGroupDetailNotify.ImAddrList",function(a,b){a.stopPropagation();
a.preventDefault();e.updateImGroupDetailNotify(b)})},initRender:function(e,a){this.render(e,a)},render:function(e,a){var b=this;b.imSessionAllCount();window.imCurrentUser&&!b.imWinComView&&b.renderRecentList(function(){if(b.createType)switch(b.createType){case "imFastChat":case "imFastSys":break;default:var e=window.localStorage.getItem(window.imCurrentUser.uid+"-imClickRemember");e&&(e=JSON.parse(e),b.openRecentWin(e))}else if(e=window.localStorage.getItem(window.imCurrentUser.uid+"-imClickRemember"))e=
JSON.parse(e),b.openRecentWin(e)})},renderHelperGroupList:function(){},turnPage:function(e){switch(this.chatIndexType){case "user":this.addressPageNo&&(this.addressPageNo+=1,this.turnPageAddressList(e));break;case "group":this.indexGroupTurnPage(e);break;case "session":switch(this.chatIndexSessionType){case "session":this.turnPageRecentList(e);break;case "eteamsService":this.turnPageServiceSessionList(e)}}},renderByTab:function(e,a){var b=$(this.el);this.wheelPageUnlLocked=!0;var c=b.find(".j_im-session-container"),
k=b.find(".j_im-addruser-container"),d=b.find(".j_im-addrgroup-container"),b=b.find(".j_im-service-container");b.addClass("hide-im");c.addClass("hide-im");k.addClass("hide-im");d.addClass("hide-im");this.chatIndexType=e;this.addressPageNo=1;switch(e){case "session":switch(this.chatIndexSessionType){case "session":c.removeClass("hide-im");a||this.renderRecentList();break;case "eteamsService":b.removeClass("hide-im"),a||this.switchToEteamsGroupSession("open")}break;case "user":k.removeClass("hide-im");
a||this.syncAndRenderAddrUserList();break;case "group":d.removeClass("hide-im"),a||this.syncAndRenderAddrGroupList()}},renderRecentList:function(e){var a=$(this.el).find(".j_im-session-container").find(".j_im-session-list");a.empty();window.imCurrentUser.hideChat||this.renderRecentListExt(a);this.renderRecentSessions(e);e=$(this.el).find(".j_im-session-container").find(".j_im-recent-ext-list");e.empty();this.ImRecentListCBService.renderCallback(e)},renderRecentSessions:function(e){var a=this;a.imSessionCacheManager.render(function(b){var c=
$(a.el).find(".j_im-session-container").find(".j_im-session-list");a.renderRecentSessionsView(b.sessionArray,!0,b.msgReminderCacheDatas,c);e&&e()})},renderRecentSessionsView:function(e,a,b,c){if(c){var k=c.clone();k.find(".j_list-item:not(.j_im-list-locked)").remove();var d;if(e&&0<e.length){this.minSessionId=e[e.length-1].session_id;for(var f={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[],serviceGroupIdArray:[]},g={userArray:[],groupIdArray:[],sysMsgGroupArray:[],
uidArray:[],sgroupIdArray:[],serviceGroupIdArray:[]},q=0;q<e.length;q++)d=this.renderRecentSessionOne(e[q],k,c,f,g,b);a&&(e=this.sortRecentListDom(k),c.find(".j_list-item:not(.j_im-list-locked)").remove(),c.append(e.children()));e="2";"eteamsService"==this.chatIndexSessionType&&(e="7");this.renderSessionNameTitle(d,c,e);this.$activeSession&&0<this.$activeSession.length&&c.find("#"+this.$activeSession.attr("id")).addClass("active")}}else console.log("$listContainer is undefined")},turnPageRecentSessions:function(e){var a=
$(this.el).find(".j_im-session-container").find(".j_im-session-list"),b;if(e&&0<e.length){this.minSessionId=e[e.length-1].session_id;for(var c={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]},k={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]},d=0;d<e.length;d++)b=this.renderRecentSessionOne(e[d],a,a,c,k);this.sgroupId&&(e=this.showTop("sgroup-"+this.sgroupId),this.openMsgWindowBefore(e),this.openSysMsgWindow(this.sgroupId));e="2";"eteamsService"==
this.chatIndexSessionType&&(e="7");this.renderSessionNameTitle(b,a,e)}},renderSessionNameTitle:function(e,a,b){this.renderSingleChatUser(e.idArrayObj.userArray,a);this.renderGroupChat(e.idArrayObj.groupIdArray,a,b);this.renderSysConfig(e.idArrayObj.sgroupIdArray,a);this.renderLastSingleMsg(e.titleArrayObj.userArray,a);this.renderLastGroupMsg(e.titleArrayObj.groupIdArray,a);this.renderLastSysMsg(e.titleArrayObj.sysMsgGroupArray,a)},renderSingleChatUser:function(e,a){var b=this;g.getBatchImUserInfo(e,
function(e){for(var c=[],k=0;k<e.length;k++){var d=e[k];if(d.uid&&d.cid){"10000"==d.uid&&(d.cid="10000");b.imSessionCacheManager.markSessionOwner("1-"+d.uid,d);c.push(d);var f=$('\x3cdiv id\x3d"'+d.uid+'"\x3e\x3c/div\x3e');b.renderRecentSingleChatOne(f,d,void 0,a,!0)}else console.log("\u5fc5\u8981\u53c2\u6570\u4e3a\u7a7a")}g.setImChatUserCacheList(c)})},renderGroupChat:function(e,a,b){var c=this;if(e&&0<e.length){var k=g.getImChatGroupAllCache(),d={},f=1;e.forEach(function(e){d["groupIdArray-"+f]||
(d["groupIdArray-"+f]=[]);var g=k["imChatGroup-"+e];if(g){b||(b="2");c.imSessionCacheManager.markSessionOwner(b+"-"+g.id,g);var h=$('\x3cdiv id\x3d"'+g.id+'"\x3e\x3c/div\x3e');c.renderRecentGroupChatOne(h,g,a,!0);d["groupIdArray-"+f].push({groupId:e,clientUc:g.clientUc})}else d["groupIdArray-"+f].push({groupId:e,clientUc:"0"});10==d["groupIdArray-"+f].length&&f++});for(e=1;e<=f;e++){var h=d["groupIdArray-"+e];h&&0<h.length&&c.imRecentListComponent.getGroupInfoListReq(h,function(e){for(var k=g.getImChatGroupAllCache(),
d=0;d<e.length;d++){var f=k["imChatGroup-"+e[d].groupId];c.imSessionCacheManager.markSessionOwner(b+"-"+f.id,f);var h=$('\x3cdiv id\x3d"'+f.id+'"\x3e\x3c/div\x3e');c.renderRecentGroupChatOne(h,f,a,!0)}(!e||1>e.length)&&console.log("null group")})}}},renderSysConfig:function(e,a){for(var b=0;b<e.length;b++){var c=e[b],k=a.find("#sgroup-"+c),d={sgroup:c,imgSrc:TEAMS.service.imWebapp+"/static/img/mobile/sysmsg/sgroup_"+c+".png"};this.imSessionCacheManager.markSessionOwner("4-sgroup-"+c,d);this.renderRecentSysMsgOne(k,
d)}},renderRecentListExt:function(e){},renderRecentSessionOne:function(e,a,b,c,k,d){if("1"==e.delta_flag)return{idArrayObj:c,titleArrayObj:k};var f=$(this.el).find("#im-addrlist-clone-field #im-session-one-clone").clone();f.data("data",e);f.attr("session-id",e.session_id);f.attr("last-msg-id",e.last_msgid);var g,q,h=e.session_type;switch(h){case "1":f.find(".j_name").text("\u5355\u4eba\u6d88\u606f");if(window.imCurrentUser.hideChat)return{idArrayObj:c,titleArrayObj:k};f.addClass("j_im-singleChat");
q=e.fuser;g=q.uid;f.attr("cid",q.cid);"10000"==q.uid&&"10000"==q.cid&&f.addClass("j_im-eteams-helper");c.uidArray.push(g);c.userArray.push({uid:q.uid,cid:q.cid});e.title?(b=b.find("#"+g),q=this.renderSessionTitle(f,e),b&&0<b.length&&b.find(".j_info").html(q)):(k.uidArray.push(g),k.userArray.push({uid:q.uid,cid:q.cid}));e.ownerObj&&(f.removeClass("hide-im"),f.attr("id",g),this.renderRecentSingleChatOne(f,e.ownerObj,void 0,a));break;case "2":f.find(".j_name").text("\u7fa4\u7ec4\u6d88\u606f");if(window.imCurrentUser.hideChat)return{idArrayObj:c,
titleArrayObj:k};f.addClass("j_im-groupChat");g=e.group_id;if(e.remind_flag)switch(f.find(".j_atme").addClass("hide-im"),f.find(".j_replyme").addClass("hide-im"),e.remind_flag){case "1":f.find(".j_atme").removeClass("hide-im");break;case "2":f.find(".j_replyme").removeClass("hide-im")}c.groupIdArray.push(e.group_id);e.title?this.renderSessionTitle(f,e):k.groupIdArray.push(e.group_id);break;case "3":f.find(".j_name").text("\u5ba2\u6237\u6d88\u606f");this.serviceGroupId=e.group_id;g="3-serviceGroup";
if(window.imCurrentUser.hideChat)return;f.addClass("j_im-list-locked");f.find(".j_im-portal-recent-delete").remove();f.addClass("j_im-customMsg-trigger");f.removeClass("hide-im");f.attr("id",g);f.addClass("j_custom-serviceGroup");f.find(".info .j_name").text("\u7528\u6237\u54a8\u8be2\u6c47\u603b");f.find(".j_avatar img").attr("src",TEAMS.service.imWebapp+"/static/img/headimg/service_group.png");f.data("customData",{id:"serviceGroup",name:"\u5ba2\u6237\u7fa4\u7ec4",imgSrc:TEAMS.service.imWebapp+"/static/img/headimg/service_group.png",
flag:2});e.title?this.renderSessionTitle(f,e):k.serviceGroupIdArray.push(e.group_id);c.serviceGroupIdArray.push(e.group_id);1>b.find("#3-serviceGroup").length?(b.prepend(f),a.prepend(f.clone())):b.find("#3-serviceGroup").replaceWith(f);break;case "4":f.find(".j_name").text("\u7cfb\u7edf\u6d88\u606f");f.addClass("j_im-sysmsg");b=e.group;g="sgroup-"+b;if(m.sgroupFilter(b))e.title?this.renderSessionTitle(f,e):(q="9223372036854775807","0"!=e.last_msgid&&(q=(parseInt(e.last_msgid)+1).toString()),k.sysMsgGroupArray.push({msgId:q,
sgroup:b}),k.sgroupIdArray.push(b)),q="9223372036854775807","0"!=e.last_msgid&&(q=(parseInt(e.last_msgid)+1).toString()),c.sysMsgGroupArray.push({msgId:q,sgroup:b}),c.sgroupIdArray.push(b),e.ownerObj&&(f.removeClass("hide-im"),f.attr("id",g),this.renderRecentSysMsgOne(f,e.ownerObj));else return{idArrayObj:c,titleArrayObj:k};break;case "7":if(window.imCurrentUser.hideChat)return{idArrayObj:c,titleArrayObj:k};f.addClass("j_im-eteamsService");g=e.group_id;"1"==e.remind_flag&&f.find(".j_atme").removeClass("hide-im");
c.groupIdArray.push(e.group_id);e.title?this.renderSessionTitle(f,e):k.groupIdArray.push(e.group_id);e.ownerObj&&(f.removeClass("hide-im"),f.attr("id",g),this.renderRecentGroupChatOne(f,e.ownerObj,a,void 0,"7"))}f.attr("id",g);f.find(".j_count").text("");f.attr("count",0);if(d){if(d=d[h+"-"+g])switch(d.reminder){case "1":f.find(".j_count").addClass("no-remind"),this.hideRemindBell(f,e.unread_count)}}else if(e.reminder)switch(e.reminder){case "1":f.find(".j_count").addClass("no-remind"),this.hideRemindBell(f,
e.unread_count)}e&&0<e.unread_count&&(d=parseInt(e.unread_count),e.delta_flag="0",f.attr("order",10),h=d,99<d&&(h="99+"),f.find(".j_count").text(h),f.attr("count",d),this.hideRemindBell(f,d));e.orderType&&f.attr("order",9);"1"==e.top_status?(f.attr("order",8),f.addClass("j_im-in-session-top"),f.addClass("list-item-stick")):f.removeClass("list-item-stick");e.update_tm&&(d=m.confirmDate(1E3*e.update_tm),f.find(".j_date").text(d));g=a.find("#"+g);if(1>g.length)"0"==e.delta_flag&&a.append(f);else if(g.hasClass("j_im-list-locked"))return{idArrayObj:c,
titleArrayObj:k};return{idArrayObj:c,titleArrayObj:k,$clone:f}},renderSessionTitle:function(e,a){var b=a.title;if(b){var c;switch(a.session_type){case "1":break;case "4":if(!b.sys)return;switch(b.sys.tpl.toString()){case "1":b.dt[0].txt.v||(b.dt[0].txt.v="\u60a8\u6709\u4e00\u6761\u7cfb\u7edf\u6d88\u606f"),b.sys.et&&(b.dt[0].txt.v=b.sys.et.nm)}c=b.sname;a.fuser&&"10000"==a.fuser.uid&&"10000"==a.fuser.cid&&(c=l.assistantNameObj[window.imCurrentUser.perLang]);break;default:c=b.sname}var d=b.type;if(d){var d=
d.toString(),f="";switch(d){case "1":if("10"==b.typeBak||"12"==b.typeBak)f=m.getMsgContent(b,window.imCurrentUser);else if(d=b.dt[0].txt)f=d.v,d.aus&&0<d.aus.length&&(f=g.completeAtContent(d.aus,f,f,void 0,window.imCurrentUser.perLang).txtValueName),d.i18n&&(b.type="9",f=m.processMsgByType(b));break;case "9":f=m.processMsgByType(b);break;case "10":case "11":b.suid&&window.imCurrentUser.uid==b.suid&&(b.dt[0].txt.i18n+=".self");f=m.processMsgByType(b);break;default:f=m.getLastTxtByMsgType(d)}f=m.initTitle(f);
"1"===b.display?f="["+k.il8n("anonymity")+"] "+f:c&&0<c.length&&(f=c+"\uff1a"+f);"3"==a.session_type?this.imGroupCacheManager.getGroupInfoUcReq(a.group_id,function(a){a=a.name;5<a.length&&(a=a.substring(0,4)+"...");f="["+a+"]"+f;e.find(".j_info").html(f)}):e.find(".j_info").html(f);return f}}},renderRecentSingleChatOne:function(e,a,b,c,k){var d=e.attr("id");c&&!e.attr("session-id")&&(e=c.find("#"+d));if(!(!b&&0<e.length&&e.hasClass("j_im-list-locked")))return e.addClass("j_im-singleChat"),e.removeClass("hide-im"),
e.find(".info .j_name").text(a.name),"10000"==a.uid&&"10000"==a.cid?(e.find(".info .j_name").text(l.assistantNameObj[window.imCurrentUser.perLang]),a.imgSrc="/static/img/global/avatar_assistant.png"):a.avatar?a.imgSrc="/base/download/"+a.avatar:!b&&1E5<d&&(a.imgSrc="/static/images/avatar.png"),e.find(".j_avatar img").attr("src",a.imgSrc),e.data("chatType","singleChat"),e.data("imChatUser",a),window.imCacheData.imChatValCache&&window.imCacheData.imChatValCache["1-"+a.uid+"-"+a.cid]&&(b=window.imCacheData.imChatValCache["1-"+
a.uid+"-"+a.cid].content,e&&0<e.length&&(e.find(".j_draft").removeClass("hide-im"),e.find(".j_draft-text").removeClass("hide-im"),e.find(".j_draft-text").text(b),e.find(".j_info").addClass("hide-im"))),k||(a=g.getImChatNoReadCounts("1-"+a.id),e.attr("count",0),e.find(".j_count").text(""),a&&0<a.count?(k=a.count,99<a.count&&(k="99+"),e.find(".j_count").text(k),e.attr("count",a.count),this.hideRemindBell(e,a.count)):this.hideRemindBell(e,0)),e},renderRecentGroupChatOne:function(e,a,b,c,k){var d=e.attr("id");
b&&!e.attr("session-id")&&(e=b.find("#"+d));e.removeClass("hide-im");b=b.find("#"+a.id);0<b.length&&(e=b);if(e.hasClass("j_im-list-locked")){if(b=e.find(".j_info").text())a&&a.name&&5<a.name.length&&(b="["+a.name.substring(0,4)+"...]"+b),e.find(".j_info").text(b)}else e.addClass("j_im-groupChat"),e.find(".info .j_name").text(a.name),b=TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png",a.avatar&&0<a.avatar.length&&(b="/base/download/"+a.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID),
a.imgSrc=b,e.find(".j_avatar img").attr("src",b),e.data("chatType","groupChat"),e.data("imChatGroup",a);if(a.mask)switch(a.mask){case "1":e.find(".j_entity-mark-tag").removeClass("hide-im")}window.imCacheData.imChatValCache&&window.imCacheData.imChatValCache["2-"+a.id]&&(b=window.imCacheData.imChatValCache["2-"+a.id].content,e&&0<e.length&&(e.find(".j_draft").removeClass("hide-im"),e.find(".j_draft-text").removeClass("hide-im"),e.find(".j_draft-text").text(b),e.find(".j_info").addClass("hide-im")));
c||(k?"7"==k&&e.addClass("j_im-eteamsService"):k="2",a=g.getImChatNoReadCounts(k+"-"+a.id,k),e.attr("count",0),e.find(".j_count").text(""),a&&0<a.count?(c=a.count,99<a.count&&(c="99+"),e.find(".j_count").text(c),e.attr("count",a.count),this.hideRemindBell(e,a.count)):this.hideRemindBell(e,0))},renderRecentSysMsgOne:function(e,a,b){e.addClass("j_im-sysmsg");e.removeClass("hide-im");b=g.getImSysMsgConfig("sgroupMap","sgroup")[a.sgroup];var c=b.name,k=c.zh_cn;c[window.imCurrentUser.perLang.toLocaleLowerCase()]&&
(k=b.name[window.imCurrentUser.perLang.toLocaleLowerCase()]);e.find(".info .j_name").text(k);e.find(".j_avatar img").attr("src",a.imgSrc);a.subtitle&&(a.subtitle=m.initTitle(a.subtitle),e.find(".j_info").html(a.subtitle));a.time&&(b=m.confirmDate(1E3*a.time),e.find(".j_date").text(b));e.data("imSysMsg",a);e.attr("count","0");e.find(".j_count").text("");(a=g.getImSysMsgNoReadCounts("4-sgroup-"+a.sgroup))&&0<a.count?(b=a.count,99<a.count&&(b="99+"),e.find(".j_count").text(b),e.attr("count",a.count),
this.hideRemindBell(e,a.count)):this.hideRemindBell(e,0)},renderRecentCustomOne:function(e,a,b){e.addClass("j_im-customMsg-trigger");e.removeClass("hide-im");e.attr("id",a.id);e.addClass("j_custom-"+a.id);e.find(".info .j_name").text(a.name);a.subtitle&&(a.subtitle=m.initTitle(a.subtitle));e.find(".j_info").html(a.subtitle);e.find(".j_avatar img").attr("src",a.imgSrc);e.data("customData",a)},renderLastSysMsg:function(e,a){if(e&&0<e.length){var b=this,c={};c.sysMsgGroupArray=e;b.imRecentListComponent.getSysMsgGroupSubtitle(c,
function(e){if((e=e.message.datas)&&0<e.length)for(var c=0;c<e.length;c++){var k=e[c];b.renderLastSysMsgOne(k.msg_type.group,k,a)}})}},renderLastSysMsgOne:function(e,a,b,c){var d=a.msg,f=a.ser_msgid,h=d.dt[0].txt;h.v||(h.v="");h.v=h.v.replace(/</g,"\x26lt").replace(/>/g,"\x26gt").replace(/\r\n|\n/g,"");var l=m.processMsgByType(d,null,!1);if(d.sys.tpl)switch(d.sys.tpl){case "1":l=d.sys.et.nm}h.aus&&0<h.aus.length&&(l=g.completeAtContent(h.aus,l,l,void 0,window.imCurrentUser.perLang).txtValueName);
"1"===d.display?l="["+k.il8n("anonymity")+"] "+l:d.sname&&0<d.sname.length&&(l=d.sname+"\uff1a"+l);d=b.find("#sgroup-"+e);1>d.length&&(d=$(this.el).find("#im-addrlist-clone-field #im-session-one-clone").clone().attr("id","sgroup-"+e),b.append(d),this.renderRecentSysMsgOne(d,{sgroup:e,imgSrc:TEAMS.service.imWebapp+"/static/img/mobile/sysmsg/sgroup_"+e+".png"}));d.attr("last-msg-id",f);d.find(".j_info").html(l);a.msgtime&&(a=m.confirmDate(1E3*a.msgtime),d.find(".j_date").text(a));a=d.attr("order");
(e=this.imSessionCacheManager.getMsgRemindCacheData("4-sgroup-"+e))&&"1"==e.reminder&&d.find(".j_count").addClass("no-remind");c&&(this.hideRemindBell(d,c),0<c&&a&&100==parseInt(a)&&d.attr("order",10));return d},renderLastSingleMsg:function(e,a){if(!(void 0==e||1>e.length)){var b=this,c={},k=1;e.forEach(function(e){c["userArray-"+k]||(c["userArray-"+k]=[]);e&&c["userArray-"+k].push(e);10==c["userArray-"+k].length&&k++});for(var d=1;d<=k;d++){var f=c["userArray-"+d];f&&0<f.length&&b.imRecentListComponent.syncLastSingleMsg(f,
function(e){e=e.message.datas;for(var c=0;c<e.length;c++){var k=e[c];k.datas&&b.renderLastSingleMsgOne(k.datas[0],a)}})}}},renderLastSingleMsgOne:function(e,a,b,c){var k=this,d,f=!1,h={};c?(d=c.uid,h=c):e.from_uid==window.imCurrentUser.uid?(f=!0,d=e.to_uid,h={uid:e.to_uid,cid:e.to_cid}):(d=e.from_uid,h={uid:e.from_uid,cid:e.from_cid});var q=a.find("#"+d);1>q.length&&(q=$(k.el).find("#im-addrlist-clone-field #im-session-one-clone").clone().attr("id",d),a.append(q),f&&1>a.find(".j_list-item.active").length&&
q.addClass("active"),g.getImUserInfo(h,function(e){k.renderRecentSingleChatOne(q,e,void 0,void 0)}));f&&(q.find(".j_draft").addClass("hide-im"),q.find(".j_draft-text").addClass("hide-im"));if(a=e.msg.type){a=a.toString();c="";switch(a){case "1":c=m.getMsgContent(e.msg,window.imCurrentUser);break;case "10":e.msg&&window.imCurrentUser.uid==e.msg.suid&&(e.msg.dt[0].txt.i18n="im.chat.b.self");c=m.processMsgByType(e.msg);break;case "11":e.msg&&window.imCurrentUser.uid==e.msg.suid&&(e.msg.dt[0].txt.i18n=
"im.chat.sk.self");c=m.processMsgByType(e.msg);break;case "12":c=m.getMsgContent(e.msg,window.imCurrentUser);break;default:c=m.getLastTxtByMsgType(a)}c=m.initTitle(c);q.find(".j_info").html(c);a=m.confirmDate(1E3*e.msgtime);q.find(".j_date").text(a);q.attr("last-msg-id",e.ser_msgid);e=q.attr("order");(d=k.imSessionCacheManager.getMsgRemindCacheData("1-"+d))&&"1"==d.reminder&&q.find(".j_count").addClass("no-remind");k.hideRemindBell(q,b);b&&0<b&&e&&100==parseInt(e)&&q.attr("order",10);return q}},renderLastGroupMsg:function(e,
a){if(!(void 0==e||1>e.length)){var b=this,c={},k=1;e.forEach(function(e){c["groupIdArray-"+k]||(c["groupIdArray-"+k]=[]);e&&c["groupIdArray-"+k].push(e);10==c["groupIdArray-"+k].length&&k++});for(var d=1;d<=k;d++){var f=c["groupIdArray-"+d];f&&0<f.length&&(f={groupIdArray:f,isHelper:!1},"eteamsService"==b.chatIndexSessionType&&(f.isHelper=!0),b.imRecentListComponent.syncLastGroupMsg(f,function(e){if((e=e.message.datas)&&0<e.length)for(var c=0;c<e.length;c++){var k=e[c];k.datas&&0<k.datas.length&&
b.renderLastGroupMsgOne(k.group_id,k.datas[0],a)}}))}}},renderLastGroupMsgOne:function(e,a,b,c,d,f){var h=this,l=b.find("#"+e),q=!1;a.from_uid==window.imCurrentUser.uid&&(q=!0);1>l.length&&(l=$(h.el).find("#im-addrlist-clone-field #im-session-one-clone").clone().attr("id",e),b.append(l),q&&1>b.find(".j_list-item.active").length&&l.addClass("active"),q&&(l.find(".j_draft").addClass("hide-im"),l.find(".j_draft-text").addClass("hide-im")),h.imGroupCacheManager.getGroupInfoUcReq(e,function(e){e&&h.renderRecentGroupChatOne(l,
e,b,void 0,f)}));var z=a.msg.type;if(z){z=z.toString();q="";switch(z){case "1":"10"==a.msg.typeBak||"12"===a.typeBak?q=m.getMsgContent(a.msg,window.imCurrentUser):(z=a.msg.dt[0].txt,q=z.v,l.find(".j_atme").addClass("hide-im"),l.find(".j_replyme").addClass("hide-im"),z.aus&&0<z.aus.length&&(z=g.completeAtContent(z.aus,q,q,null,window.imCurrentUser.perLang,!0),q=z.txtValueName,z.isAtme&&c&&l.find(".j_atme").removeClass("hide-im")),a.msg.rmsg&&(c=a.msg.rmsg.fuser,c.uid==window.imCurrentUser.uid&&c.cid==
window.imCurrentUser.cid&&l.find(".j_replyme").removeClass("hide-im")));break;case "10":q=m.getMsgContent(a.msg,window.imCurrentUser);break;case "11":window.imCurrentUser.uid==a.msg.suid&&(a.msg.dt[0].txt.i18n="im.chat.sk.self");q=m.processMsgByType(a.msg);break;case "12":q=m.getMsgContent(a.msg,window.imCurrentUser);break;default:q=m.getLastTxtByMsgType(z)}"1"===a.msg.display?q="["+k.il8n("anonymity")+"] "+q:a.msg.sname&&(q=a.msg.sname+"\uff1a"+q);q=m.initTitle(q);l.find(".j_info").html(q);c=m.confirmDate(1E3*
a.msgtime);l.find(".j_date").text(c);l.attr("last-msg-id",a.ser_msgid);a=l.attr("order");(e=h.imSessionCacheManager.getMsgRemindCacheData("2-"+e))&&"1"==e.reminder&&l.find(".j_count").addClass("no-remind");h.hideRemindBell(l,d);d&&0<d&&a&&100==parseInt(a)&&l.attr("order",10);return l}},renderSearchList:function(e){var a=this,b=$(a.el).find(".j_im-addrsearch-container"),c=b.find(".j_im-addrsearch-list");c.empty();b.find(".j_no-result").removeClass("hide-im");if(e&&0<e.length){var k={pageNo:1,pageSize:20};
k["employee.username"]=e.trim();k["employee.status"]="normal";k["employee.extra"]=!1;k.isContainsSub=!0;a.imRecentListComponent.queryChatUserByName(k,function(e){if((e=e.page.result)&&0<e.length)for(var k=0;k<e.length;k++)b.find(".j_no-result").addClass("hide-im"),a.renderSearchUserOne(e[k],c)});e={queryName:e.trim()};a.imRecentListComponent.searchChatGroupByName(e,function(e){a.renderSearchGroupList(e.message.datas,null,b)})}},renderSearchGroupList:function(e,a,b,c){if(e&&0<e.length){b&&(a=$(this.el).find(".j_im-addrsearch-container .j_im-addrsearch-list"),
b.find(".j_no-result").addClass("hide-im"));e=m.sortBy(e,"add_time");b=[];for(var k=0;k<e.length;k++)b.push({groupId:e[k].group_id}),this.renderGroupListOne(e[k],a);this.renderGroupListAvatar(b,a)}c&&c(e)},renderGroupList:function(e,a,b,c){if(e&&0<e.length){b&&(a=$(this.el).find(".j_im-addrsearch-container .j_im-addrsearch-list"),b.find(".j_no-result").addClass("hide-im"));e=m.sortBy(e,"add_time");b=10;11>e.length&&(b=e.length);for(var k=[],d=0;d<b;d++)k.push({groupId:e[d].group_id}),this.renderGroupListOne(e[d],
a);this.renderGroupListAvatar(k,a)}c&&c(e)},renderGroupListAvatar:function(e,a){var b=g.getImChatGroupAllCache();e&&0<e.length&&(e.forEach(function(e){var a="imChatGroup-"+e.groupId;e.clientUc=b[a]?b[a].clientUc:"0"}),this.imRecentListComponent.getGroupInfoListReq(e,function(e){e.forEach(function(e){var b=g.getImChatGroupAllCache()["imChatGroup-"+e.groupId];b&&b.avatar&&0<b.avatar.length&&(b="/base/download/"+b.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID,e=a.find("#"+e.groupId),e.find(".j_avatar img").attr("src",
b),e.data("imChatGroup").imgSrc=b)})}))},renderSearchUserOne:function(e,a){var b=$(this.el).find("#im-addrlist-clone-field #im-address-user-clone").clone().attr("id",e.id);b.addClass("j_im-addr-searchone");var c={id:e.id,uid:e.id,cid:window.imCurrentUser.cid,name:e.username};e.avatar&&(c.avatar=e.avatar.p5);b.data("imChatUser",c);b.data("chatType","singleChat");b.find(".j_name").attr("title",c.name).text(c.name);if(c.avatar){var k="/base/download/"+c.avatar;b.find(".j_avatar img").attr("src",k);c.imgSrc=
k}b.attr({id:c.id,"data-entity":"employee"});a.prepend(b)},syncAndRenderAddrUserList:function(){var e=this,a={};a.pageNo=e.addressPageNo;a.pageSize=20;a["employee.status"]="normal";a["employee.extra"]=!1;a.isContainsSub=!0;var b=$(e.el).find(".j_im-addruser-container");b.removeClass("hide-im");var c=b.find(".j_im-addruser-list");c.empty();e.imRecentListComponent.loadMembers(a,function(a){e.singleChatListConfig&&0<e.singleChatListConfig.length&&e.renderAddressExt(e.singleChatListConfig,c);e.renderAddressList(a,
c,b)})},syncAndRenderAddrGroupList:function(){var e=this,a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type="0";a.pageSize="20";var b=$(e.el).find(".j_im-addrgroup-container");b.find(".loading_small").removeClass("hide-im");e.imWebReqMethods.syncGroupListByPageReq(a,function(a){b.find(".loading_small").addClass("hide-im");a=a.message.datas;b.find(".j_chat-index-list div").detach();var c=b.find(".j_im-addrgroup-list");c.empty();a&&0<a.length?(a=m.sortBy(a,"add_time"),e.pageDownAddTime=
a[a.length-1].add_time,e.renderIndexGroupList(a,c),b.find(".j_no-result").addClass("hide-im")):b.find(".j_no-result").removeClass("hide-im")})},renderIndexGroupList:function(e,a){if(e&&0<e.length){for(var b=[],c=0;c<e.length;c++){var k=e[c];b.push({groupId:k.group_id});this.renderIndexGroupListOne(k,a)}this.renderGroupListAvatar(b,a)}setTimeout(function(){$("#im-chat-index .scrollwrapper").trigger("resizeSroll",{resizeImScroll:!0})},310)},renderIndexGroupListOne:function(e,a){var b=a.find("#"+e.group_id);
if(b&&0<b.length)return b;var b=$(this.el).find("#im-addrlist-clone-field #im-address-group-clone").clone().attr("id",e.group_id),c={id:e.group_id,name:e.name,avatar:e.avatar,exist:"1",imgSrc:TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png"};c.avatar&&(c.imgSrc="/base/download/"+c.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID);b.find(".j_avatar img").attr("src",c.imgSrc);b.data({chatType:"groupChat",imChatGroup:c});c.name&&(b.find(".j_name").text(c.name),b.find(".j_name").attr("title",
c.name));a.append(b);return b},renderAddressList:function(e,a,b){var c=[];e=e.page;for(var k=0;k<e.result.length;k++){var d=e.result[k];c.push({uid:d.id,cid:window.imCurrentUser.cid});this.renderAddressOne(d,a)}this.renderUserStatus(c,a,b);b.find(".j_address-more").addClass("hide");20>e.result.length?this.addressPageNo=void 0:b.find(".j_address-more").removeClass("hide");b.find(".j_address-more").attr("pageNo",this.addressPageNo)},renderUserStatus:function(e,a,b){this.imRecentListComponent.renderUserStatus({users:e},
function(e){e&&0<e.length&&e.forEach(function(e){var b=a.find("#"+e.user.uid).find(".j_user-status-dev").removeClass("hide-im");b.removeClass("offline");switch(e.status){case "0":b.addClass("offline");b.attr("data-original-title","\u8be5\u7528\u6237\u4e0d\u5728\u7ebf");break;case "1":if(-1<["0","5","7","9"].indexOf(e.dev))b.addClass("pc"),b.attr("data-original-title","\u7535\u8111\u7aef\u5728\u7ebf");else switch(b.addClass("mobile"),e.dev){case "1":e={zh_cn:"android\u79fb\u52a8\u7aef\u5728\u7ebf",
zh_tw:"android\u79fb\u52d5\u7aef\u5728\u7dda",en_us:"android online"};b.attr("title",e[window.imCurrentUser.perLang]);break;case "2":e={zh_cn:"iphone\u79fb\u52a8\u7aef\u5728\u7ebf",zh_tw:"iphone\u79fb\u52d5\u7aef\u5728\u7dda",en_us:"iphone online"};b.attr("data-original-title",e[window.imCurrentUser.perLang]);break;default:b.attr("data-original-title","\u7528\u6237\u79fb\u52a8\u7aef\u5728\u7ebf")}break;case "2":switch(e.dev){case "5":e={zh_cn:"\u7528\u6237\u7684web\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",
zh_tw:"The user's web client is left",en_us:"\u7528\u6236\u7684web\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"};b.attr("title",e[window.imCurrentUser.perLang]);break;default:e={zh_cn:"\u7528\u6237\u7684\u7535\u8111\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",zh_tw:"The user's computer terminal is left",en_us:"\u7528\u6236\u7684\u96fb\u8166\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"}}b.attr("data-original-title",e[window.imCurrentUser.perLang]);b.addClass("leave");break;case "8":b.attr("data-original-title",
"\u7528\u6237\u79bb\u7ebf\u4f46\u53ef\u4ee5\u63a5\u6536\u5230\u79bb\u7ebf\u6d88\u606f\u63a8\u9001"),b.addClass("push")}})})},turnPageAddressList:function(e){var a=this,b={};b.pageNo=a.addressPageNo;b.pageSize=20;b["employee.status"]="normal";b["employee.extra"]=!1;b.isContainsSub=!0;var c=$(a.el).find(".j_im-addruser-container");c.removeClass("hide-im");var k=$(a.el).find(".j_im-addruser-container .j_im-addruser-list");a.imRecentListComponent.loadMembers(b,function(b){a.renderAddressList(b,k,c);e&&
e()})},turnPageRecentList:function(e){var a=this,b={sessionType:"0"};b.sessionId=a.minSessionId;b.pageSize=10;a.imSessionCacheManager.turnPage(b,function(b){a.turnPageRecentSessions(b.sessionArray);e&&e()})},turnPageServiceSessionList:function(e){var a=this,b={sessionType:"7"};b.sessionId=a.minSessionId;b.pageSize=10;b.isHelper=!0;a.imSessionCacheManager.turnPage(b,function(b){a.turnPageRecentSessions(b.sessionArray);e&&e()})},indexGroupTurnPage:function(e){var a=this,b={};b.uid=window.imCurrentUser.uid;
b.cid=window.imCurrentUser.cid;b.type="0";b.pageSize="20";b.addTime=a.pageDownAddTime;var c=$(a.el).find(".j_im-addrgroup-container");a.imWebReqMethods.syncGroupListByPageReq(b,function(b){if((b=b.message.datas)&&0<b.length){b=m.sortBy(b,"add_time");a.pageDownAddTime=b[b.length-1].add_time;var k=c.find(".j_im-addrgroup-list");a.renderIndexGroupList(b,k);19<b.length&&e&&e()}})},renderAddressExt:function(e,a){var b=$(this.el).find("#im-addrlist-clone-field #im-pinyin-clone").clone().attr("id","pinyin-system");
b.find("dt").text("\u7cfb\u7edf");a.append(b);for(var c=0;c<e.length;c++){var k=e[c],d={id:k.id,uid:k.id,cid:k.cid,name:k.name,imgSrc:k.imgSrc,flag:"1"},f=$(this.el).find("#im-addrlist-clone-field #im-address-user-clone").clone().attr("id",d.id);f.data("imChatUser",d);f.data("chatType","singleChat");f.addClass("j_im-eteams-helper");f.find(".j_name").attr("title",d.name).text(d.name);f.find(".j_avatar img").attr("src",k.imgSrc);f.attr({id:d.id,"data-entity":"employee"});b.append(f)}},renderAddressOne:function(e,
a){var b=$.trim(e.pinyin);if(!b||1>b.length){var c=a.find("#pinyin-system");c.removeClass("hide-im")}if(b){b=b.substring(0,1).toLocaleUpperCase();/[a-zA-Z]$/.test(b)||(b="degit");var k="pinyin-"+b,c=a.find("#"+k);c.removeClass("hide-im");b&&1>c.length&&(c=$(this.el).find("#im-addrlist-clone-field #im-pinyin-clone").clone().attr("id",k),c.find(".j_group-head").text(b),"degit"==b&&c.find(".j_group-head").text("#"),a.append(c))}b=$(this.el).find("#im-addrlist-clone-field #im-address-user-clone").clone().attr("id",
e.id);k={id:e.id,uid:e.id,cid:window.imCurrentUser.cid,name:e.name,avatar:e.avatar};b.find(".j_user-status-dev").removeClass("hide-im");b.data("imChatUser",k);b.data("chatType","singleChat");b.find(".j_name").attr("title",k.name).text(k.name);if(k.avatar&&k.avatar.p5){var d="/base/download/"+k.avatar.p5;b.find(".j_avatar img").attr("src",d);k.imgSrc=d}b.attr({id:k.id,"data-entity":"employee"});c.append(b)},turnPageGroup:function(){var e=this,a=$(e.el).find(".j_im-addruser-container .j_address-group-list .j_list-dl");
a.find(".j_employ_group .loading_small").removeClass("hide-im");var b={};b.maxGroupId=e.pageDownAddTime;e.imRecentListComponent.syncGroupListByPageReq(b,function(b){a.find(".j_employ_group .loading_small").addClass("hide-im");var c=a.find(".j_group-list");e.renderGroupList(b.message.datas,c,null,function(b){b&&(10<b.length?(a.find(".j_group-more").removeClass("hide-im"),a.find(".j_group-more").removeClass("hide-im"),e.pageDownAddTime=b[b.length-2].add_time):(e.pageDownAddTime="0",a.find(".j_group-more").addClass("hide-im")))})})},
syncAndRenderGroupList:function(){var e=this,a=$(e.el).find(".j_im-addruser-container .j_address-group-list .j_list-dl");a.find(".j_employ_group .loading_small").removeClass("hide-im");e.imRecentListComponent.syncGroupListByPageReq({},function(b){a.find(".j_employ_group .loading_small").addClass("hide-im");var c=a.find(".j_group-list");c.find("dd").detach();e.renderGroupList(b.message.datas,c,null,function(b){b?10<b.length?(a.find(".j_group-more").removeClass("hide-im"),a.find(".j_group-more").removeClass("hide-im"),
e.pageDownAddTime=b[b.length-2].add_time):(e.pageDownAddTime="0",a.find(".j_group-more").addClass("hide-im"),a.find(".j_group-more").addClass("hide-im")):a.find(".jgroupInviteTip").removeClass("hide-im")})})},openMsgWindowBefore:function(e,a){var b=$(this.el).find(".j_im-session-container .j_im-session-list .j_list-item"),c=$(this.el).find(".j_im-addruser-container .j_im-addruser-list .j_list-item"),k=$(this.el).find(".j_im-addrgroup-container .j_im-addrgroup-list .j_list-item");0<b.length&&b.removeClass("active");
0<c.length&&c.removeClass("active");0<k.length&&k.removeClass("active");if(a)switch(a){case "serviceGroup":this.$activeSession=void 0}else e&&(e.addClass("active"),e.nextAll().removeClass("active"),e.prevAll().removeClass("active")),this.imWinComView&&(this.imWinComView.remove(),this.imWinComView=void 0)},renderGroupListOne:function(e,a){var b=$(this.el).find("#im-addrlist-clone-field #im-address-group-clone").clone().attr("id",e.group_id);b.addClass("j_im-addr-searchone");e.name&&(b.find(".j_name").text(e.name),
b.find(".j_name").attr("title",e.name));var c={id:e.group_id,name:e.name,avatar:e.avatar,type:e.type,exist:"1",imgSrc:TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png"};"1"==c.type&&b.addClass("j_im-eteamsService");b.find(".j_avatar img").attr("src",c.imgSrc);b.data({chatType:"groupChat",imChatGroup:c});a.append(b);return b},deleteGroupListOne:function(e,a,b){g.delImChatGroupCache(e.group_id);b=b.find("#"+e.group_id);this.deleteRecentItem(b);b.remove();a.find("#"+e.group_id).remove();
e=a.find(".j_list-item");(!e||1>e.length)&&a.find(".j_no-result").removeClass("hide-im");$("#"+l.IM_FRAME_EL).find("#im-noresult-container").removeClass("hide-im");$("#"+l.IM_FRAME_EL).find("#im-wincom-container").addClass("hide-im")},renderChannelMembers:function(e){if(e){for(var a="",b=0;b<e.length-1;b++)a=a+e[b].username+",";return a+=e[e.length-1].username}},recentToTop:function(){var e=$(this.el).find(".j_list-item.active"),a=$("#j_communi-menu").find(".j_mesRecent div").eq(0);e.attr("id")!=
a.attr("id")&&a.before(e)},updateNoReadMsgCount:function(e){var a=e.type,b=e.count,c;switch(a){case "1":c=e.user.uid;break;case "3":c="3-serviceGroup";break;case "2":case "7":c=e.group_id;break;case "4":c="sgroup-"+e.sgroup}e=$(this.el).find(".j_im-session-container").find(".j_im-session-list");"7"==a&&(e=$(this.el).find(".j_im-service-session-container").find(".j_im-service-list"));0<e.length&&0<e.find("#"+c).length&&(a=e.find("#"+c),a.attr("count",b),a.find(".j_count").text(""),this.hideRemindBell(a,
parseInt(b)),0<parseInt(b)?(c=b,99<parseInt(b)&&(c="99+"),a.find(".j_count").text(c)):(a.find(".j_atme").addClass("hide-im"),a.find(".j_replyme").addClass("hide-im"),a.find(".j_count").text(""),(b=a.attr("order"))&&10==parseInt(b)&&a.attr("order",100)))},setTopNotify:function(e){this.renderSessionTop(e.info)},updateRecentByNotify:function(e,a,b){switch(e){case "4":e=g.getImSysMsgNoReadCounts(a);break;case "7":e=g.getImServiceGroupNoReadCounts(a);break;default:e=g.getImChatNoReadCounts(a)}this.updateChatTimeAndSubtitle(e,
b.datas);this.updateNoReadMsgCount(e)},updateServiceGroupSubtitle:function(e){var a=e.datas;e=e.group_id;var b=a.msg,c="",d=b.type;if(d){d=d.toString();switch(d){case "1":c=m.getMsgContent(b,window.imCurrentUser);b.dt[0].txt.aus&&b.dt[0].txt.aus.length&&(c=g.completeAtContent(b.dt[0].txt.aus,c,c,void 0,window.imCurrentUser.perLang).txtValueName);break;case "10":b&&window.imCurrentUser.uid==b.suid&&(b.dt[0].txt.i18n="im.chat.b.self");c=m.processMsgByType(b);break;case "11":b&&window.imCurrentUser.uid==
b.suid&&(b.dt[0].txt.i18n="im.chat.sk.self");c=m.processMsgByType(b);break;default:c=m.getLastTxtByMsgType(d)}c=m.initTitle(c);c="1"===b.display?"["+k.il8n("anonymity")+"] "+c:b.sname+"\uff1a"+c}var b=$(this.el).find(".j_im-session-container").find(".j_im-session-list"),f=b.find(".j_custom-serviceGroup");f&&0<f.length?(a.msgtime&&(a=m.confirmDate(1E3*a.msgtime),f.find(".j_date").text(a)),this.imGroupCacheManager.getGroupInfoUcReq(e,function(a){a&&a.name&&5<a.name.length&&(c="["+a.name.substring(0,
4)+"...]"+c,f.find(".j_info").html(c))}),a=g.getImChatNoReadCounts("3-serviceGroup"),this.updateNoReadMsgCount(a)):(f=$(this.el).find("#im-addrlist-clone-field #im-session-one-clone").clone(),this.imGroupCacheManager.getGroupInfoUcReq(e,function(a){a&&a.name&&5<a.name.length&&(c="["+a.name.substring(0,4)+"...]"+c,f.find(".j_info").html(c))}),window.imCurrentUser.hideChat||(f.addClass("j_im-list-locked"),f.find(".j_im-portal-recent-delete").remove(),f.addClass("j_im-customMsg-trigger"),f.removeClass("hide-im"),
f.attr("id","3-serviceGroup"),f.addClass("j_custom-serviceGroup"),f.find(".info .j_name").text("\u7528\u6237\u54a8\u8be2\u6c47\u603b"),f.find(".j_avatar img").attr("src",TEAMS.service.imWebapp+"/static/img/headimg/service_group.png"),f.data("customData",{id:"serviceGroup",name:"\u7528\u6237\u54a8\u8be2\u6c47\u603b",imgSrc:TEAMS.service.imWebapp+"/static/img/headimg/service_group.png",flag:2}),1>b.find("#3-serviceGroup").length&&b.prepend(f),a=g.getImChatNoReadCounts("3-serviceGroup"),this.updateNoReadMsgCount(a)))},
updateChatTimeAndSubtitle:function(a,b){var c=a.type,k,d=$(this.el).find(".j_im-session-container").find(".j_im-session-list");"7"==c&&(d=$(this.el).find(".j_im-service-session-container").find(".j_im-service-list"));var f;switch(c){case "1":k=a.user.uid;var g;"10000"==k&&(g=a.user);f=this.renderLastSingleMsgOne(b,d,a.count,g);break;case "2":case "7":k=a.group_id;f=!0;window.imCurrentUser.uid==b.from_uid&&(f=!1);f=this.renderLastGroupMsgOne(k,b,d,f,a.count,c);break;case "4":f=a.sgroup,k="sgroup-"+
f,f=this.renderLastSysMsgOne(f,b,d,a.count)}f&&((d=f.data("data"))&&!d.top_status?d.top_status="0":!d&&(c=this.imSessionCacheManager.getSessionCache(c+"-"+k,c))&&(c.top_status="0",f.data("data",c)))},showTop:function(a,b,c,k,d){var f=this,g=!1;if(a&&(k=$(f.el).find(".j_im-session-list"),c&&"7"==c.session_type?k=$(f.el).find(".j_im-service-session-container").find(".j_im-service-list"):"7"==d&&(k=$(f.el).find(".j_im-service-session-container").find(".j_im-service-list")),d=k.find("#"+a),!d.hasClass("j_im-list-locked"))){8==
d.attr("order")&&(b=!0);if(0<d.length){k.find("#"+d.attr("id")).detach();var h;if(b){c&&d.data("data",c);d.attr("order",8);d.addClass("list-item-stick");h=k.find(".j_list-item.j_im-in-session-top");if(!h||1>h.length)g=!0;d.addClass("j_im-in-session-top")}else g=!0;if(g){h=k.find(".j_list-item[order\x3d8]");if(!h||1>h.length)h=k.find(".j_list-item.j_im-list-locked"),(!h||1>h.length)&&k.prepend(d);h&&0<h.length&&k.find("#"+h[h.length-1].id).after(d)}else{k=!1;for(b=0;b<h.length;b++)if(g=$(h[b]),d.attr("last-msg-id")>
g.attr("last-msg-id")){g.before(d);k=!0;break}k||$(h[h.length-1]).after(d)}return d}h={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]};d={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]};b=$("\x3cdiv\x3e\x3c/div\x3e");c&&(h=f.renderRecentSessionOne(c,b,b,h,d),h.$clone.removeClass("j_im-in-session-top"),k.append(h.$clone),f.renderSessionNameTitle(h,k),f.imSessionCacheManager.insertSessionData(a,c),setTimeout(function(){f.showTop(a,!0,c)},
500))}},cancelTop:function(a,b){if(a){var c=$(this.el).find(".j_im-session-list");"7"==b.session_type&&(c=$(this.el).find(".j_im-service-session-container").find(".j_im-service-list"));var k=c.find("#"+a);if(0<k.length){var d;k.removeClass("j_im-in-session-top");b&&k.data("data",b);var f=100,f=0<b.unread_count?10:100;d=c.find('.j_list-item[order\x3d"'+f+'"]:not(.j_im-list-locked):not(.hide)');k.attr("order",f);k.addClass("hide-im");k.removeClass("list-item-stick");var g=!1,h=!1;if(d&&0<d.length)for(var h=
!0,q=0;q<d.length;q++){var l=$(d[q]);if(k.attr("last-msg-id")>l.attr("last-msg-id")){g=!0;l.before(k);break}}if(!g)if(h)d=d[d.length-1],c.find("#"+d.id).after(k);else{if(100==f){if(d=c.find(".j_list-item[order\x3d10]"),!d||1>d.length)d=c.find(".j_list-item[order\x3d8]")}else d=c.find(".j_list-item[order\x3d8]");if(!d||1>d.length)d=c.find(".j_list-item.j_im-list-locked");d&&0<d.length&&(d=d[d.length-1],c.find("#"+d.id).after(k))}k.removeClass("hide-im")}return k}},deleteRecentItem:function(a){var b=
{},c={},k;a.hasClass("j_im-singleChat")?(c.sessionType="1",a=a.data("imChatUser"),c.fuser={uid:a.uid,cid:a.cid},k="1-"+a.uid):a.hasClass("j_im-groupChat")?(k="2","eteamsService"==this.chatIndexSessionType&&(k="7"),c.sessionType=k,c.groupId=a.attr("id"),k=k+"-"+a.attr("id")):a.hasClass("j_im-sysmsg")&&(a=a.data("imSysMsg"),c.sessionType="4",c.group=a.sgroup,k="4-sgroup-"+a.sgroup);b.info=c;this.imSessionCacheManager.delSessionCache(k);this.imRecentListComponent.deleteRecentItem(b,function(a){})},openSingleChatWindow:function(a){this.openMsgWindowBefore(a);
var b={imMsgModule:"chat"};b.chatType=a.data("chatType");b.imChatUser=a.data("imChatUser");a.attr("cid")&&(b.imChatUser.cid=a.attr("cid"));b.count=a.attr("count");a.hasClass("j_im-eteams-helper")?b.isHelper=!0:this.afterClickRemember("1",b);this.$activeSession=a;this.activeSessionType="chat";this.imWinComView=new h(b);this.imWinComView.render()},openSysWinView:function(a){switch(a.imSysMsg.sgroup){case "112":a.sgroup="112";a.imMsgModule="third";this.imWinComView=new h(a);this.imWinComView.render();
break;default:this.imWinComView=new h(a),this.imWinComView.render()}this.afterClickRemember("4",a);this.activeSessionType="sys"},openSysMsgWindow:function(a,b){var c=this,k=$(c.el).find(".j_im-session-container").find(".j_im-session-list"),d=k.find("#sgroup-"+a),f;d&&0<d.length&&(f=d.attr("count"));var l={imMsgModule:"sys"};l.imSysMsg={sgroup:a,imgSrc:TEAMS.service.imWebapp+"/static/img/mobile/sysmsg/sgroup_"+a+".png"};var m=g.getImSysMsgNoReadCounts("4-sgroup-"+a);l.count=f&&0!=f?f:m&&0!=m.count?
m.count:0;c.imWinComView=new h(l);c.imWinComView.render();1>d.length&&(l={},d=[],d.push(a),l.groups=d,l.sessionId="0",l.sessionType="4",c.imRecentListComponent.getSessionByGroupReq(l,function(d){var f=$(c.el).find("#im-addrlist-clone-field #im-session-one-clone").clone().attr("id","sgroup-"+a);d=d.message.datas;k.append(f);c.renderRecentSysMsgOne(f,{sgroup:a,imgSrc:TEAMS.service.imWebapp+"/static/img/mobile/sysmsg/sgroup_"+a+".png"});f.attr("order",100);if(d&&0<d.length){d=d[0];f.attr("session-id",
d.session_id);var g=[];g.push({msgId:d.last_msgid,sgroup:a});c.renderLastSysMsg(g,k)}c.sgroupId=a;f.addClass("active");c.showTop("sgroup-"+c.sgroupId,void 0,void 0,b)}))},sgroupFilter:function(a){return!0},sortRecentListDom:function(a){var b=$("\x3cdiv\x3e\x3c/div\x3e\x3e");a=a.find(".j_list-item:not(.j_im-list-locked)");a.sort(function(a,b){var e=1*a.getAttribute("order"),c=1*b.getAttribute("order"),k=1,k=-1;if(e>c)return-1*k;if(e<c)return 1*k;if(e==c){e=a.getAttribute("last-msg-id");c=b.getAttribute("last-msg-id");
if(e>c)return 1*k;if(e<c)return-1*k}return 0});b.append(a);return b},refreshImUnreadCount:function(){var a=g.getImMsgNoReadCountsAll(),b=$(this.el).find(".j_im-session-container").find(".j_im-session-list");if(a)for(var c in a){var k=a[c],d=b.find("#sgroup-"+k.sgroup);if(k&&k.count&&0<k.count){var f=k.count;99<k.count&&(f="99+");d.find(".j_count").text(f);d.attr("count",k.count);d.attr("order",10);this.hideRemindBell(d,k.count)}else this.hideRemindBell(d,0)}if(a=g.getImChatNoReadAllCounts())for(c in a)k=
a[c],d=b.find(k.id),d.find(".j_count").text(""),d.attr("count",0),k&&k.count&&0<k.count?(f=k.count,99<k.count&&(f="99+"),d.find(".j_count").text(f),d.attr("count",k.count),d.attr("order",10),this.hideRemindBell(d,k.count)):this.hideRemindBell(d,0);c=this.sortRecentListDom(b);b.detach(".j_list-item:not(.j_im-list-locked)");b.append(c.children())},updateMarkBackTitle:function(a){var b=a.objId,c=a.msgId,d=a.msgObj,f=$(this.el).find(".j_im-session-container").find(".j_im-session-list");2==a.type&&a.isHelper&&
(f=$(this.el).find(".j_im-service-session-container").find(".j_im-service-list"),this.updateServiceGroupSubtitle({datas:{msg:a.msgObj},group_id:a.groupId}));a=f.find("#"+b);b=a.data("data");a&&0<a.length&&a.attr("last-msg-id")==c&&(d.suid&&window.imCurrentUser.uid==d.suid&&(d.dt[0].txt.i18n="im.chat.b.self"),d=m.getMsgContent(d,window.imCurrentUser,k.il8n("anonymity")),a.find(".j_info").html(d));b.remind_msgid==c&&a.find(".j_atme").addClass("hide-im")},onMaskGroupMsg:function(a,b){var c=$("#"+b.groupId),
k=b.msgObj;c.length&&c.attr("last-msg-id")===b.msgId&&(k.suid===window.imCurrentUser.uid&&(k.dt[0].txt.i18n="im.chat.mask.self"),k=m.processMsgByType(k),c.find(".j_info").html(k));c.data("data").remind_msgid===b.msgId&&c.find("j_atme").addClass("hide-im")},setSessionTop:function(a,b){var c={};c.uid=window.imCurrentUser.uid;c.cid=window.imCurrentUser.cid;c.flag="1";c.info={sessionType:a.session_type,tuid:a.tuid,tcid:a.tcid,groupId:a.group_id,group:a.group,fuser:a.fuser,topStatus:a.top_status,deltaFlag:a.delta_flag,
sessionId:a.session_id,unreadCount:a.unread_count,updateTm:a.update_tm,remindFlag:a.remind_flag,remindMsgId:a.remind_msgid,lastMsgId:a.last_msgid,title:a.title};c.dev=window.imClientDev;this.imWebReqMethods.setSessionReq(c,function(a){b&&b(a)})},setMsgNoReminder:function(a,b,c){var k={};k.uid=window.imCurrentUser.uid;k.cid=window.imCurrentUser.cid;var d={};switch(a.session_type){case "1":d={sessionType:a.session_type,user:a.fuser,reminder:b};break;case "2":case "7":d={sessionType:a.session_type,groupId:a.group_id,
reminder:b};break;case "4":d={sessionType:a.session_type,group:a.group,reminder:b}}k.remind=d;this.imWebReqMethods.setMsgRemindReq(k,function(a){c&&c(a)})},renderSessionTop:function(a){var b;switch(a.session_type){case "1":b=a.fuser.uid;break;case "2":case "7":b=a.group_id;break;case "4":b="sgroup-"+a.group}this.imSessionCacheManager.insertSessionData(b,a);switch(a.top_status){case "0":this.cancelTop(b,a);break;case "1":this.showTop(b,!0,a)}},renderMsgNoReminder:function(a,b){a.reminder=b;var c={type:a.session_type,
reminder:b},k;switch(a.session_type){case "1":k=a.fuser.uid;c.user=a.fuser;break;case "2":case "7":k=a.group_id;c.group_id=a.group_id;break;case "4":k="sgroup-"+a.group,c.group=a.group}this.imSessionCacheManager.saveMsgReminderCache(a.session_type+"-"+k,c);c=$(this.el).find(".j_im-session-list");"7"==a.session_type&&(c=$(this.el).find(".j_im-service-session-container").find(".j_im-service-list"));if((k=c.find("#"+k))&&0<k.length){if(b)switch(b){case "0":k.find(".j_count").removeClass("no-remind");
this.hideRemindBell(k,a.unread_count);break;case "1":k.find(".j_count").addClass("no-remind"),this.hideRemindBell(k,a.unread_count)}k.data("data",a)}$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")},setUnreadSessionUpdate:function(a,b){var c=a.sessionType,k=a.objId,d=a.unreadCount,f=$(this.el).find(".j_im-session-container").find(".j_im-session-list");"7"==c&&(f=$(this.el).find(".j_im-service-session-container .j_im-service-list"));var g;switch(c){case "1":g=k;break;case "3":g=
k;break;case "2":case "7":g=k;break;case "4":g="sgroup-"+k}if((k=f.find("#"+g))&&0<k.length){if(g=this.imSessionCacheManager.getSessionCache(c+"-"+g,c))g.unread_count=d.toString(),k.data("data",g);g=d;99<d&&(g="99+");k.find(".j_count").text(g);k.attr("count",d);k.attr("order",10);this.hideRemindBell(k,d);switch(c){case "4":$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage");break;default:$("body").trigger("updateImChatCount"),$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")}}},
afterClickRemember:function(a,b){a&&b&&(b.sessionType=a,window.localStorage.setItem(window.imCurrentUser.uid+"-imClickRemember",JSON.stringify(b)))},openRecentWin:function(a){var b=this,c;switch(a.sessionType){case "1":window.imCurrentUser.hideChat||(a.count=0,c=a.imChatUser.id,b.imWinComView=new h(a),b.imWinComView.render());b.activeSessionType="chat";break;case "2":window.imCurrentUser.hideChat||(a.count=0,c=a.imChatGroup.id,b.imRecentListComponent.getGroupInfoUcReq(c,function(c){a.imChatGroup=
c;b.imWinComView=new h(a);b.imWinComView.render()}));b.activeSessionType="chat";break;case "4":a.count=0,c="sgroup-"+a.imSysMsg.sgroup,b.imWinComView=new h(a),b.imWinComView.render(),b.activeSessionType="sys"}$(b.el).find(".j_im-session-container .j_im-session-list .j_list-item.active").removeClass("active");(c=$(b.el).find(".j_im-session-container .j_im-session-list #"+c))&&0<c.length&&(c.addClass("active"),c.attr("count")&&(a.count=c.attr("count")));b.$activeSession=c},imFastTrigger:function(a){var b=
this;b.imWinComView&&(b.imWinComView.remove(),b.imWinComView=void 0);var c=a.imMsgModule,k=a.imChatUser,d=a.imChatGroup,f=a.imSysMsg,l=a.chatType,m,q={isHelper:a.isHelper};switch(c){case "chat":q.imMsgModule=c;q.chatType=l;switch(l){case "singleChat":m=k.id;g.getImUserInfo({uid:k.uid,cid:k.cid},function(a){q.imChatUser=a;b.imFastWinOpen(m,c,q);b.afterClickRemember("1",q)});break;case "groupChat":m=d.id,b.imRecentListComponent.getGroupInfoUcReq(d.id,function(a){q.imChatGroup=a;b.imFastWinOpen(m,c,
q);b.afterClickRemember("2",q)})}break;case "sys":switch(f.sgroup){case "112":m="sgroup-112";q.sgroup="112";q.imMsgModule="third";b.imWinComView=new h(q);b.afterClickRemember("4",q);break;default:m="sgroup-"+f.sgroup,q.imMsgModule=c,q.imSysMsg=f,b.afterClickRemember("4",q)}b.imFastWinOpen(m,c,q)}},imFastWinOpen:function(a,b,c){if(a){$(this.el).find(".j_im-session-container .j_im-session-list .j_list-item.active").removeClass("active");if((a=$("#"+l.IM_ADDRLIST_EL).find("#"+a))&&0<a.length){a.addClass("active");
var k=a.attr("count");k&&0<k&&(c.count=k)}this.$activeSession=a;this.activeSessionType=b}this.imWinComView=new h(c);this.imWinComView.render()},closeLastWindow:function(){},sysMsgUpdateNotify:function(a){var b=this,c=a.msgId,k=a.msgType;(k=$(b.el).find(".j_im-session-container").find(".j_im-session-list").find("#sgroup-"+k.group))&&0<k.length&&k.attr("last-msg-id")==c&&b.imCommonSysMsgView.sysMsgUpdateNotify(a,function(a){b.updateRecentByNotify("4","4-sgroup-"+a.message.datas.msg_type.group,a.message)})},
updateLastMessage:function(a){var b=$(this.el).find(".j_im-session-container").find(".j_im-session-list"),c=a.msgObj,k=a.type,d,f;switch(k){case "1":d=c.to_uid;f=this.renderLastSingleMsgOne(c,b);break;case "2":d=f=a.groupId;f=this.renderLastGroupMsgOne(f,c,b);break;case "7":"eteamsService"==this.chatIndexSessionType&&(b=$(this.el).find(".j_im-service-session-container .j_im-service-list"),d=f=a.groupId,f=this.renderLastGroupMsgOne(f,c,b));break;case "4":this.renderLastSysMsgOne(a.sgroup,c,b);default:return}f&&
((b=f.data("data"))&&!b.top_status?b.top_status="0":!f.data("data")&&(b=this.imSessionCacheManager.getSessionCache(k+"-"+d,k))&&(b.top_status="0",f.data("data",b)));this.showTop(d,void 0,void 0,!0,k)},hideRemindBell:function(a,b){a.attr("count")||a.attr("count",0);1>a.attr("count")&&a.find(".j_count").hasClass("no-remind")?(a.find(".j_im-not-remind-mark").removeClass("hide-im"),0<b&&a.find(".j_im-not-remind-mark").addClass("hide-im")):a.find(".j_im-not-remind-mark").addClass("hide-im")},changeToSessionList:function(a){var b=
this,c=$(b.el);b.isSearchList=!1;var k=$(b.el).find(".j_panel-search .j_im-addrlist-search-input");k.val("");k.text("");$(b.el).find(".j_im-addrlist-tab-container").removeClass("hide-im");$(b.el).find(".j_im-addrsearch-container").addClass("hide-im");c.find(".j_im-addrlist-tab div").removeClass("active");c.find('.j_im-addrlist-tab[type\x3d"session"] div').addClass("active");b.renderByTab("session",!0);var d=$(b.el).find(".j_im-session-container").find(".j_im-session-list"),k=a.imChatUser,c=a.imChatGroup,
f,h;switch(a.chatType){case "groupChat":a=c.type;h=c.id;switch(a){case "1":b.switchToEteamsGroupSession("open",0,function(){d=$(b.el).find(".j_im-service-session-container").find(".j_im-service-list")})}f=d.find("#"+c.id);f.addClass("active");1>f.length&&(f=$(b.el).find("#im-addrlist-clone-field #im-session-one-clone").clone().attr("id",h),d.append(f),b.imRecentListComponent.getGroupInfoReq(c.id,function(a){a&&b.renderRecentGroupChatOne(f,a,d)}));break;case "singleChat":h=k.id,f=d.find("#"+k.id),
f.addClass("active"),1>f.length&&(f=$(b.el).find("#im-addrlist-clone-field #im-session-one-clone").clone().attr("id",h),d.append(f),g.getImUserInfo({uid:k.uid,cid:k.cid},function(a){b.renderRecentSingleChatOne(f,a,void 0,void 0)}))}b.showTop(h)},imSessionAllCount:function(){var a=$(this.el).find(".j_im-addrlist-tab-container .j_session-allcount"),b=$("body").data("imCacheData").sessionCacheDatas.imAllCounts;if(b&&0<b){var c=b;99<b&&(c="99+");a.text(c)}else a.text("")},updateImGroupDetailNotify:function(a){var b=
a.newImChatGroup;a=a.mask;var c,k,d=$("#"+l.IM_ADDRLIST_EL).find(".j_im-addrgroup-list");0<d.length&&0<d.find("#"+b.id).length&&(c=d.find("#"+b.id));d=$("#"+l.IM_ADDRLIST_EL).find(".j_im-session-list");0<d.length&&0<d.find("#"+b.id).length&&(k=d.find("#"+b.id));switch(a){case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_NAME:c&&0<c.length&&c.find(".j_name").attr("data-original-title",b.name).text(b.name);k&&0<k.length&&k.find(".j_name").attr("data-original-title",b.name).text(b.name);break;case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_AVATAR:b=
"/base/download/"+b.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID,c&&0<c.length&&c.find(".j_avatar img").attr("src",b),k&&0<k.length&&k.find(".j_avatar img").attr("src",b)}},switchToEteamsGroupSession:function(a,b,c){var k=this,d=$(k.el),f=d.find(".j_im-service-container.j_im-member-list");f.find(".j_no-result").removeClass("hide-im");d=d.find(".j_im-session-container.j_im-member-list");switch(a){case "open":k.chatIndexSessionType="eteamsService";f.removeClass("hide-im");d.addClass("hide-im");
k.imSessionCacheManager.loadServiceSessionData(function(a){var e=$(k.el).find(".j_im-service-session-container");if(0<a.sessionArray.length){f.find(".j_no-result").addClass("hide-im");var d=$(k.el).find(".j_im-service-session-container").find(".j_im-service-list");d.empty();k.renderRecentSessionsView(a.sessionArray,!0,a.msgReminderCacheDatas,d,e);if(b&&"0"!=b){e=!0;for(d=0;d<a.sessionArray.length;d++)if(0<a.sessionArray[d].unread_count){e=!1;break}e&&(a={uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,
info:{sessionType:"3"}},a.dev=window.imClientDev,k.imWebReqMethods.setSessionReq(a,function(a){a=g.getImChatNoReadCounts("3-serviceGroup");a.count=0;g.setImMsgNoReadCounts("3-serviceGroup",a,"3");k.imWebReqMethods.triggerMsgReadStatusNoticeMethods(a)}))}}c&&c()});break;case "return":k.chatIndexSessionType="session",f.addClass("hide-im"),d.removeClass("hide-im"),k.renderRecentList(),$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")}f.find(".j_im-addrlist-scrollbar").trigger("resizeSroll")},
remove:function(){$(this.el).off(".ImAddrList")}});p.exports=n});
define("im/minichat/ImWinComView",["im/component/imUtils","im/component/imContants","im/minichat/ImChatWinView","im/minichat/ImSysWinView","im/minichat/ImThirdWinView"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/minichat/ImChatWinView"),g=n("im/minichat/ImSysWinView"),f=n("im/minichat/ImThirdWinView");n=Backbone.View.extend({initialize:function(a){this.el="#"+l.IM_WINCOM_EL;this.sgroup=a.sgroup;this.count=a.count;this.isHelper=a.isHelper;$("#"+l.IM_WINCOM_EL).html(m.template("imchat.imwincom"));
if(this.imMsgModule=a.imMsgModule)switch(this.imMsgModule){case "chat":$("#"+l.IM_FRAME_EL).find("#im-noresult-container").addClass("hide-im");$("#"+l.IM_FRAME_EL).find("#im-wincom-container").removeClass("hide-im");var d={};d.chatType=a.chatType;d.imChatUser=a.imChatUser;d.imChatGroup=a.imChatGroup;d.isHideAtView=a.isHideAtView;d.parentEl=this.el;d.count=a.count;d.isHelper=a.isHelper;this.imMsgModuleView=new h(d);break;case "sys":$("#"+l.IM_FRAME_EL).find("#im-noresult-container").addClass("hide-im");
$("#"+l.IM_FRAME_EL).find("#im-wincom-container").removeClass("hide-im");d={};d.imSysMsg=a.imSysMsg;d.count=a.count;this.imMsgModuleView=new g(d);break;case "third":$("#"+l.IM_FRAME_EL).find("#im-noresult-container").addClass("hide-im"),$("#"+l.IM_FRAME_EL).find("#im-wincom-container").removeClass("hide-im"),$("#"+l.IM_FRAME_EL).find("#im-wincom-container #im-thirdwin-content").addClass("module-blog-view"),d={sgroup:this.sgroup,count:this.count,userId:window.imCurrentUser.uid,type:"myblog",parentEl:"#im-wincom-container #im-thirdwin-content"},
this.imMsgModuleView=new f(d)}},delegateEvents:function(){$(this.el)},render:function(a){$(this.el);this.imMsgModuleView.render(a)},remove:function(){this.imMsgModuleView&&this.imMsgModuleView.remove()}});p.exports=n});
define("im/minichat/ImSysWinView",["im/component/imUtils","im/component/imContants","im/component/emojiarea","im/component/imChatComponent","im/component/imCommonSysMsgView"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/component/emojiarea"),g=n("im/component/imChatComponent"),f=n("im/component/imCommonSysMsgView");n=Backbone.View.extend({initialize:function(a){this.el="#"+l.IM_SYSWIN_EL;this.recentListEl="#"+l.IM_ADDRLIST_EL;this.parentEl=a.parentEl;this.imSysMsg=
a.imSysMsg;this.count=a.count;this.sysMsgSgroupObj;this.imSysMsgCBService=window.imEteamsJsService.ImSysMsgCBService;this.imCommonSysMsgView=new f;this.initSysMsgViewTpl();this.readFlag=2;this.pageUpMsgId;this.pageDownMsgId;this.minNextId="0";this.wheelPageDownLocked=!1;this.imMsgType={group:this.imSysMsg.sgroup};h($)},delegateEvents:function(){var a=this,d=$(a.el);d.off("click.ImSysWin",".j_im-sysmsg-list-switch .j_readed").on("click.ImSysWin",".j_im-sysmsg-list-switch .j_readed",function(b){b.stopPropagation();
b=$(this);var c=$(a.el);b.hasClass("active")||(b.prevAll().removeClass("active"),b.addClass("active"),c.find(".j_im-portal-sysmsg-head .j_sysmsg-stype-selector a.selectui-result").html('\u5168\u90e8 \x3ci class\x3d"icon-caret-down"\x3e\x3c/i\x3e'),c.find(".j_im-sysmsg-read-all").addClass("hide"),a.readFlag=1,a.renderSysMsg(a.readFlag))});d.off("click.ImSysWin",".j_im-sysmsg-list-switch .j_unread").on("click.ImSysWin",".j_im-sysmsg-list-switch .j_unread",function(b){b.stopPropagation();b=$(this);b.nextAll().removeClass("active");
b.addClass("active");a.initSysMsgHead(!0);d.find(".j_im-sysmsg-read-all").removeClass("hide");a.readFlag=2;a.renderSysMsg(a.readFlag)});d.off("click.ImSysWin",".j_im-user-avatar-trigger").on("click.ImSysWin",".j_im-user-avatar-trigger",function(b){b.stopPropagation();b=$(this);a.imSysMsgCBService.triggerUserAvatarData(b.data("imChatUser"),b)});d.off("click.ImSysWin",".j_sysmsg-toolbar-stype").on("click.ImSysWin",".j_sysmsg-toolbar-stype",function(b){b=$(this);a.renderSysMsgByStype(b.attr("stype"),
b.attr("sgroup"))});d.off("click.ImSysWin",".j_im-sysmsg-entity-toggle").on("click.ImSysWin",".j_im-sysmsg-entity-toggle",function(b){b.stopPropagation();var c=$(this);(b=c.parents(".j_sysmsg-item"))&&b.hasClass("j_read-sysmsg-item")&&a.markReadSysMsgOne(b);var k=c.data("imEntity"),c=c.data("ups"),e={};e.imEntity=k;e.ups=c;e.$msgDom=b;a.openSysMsgEntity(e);a.setMsgReadByTaskId(k.id,b)});d.off("click.ImSysWin",".j_read-sysmsg-item").on("click.ImSysWin",".j_read-sysmsg-item",function(b){b=$(this);a.markReadSysMsgOne(b)});
d.off("click.ImSysWin",".j_im-fastchat").on("click.ImSysWin",".j_im-fastchat",function(a){a=$(this);a={chatType:a.attr("chatType"),imChatUser:{id:a.attr("user-uid"),uid:a.attr("user-uid"),cid:a.attr("user-cid"),name:a.attr("name")},imChatGroup:{id:a.attr("group-id"),name:a.attr("name")}};$("#"+l.IM_MINI_PAGE).trigger("imFastChat.miniChatPage",a)});d.off("click.ImSysWin",".j_im-click-entity").on("click.ImSysWin",".j_im-click-entity",function(b){b=$(this);b={imEntity:{id:b.attr("entity-id"),nm:b.attr("name"),
me:b.attr("module")}};a.imSysMsgCBService.openSysMsgEntity(b)});d.off("click.ImSysWin",".icon-envelope").on("click.ImSysWin",".icon-envelope",function(b){b=$(this).parents(".j_sysmsg-item");var c=b.data("sysMsgData").msg_type.type,k=b.attr("id");b.find(".j_status i").removeClass("icon-envelope");b.find(".j_status i").addClass("icon-envelope-alt");b.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u5df2\u8bfb");b.addClass("j_read-sysmsg-item");a.imCommonSysMsgView.setSysMsgUnReadStatusReq({type:c,
group:a.imSysMsg.sgroup,msgId:k},function(b){b=b.message.data;var c={sessionType:"4"};c.objId=b.group;c.unreadCount=b.unread_count;$(a.recentListEl).trigger("setUnreadSessionUpdate",c)})});d.off("setSysMsgUnreadNotify.ImSysWin").on("setSysMsgUnreadNotify.ImSysWin",function(b,c){$(this);if(a.imSysMsg.sgroup==c.sgroup){var k=c.msgIds,e=d.find(".j_im-syswin-msg-list"),f;k&&0<k.length&&k.forEach(function(a){(f=e.find("#"+a))&&0<f.length&&(f.find(".j_status i").removeClass("icon-envelope"),f.find(".j_status i").addClass("icon-envelope-alt"),
f.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u5df2\u8bfb"),f.addClass("j_read-sysmsg-item"))})}});d.off("click.ImSysWin",".j_im-sysmsg-read-page").on("click.ImSysWin",".j_im-sysmsg-read-page",function(b){$(this);if(b=$(a.el).find(".j_im-syswin-msg-list").find(".j_read-sysmsg-item")){var c=[];_.each(b,function(a){a=$(a);c.push({msgId:a.attr("id"),type:a.attr("stype")});a.find(".j_status i").removeClass("icon-envelope-alt");a.find(".j_status i").addClass("icon-envelope");a.find(".j_status i").attr("data-original-title",
"\u6807\u8bb0\u672a\u8bfb");a.removeClass("j_read-sysmsg-item")});a.setSysMsgReadStatusReq({datas:c,flag:"4"})}});d.off("click.ImSysWin",".j_im-sysmsg-read-all").on("click.ImSysWin",".j_im-sysmsg-read-all",function(b){$(this);(b=$(a.el).find(".j_im-syswin-msg-list").find(".j_read-sysmsg-item"))&&_.each(b,function(a){$(a).find(".j_status i").removeClass("icon-envelope-alt");$(a).find(".j_status i").addClass("icon-envelope");$(a).find(".j_status i").attr("data-original-title","\u6807\u8bb0\u672a\u8bfb");
$(a).removeClass("j_read-sysmsg-item")});a.setSysMsgReadStatusReq({flag:"2"},function(){m.notify("\u5168\u90e8\u6807\u8bb0\u5df2\u8bfb\u6210\u529f")})});d.off("updateApplyStatus.ImSysWin").on("updateApplyStatus.ImSysWin",function(b,c){a.setSysMsgReadStatusReq(c.setReadParams);a.updateSysMsgContent(c)});d.off("click.ImSysWin",".j_im-sysmsg-option .j_agree").on("click.ImSysWin",".j_im-sysmsg-option .j_agree",function(b){b.stopPropagation();b=$(this);var c=b.parents(".j_sysmsg-item");b.parents(".j_sysmsg-item").find(".j_im-sysmsg-option").addClass("hide");
b.parents(".j_sysmsg-item").find(".j_content span").text("\u60a8\u540c\u610f\u4e86\u8fd9\u6761\u7533\u8bf7\u6d88\u606f");a.setMsgAgree(c)});d.off("click.ImSysWin",".j_im-sysmsg-option .j_refuse").on("click.ImSysWin",".j_im-sysmsg-option .j_refuse",function(b){b.stopPropagation();b=$(this);var c=b.parents(".j_sysmsg-item");b.parents(".j_sysmsg-item").find(".j_im-sysmsg-option").addClass("hide");b.parents(".j_sysmsg-item").find(".j_content span").text("\u60a8\u62d2\u7edd\u4e86\u8fd9\u6761\u7533\u8bf7\u6d88\u606f");
a.setMsgRefuse(c)});d.off("click.ImSysWin",".j_at-obj-trigger").on("click.ImSysWin",".j_at-obj-trigger",function(b){b.stopPropagation();b=$(this);var c={id:b.attr("objId"),name:b.attr("objName"),type:b.attr("objType")};a.imSysMsgCBService.triggerAtObjData(c,b)});d.off("imSysMsgNotify.ImSysWin").on("imSysMsgNotify.ImSysWin",function(b,c){var k=$(a.el).find(".j_im-syswin-msg-list");a.imSysBoxNotify(c,k)});d.off("sysMsgUpdateNotify.ImSysWin").on("sysMsgUpdateNotify.ImSysWin",function(b,c){a.sysMsgUpdateNotify(c)})},
render:function(){var a=this,d=$(a.el);m.layout(".j_im-syswin-msg-container.j_im-syswin-msg-scrollbar",{whileScrolling:function(){TEAMS.ownCache["portal.mcsTop"]=this.mcs.top;a.mcsTopPct=this.mcs.topPct;90<a.mcsTopPct&&a.pageDownMsgId&&a.minNextId&&!a.wheelPageDownLocked&&a.turnPage()}},[{gotoTopButton:!0,scrollInertia:500,mouseWheel:{scrollAmount:350}}]);a.initSysMsgHead();a.initSysMsgTips();0<parseInt(a.count)?(a.readFlag=2,d=d.find(".j_im-sysmsg-read-all"),d.hasClass("hide")||d.removeClass("hide"),
a.renderSysMsg(a.readFlag,function(b){b||a.checkSysMsgList()})):(a.readFlag=1,d.find(".j_im-sysmsg-read-all").addClass("hide"),a.renderSysMsg(a.readFlag),$(a.el).find(".j_im-sysmsg-list-switch div").removeClass("active"),$(a.el).find(".j_im-sysmsg-list-switch .j_readed").addClass("active"))},checkSysMsgList:function(){var a=$(this.el);this.setSysMsgReadStatusReq({flag:"2"});this.readFlag=1;a.find(".j_im-sysmsg-read-all").addClass("hide");this.renderSysMsg(this.readFlag);a.find(".j_im-sysmsg-list-switch li").removeClass("active");
a.find(".j_im-sysmsg-list-switch .j_readed").addClass("active")},turnPage:function(){var a=this;a.wheelPageDownLocked=!0;var d={};d.uid=window.imCurrentUser.uid;d.cid=window.imCurrentUser.cid;d.msgType=a.imSysMsg;d.order="desc";d.dev=window.imClientDev;d.flag=a.readFlag;var b=[];b.push({start:a.pageDownMsgId,msgType:a.imMsgType,maxNum:"10"});d.datas=b;var c=$(a.el).find(".j_im-syswin-msg-list");c.find(".loading_small").removeClass("hide");a.imCommonSysMsgView.syncSysMsgReq(d,function(b){c.find(".loading_small").addClass("hide");
a.renderSysMsgCallback(b,c);a.wheelPageDownLocked=!1})},initSysMsgHead:function(a){var d=this,b=$(d.el).find(".j_view-head"),c=$(d.el).find(".j_sysmsg-stype-selector");d.sysMsgSgroupObj=g.getImSysMsgConfig("sgroupMap","sgroup")[d.imSysMsg.sgroup];d.sysMsgStypeMap=g.getImSysMsgConfig("stypeMap","stype");var k=c.find(".j_filter-selector");k.find("div").eq(0).attr("sgroup",d.imSysMsg.sgroup);var e=d.sysMsgSgroupObj.name,f=e.zh_cn;e[TEAMS.perLang.toLocaleLowerCase()]&&(f=e[TEAMS.perLang.toLocaleLowerCase()]);
b.find(".j_name").text(f);var h,l,m,n="";a||d.imCommonSysMsgView.querySysMsgRel(d.imSysMsg.sgroup,function(a){for(var b=0;b<a.length;b++)if(h=a[b],110<parseInt(h)){c.hasClass("hide-im")&&c.removeClass("hide-im");if(l=d.sysMsgStypeMap[h])m=l.name,n=m.zh_cn,m[TEAMS.perLang.toLocaleLowerCase()]&&(n=m[TEAMS.perLang.toLocaleLowerCase()]);var e=$(d.el).find("#im-syswin-clone-field .j_sysmsg-toolbar-stype").clone();e.attr("stype",h);e.attr("sgroup",d.imSysMsg.sgroup);e.text(n).attr("title",n);k.append(e)}});
switch(d.sysMsgSgroupObj.gtype){case "1":b.find(".j_sysmsg-stype-selector").removeClass("hide");b.find(".j_im-sysmsg-read-all").removeClass("hide");break;case "2":b.find(".j_unread a").text("\u672a\u5904\u7406");b.find(".j_readed a").text("\u5df2\u5904\u7406");break;case "3":b.find(".j_sysmsg-stype-selector").removeClass("hide");b.find(".j_unread a").text("\u672a\u5904\u7406");b.find(".j_readed a").text("\u5df2\u5904\u7406");break;case "5":b.find(".j_sysmsg-stype-selector").removeClass("hide"),b.find(".j_im-sysmsg-read-all").removeClass("hide")}},
initSysMsgTips:function(){var a=this.imSysMsgCBService.sysMsgTipsConfig["sgroup-"+this.imMsgType.group];a&&a.tip&&$(this.el).find(".j_sysmsg-head-toolbar .j_tip").removeClass("hide").find("i").attr("title",a.tip)},setSysMsgReadStatusReq:function(a,d){var b=a.datas,c=a.flag,k={};k.uid=window.imCurrentUser.uid;k.cid=window.imCurrentUser.cid;k.datas=b;k.sgroup=this.imSysMsg.sgroup;c&&(k.flag=c);a.taskId&&(k.taskId=a.taskId);var c="4-sgroup-"+k.sgroup,e=g.getImSysMsgNoReadCounts(c);switch(k.flag){case "4":e.count-=
b.length;break;case "2":e.count=0}g.setImMsgNoReadCounts(c,e,"4");$("#"+l.IM_ADDRLIST_EL).trigger("updateUnreadNumOne.ImAddrList",e);$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage");this.imCommonSysMsgView.setSysMsgReadStatusReq(k,d)},renderSysMsg:function(a,d){var b=this,c=$(b.el),k={};k.uid=window.imCurrentUser.uid;k.cid=window.imCurrentUser.cid;k.msgType=b.imSysMsg;k.order="desc";k.dev=window.imClientDev;k.flag=a;var e=[];e.push({msgType:b.imMsgType,maxNum:"10"});k.datas=e;
var f=c.find(".j_im-syswin-msg-list");f.find(".loading_small").removeClass("hide");b.imCommonSysMsgView.syncSysMsgReq(k,function(a){f.find(".loading_small").addClass("hide");f.empty();$(b.el).find(".j_im-syswin-msg-scrollbar").mCustomScrollbar("update");var e=a.message.datas;e&&0<e.length?b.renderSysMsgCallback(a,f):($(b.el).find(".j_hasMesInfo").addClass("hide"),$(b.el).find(".j_noMesInfo").removeClass("hide"));d&&d(e)})},renderSysMsgCallback:function(a,d){this.isRead=0;var b=a.message.datas;b&&
0<b.length&&($(this.el).find(".j_hasMesInfo").removeClass("hide"),$(this.el).find(".j_noMesInfo").addClass("hide"),this.pageDownMsgId=b[b.length-1].ser_msgid,this.minNextId=b[b.length-1].next_id,this.renderSysMsgList(b,d))},renderSysMsgList:function(a,d){for(var b=0;b<a.length;b++)this.renderSysMsgOne(a[b],d)},renderSysMsgOne:function(a,d,b){var c=$(this.el),k=a.msg,e=c.find("#im-syswin-clone-field #im-sys-msg-clone").clone().attr("id",a.ser_msgid);e.addClass("hide");e.attr("stype",a.msg_type.type);
b?d.prepend(e):d.append(e);e.data("sysMsgData",a);1==this.isRead&&(e.find(".j_status i").removeClass("icon-envelope-alt"),e.find(".j_status i").addClass("icon-envelope"),e.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u672a\u8bfb"));e.find(".j_user").text(k.sname);"10000"==a.from_uid&&(a.from_cid="10000");g.getImUserInfo({uid:a.from_uid,cid:a.from_cid},function(b){e||(e=d.find("#"+a.ser_msgid));e.attr("sender-id",a.from_uid);e.find(".j_user").text(b.name);e.find(".j_user").data("imChatUser",
b);e.find(".usercard-toggle").attr("userid",b.id);e.find(".j_user").data("employee",b);e.find(".j_avatar").data("imChatUser",b);b.avatar?e.find(".j_avatar img").removeClass("hide").attr("src","/base/download/"+b.avatar):b.id&&"10000"==b.id?(b={zh_CN:"eteams\u5c0f\u52a9\u624b",zh_TW:"eteams\u5c0f\u52a9\u624b",en_US:"eteams assistant"}[TEAMS.perLang],e.find(".j_user").text(b),e.find(".j_avatar img").removeClass("hide").attr("src","/static/img/global/service.png"),e.find(".avatar").css("cursor","auto"),
e.find(".user").css({"text-decoration":"none",cursor:"auto"})):e.find(".j_avatar img").removeClass("hide").attr("src","/static/images/avatar.png")});if(e=this.renderSysMsgByTpl(e,k))e.removeClass("hide"),a.read_status&&(e.find(".j_status i").removeClass("icon-envelope-alt"),e.find(".j_status i").addClass("icon-envelope"),e.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u672a\u8bfb"),e.removeClass("j_read-sysmsg-item")),b="",a.msgtime&&(b=Date.create(parseInt(1E3*a.msgtime)).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")),
e.find(".j_time").text(b)},renderSysMsgByTpl:function(a,d){var b=d.sys;if(b){var c=b.et;switch(b.tpl){case "0":a=this.renderTplCommentMsg(a,c,d);break;case "1":a=this.renderTplItemMsg(a,c,d);break;case "2":a=this.renderTplApplyMsg(a,c,d);break;case "3":a=this.renderTplNewCollegueMsg(a,c,d);break;default:a=this.renderTplCommentMsg(a,c,d)}return a}},renderTplNewCollegueMsg:function(a,d,b){m.processMsgByType(b);d=this.getOperateWords(b.sys.ot);a.find(".j_text").text(d);d=a.find(".j_content");b=m.processMsgByType(b);
b=m.initMessage(b);d.text(b);return a},renderTplCommentMsg:function(a,d,b){var c=this.sysMsgStypeMap[b.sys.type];if(c){c=this.getOperateWords(b.sys.ot,c);a.find(".j_text").text(c);d&&(a.attr("taskId",d.id),a.find(".j_entity a").data("imEntity",d),a.find(".j_entity a").data("ups",b.sys.ups),d=d.nm,this.imSysMsgCBService.getEntityNameExt&&(c=this.imSysMsgCBService.getEntityNameExt(b.sys))&&(d=c),a.find(".j_entity a").removeClass("hide").text(d));d=b.dt[0].txt;c=a.find(".j_content");d.v||(d.v="");var k=
b=m.processMsgByType(b);if(d.aus&&0<d.aus.length){var e=$('\x3ca class\x3d"at-user j_at-obj-trigger"\x3e\x3c/a\x3e');b=g.completeAtContent(d.aus,b,k,e,TEAMS.perLang).txtValue}else b=k;c.html(b);return a}},renderTplItemMsg:function(a,d,b){if(d){a.attr("taskId",d.id);a.find(".j_entity a").attr({"data-id":d.id,"data-module":d.me});var c=this.sysMsgStypeMap[b.sys.type];if(!c)return;c=this.getOperateWords(b.sys.ot,c);a.find(".j_text").text(c);c=a.find(".j_content a").removeClass("hide").text(d.nm);c.data("imEntity",
d);c.data("ups",b.sys.ups)}else console.log("\u9519\u8bef\u6570\u636e\uff0c \u4e8b\u9879\u4e3a\u7a7a\uff1a"+JSON.stringify(b));return a},renderTplApplyMsg:function(a,d,b){"102"==b.sys.group&&(b.sys.ot=void 0,"apl.jo.ap"==b.dt[0].txt.i18n&&(b.dt[0].txt.i18n=void 0));if(d){a.find(".j_entity a").data("imEntity",d);a.find(".j_entity a").data("ups",b.sys.ups);var c=this.sysMsgStypeMap[b.sys.type];if(!c)return;c=this.getOperateWords(b.sys.ot,c);a.find(".j_text").text(c);a.find(".j_entity a").removeClass("hide").text(d.nm)}else c=
this.getOperateWords(b.sys.ot,void 0),a.find(".j_text").text(c);if(d=b.sys.mod){switch(d.type.toString()){case "0":0==this.isRead&&(a.removeClass("j_read-sysmsg-item"),a.find(".j_im-sysmsg-option").removeClass("hide"),b=m.processMsgByType(b,null,!1),a.find(".j_content").text(b));break;default:a.find(".j_im-sysmsg-option").addClass("hide"),b=m.processMsgByType(b,null,!1),a.find(".j_content").text(b)}return a}},renderSysMsgByStype:function(a,d){var b=this;b.imMsgType.type=a;var c=$(b.el).find(".j_sysmsg-stype-selector").find(".j_select-result"),
k=b.sysMsgStypeMap[a],e=k?k.name:{zh_cn:"\u5168\u90e8",zh_tw:"\u5168\u90e8",en_us:"All"},k=e.zh_cn;e[TEAMS.perLang.toLocaleLowerCase()]&&(k=e[TEAMS.perLang.toLocaleLowerCase()]);c.text(k);c={};c.uid=window.imCurrentUser.uid;c.cid=window.imCurrentUser.cid;c.msgType=b.imSysMsg;c.order="desc";c.dev=window.imClientDev;c.flag=b.readFlag;k=[];k.push({msgType:b.imMsgType,maxNum:"10"});c.datas=k;var f=$(b.el).find(".j_im-syswin-msg-list");b.imCommonSysMsgView.syncSysMsgReq(c,function(a){f.find(".loading_small").addClass("hide");
f.empty();var e=a.message.datas;e&&0<e.length?b.renderSysMsgCallback(a,f):($(b.el).find(".j_hasMesInfo").addClass("hide"),$(b.el).find(".j_noMesInfo").removeClass("hide"))})},updateSysMsgContent:function(a){var d=$(this.el).find(".j_im-syswin-msg-list").find("#"+a.msgData.msgId);a=a.msgObj;d.find(".j_status i").removeClass("icon-envelope-alt");d.find(".j_status i").addClass("icon-envelope");d.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u672a\u8bfb");this.renderTplApplyMsg(d,a.et,
a)},getOperateWords:function(a,d){if(d){var b=d.name,c=b.zh_cn;b[TEAMS.perLang.toLocaleLowerCase()]&&(c=b[TEAMS.perLang.toLocaleLowerCase()]);d.stypeName=c}return this.imSysMsgCBService.getOperateWords(a,this.sysMsgSgroupObj,d,TEAMS.perLang)},initSysMsgViewTpl:function(){$(this.el).html(m.template("imchat.imsyswin"))},openSysMsgEntity:function(a){var d=a.ups;"email"===a.imEntity.me?ROUTER.navigate("/email/list/"+(d.flag||"receiveBox"),{trigger:!0}):this.imSysMsgCBService.openSysMsgEntity(a)},setMsgRefuse:function(a){a=
a.data("sysMsgData");this.imSysMsgCBService.setMsgRefuseCallback(a)},setMsgAgree:function(a){a=a.data("sysMsgData");this.imSysMsgCBService.setMsgAgreeCallback(a)},setMsgReadByTaskId:function(a,d){var b=$(this.el).find(".j_im-syswin-msg-list").find(".j_read-sysmsg-item[taskId\x3d"+a+"]");_.each(b,function(a){a=$(a);a.find(".j_status i").removeClass("icon-envelope-alt");a.find(".j_status i").addClass("icon-envelope");a.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u672a\u8bfb");a.removeClass("j_read-sysmsg-item")})},
imSysBoxNotify:function(a,d){var b=a.message.datas.msg_type;2!=this.readFlag||this.imSysMsg.sgroup!=b.group||this.imSysMsg.stype&&this.imSysMsg.stype!=b.type||($(this.el).find(".j_noMesInfo").addClass("hide"),this.renderSysMsgOne(a.message.datas,d,!0))},sysMsgUpdateNotify:function(a){var d=this,b=a.msgId;if(d.imSysMsg.sgroup==a.msgType.group&&2==d.readFlag){var c=$(d.el).find(".j_im-syswin-msg-list").find("#"+b);c&&0<c.length&&d.imCommonSysMsgView.sysMsgUpdateNotify(a,function(a){c.addClass("j_read-sysmsg-item");
d.renderSysMsgByTpl(c,a.message.datas.msg)})}},markReadSysMsgOne:function(a){var d=a.data("sysMsgData").msg_type.type,b=[];b.push({msgId:a.attr("id"),type:d});a.find(".j_status i").removeClass("icon-envelope-alt");a.find(".j_status i").addClass("icon-envelope");a.find(".j_status i").attr("data-original-title","\u6807\u8bb0\u672a\u8bfb");a.removeClass("j_read-sysmsg-item");this.setSysMsgReadStatusReq({datas:b,flag:"4"})},remove:function(){$(this.el).off(".ImSysWin");$(this.el).empty()}});p.exports=
n});
define("im/minichat/ImChatWinView","im/component/imUtils im/component/imContants im/component/imCommonModel im/chat/imSingleChatView im/component/imChatComponent im/component/imUserSelectorPanel im/chat/imGroupChatView im/chat/history/imChatHistoryView im/component/emojiarea im/component/atmearea im/component/pasteuploadfile im/component/imFuncPanel im/component/imUsercard im/chat/imMsgReadStatusView im/chat/imGroupDetailView im/component/atmeview teams/base/configmodel im/component/group/anonymous".split(" "),function(n,
s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/component/imCommonModel"),g=n("im/chat/imSingleChatView"),f=n("im/component/imChatComponent"),a=n("im/component/imUserSelectorPanel"),d=n("im/chat/imGroupChatView"),b=n("im/chat/history/imChatHistoryView"),c=n("im/component/emojiarea"),k=n("im/component/atmearea"),e=n("im/component/pasteuploadfile"),w=n("im/component/imFuncPanel"),u=n("im/component/imUsercard"),A=n("im/chat/imMsgReadStatusView"),y=n("im/chat/imGroupDetailView"),
r=n("im/component/atmeview"),x=n("teams/base/configmodel"),v=n("im/component/group/anonymous");n=Backbone.View.extend({initialize:function(a){this.configmodel=new x;this.imChatMsgCBService=window.imEteamsJsService.ImChatMsgCBService;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imGroupCacheManager=window.imCacheData.imGroupCacheManager;this.mcsTopPct=100;this.isFirst=!0;this.minMsgId=void 0;this.inputEl="#im-chatwin-textarea";this.chatType=a.chatType;this.isHideAtView=a.isHideAtView;
this.imChatUser=a.imChatUser;this.imChatGroup=a.imChatGroup;this.el="#"+l.IM_CHATWIN_EL;this.imChatBoxContentEl=".j_im-chatwin-msg-container";this.imChatBoxContentKindEl=".j_im-chatwin-kind-msg-container";this.imChatBoxContentExtEl=".j_im-chatwin-msg-ext-container";this.count=a.count;this.wheelPageUnlLocked=!1;this.isUnread=!0;this.chatMsgLimit=1E3;this.autoTurnByReplyPageNum=this.autoTurnPageNum=0;this.isFirst=!0;this.groupExistIdArray=[];this.attachmentUploader;this.imgUploader;this.selectedText;
this.readStatusAllow=!1;this.isOnline=!0;this.listPosiTop=9999;this.hideReplyCount=this.listPosiBottom=0;this.chatBoxType="chat";this.groupExist=void 0;this.isHelper=a.isHelper;this.initChatMsgViewTpl();this.getMoreCount=0;this.initToolBar()},delegateEvents:function(){var e=this,c=$(e.el);e.renderPortalChatHead();e.initWebUpload();e.initImPortalChatUploaders();if("groupChat"==e.chatType)e.imGroupCacheManager.syncGroupMemberList({groupId:e.imChatGroup.id,forceUpdate:!1},function(){var a=$(".j_im-chatgroup-view");
e.renderGroupMembers(a)});else{var k=$(".j_im-chatgroup-view");k.find(".j_im-exit-group").addClass("hide");e.renderGroupMembers(k)}m.layout(".j_im-chatwin-msg-scrollbar",{whileScrolling:function(){e.mcsTopPct=this.mcs.topPct;e.listPosiTopTemp&&(this.mcs.top=-1*e.listPosiTopTemp,e.listPosiTop=e.listPosiTopTemp,e.listPosiTopTemp=void 0);e.mcsTop=this.mcs.top;e.listPosiTop>0-this.mcs.top&&(e.listPosiTop=0-this.mcs.top);var a=$(e.el).find(".j_im-chatwin-msg-container").height()-this.mcs.top;e.listPosiBottom<
a&&(e.listPosiBottom=a);e.readStatusAllow&&e.isOnline&&e.getScreenMsg(e.listPosiTop,e.listPosiBottom);100==e.mcsTopPct?(a=$(e.el).find(".j_im-chat-bottom-push"),a.addClass("hide").find("span.text").empty(),a.find("span.j_text").attr("number",0)):3>e.mcsTopPct&&e.wheelPageUnlLocked&&($(e.el).find(".j_im-chat-unread-top").addClass("hide"),e.wheelPageUnlLocked&&$(e.el).find(".j_im-more-chatMessage").trigger("click"))}},[{scrollInertia:500,mouseWheel:{scrollAmount:350}}]);c.off("uploadPasteImage.ImChatWin").on("uploadPasteImage.ImChatWin",
function(){e.webUploader.upload()});c.off("openFrameTrigger.ImChatWin").on("openFrameTrigger.ImChatWin",function(){e.renderWhenNoScrollbar()});c.off("click.ImChatWin",".j_im-chat-unread-top").on("click.ImChatWin",".j_im-chat-unread-top",function(a){a.stopPropagation();$(this).addClass("hide");$(e.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo","top");setTimeout(function(){e.getScreenMsg(e.listPosiTop,e.listPosiBottom,!0);setTimeout(function(){e.wheelPageUnlLocked=
!0},600)},600)});c.off("click.ImChatWin",".j_im-chat-bottom-push").on("click.ImChatWin",".j_im-chat-bottom-push",function(a){a.stopPropagation();$(a.target).hasClass("j_im-chat-scroll-remove")||(e.scrollToNewMessage(a,!0),setTimeout(function(){e.wheelPageUnlLocked=!0;e.getScreenMsg(e.listPosiTop,e.listPosiBottom,!0)},700))});c.off("setHelperGroupNameDatas.ImChatWin").on("setHelperGroupNameDatas.ImChatWin",function(a,b){a.stopPropagation();if(b){var c=$(e.el).find(".j_view-head .j_im-chat-name-input");
c.removeClass("j_im-user-avatar-trigger");c.addClass("im-cp");c.addClass("im-clickable");c.addClass("j_im-chatwin-name-clickevent");for(var k in b)c.data(k,b[k])}});c.off("click.ImChatWin",".j_im-chatwin-name-clickevent").on("click.ImChatWin",".j_im-chatwin-name-clickevent",function(a,b){a.stopPropagation();var e=$(this),c=e.data("imChatUser");h.syncCorpInfoReq(c.cid,function(b){h.getEntityIdByTenantKeyAndModule({tenantKey:b.datas[0].account,module:"customer"},function(b){(b=b.data)&&0<b.length?($("#imFuncPanel").trigger("closePanel"),
(new w({targetEl:e,pointX:a.pageX,pointY:a.pageY,funcType:"customerList",crmList:b})).render()):m.notify("\u6682\u65e0\u6743\u9650\u6253\u5f00\u8be5\u5ba2\u6237\u7684\u5361\u7247")})})});c.off("saveImChatDraft.ImChatWin").on("saveImChatDraft.ImChatWin",function(a){a.stopPropagation();e.saveImChatDraft()});c.off("click.ImChatWin",".j_im-chat-scroll-remove").on("click.ImChatWin",".j_im-chat-scroll-remove",function(a){a.stopPropagation();e.scrollToNewMessage(a,!1)});c.off("click.ImChatWin",".j_reply-info-trigger").on("click.ImChatWin",
".j_reply-info-trigger",function(a){a.stopPropagation();a=$(this).data("rmsg");e.scrollToReplyMsg(a)});c.off("click.ImChatWin",".j_close-chat-top-tip").on("click.ImChatWin",".j_close-chat-top-tip",function(a){a.stopPropagation();$(this).parents(".j_chat-call").addClass("hide-im")});c.off("click.ImChatWin",".j_btn-send").on("click.ImChatWin",".j_btn-send",function(a){a=$(this);var b=a.parents("#chat-editor-div").find("#im-chatwin-textarea");e.sendChatTextMsg(a,b);e.countWordNum($(e.el).find("#im-chatwin-textarea"))});
c.off("click.ImChatWin",".j_im-chat-sender-avatar-trigger").on("click.ImChatWin",".j_im-chat-sender-avatar-trigger",function(a){a.stopPropagation();a=$(this).data("imChatUser");e.imChatMsgCBService.clickSenderAvatar(a)});c.off("uploadPasteImage.ImChatWin").on("uploadPasteImage.ImChatWin",function(){e.webUploader.upload()});c.off("sendChatMsgAndBack.ImChatWin").on("sendChatMsgAndBack.ImChatWin",function(a,b){e.imChatView.sendChatMsgAndBack(b)});c.off("click.ImChatWin",".j_im-user-avatar-trigger").on("click.ImChatWin",
".j_im-user-avatar-trigger",function(a){a.stopPropagation();var b=$(this),c=b.data("imChatUser");c.cid==window.imCurrentUser.cid?e.imChatMsgCBService.clickSenderAvatar(c,b):($("#"+l.IM_USERCARD).trigger("closePanel"),0<$("#usercard").length&&$("#usercard").trigger("closeUsercard"),(new u({targetEl:b,pointX:a.pageX,pointY:a.pageY,uidCid:{uid:c.uid,cid:c.cid},isHelper:e.isHelper,chatType:e.chatType})).render())});c.off("click.ImChatWin",".j_im-group-member-avatar-trigger").on("click.ImChatWin",".j_im-group-member-avatar-trigger",
function(a){a.stopPropagation();a=$(this);var b=a.parents(".j_im-user-avatar-trigger").data("imChatUser");e.imChatMsgCBService.clickSenderAvatar(b,a)});c.off("click.ImChatWin",".j_chat-tabbar .j_im-chat-tab").on("click.ImChatWin",".j_chat-tabbar .j_im-chat-tab",function(a){a=$(this);a.hasClass("active")||e.switchImChatHeadTab(a)});c.off("click.ImChatWin",".j_im-chat-head-tab-more-list .j_im-chat-tab-more").on("click.ImChatWin",".j_im-chat-head-tab-more-list .j_im-chat-tab-more",function(a){a=$(this);
e.switchImChatHeadTab(a)});c.off("click.ImChatWin",".j_at-obj-trigger").on("click.ImChatWin",".j_at-obj-trigger",function(a){a.stopPropagation();a=$(this);var b={id:a.attr("objId"),name:a.attr("objName"),type:a.attr("objType")};e.imChatMsgCBService.triggerAtObjData(b,a)});c.off("keydown.ImChatWin","#im-chatwin-textarea").on("keydown.ImChatWin","#im-chatwin-textarea",function(a){var b=a.keyCode,k=$(this),d=k.val();"groupChat"!=e.chatType||e.isAnonymous||e.atmeview.keyDownFilter(a);if("CtrlEnter"==
(c.find(".j_sendType_menu").data("type")||"CtrlEnter")){if(a.ctrlKey&&13==a.which){if("groupChat"==e.chatType&&!e.groupExist){m.notify("\u60a8\u5df2\u4e0d\u5728\u8be5\u7fa4\u4e2d\uff0c\u65e0\u6cd5\u53d1\u9001\u6d88\u606f");return}a=k.parents("#chat-editor-div").find(".j_btn-send");e.sendChatTextMsg(a,k);return!1}}else if(13==b)if(a.ctrlKey)k.val(k.val()+"\r\n");else{if("groupChat"==e.chatType&&!e.groupExist){m.notify("\u60a8\u5df2\u4e0d\u5728\u8be5\u7fa4\u4e2d");return}a=k.parents("#chat-editor-div").find(".j_btn-send");
e.sendChatTextMsg(a,k);return!1}(8==b||46==b)&&1>d.length&&(e.hideReplyCount++,1<e.hideReplyCount&&(k=$(e.el).find(".j_input-reply-content-field"),e.hideReplyCount=0,e.resetInputAreaSize(!1),k.addClass("hide-im"),e.replyMsg=void 0))});c.off("keyup.ImChatWin","#im-chatwin-textarea").on("keyup.ImChatWin","#im-chatwin-textarea",function(a){e.countWordNum($(this))});c.off("paste.ImChatWin","#im-chatwin-textarea").on("paste.ImChatWin","#im-chatwin-textarea",function(a){var b=this;window.setTimeout(function(){e.countWordNum($(b))},
200)});c.off("setMsgReadStatusNotify.ImChatWin").on("setMsgReadStatusNotify.ImChatWin",function(a,b){var c=b.groupId,k=b.flag;e.imChatGroup.rsOnOff=k;e.imChatView.syncImChatGroupPageCache(e.imChatGroup);if("groupChat"==e.chatType&&c==e.imChatGroup.id)switch(c=$(e.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),k){case "0":c.find(".j_chat-message .j_im-chatmsg-readStatus").addClass("hide-im");break;case "1":c.find(".j_chat-message .j_im-chatmsg-readStatus").removeClass("hide-im")}});
c.off("modifyLimitNum.ImChatWin").on("modifyLimitNum.ImChatWin",function(a){a="";var b=$(e.el).find("#im-chatwin-textarea").val();b||$(e.el+" #limitTip").text("\u8fd8\u53ef\u4ee5\u8f93\u51651000\u5b57");b.length<=e.chatMsgLimit?a="\u8fd8\u53ef\u4ee5\u8f93\u5165"+(e.chatMsgLimit-b.length)+"\u5b57":b.length>e.chatMsgLimit&&(a="\u5df2\u8d85\u51fa"+(b.length-e.chatMsgLimit)+"\u5b57");$(e.el+" #limitTip").text(a)});c.off("click.ImChatWin",".j_sendType_menu li").on("click.ImChatWin",".j_sendType_menu li",
function(a){a=$(this);a.hasClass("active")||e.setEnterKey(a.data("type"),!0)});c.off("click.ImChatWin",".j_im-entity-selector-toggle").on("click.ImChatWin",".j_im-entity-selector-toggle",function(a,b){e.imChatMsgCBService.openImEntitySelector($(this),c.find("textarea.j_im-chatwin-textarea"));$("#selector-relevance .selector-btns").remove()});c.off("click.ImChatWin",".j_im-video-play").on("click.ImChatWin",".j_im-video-play",function(a,b){var c=$(this);clearInterval(c.timer);var k=c.parents(".j_weixinAudio"),
c=$(this).parents(".j_audio_area"),k=k.find("audio"),d=k.attr("status"),g=$(e.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list").find(".chat-message[type\x3d3]");if(g&&0<g.length)for(var h=0;h<g.length;h++){var w=$(g[h]);f.optAudioMsg(w.find(".j_audio_area"),w.find("audio"),"close")}"off"==d&&f.optAudioMsg(c,k,"open")});c.off("sendEntityMessage.ImChatWin",".j_im-chatwin-textarea").on("sendEntityMessage.ImChatWin",".j_im-chatwin-textarea",function(a,b){e.imChatMsgCBService.sendEntityMsgPre({chatType:e.chatType,
imChatUser:e.imChatUser,imChatGroup:e.imChatGroup,imEntity:b,imCurrentUser:window.imCurrentUser},function(){e.sendChatEntityMsg(b)})});c.off("fastSendEntityMessage.ImChatWin").on("fastSendEntityMessage.ImChatWin",function(a,b){var c={chatType:e.chatType,imChatUser:e.imChatUser,imChatGroup:e.imChatGroup,imEntity:b,imCurrentUser:window.imCurrentUser};e.sendChatEntityMsg(b);setTimeout(function(){e.imChatMsgCBService.sendEntityMsgPre(c)},1E3)});c.off("click.ImChatWin",".j_im-chat-quick-at").on("click.ImChatWin",
".j_im-chat-quick-at",function(a){a=$(this).parents(".j_chat-message").find(".j_avatar img").data("imChatUser");e.atmeview.insertAtMember({id:a.id,name:a.name,atType:"user"},e)});c.off("click.ImChatWin",".j_chat-head-at-read").on("click.ImChatWin",".j_chat-head-at-read",function(a){a.stopPropagation();a=$(this);var b=a.data("msgId");e.scrollTbackPosition(b);a.addClass("hide-im")});c.off("click.ImChatWin",".j_im-send-shakemsg").on("click.ImChatWin",".j_im-send-shakemsg",function(a){a.stopPropagation();
a=e.imChatUser.uid+"-"+e.imChatUser.cid;var b=window.imCacheData.imChatShakeCache[a],c=(new Date).getTime();b&&3E4>c-b.t?e.sendChatTipMsg():(b={t:c},window.imCacheData.imChatShakeCache[a]=b,e.sendChatShakeMsg(),$("#"+l.IM_MINI_PAGE).trigger("imFrameShake.miniChatPage",{isSelf:!0}))});c.off("markMsgBack.ImChatWin").on("markMsgBack.ImChatWin",function(a,b){a.stopPropagation();var c=b.mesData,k=window.imCurrentUser.uid,d=window.imCurrentUser.cid;if(c){var f=c.ser_msgid,g=c.sname;g||(g=c.msg.sname);var h=
"\u64a4\u56de\u4e86\u4e00\u6761\u6d88\u606f";g&&(h=g+h);b.uid=k;b.cid=d;b.msgId=f;b.kind="1001";b.sname=g;b.defaultMsg=h;b.isHelper=e.isHelper;b.isAnonymous="1"===c.msg.display;var w=e.imChatView.markMsgBack(b,function(a){switch(a.message.ret.ret){case "0":window.imCurrentUser.uid!=c.to_uid&&(b.isSelf=!0);b.msgObj=w.msgObj;b.subtitleObj=w.subtitleObj;e.markChatMsgBack(b,w);break;case "1505":m.notify("\u64a4\u56de\u5931\u8d25\uff0c\u8be5\u6d88\u606f\u53d1\u9001\u65f6\u95f4\u5df2\u8d85\u8fc73\u5206\u949f\u3002")}})}});
c.off("forwardMsg.ImChatWin").on("forwardMsg.ImChatWin",function(b,c){b.stopPropagation();var k=c.mesData;k&&(e.imUserSelectorPanel=new a({imChatGroup:e.imChatGroup,selectType:0,limitUserCount:10,confirmFunc:function(a){a&&0<a.length&&e.forwardMsg(a,k)}}),e.imUserSelectorPanel.render())});c.off("onMaskGroupMsg.ImChatWin").on("onMaskGroupMsg.ImChatWin",function(a,b){var c=b.mesData;if(c){var k=c.ser_msgid,d=window.imCurrentUser.name,f="\u8be5\u6d88\u606f\u5df2\u88ab\u7ba1\u7406\u5458 ["+d+"] \u4e8e ["+
m.confirmDate()+"] \u5c4f\u853d";b.cid=window.imCurrentUser.cid;b.uid=window.imCurrentUser.uid;b.scid=window.imCurrentUser.cid;b.suid=window.imCurrentUser.uid;b.msgId=k;b.kind="1001";b.sname=c.msg.sname;b.maskName=d;b.defaultMsg=f;b.isHelper=!!e.isHelper;b.isAnonymous="1"===c.msg.display;var g=e.imChatView.maskMsg(b,function(a){a=a.message.ret.ret;"0"===a?(b.msgObj=g.msgObj,b.subtitleObj=g.subtitleObj,e.maskGroupMsg(b)):"1210"===a?m.notify("\u64cd\u4f5c\u5931\u8d25\uff0c\u60a8\u6ca1\u6709\u64cd\u4f5c\u6743\u9650"):
m.notify("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5")})}return!1});$(e.el).off("click.ImChatWin",".j_chat-head-at-close").on("click.ImChatWin",".j_chat-head-at-close",function(a){a.stopPropagation();$(this).parents(".j_chat-head-at-read").addClass("hide-im")});c.off("click.ImChatWin",".j_im-more-chatMessage").on("click.ImChatWin",".j_im-more-chatMessage",function(a){$(a.currentTarget).hasClass("hide")||(e.isFirst&&(e.isFirst=!1),e.lastDivId=e.kind&&0<e.kind?c.find(".j_im-chatwin-kind-msg-container .j_im-chatwin-msg-list div").get(0).id:
c.find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list div").get(0).id,m.timeoutControll($(this),1E3)&&e.turnPage("up"))});c.off("click.ImChatWin","#im-chatwin-history").on("click.ImChatWin","#im-chatwin-history",function(a){"groupChat"==e.chatType&&!e.groupExist&&e.isHelper?m.notify({zh_CN:"\u60a8\u5df2\u4e0d\u5728\u8be5\u5ba2\u6237\u7fa4\u5185\uff0c\u65e0\u6cd5\u67e5\u770b\u5386\u53f2\u6d88\u606f",zh_TW:"\u60a8\u5df2\u4e0d\u5728\u8a72\u5ba2\u6236\u7fa4\u5167\uff0c\u7121\u6cd5\u67e5\u770b\u6b77\u53f2\u6d88\u606f",
en_US:"You are not in this group, cannot refer the messages"}[TEAMS.perLang]):(e.imChatHistoryView=new b({imChatGroup:e.imChatGroup,imChatUser:e.imChatUser,chatType:e.chatType,isHelper:e.isHelper}),e.imChatHistoryView.render())});$("body").off("click.ImChatWin").on("click.ImChatWin",function(a){0!=$(a.target).parents(".j_im-group-member-panel").length||$(a.target).hasClass("chat-name")||0!=$(a.target).parents(".chat-name").length||c.find(".j_im-portal-chat-head:not(.hide) .j_members.on").trigger("click")});
c.off("confirmHandler.ImChatWin",".j_im-group-add-member").on("confirmHandler.ImChatWin",".j_im-group-add-member",function(a,b){var c=$(this),k=b.objs;if(!(1>k.length))if("singleChat"==e.chatType)e.createImGroup(k);else if("groupChat"==e.chatType){var d=[];k&&k.length&&k.forEach(function(a){var b=!1;e.groupExistIdArray&&0<e.groupExistIdArray.length&&e.groupExistIdArray.forEach(function(e){e==a.id&&(b=!0)});b||d.push(a)});d&&0<d.length&&e.inviteToGroup(c,d);e.groupExistIdArray=[]}});c.off("click.ImChatWin",
".j_im-group-add-member").on("click.ImChatWin",".j_im-group-add-member",function(b,c){var k=$(this),d=[];switch(e.chatType){case "groupChat":var g=f.getImGroupMemberCache("groupMemberKeyArray-"+e.imChatGroup.id),h;for(h in g.imGroupMemberCacheMap){var w=g.imGroupMemberCacheMap[h];w&&d.push({uid:w.uid,cid:w.cid})}d={selectType:0,limitUserCount:200,componentType:1,existUsers:d,confirmFunc:function(a){if(a&&0<a.length){var b=[];a.forEach(function(a){a&&"singleChat"==a.chatType&&b.push(a.imChatUser)});
b&&0<b.length&&e.inviteToGroup(k,b)}}};e.imUserSelectorPanel=new a(d);e.imUserSelectorPanel.render();break;case "singleChat":d={selectType:0,limitUserCount:30,defaultCreateObjArray:[{chatType:"singleChat",imChatUser:e.imChatUser}],existUsers:[window.imCurrentUser],componentType:1,confirmFunc:function(a){if(a&&0<a.length){var b=[];a.forEach(function(a){a&&"singleChat"==a.chatType&&b.push(a.imChatUser)});f.createImGroup({users:b},function(a){a={imChatGroup:{id:a.message.group_id,name:a.message.name,
userNum:b.length,exist:"1"},resDatas:a.message,users:b};$("#"+l.IM_ADDRLIST_EL).trigger("createImChatGroup",a)})}}},e.imUserSelectorPanel=new a(d),e.imUserSelectorPanel.render()}});c.off("click.ImChatWin",".j_im-exit-group").on("click.ImChatWin",".j_im-exit-group",function(a){m.confirm("\u786e\u8ba4\u9000\u51fa\u7fa4\u7ec4?",function(a){a&&e.exitImChatGroup()})});c.off("mouseup.ImChatWin",".j_im-chat-msg-opt").on("mouseup.ImChatWin",".j_im-chat-msg-opt",function(a){e.selectedText=window.getSelection().toString()});
c.off("mouseleave.ImChatWin",".j_im-chat-msg-opt").on("mouseleave.ImChatWin",".j_im-chat-msg-opt",function(a){e.selectedText=""});c.off("mousewheel.ImChatWin",".j_im-chatwin-msg-scrollbar").on("mousewheel.ImChatWin",".j_im-chatwin-msg-scrollbar",function(a){e.wheelQueryMoreMessage(a)});c.off("imChatBoxNotify.ImChatWin").on("imChatBoxNotify.ImChatWin",function(a,b){var c=$(e.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),k=!1,d=!1;switch(e.chatType){case "singleChat":var f=b.message.from_uid;
f&&e.imChatUser.id==f&&(k=!0);break;case "groupChat":(f=b.message.group_id)&&e.imChatGroup.id==f&&(k=!0)}b.message.datas.from_uid==window.imCurrentUser.uid&&(d=!0);f=!1;e.isOnline||(f=!0);b.isHelper=e.isHelper;e.imChatView.imChatBoxNotify(b,f,k,d,c);"chat"==e.chatBoxType&&e.renderNewMessageRemind(b,k,d)});c.off("mousedown.ImChatWin",".j_im-chat-msg-opt").on("mousedown.ImChatWin",".j_im-chat-msg-opt",function(a){var b=$(this),c=b.parents(".j_chat-message"),k=c.data("mesData");3==a.which&&($("#imFuncPanel").trigger("closePanel"),
(new w({targetEl:b,pointX:a.pageX,pointY:a.pageY,mesData:k,funcType:"chatMsg",chatType:e.chatType,msgType:c.attr("msg-type"),selectedText:e.selectedText,isHelper:e.isHelper})).render())});c.off("contextmenu.ImChatWin",".j_im-chat-msg-opt").on("contextmenu.ImChatWin",".j_im-chat-msg-opt",function(a){a.stopPropagation();a.preventDefault();return!1});c.off("markChatMsgBackNotify.ImChatWin").on("markChatMsgBackNotify.ImChatWin",function(a,b){e.markChatMsgBackNotify(b)});c.off("onMaskGroupMsgNotify.ImChatWin").on("onMaskGroupMsgNotify.ImChatWin",
function(a,b){e.maskGroupMsg(b)});$(window).off("resize.ImChatWin").on("resize.ImChatWin",function(a){e.resizeLocked||(e.resizeLocked=!0,e.renderKindChatTab())});c.off("click.ImChatWin",".j_trigger-usercard").on("click.ImChatWin",".j_trigger-usercard",function(a){a.stopPropagation();var b=$(this),c=b.parents(".j_chat-message").find(".j_avatar img").data("imChatUser");c.cid==window.imCurrentUser.cid?e.imChatMsgCBService.clickSenderAvatar(c,b):($("#"+l.IM_USERCARD).trigger("closePanel"),0<$("#usercard").length&&
$("#usercard").trigger("closeUsercard"),(new u({targetEl:b,pointX:a.pageX,pointY:a.pageY,uidCid:{uid:c.uid,cid:c.cid},isHelper:e.isHelper,chatType:e.chatType})).render())});c.off("click.ImChatWin",".j_send-msg-again").on("click.ImChatWin",".j_send-msg-again",function(a,b){var c=$(this),k=c.data("file"),d=c.data("pasteData"),f=c.data("tempMsgId");m.notify("\u6b63\u5728\u91cd\u53d1\u4e2d");c.hasClass("j_disabled")||(c.addClass("j_disabled"),e.attachmentUploader&&k&&(c=e.attachmentUploader.getFile(k.id))&&
(c.status=1,c.tempMsgId=f,e.attachmentUploader.start()),e.imgUploader&&k&&(c=e.imgUploader.getFile(k.id))&&(c.status=1,c.tempMsgId=f,e.imgUploader.start()),d&&(d.tempMsgId=f,e.retryPaste(d,function(a){a.pasteData=d;e.sendChatPicMsg(e,a,!0)})))});c.off("click.ImChatWin",".j_check-addr").on("click.ImChatWin",".j_check-addr",function(a){a=$(this).data("location");e.mapWindowView&&(f.removeChatMap(e.mapWindowView),e.mapWindowView=null);e.mapWindowView=f.openChatMap(a)});c.off("singleReadNotify.ImChatWin").on("singleReadNotify.ImChatWin",
function(a,b){"singleChat"==e.chatType&&e.renderSingleReadedStatus(b)});c.off("groupReadNotify.ImChatWin").on("groupReadNotify.ImChatWin",function(a,b){"groupChat"==e.chatType&&e.renderGroupReadedStatus(b)});c.off("click.ImChatWin",".j_im-open-group-panel").on("click.ImChatWin",".j_im-open-group-panel",function(a,b){var c=$(this),k=$(e.el).find(".j_im-chatgroup-view"),d=$(e.el).find(".j_im-chat-unread-top");k.hasClass("off")?(c.attr("data-original-title","\u5173\u95ed\u6210\u5458\u5217\u8868"),k.removeClass("off"),
d.css("right","150px"),e.openGroupMemberPanel()):(c.attr("data-original-title","\u6253\u5f00\u6210\u5458\u5217\u8868"),k.addClass("off"),d.css("right","0px"))});c.off("click.ImChatWin",".j_im-open-group-detail").on("click.ImChatWin",".j_im-open-group-detail",function(a){(new y({imChatGroup:e.imChatGroup,chatType:"groupChat",isHelper:e.isHelper})).render()});$("body").off("click.ImChatWin").on("click.ImChatWin",function(a,b){var c=$(a.target);if(!(c.hasClass(".j_im-chatgroup-view")||0<c.parents(".j_im-chatgroup-view").length||
c.hasClass("j_im-open-group-panel")||c.hasClass("j_im-open-group-panel-show")||0<c.parents(".j_im-open-group-panel-show").length)){var c=$(e.el).find(".j_im-open-group-panel"),k=$(e.el).find(".j_im-chatgroup-view");c.attr("data-original-title","\u6253\u5f00\u6210\u5458\u5217\u8868");k.addClass("off")}});c.off("showAtHeadView.ImChatWin").on("showAtHeadView.ImChatWin",function(a,b){$(this);var c=$(e.el).find(".j_chat-head-at-read");e.isHideAtView&&c.addClass("hide-im")});c.off("click.ImChatWin",".j_im-groupmsg-readStatus").on("click.ImChatWin",
".j_im-groupmsg-readStatus",function(a,b){var c=$(this).parents(".j_chat-message");(new A({msgId:c.attr("id"),groupId:e.imChatGroup.id})).render()});c.off("triggerImChatRead.ImChatWin").on("triggerImChatRead.ImChatWin",function(a){e.markImChatRead();$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo","+\x3d1")});c.off("refreshImGroupMemberList.ImChatWin").on("refreshImGroupMemberList.ImChatWin",function(a,b){e.refreshImGroupMemberList(b)});c.off("modifyImGroupNotify.ImChatWin").on("modifyImGroupNotify.ImChatWin",
function(a,b){"groupChat"==e.chatType&&b.group_id==e.imChatGroup.id&&e.modifyImGroupNotify(b)});c.off("updateImGroupDetailNotify.ImChatWin").on("updateImGroupDetailNotify.ImChatWin",function(a,b){a.stopPropagation();a.preventDefault();e.updateImGroupDetailNotify(b)});c.off("updateCurrentGroupMember.ImChatWin").on("updateCurrentGroupMember.ImChatWin",function(a,b){a.stopPropagation();a.preventDefault();e.updateCurrentGroupMember(b)});c.off("syncImChatGroupPageCache.ImChatWin").on("syncImChatGroupPageCache.ImChatWin",
function(a,b){a.stopPropagation();a.preventDefault();e.imChatView.syncImChatGroupPageCache(b.imChatGroup)});c.off("closePasteImgNotify.ImChatWin").on("closePasteImgNotify.ImChatWin",function(a,b){a.stopPropagation();a.preventDefault();e.webUploader.reset()});c.off("replyChatMsg.ImChatWin").on("replyChatMsg.ImChatWin",function(a,b){a.stopPropagation();a.preventDefault();var c=b.mesData,k=$(e.el).find(".j_input-reply-content-field");k.removeClass("hide-im");var d=c.msg,g=d.sname;"1"===d.display&&(g=
"["+v.il8n("anonymity")+"] "+g);k.find(".j_info-base .j_name").text(g);var h;switch(d.type){case "1":h=d.dt[0].txt.aus;g=d.dt[0].txt.v;"12"===d.typeBak&&(g=m.getMsgContent(d,window.imCurrentUser));break;default:g=m.getLastTxtByMsgType(d.type)}g=m.subStringByLength(g,56);e.replyMsg={id:c.ser_msgid,t:d.type,time:1E3*c.msgtime,fname:d.sname,display:d.display,fuser:{uid:c.from_uid?c.from_uid:window.imCurrentUser.uid,cid:c.from_cid?c.from_cid:window.imCurrentUser.cid},rcon:g,aus:h};"12"===d.typeBak&&(e.replyMsg.msg=
d);k.data("rmsg",e.replyMsg);g=$.faceConvert(g);e.replyMsg.aus&&(g=f.buildReplyMsgTitle(e.replyMsg.aus,e.replyMsg.rcon,e.replyMsg.t));k.find(".j_info-detail").html(g);c=Date.create(e.replyMsg.time);k.find(".j_date").text(c.format("{HH}:{mm}:{ss}"));e.resetInputAreaSize(!0);$(e.el).find("#im-chatwin-textarea").focus()});$(e.el).find(".j_im-size-editor").resizable({handles:"n",minHeight:200,maxHeight:320,resize:function(a,b){$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").attr("marginbottom",
b.size.height);$(".j_im-chatwin-msg-scrollbar").trigger("resizeSroll",{resizeImScroll:!0});var c=0,k=$(e.el).find(".j_im-size-editor .j_input-reply-content-field");k.is(":visible")&&(c=k.innerHeight());$("#im-chatwin-textarea").height(b.size.height-80-c);$(".j_im-chat-bottom-push").css("bottom",b.size.height+5+"px");window.localStorage&&localStorage.setItem("imdragsize_toolbox_h_"+window.imCurrentUser.uid,b.size.height)},stop:function(a,b){setTimeout(function(){$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo",
"bottom")},300)}}).on("resize",function(a){a.stopPropagation()});c.off("beforeSwitchSession.ImChatWin").on("beforeSwitchSession.ImChatWin",function(a,b){"group"===b.type&&e.snapshoot(e.imChatGroup,b.data)}).off("afterSwitchSession.ImChatWin").on("afterSwitchSession.ImChatWin",function(a,b){"group"===b.type&&e.recovery(b.data)})},resetInputAreaSize:function(a){if(this.replyMsg){var b=$("#"+l.IM_CHATWIN_EL).find(".j_input-reply-content-field"),e=$("#"+l.IM_CHATWIN_EL).find("#im-chatwin-textarea");a?
e.height()>b.innerHeight()&&e.height(e.height()-b.innerHeight()):e.height(e.height()+b.innerHeight())}},render:function(a){this.imChatView&&(this.listPosiTop=9999,this.listPosiBottom=0,$(this.el).find(".j_im-chatwin-msg-container").data("msgHeightDatas",""),"groupChat"==this.chatType?this.renderBase(a):this.imChatUser.id!=window.imCurrentUser.uid?this.renderBase(a):($(this.imChatBoxContentEl).addClass("hide"),$(this.imChatBoxContentExtEl).removeAttr("style").removeClass("hide").trigger("resizeSroll",
{resizeImScroll:!0}),$(this.el).find("#chat-editor-div").addClass("hide"),a={},a.imChatUser=this.imChatUser,a.imChatBoxContentEl=this.imChatBoxContentExtEl,$(this.el).find(".j_im-group-add-member").addClass("hide-im"),this.imChatMsgCBService.openSelfPortalChat(a)),a=!0,1>this.count&&(a=!1),a&&this.markImChatRead(),this.loadImChatDraft(),$("#"+l.IM_FRAME_EL).trigger("saveWinComModule.ImFrameView",this))},renderBase:function(a){var b=this;$(b.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list").empty();
b.renderUnreadMessageRemind(b.count);var e={renderOrder:"down",$listContainer:$(b.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),$scrollBar:$(b.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar")};b.count&&0<b.count&&(e.maxNum=b.count);e.isHelper=b.isHelper;"groupChat"==b.chatType&&void 0==b.groupExist?b.imChatView.isGroupMemberReq({},function(c){"1"==c.message.datas[0].ret&&(b.groupExist=!0);b.renderBaseCallback(e,a)}):b.renderBaseCallback(e,a)},renderBaseCallback:function(a,
b){var e=this;a.groupExist=e.groupExist;e.imChatView.render(a,function(a){var c=$(e.el).find(".j_im-chatwin-msg-container").find(".mCSB_scrollTools_vertical").css("display");if(!c||"none"!=c){var c=$(e.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),k=c.find(".mCSB_container").height(),d=c.height(),k=-1*(k-d);c.find(".mCSB_container").css("top",k+"px")}$(e.el).find("#im-chat-list-loading").addClass("hide");e.count-=a.length;0<e.count&&e.turnPage();if(a&&0<a.length&&"0"!=a[a.length-
1].next_id)switch(e.chatType){case "singleChat":a[0].chatTypeNo="1";break;case "groupChat":a[0].chatTypeNo="2",a[0].group_id=e.imChatGroup.id}else $(e.el).find(".j_im-more-chatMessage").addClass("hide");b&&b()});var c=_.find(TEAMS.userConfig,function(a){return"chat.enter.key"==a.configKey});e.setEnterKey(c&&c.configValue);setTimeout(function(){var a=$(e.el),b=a.find(".j_im-chatwin-msg-container"),c=a.find(".j_im-chatwin-msg-container").data("msgHeightDatas");if(c&&c.msgHeightList&&0<c.msgHeightList.length)for(var k=
0;k<c.msgHeightList.length;k++){var d=c.msgHeightList[k];b.find("#"+d.msgId).hasClass("j_msgstatus-unread")?d.readed=!1:d.readed=!0}a=a.find(".j_im-chatwin-msg-container").find(".mCSB_container").css("top");a=a.replace("px","");e.listPosiTopTemp=-1*parseInt(a);e.readStatusAllow=!0;e.renderWhenNoScrollbar();$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo","+\x3d1");$("#im-chatwin-textarea").focus()},1E3)},renderPortalChatHead:function(){var a=this,b=$(a.el),e=
b.find(".j_view-head");switch(a.chatType){case "singleChat":e.find(".j_im-open-group-panel").remove();e.find(".j_name").text(a.imChatUser.name);e.find(".j_name").data("imChatUser",a.imChatUser);e.find(".j_im-group-add-member").attr("title","\u521b\u5efa\u7fa4\u7ec4");"10000"==a.imChatUser.id&&(e.find(".j_name").text({zh_CN:"eteams\u5c0f\u52a9\u624b",zh_TW:"eteams\u5c0f\u52a9\u624b",en_US:"eteams Assistant"}[TEAMS.perLang]),e.find(".j_name").removeClass("im-cp"),e.find(".j_im-group-add-member").remove());
a.imChatUser.flag||(a.renderKindChatTab(),a.renderSingleChatTabExt());break;case "groupChat":e.find(".j_im-group-add-member").attr("data-original-title","\u9080\u8bf7\u5165\u7fa4");if(a.isHelper){var c=b.find(".j_im-chatwin-toolbar");c.find("#chat-entity").parent().remove();c.find(".j_tool-item-at").remove();b.find(".j_chat-tabbar .j_im-chat-kind-tab").remove()}b.find(".j_im-open-group-detail").removeClass("hide-im");e.data("imChatGroup",a.imChatGroup);e.find(".j_name").text(a.imChatGroup.name);e.find(".j_name").attr("groupName",
a.imChatGroup.name);e.find(".j_name").attr("title",a.imChatGroup.name);void 0==a.groupExist?a.imChatView.isGroupMemberReq({},function(b){"1"==b.message.datas[0].ret&&(a.groupExist=!0);a.renderGroupExistPanel()}):a.renderGroupExistPanel();e.find(".j_dynamicTab li").each(function(){var a=$(this).attr("data-show");"#i-groupchat-task"!=a&&"#i-groupchat-other"!=a&&"#i-groupchat-task"!=a||$(this).addClass("hide")});e.find(".j_chat-tabbar j_im-chat-tab:first").addClass("active");$(a.el).find(".j_chat-tabbar").empty();
a.renderKindChatTab()}},renderGroupExistPanel:function(){var a=$(this.el);this.groupExist?(a.find(".j_im-open-group-panel").removeClass("hide-im"),this.isHelper||a.find(".j_im-open-group-detail").removeClass("hide-im"),a.find(".j_im-group-exit-tag").addClass("hide-im"),a.find(".j_im-chatwin-send-btns").removeClass("hide-im"),a.find(".j_im-chatwin-toolbar").removeClass("hide-im"),a.find(".j_im-group-add-member").removeClass("hide-im")):(a.find(".j_im-open-group-panel").addClass("hide-im"),a.find(".j_im-group-add-member").addClass("hide-im"),
a.find(".j_im-open-group-detail").addClass("hide-im"),a.find(".j_im-group-exit-tag").removeClass("hide-im"),a.find(".j_im-chatwin-send-btns").addClass("hide-im"),a.find(".j_im-chatwin-toolbar").addClass("hide-im"));if(this.imChatGroup.mask)switch(this.imChatGroup.mask){case "1":a.find(".j_im-group-entity-tag").removeClass("hide-im")}},renderSingleChatTabExt:function(){var a=!1;this.imChatUser.id==window.imCurrentUser.uid&&(a=!0);var b=this.imChatMsgCBService.imSingleChatHeadTabs;if(a){var e=$(this.el).find(".j_chat-tabbar");
e.find(".j_im-chat-tab.j_im-chat-kind-tab").detach()}else $(this.el).find(".j_im-chat-head-tab-more-tag").removeClass("hide-im").removeClass("hide"),e=$(this.el).find(".j_im-chat-head-tab-more-list"),e.empty();for(var c=0;c<b.length;c++){var k=b[c];if(a){var d=$(this.el).find("#im-chatwin-clone-field .j_im-chat-tab-clone").clone();d.removeClass("j_im-chat-tab-clone");d.attr("type","ext");d.data("tabData",k);d.addClass("j_im-chat-kind-tab");d.text(k.name);"blog"!=k.id&&"subWorkSpace"!=k.id||d.addClass("hide-im");
e.append(d);e.remove(".j_im-chat-tab[type\x3d"+d.attr("type")+"]")}else d=$(this.el).find("#im-chatwin-clone-field .j_im-chat-tab-more-clone").clone(),d.removeClass("j_im-chat-tab-more-clone"),d.data("tabData",k),d.attr("type","ext"),d.attr("id","tabid-"+k.id),d.find("a").text(k.name),"blog"!=k.id&&"subWorkSpace"!=k.id||d.addClass("hide-im");e.append(d)}a={};a.superiorId=window.imCurrentUser.uid;a.subordinateId=this.imChatUser.id;this.isSuperior(a,function(a){a&&a.isSuperior&&(e.find("#tabid-blog").removeClass("hide-im"),
e.find("#tabid-subWorkSpace").removeClass("hide-im"))});1>e.find(".active").length&&e.find("div:first").addClass("active")},renderKindChatTab:function(){var a=this,b=!1;a.imChatUser&&a.imChatUser.id==window.imCurrentUser.uid&&(b=!0);if(!(b||a.imChatUser&&a.imChatUser.flag)){var e=$(a.el).find(".j_chat-tabbar"),c=e.find(".active").attr("kind");e.find(".j_im-chat-tab.j_im-chat-kind-tab").detach();var k=e.width();$(a.el).find(".j_chat-tabbar").parent().width();$(a.el).find(".j_im-chat-head-tab-more-tag").width();
[{type:"chat",name:"\u804a\u5929",kind:"0",chatType:0},{type:"chat",kind:"8000",name:"\u5173\u8054\u4e8b\u9879",chatType:3},{type:"chat",kind:"2001",name:"\u56fe\u7247",chatType:0},{type:"chat",kind:"4001",name:"\u6587\u4ef6",chatType:0},{type:"chat",kind:"3001",name:"\u8bed\u97f3",chatType:0}].forEach(function(b){var d=!1;switch(b.chatType){case 1:"singleChat"==a.chatType&&(d=!0);break;case 2:"groupChat"==a.chatType&&(d=!0);break;case 3:a.isHelper||(d=!0);break;default:if("3001"==b.kind){d=!1;if(void 0!=
window.IsEteamsClient)switch(window.IsEteamsClient()){case 2:d=!0}d=d?!1:!0}else d=!0}d&&(d=$(a.el).find("#im-chatwin-clone-field .j_im-chat-tab-clone").clone(),d.removeClass("j_im-chat-tab-clone"),d.attr("type",b.type),d.attr("kind",b.kind),d.addClass("j_im-chat-kind-tab"),d.text(b.name),b.kind==c&&d.addClass("active"),e.append(d),k+=d.width()+30,e.remove(".j_im-chat-tab[type\x3d"+d.attr("type")+"]"))});1>e.find(".active").length&&(a.notMarkTab||e.find("div:first").addClass("active"));a.resizeLocked=
!1}},isSuperior:function(a,b){$.ajax({type:"get",url:"/base/employee/isSuperiorNew.json",dataType:"json",data:{superiorId:a.superiorId,subordinateId:a.subordinateId},success:function(a){b&&b(a)}})},turnPage:function(){var a=this;a.isFirst&&3>a.autoTurnPageNum?a.autoTurnPageNum+=1:(a.isFirst=!1,a.autoTurnPageNum=0);var b={renderOrder:"up",$listContainer:$(a.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list")};a.count&&0<a.count&&(b.maxNum=a.count);b.kind=a.kind;b.kind&&0<b.kind?(b.$scrollBar=
$(a.el).find(".j_im-chatwin-kind-msg-container.j_im-chatwin-msg-scrollbar"),b.$listContainer=$(a.el).find(".j_im-chatwin-kind-msg-container .j_im-chatwin-msg-list")):(b.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),b.$listContainer=$(a.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"));$(a.el).find("#im-chat-list-loading").removeClass("hide");b.groupExist=a.groupExist;b.isHelper=a.isHelper;a.imChatView.turnPage(b,function(b){$(a.el).find("#im-chat-list-loading").addClass("hide");
0<a.count&&a.isFirst&&(a.count-=b.length,0<a.count&&(a.isUnread=!1,a.turnPage()));$(a.el).find(".j_im-more-chatMessage").addClass("hide");b&&0<b.length&&"0"!=b[b.length-1].next_id&&(a.wheelPageUnlLocked=!0,$(a.el).find(".j_im-more-chatMessage").removeClass("hide"));a.kind&&"0"!=a.kind||setTimeout(function(){var b=$(a.el).find(".j_im-chatwin-msg-container"),e=$(a.el).find(".j_im-chatwin-msg-container").data("msgHeightDatoas");if(e&&0<e.length){for(var c=0;c<e.msgHeightList.length;c++){var k=e.msgHeightList[c];
b.find("#"+k.msgId).hasClass("j_msgstatus-unread")?k.readed=!1:k.readed=!0}a.readStatusAllow=!0;a.listPosiTop=-1*a.mcsTop}},500)})},setEnterKey:function(a,b){var e=$(this.el),c=a||"CtrlEnter",e=e.find(".j_actionbar");e.find(".j_sendType_menu").data("type",c);e.find('ul.j_sendType_menu li[data-type\x3d"'+c+'"]').addClass("active").siblings().removeClass("active");if(b){var k=!1;_.each(TEAMS.userConfig,function(a){"chat.enter.key"==a.configKey&&(a.configValue=c,k=!0)});k||TEAMS.userConfig.push({configKey:"chat.enter.key",
configValue:c});this.configmodel.saveConfig({configKey:"chat.enter.key",configValue:c})}},scrollTbackPosition:function(a){a||(a=this.lastDivId);setTimeout(function(){void 0!=a&&$(".j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo","#"+a)},100)},scrollToNewMessage:function(a,b,e){a=$(a.target).parents(".j_im-chat-bottom-push");a.find("span.j_text").attr("number","0").empty();b&&$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo","bottom");$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("update");
a.addClass("hide")},updateChatMesBody:function(a,b){var e=a.$msgBody,c=a.listContainer,k=a.msgDateTime,d=a.chatType,f=a.msgId;if(f&&!(0<c.find("#"+f).length))return e.attr("id",f),"singleChat"==d&&e.find(".j_name img").remove(),k&&(e.data("msgDateTime",k),c=Date.create(1E3*k),c.is("today")?e.find(".chat-time time").text(c.format("{HH}:{mm}:{ss}")).data("lastDate",c.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")):e.find(".chat-time time").text(c.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")).data("lastDate",
c.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"))),e},renderChatAtOne:function(a){var b=a.mcChatAtRead,e=$("#j_communi-content").find(".j_chat-call");e.find(".j_content-box div").addClass("hide");if(b){e.removeClass("hide");var c=b.sender,k=$(this.el).find("#chat-at-notify-clone").clone().addClass("hide").attr("id",b.id),d={};d.id=a.id;d.mcChatAtRead=b;d.windowId=b.windowId;k.data("atMessage",d);a=c.username+"\uff1a"+a.message;70<a.length&&(a=a.substring(0,68)+"...");k.find(".message").text(a);c.avatar?
k.find(".avatar img").attr("src","/base/download/"+c.avatar):k.find(".avatar img").attr("src","/static/images/avatar.png");e.find(".j_content-box").empty();e.find(".j_content-box").prepend(k);e.find(".j_content-box div.content").first().removeClass("hide")}},rePosition:function(a){var b=$(this.el).find(".mCSB_container").css("top"),b=b.replace("px",""),b=b-a.height();this.newPagePosition=b-=30;$(".j_im-chatwin-msg-scrollbar").find(".mCSB_container").css("top",b+"px")},sendChatTextMsg:function(a,b){if(!(0<
$("#pasteimg").length||0<$("#im-atdiv").length&&!$("#im-atdiv").hasClass("hide")||a.hasClass("disabled"))){a.addClass("disabled");var e=b.val();if(e.isBlank())a.removeClass("disabled"),m.notify("\u8bf7\u8f93\u5165\u9700\u8981\u53d1\u9001\u7684\u6d88\u606f");else if(m.checkEmoji(e))a.removeClass("disabled"),m.notify("\u6682\u4e0d\u652f\u6301\u8f93\u5165\u6cd5\u81ea\u5e26\u7684emoji\u8868\u60c5\uff0c\u8bf7\u5220\u9664\u540e\u91cd\u8bd5\u3002");else if(e.length>this.chatMsgLimit)a.removeClass("disabled"),
m.notify("\u6700\u591a\u53d1\u9001"+this.chatMsgLimit+"\u5b57");else{this.clearImChatDraft();a.removeClass("disabled");var c="1001",k=$(this.el).find(this.inputEl).data("userData");k&&0<k.length&&(c="1002");e=f.dealWithAtMessage(e,k);k={};k.clitxt=e.msg;k.msgType="1";k.aus=e.aus;k.msgTypeConf=c;k.replyMsg=this.replyMsg;$(this.el).find(".j_input-reply-content-field").removeClass("hide-im");this.resetInputAreaSize();this.replyMsg=void 0;this.sendChatMsg(k);$(this.el).find(".j_input-reply-content-field").addClass("hide-im");
b.val("");this.atmeview&&this.atmeview.resetView();$(this.el).hasClass("mode-anonymous")&&$(this.el).find(".btn-anonymous-mode").click()}}},renderGroupMembers:function(a){var b=this,e=a.find(".j_im-group-member-list"),c=$(b.el).find(".j_im-group-member-panel");"groupChat"==b.chatType?(b.imChatGroup.announce&&a.find(".j_chatgroup-info .j_explain .j_value").text(b.imChatGroup.announce),c.hasClass("mCustomScrollbar")||(m.layout(".j_chatgroup-info .j_explain",{},[{scrollInertia:100}]),m.layout(".j_im-chatgroup-view .groupMemberScroll",
{},[{scrollInertia:100}])),e.find(".j_im-chatwin-group-item").detach(),a=$(b.el).find("#im-chatwin-clone-field #im-chatwin-group-clone").clone(),b.imChatView.renderGroupMembers(a,e)):(a.find(".j_chatgroup-info").addClass("hide-im"),a.find(".j_member-search").addClass("hide-im"),a=[{uid:b.imChatUser.uid,cid:b.imChatUser.cid},{uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid}],b.imChatUser.id==window.imCurrentUser.uid&&(a=[window.imCurrentUser.uid]),a.forEach(function(a){f.getImUserInfo(a,
function(c){var k=$(b.el).find("#im-chatwin-clone-field #im-chatwin-group-clone").clone();k.attr("id",c.id);k.data("imChatUser",c);k.find(".j_name").text(c.name);c.avatar&&k.find("img").attr("src","/base/download/"+c.avatar);a==window.imCurrentUser.uid?e.prepend(k):e.append(k)})}))},openGroupMemberPanel:function(){if("groupChat"==this.chatType){var a=$(".j_im-chatgroup-view"),b=a.find(".j_im-group-member-list");this.imChatGroup&&this.imChatGroup.announce&&a.find(".j_chatgroup-info .j_explain .j_value").text(this.imChatGroup.announce);
setTimeout(function(){$(".j_im-chatgroup-view .groupMemberScroll").trigger("resizeSroll",{resizeImScroll:!0})},200);b.find(".j_im-chatwin-group-item").empty();a=$(this.el).find("#im-chatwin-clone-field #im-chatwin-group-clone").clone();this.imChatView.renderGroupMembers(a,b)}},sendChatEntityMsg:function(a){var b=[];a.etype=a.stype;a.ups={};a.ups.targetId=a.id;b.entity=a;b.msgType="8";b.msgTypeConf="8000";b.$scrollBar=$(this.el).find(".j_im-chatwin-msg-scrollbar");b.$listContainer=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");
b.isHelper=this.isHelper;b.isAnonymous=this.isAnonymous;this.imChatView.sendChatMsgAndBack(b);this.backToUnanonynous()},wheelQueryMoreMessage:function(a){0<(a.originalEvent.wheelDelta&&(0<a.originalEvent.wheelDelta?1:-1)||a.originalEvent.detail&&(0<a.originalEvent.detail?-1:1))&&(this.getMoreCount++,2<this.getMoreCount&&100>this.getMoreCount&&(this.getMoreCount=100,this.wheelPageUnlLocked=!0,$(this.el).find(".j_im-more-chatMessage").trigger("click")))},renderNewMessageRemind:function(a,b,e){var c=
this;!e&&b&&(90>c.mcsTopPct?(b=$(c.el).find(".j_im-chat-bottom-push").removeClass("hide"),e=b.find("span.j_text").attr("number"),e=parseInt(e)+1,b.find("span.j_text").attr("number",e).text(e+" \u6761\u65b0\u6d88\u606f")):(c.isOnline?(c.readStatusAllow=!1,c.stopScreen=!0,setTimeout(function(){c.setMsgReadStatusReq([a.message.datas.ser_msgid],function(){setTimeout(function(){c.stopScreen=!1},1E3)})},1E3)):100!=c.mcsTopPct&&(b=$(c.el).find(".j_im-chat-bottom-push").removeClass("hide"),e=b.find("span.j_text").attr("number"),
e=parseInt(e)+1,b.find("span.j_text").attr("number",e).text(e+" \u6761\u65b0\u6d88\u606f")),$(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").mCustomScrollbar("scrollTo","bottom")))},renderUnreadMessageRemind:function(a){5<a&&0!=this.mcsTopPct&&$(this.el).find(".j_im-chat-unread-top").removeClass("hide").find("span.j_text").attr("number",a).text(a+" \u6761\u672a\u8bfb\u6d88\u606f")},sendChatMsg:function(a){a.ver="1.0";a.dev="4";a.container=$(this.el);a.$listContainer=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");
a.imChatGroup||(a.imChatGroup=this.imChatGroup);a.imChatUser||(a.imChatUser=this.imChatUser);a.$scrollBar=$(this.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar");a.isHelper=this.isHelper;a.isAnonymous=this.isAnonymous;this.imChatView.sendChatMsgAndBack(a)},sendChatPicMsg:function(a,b,e){e?(e=b.pasteData,b.fileObj?(b=f.buildImageMsgParams(b),b.msgTypeConf="2001",b.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),b.$listContainer=$(a.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),
e&&e.tempMsgId&&(b.tempMsgId=a.imWebReqMethods.initTempMsgId().toString(),b.isRetry=!0),b.isHelper=a.isHelper,b.isAnonymous=a.isAnonymous,a.imChatView.sendChatMsgAndBack(b)):(b={clitxt:"[\u56fe\u7247]"},b.pasteData=e,b.msgType="1",b.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),b.isAnonymous=a.isAnonymous,e=$("#im-chat-msg-container .j_im-chatwin-msg-container .j_im-chatwin-msg-list #"+e.tempMsgId),1>e.length?a.imChatView.sendUploadFailMsg(b):e.find(".j_send-msg-again").removeClass("j_disabled"))):
(e=b.file,b.jsonData?(b=f.buildImageMsgParams(b.jsonData),b.msgTypeConf="2001",b.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),b.$listContainer=$(a.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),e.tempMsgId&&(b.tempMsgId=e.tempMsgId,b.isRetry=!0),b.isHelper=a.isHelper,b.isAnonymous=a.isAnonymous,a.imChatView.sendChatMsgAndBack(b)):(b={},b.clitxt=e.name,b.file=e,b.msgType="1",b.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),
b.isAnonymous=a.isAnonymous,e=$("#im-chat-msg-container .j_im-chatwin-msg-container .j_im-chatwin-msg-list #"+e.tempMsgId),1>e.length?a.imChatView.sendUploadFailMsg(b):e.find(".j_send-msg-again").removeClass("j_disabled")));a.backToUnanonynous()},sendChatFileMsg:function(a,b){var e=b.file;if(b.jsonData){var c=f.buildAttachMsgParams(b.jsonData);c.msgTypeConf="4001";c.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar");c.$listContainer=$(a.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");
e.tempMsgId&&(c.tempMsgId=e.tempMsgId,c.isRetry=!0);c.isHelper=a.isHelper;c.isAnonymous=a.isAnonymous;a.imChatView.sendChatMsgAndBack(c)}else c={},c.clitxt=e.name,c.file=e,c.msgType="1",c.$scrollBar=$(a.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),c.isAnonymous=a.isAnonymous,e=$("#im-chat-msg-container .j_im-chatwin-msg-container .j_im-chatwin-msg-list #"+e.tempMsgId),1>e.length?a.imChatView.sendUploadFailMsg(c):e.find(".j_send-msg-again").removeClass("j_disabled");a.backToUnanonynous()},
createImGroup:function(a){this.imChatView.createImGroup(a,function(b){b={imChatGroup:{id:b.message.group_id,name:b.message.name,userNum:a.length,exist:"1"},resDatas:b.message,users:a};$("#"+l.IM_ADDRLIST_EL).trigger("createImChatGroup",b)})},inviteToGroup:function(a,b){var e=this;if(b&&0<b.length){var c={},k=1;b.forEach(function(a){c["inviteUserArray-"+k]||(c["inviteUserArray-"+k]=[]);a&&c["inviteUserArray-"+k].push({uid:a.id,cid:window.imCurrentUser.cid,name:a.name});10==c["inviteUserArray-"+k].length&&
k++});for(var d=1;d<=k;d++){var f=c["inviteUserArray-"+d];f&&0<f.length&&(f={users:f},f.isHelper=e.isHelper,e.imChatView.inviteToGroup(f,function(a){window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:e.imChatGroup.id,forceUpdate:!1},function(){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(e.imChatGroup.id,function(a){e.imChatGroup=a;e.imChatView.syncImChatGroupPageCache(a);e.refreshImGroupMemberList({group_id:a.id})})})}))}m.notify("\u9080\u8bf7\u6210\u529f")}},modifyChatGroupName:function(a){var b=
this,e=$.trim(a.text());a=$.trim(a.attr("groupName"));e&&0!=e.length?20<e.length?m.notify("\u7fa4\u7ec4\u540d\u5b57\u6700\u957f20\u4e2a\u5b57"):m.testSpecialMark(e)?m.notify("\u7fa4\u540d\u79f0\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26"):e!=a&&(a={},a.groupName=e,b.imChatView.modifyChatGroupName(a,function(a){if("0"==a.message.ret.ret){m.notify("\u7fa4\u7ec4\u540d\u79f0\u4fee\u6539\u6210\u529f");a=b.imChatGroup.id;b.imChatGroup.name=e;var c=$("#"+l.IM_ADDRLIST_EL).find(".j_im-addrgroup-list");
0<c.length&&0<c.find("#"+a).length&&(c=c.find("#"+a),c.find(".j_name").attr("title",e).text(e));c=$("#"+l.IM_ADDRLIST_EL).find(".j_im-session-list");0<c.length&&0<c.find("#"+a).length&&(c=c.find("#"+a),c.find(".j_name").text(e),c.find(".j_name").attr("groupName",e))}})):m.notify("\u8bf7\u8f93\u5165\u7fa4\u7ec4\u540d\u5b57")},initChatMsgViewTpl:function(){$(this.el).html(m.template("imchat.imchatwin",TEAMS));window.localStorage&&localStorage.getItem("imdragsize_toolbox_h_"+window.imCurrentUser.uid)&&
($(this.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar").attr("marginbottom",localStorage.getItem("imdragsize_toolbox_h_"+window.imCurrentUser.uid)),$(this.el).find(".j_im-size-editor").height(localStorage.getItem("imdragsize_toolbox_h_"+window.imCurrentUser.uid)),$(this.el).find("#im-chatwin-textarea").height(localStorage.getItem("imdragsize_toolbox_h_"+window.imCurrentUser.uid)-80),$(this.el).find(".j_im-chat-bottom-push").css("bottom",Number(localStorage.getItem("imdragsize_toolbox_h_"+
window.imCurrentUser.uid))+5+"px"))},switchImChatHeadTab:function(a){var b=$(this.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),e=a.data("tabData");this.notMarkTab=!1;e&&"subWorkSpace"==e.id?this.notMarkTab=!0:e?$(this.el).find(".j_chat-tabbar .j_im-chat-tab").removeClass("active"):(a.addClass("active"),a.nextAll().removeClass("active"),a.prevAll().removeClass("active"));var c=$(this.imChatBoxContentEl),k=$(this.imChatBoxContentExtEl),d=$(this.imChatBoxContentKindEl);"ext"==a.attr("type")?
("subWorkSpace"!=e.id?(c.addClass("hide"),k.addClass("hide"),d.addClass("hide"),b&&k.hasClass("hide")&&(this.$scrollBarTop=b.find(".mCSB_container").css("top")),c.addClass("hide"),k.removeClass("hide").trigger("resizeSroll",{resizeImScroll:!0}),$("#chat-editor-div").addClass("hide")):this.chatBoxType="ext",b={},b.tabData=a.data("tabData"),b.chatType=this.chatType,b.imChatUser=this.imChatUser,b.imChatGroup=this.imChatGroup,b.imChatBoxContentEl=this.imChatBoxContentExtEl,this.imChatMsgCBService.clickImChatHeadTabExt(b)):
"chat"==a.attr("type")&&(c.addClass("hide"),k.addClass("hide"),d.addClass("hide"),(a=a.attr("kind"))&&0==a&&(a=void 0),this.kind=a,b={},b.kind=a,this.initChatView(),k.addClass("hide"),c.removeClass("hide"),a&&0<a?($(".j_im-chatwin-msg-container").addClass("hide"),$("#chat-editor-div").addClass("hide"),$(".j_im-chatwin-kind-msg-container").removeClass("hide").trigger("resizeSroll",{resizeImScroll:!0}),b.$listContainer=$(this.el).find(".j_im-chatwin-kind-msg-container .j_im-chatwin-msg-list"),this.renderChatByKind(b),
this.chatBoxType="kind"):($(".j_im-chatwin-kind-msg-container").addClass("hide"),$(".j_im-chatwin-msg-container").removeClass("hide").trigger("resizeSroll",{resizeImScroll:!0}),$("#chat-editor-div").removeClass("hide"),this.render(),this.chatBoxType="chat"))},renderChatByKind:function(a){var b=this;b.imChatView&&(a.isHelper=b.isHelper,a.groupExist=b.groupExist,a.$scrollBar=$(b.el).find(".j_im-chatwin-kind-msg-container.j_im-chatwin-msg-scrollbar"),$(b.el).find(".j_im-chatwin-kind-msg-container .j_im-chatwin-msg-list").empty(),
$(b.el).find("#im-chat-list-loading").removeClass("hide"),"groupChat"==b.chatType?(a.renderOrder="down",b.imChatView.renderByKind(a,function(a){$(b.el).find("#im-chat-list-loading").addClass("hide");a&&0<a.length&&"0"!=a[a.length-1].next_id?(a[0].chatTypeNo="2",a[0].group_id=b.imChatGroup.id,$(b.el).find(".j_noMesInfo").addClass("hide"),$(b.el).find(".j_im-more-chatMessage").removeClass("hide")):$(b.el).find(".j_im-more-chatMessage").addClass("hide");a?1>a.length?$(b.el).find(".j_noMesInfo").removeClass("hide"):
$(b.el).find(".j_noMesInfo").addClass("hide"):$(b.el).find(".j_noMesInfo").removeClass("hide")})):b.imChatUser.id!=window.imCurrentUser.uid?(a.renderOrder="down",b.imChatView.renderByKind(a,function(a){$(b.el).find("#im-chat-list-loading").addClass("hide");$(b.el).find(".j_im-more-chatMessage").addClass("hide");a&&0<a.length&&"0"!=a[a.length-1].next_id&&($(b.el).find(".j_im-more-chatMessage").removeClass("hide"),a[0].chatTypeNo="1",$(b.el).find(".j_noMesInfo").addClass("hide"));a?1>a.length?$(b.el).find(".j_noMesInfo").removeClass("hide"):
$(b.el).find(".j_noMesInfo").addClass("hide"):$(b.el).find(".j_noMesInfo").removeClass("hide")})):($(b.imChatBoxContentEl).addClass("hide"),$(b.imChatBoxContentExtEl).removeClass("hide"),a={},a.imChatUser=b.imChatUser,a.imChatBoxContentEl=b.imChatBoxContentExtEl,b.imChatMsgCBService.openSelfPortalChat(a)))},initToolBar:function(){c($);$("#im-chatwin-textarea").emojiarea({emojiHeight:-230,emojiLeft:-70,buttonClass:"a-emoji",buttonParent:".j_im-chatwin-toolbar .j_tool-item-emoji"});this.imChatView&&
(this.imChatView.remove(),this.imChatView=null);var a=$(this.el).find(".j_im-chatwin-toolbar");if("singleChat"==this.chatType)if(this.imChatView=new g({chatType:this.chatType,imChatUser:this.imChatUser,count:this.count,$scrollBar:$(".j_im-chatwin-msg-container .j_im-chatwin-msg-scrollbar"),el:this.el}),$(this.el).find(".j_im-open-group-panel").removeClass("hide-im"),1==this.imChatUser.flag)$(this.el).find(".j_im-open-group-panel").addClass("hide-im"),$(this.el).find("#chat-entity").remove(),$(this.el).find(".j_im-send-shakemsg-item").remove();
else{var b=$(this.el).find(".j_view-head .j_user-status-dev");b.removeClass("hide-im");b.addClass("offline");b.attr("data-original-title","\u8be5\u7528\u6237\u4e0d\u5728\u7ebf");this.imChatView.renderUserStatus({users:[{uid:this.imChatUser.id,cid:this.imChatUser.cid?this.imChatUser.cid:window.imCurrentUser.cid}]},function(a){b.removeClass("offline");switch(a.status){case "0":b.addClass("offline");b.attr("data-original-title","\u8be5\u7528\u6237\u4e0d\u5728\u7ebf");break;case "1":if(-1<["0","5","7",
"9"].indexOf(a.dev))b.addClass("pc"),b.attr("data-original-title","\u7535\u8111\u7aef\u5728\u7ebf");else switch(b.addClass("mobile"),a.dev){case "1":a={zh_CN:"android\u79fb\u52a8\u7aef\u5728\u7ebf",zh_TW:"android\u79fb\u52d5\u7aef\u5728\u7dda",en_US:"android online"};b.attr("data-original-title",a[TEAMS.perLang]);break;case "2":a={zh_CN:"iphone\u79fb\u52a8\u7aef\u5728\u7ebf",zh_TW:"iphone\u79fb\u52d5\u7aef\u5728\u7dda",en_US:"iphone online"};b.attr("data-original-title",a[TEAMS.perLang]);break;default:b.attr("data-original-title",
"\u7528\u6237\u79fb\u52a8\u7aef\u5728\u7ebf")}break;case "2":switch(a.dev){case "5":a={zh_cn:"\u7528\u6237\u7684web\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",zh_tw:"The user's web client is left",en_us:"\u7528\u6236\u7684web\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"};b.attr("title",a[window.imCurrentUser.perLang]);break;default:a={zh_cn:"\u7528\u6237\u7684\u7535\u8111\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",zh_tw:"The user's computer terminal is left",en_us:"\u7528\u6236\u7684\u96fb\u8166\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"}}b.attr("data-original-title",
a[window.imCurrentUser.perLang]);b.addClass("leave");break;case "8":b.attr("data-original-title","\u7528\u6237\u79bb\u7ebf\u4f46\u53ef\u4ee5\u63a5\u6536\u5230\u79bb\u7ebf\u6d88\u606f\u63a8\u9001"),b.addClass("push")}})}else"groupChat"==this.chatType&&(this.imChatView=new d({chatType:this.chatType,imChatGroup:this.imChatGroup,count:this.count,isUnread:this.isUnread,$scrollBar:$(".j_im-chatwin-msg-container .j_im-chatwin-msg-scrollbar"),el:this.el,view:this,fromView:"chatWin"}),this.atmeview=new r({$input:$(this.el+
" #im-chatwin-textarea"),inputId:"#im-chatwin-textarea",componentId:"portal-chat",areaPosition:"up",channelId:this.imChatGroup.id,componentType:"chat-at"}),k($),a.find(".j_im-send-shakemsg-item").addClass("hide-im"),$("#im-chatwin-textarea").atmearea({emojiHeight:-230,emojiLeft:-70,buttonClass:"a-at",buttonParent:".j_im-chatwin-toolbar .j_tool-item-at",onlyUser:!0,groupId:this.imChatGroup.id,componentType:"chat-at",atmeview:this.atmeview}))},initChatView:function(){this.wheelPageUnlLocked=!1;this.getMoreCount=
0;this.imChatView.minMsgId=void 0;this.notMarkTab=!1},markChatMsgBack:function(a){var b=$(this.el),e=a.msgId,c=a.msgObj,k=a.isSelf,d=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list").find("#"+e),f=$(this.el).find("#atmsg-"+e);f&&0<f.length&&f.parents(".j_chat-head-at-read").addClass("hide-im");d&&!d.hasClass("im-chat-back-msg")&&(k&&(c.dt[0].txt.i18n="im.chat.b.self"),(k=d.data("mesData"))&&"1"===k.msg.display&&(c.sname=k.msg.sname,c.display=k.msg.display),b=b.find("#j_chat-back-msg-clone").clone().removeAttr("id").attr("id",
e),c=m.getMsgContent(c,window.imCurrentUser,v.il8n("anonymity")),b.find("span").text(c),d.replaceWith(b),"groupChat"==this.chatType?a.type=2:"singleChat"==this.chatType&&(a.type=1),a.isHelper=this.isHelper,$("#"+l.IM_ADDRLIST_EL).trigger("updateMarkBackTitle",a))},maskGroupMsg:function(a){$("#"+l.IM_ADDRLIST_EL).trigger("onMaskGroupMsg",a);var b=$("#"+a.msgId);if(b.length&&!b.hasClass("im-msg-sys-mask")){$atNotification=$("#atmsg-"+a.msgId);$atNotification.length&&$atNotification.parents(".j_chat-head-at-read").find(".j_close-chat-top-tip").click();
a=a.msgObj;var e=m.getMsgContent(a,window.imCurrentUser),c=b.data("mesData");c.msg=a;b.addClass("im-msg-sys-mask").data("mesData",c).find(".j_im-chat-msg-opt").text(e);b.find(".chat-video-content").length&&b.find(".chat-video-content").replaceWith('\x3cdiv class\x3d"bubble j_bubble j_im-chat-msg-opt"\x3e'+e+"\x3c/div\x3e")}},markChatMsgBackNotify:function(a){switch(a.type){case 1:"singleChat"==this.chatType&&a.imChatorId==this.imChatUser.id&&(a.objId=a.imChatorId,this.markChatMsgBack(a));break;case 2:"groupChat"==
this.chatType&&a.groupId==this.imChatGroup.id&&(a.objId=a.groupId,this.markChatMsgBack(a))}},retryPaste:function(a,b){var e=m.getImPasteUrl()+"?module\x3dim\x26ETEAMSID\x3d"+ETEAMSID;$.ajax({type:"post",url:e,dataType:"json",data:a,success:function(a){m.notify("\u56fe\u7247\u4e0a\u4f20\u6210\u529f");b&&b(a)},error:function(a){m.notify("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25");b&&b(a)}})},renderSingleReadedStatus:function(a){var b=a.datas,e=a.recvMsgIds;if(a.user.uid==this.imChatUser.id){var c=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");
b&&0<b.length&&b.forEach(function(a){var b=c.find("#"+a.msgid);if(b&&0<b.length)switch(b.find(".j_im-chatmsg-readStatus").removeClass("hide-im"),a.status){case "0":b.find(".j_im-chatmsg-readStatus").text("\u672a\u8bfb");break;case "1":b.find(".j_im-chatmsg-readStatus").text("\u5df2\u8bfb"),b.find(".j_im-chatmsg-readStatus").removeClass("unread")}});e&&0<e.length&&e.forEach(function(a){c.find("#"+a).addClass("j_msgstatus-unread")})}},renderGroupReadedStatus:function(a){var b=a.datas,e=a.recvMsgIds;
if(a.groupId==this.imChatGroup.id){var c=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");if(b&&0<b.length)for(a=0;a<b.length;a++){var k=b[a],d=c.find("#"+k.msgid);if(d&&0<d.length)if(d.find(".j_im-chatmsg-readStatus").addClass("j_im-groupmsg-readStatus"),d.find(".j_im-chatmsg-readStatus").addClass("im-cp"),"1"==this.imChatGroup.rsOnOff&&d.find(".j_im-chatmsg-readStatus").removeClass("hide-im"),k.status)k=d.find(".j_im-chatmsg-readStatus").attr("count"),0<k&&(k-=1),d.find(".j_im-chatmsg-readStatus").attr("count",
k),0==k?(d.find(".j_im-chatmsg-readStatus").text("\u5168\u90e8\u5df2\u8bfb"),d.find(".j_im-chatmsg-readStatus").removeClass("unread")):d.find(".j_im-chatmsg-readStatus").text(k+"\u4eba\u672a\u8bfb");else switch(k.unread_count){case "0":d.find(".j_im-chatmsg-readStatus").text("\u5168\u90e8\u5df2\u8bfb");d.find(".j_im-chatmsg-readStatus").removeClass("unread");break;default:d.find(".j_im-chatmsg-readStatus").attr("count",k.unread_count),d.find(".j_im-chatmsg-readStatus").text(k.unread_count+"\u4eba\u672a\u8bfb")}}e&&
0<e.length&&e.forEach(function(a){c.find("#"+a).addClass("j_msgstatus-unread")})}},getScreenMsg:function(a,b,e){if(!this.chatBoxType||"chat"==this.chatBoxType){if(!this.stopScreen&&this.readStatusAllow||e){this.readStatusAllow=!1;e=$(this.el).find(".j_im-chatwin-msg-container").data("msgHeightDatas");var c=[];e&&e.msgHeightList.forEach(function(e){e.pTop>a-10&&b+1>e.pTop&&!e.readed&&(c.push(e.msgId),e.readed=!0)})}this.setMsgReadStatusReq(c)}},setMsgReadStatusReq:function(a,b){var e=this;if(a&&0<
a.length){var c={};c.isHelper=e.isHelper;if("singleChat"==e.chatType){var k={uid:e.imChatUser.id,cid:e.imChatUser.cid};k.cid||(k.cid=window.imCurrentUser.cid);c.singleReadUser=k;c.recvMsgIds=a;e.imChatView.setSingleMsgReadStatusReq(c,function(a){b&&b();setTimeout(function(){e.readStatusAllow=!0},500)})}else"groupChat"==e.chatType&&(c.groupId=e.imChatGroup.id,c.recvMsgIds=a,e.imChatView.setGroupMsgReadStatusReq(c,function(a){b&&b();setTimeout(function(){e.readStatusAllow=!0},500)}))}else b&&b(),setTimeout(function(){e.readStatusAllow=
!0},1E3)},countWordNum:function(a){var b="";(a=a.val())||$(this.el+" #limitTip").text("\u8fd8\u53ef\u4ee5\u8f93\u51651000\u5b57");a.length<=this.chatMsgLimit?b="\u8fd8\u53ef\u4ee5\u8f93\u5165"+(this.chatMsgLimit-a.length)+"\u5b57":a.length>this.chatMsgLimit&&(b="\u5df2\u8d85\u51fa"+(a.length-this.chatMsgLimit)+"\u5b57");$(this.el+" #limitTip").text(b)},markImChatRead:function(){switch(this.chatType){case "singleChat":this.imChatView.setChatMsgRead({user:{uid:this.imChatUser.id,cid:this.imChatUser.cid}});
break;case "groupChat":this.imChatView.setChatMsgRead({groupId:this.imChatGroup.id,isHelper:this.isHelper})}},modifyImGroupNotify:function(a){var b=this,e=$(b.el).find("#im-chatwin-clone-field #j_chat-member-msg-clone").clone();e.attr("id","");b.imChatGroup.userNum=a.newImChatGroup.userNum;b.imChatView.imChatGroup.userNum=a.newImChatGroup.userNum;b.imChatView.imCommonChatView.imChatGroup.userNum=a.newImChatGroup.userNum;switch(a.modType){case "1":var c=a.inviter;a=a.invitee;var c={zh_CN:f.getImChatUserCache("imUserCache-"+
c.uid+"-"+c.cid).name+"\u9080\u8bf7\u4e86"},k=c[TEAMS.perLang];a&&0<a.length&&(a.forEach(function(a){var e=f.getImChatUserCache("imUserCache-"+a.uid+"-"+a.cid);k+=e.name+"\u3001";a.uid==window.imCurrentUser.uid&&a.cid==window.imCurrentUser.cid&&(b.groupExist=!0,b.renderGroupExistPanel())}),k=k.substring(0,k.length-1),e.find("span").text(k));break;case "2":c=a.kicker;a=a.kickee;c={zh_CN:f.getImChatUserCache("imUserCache-"+c.uid+"-"+c.cid).name+"\u79fb\u9664\u4e86"};k=c[TEAMS.perLang];a&&0<a.length&&
(a.forEach(function(a){var e=f.getImChatUserCache("imUserCache-"+a.uid+"-"+a.cid);k+=e.name+"\u3001";a.uid==window.imCurrentUser.uid&&a.cid==window.imCurrentUser.cid&&(b.groupExist=!1,b.renderGroupExistPanel())}),k=k.substring(0,k.length-1),e.find("span").text(k));break;case "3":a=a.user,a.uid==window.imCurrentUser.uid&&a.cid==window.imCurrentUser.cid&&(b.groupExist=!1,b.renderGroupExistPanel()),c={zh_CN:f.getImChatUserCache("imUserCache-"+a.uid+"-"+a.cid).name+"\u9000\u51fa\u4e86\u7fa4\u7ec4"},k=
c[TEAMS.perLang],e.find("span").text(k)}window.imCacheData.imGroupCacheManager.getImGroupCache(b.imChatGroup.id,function(a){b.imChatGroup=a})},updateImGroupDetailNotify:function(a){var b=a.newImChatGroup;if(this.imChatGroup.id==b.id)switch(a.mask){case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_ANNOUNCE:$(this.el).find(".j_chatgroup-info .j_explain .j_value").text(b.announce);setTimeout(function(){$(".j_im-chatgroup-view .groupMemberScroll").trigger("resizeSroll",{resizeImScroll:!0})},200);break;case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_NAME:$(this.el).find(".j_im-chat-name-input").text(b.name),
$(this.el).find(".j_im-chat-name-input").attr("data-original-title",b.name)}},forwardMsg:function(a,b){var e=b.msg;"1"===e.display&&(e.display="0");a&&0<a.length&&f.sendForwardMsgBase({selectedObjArray:a,msgObjOrigin:e,msgType:b.msg.type,sendParams:void 0,imChatUser:this.imChatUser,imChatGroup:this.imChatGroup})},saveImChatDraft:function(){window.imCacheData.imChatValCache||(window.imCacheData.imChatValCache={});var a,b,e=$("#"+l.IM_ADDRLIST_EL).find(".j_im-session-container .j_im-session-list");
switch(this.chatType){case "singleChat":b=this.imChatUser.uid;a="1-"+this.imChatUser.uid+"-"+this.imChatUser.cid;break;case "groupChat":b=this.imChatGroup.id,a="2-"+this.imChatGroup.id,this.isHelper&&(e=$("#"+l.IM_ADDRLIST_EL).find(".j_im-service-session-container .j_im-service-list"))}var c=$(this.el+" #im-chatwin-textarea"),k=c.val(),c={content:k,userData:c.data("userData")};window.imCacheData.imChatValCache[a]=c;k&&0<k.trim().length?(a=e.find("#"+b))&&0<a.length&&(a.find(".j_draft").removeClass("hide-im"),
a.find(".j_info").addClass("hide-im"),a.find(".j_draft-text").text(k).removeClass("hide-im")):window.imCacheData.imChatValCache[a]=void 0},clearImChatDraft:function(){var a,b;switch(this.chatType){case "singleChat":b=this.imChatUser.uid;a="1-"+this.imChatUser.uid+"-"+this.imChatUser.cid;break;case "groupChat":b=this.imChatGroup.id,a="2-"+this.imChatGroup.id}window.imCacheData.imChatValCache[a]=void 0;a=$("#"+l.IM_ADDRLIST_EL).find(".j_im-session-container .j_im-session-list");this.isHelper&&(a=$("#"+
l.IM_ADDRLIST_EL).find(".j_im-service-session-container .j_im-service-list"));(b=a.find("#"+b))&&0<b.length&&b.find(".j_draft").addClass("hide-im")},loadImChatDraft:function(){if(window.imCacheData.imChatValCache){var a;switch(this.chatType){case "singleChat":a="1-"+this.imChatUser.uid+"-"+this.imChatUser.cid;break;case "groupChat":a="2-"+this.imChatGroup.id}if(a=window.imCacheData.imChatValCache[a]){var b=$(this.el+" #im-chatwin-textarea");b.val(a.content);b.data("userData",a.userData)}}},renderUserStatus:function(a,
b,e){this.imRecentListComponent.renderUserStatus({users:a},function(a){a&&0<a.length&&a.forEach(function(a){var e=b.find("#"+a.user.uid).find(".j_user-status-dev").removeClass("hide-im");e.removeClass("offline");switch(a.status){case "0":e.addClass("offline");e.attr("data-original-title","\u8be5\u7528\u6237\u4e0d\u5728\u7ebf");break;case "1":if(-1<["0","5","7","9"].indexOf(a.dev))e.addClass("pc"),e.attr("data-original-title","\u7535\u8111\u7aef\u5728\u7ebf");else switch(e.addClass("mobile"),a.dev){case "1":a=
{zh_cn:"android\u79fb\u52a8\u7aef\u5728\u7ebf",zh_tw:"android\u79fb\u52d5\u7aef\u5728\u7dda",en_us:"android online"};e.attr("title",a[window.imCurrentUser.perLang]);break;case "2":a={zh_cn:"iphone\u79fb\u52a8\u7aef\u5728\u7ebf",zh_tw:"iphone\u79fb\u52d5\u7aef\u5728\u7dda",en_us:"iphone online"};e.attr("data-original-title",a[window.imCurrentUser.perLang]);break;default:e.attr("data-original-title","\u7528\u6237\u79fb\u52a8\u7aef\u5728\u7ebf")}break;case "2":switch(a.dev){case "5":a={zh_cn:"\u7528\u6237\u7684web\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",
zh_tw:"The user's web client is left",en_us:"\u7528\u6236\u7684web\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"};e.attr("title",a[window.imCurrentUser.perLang]);break;default:a={zh_cn:"\u7528\u6237\u7684\u7535\u8111\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",zh_tw:"The user's computer terminal is left",en_us:"\u7528\u6236\u7684\u96fb\u8166\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"}}e.attr("data-original-title",a[window.imCurrentUser.perLang]);e.addClass("leave");break;case "8":e.attr("data-original-title",
"\u7528\u6237\u79bb\u7ebf\u4f46\u53ef\u4ee5\u63a5\u6536\u5230\u79bb\u7ebf\u6d88\u606f\u63a8\u9001"),e.addClass("push")}})})},initWebUpload:function(){var a=this,b=m.getImUploadUrl()+"?module\x3dim\x26refId\x3d0\x26ETEAMSID\x3d"+ETEAMSID;void 0!=a.webUploader&&a.webUploader.destroy();if("undefined"!=typeof WebUploader){var c=a.webUploader=WebUploader.create({runtimeOrder:"html5,flash",swf:"/static/swf/Uploader.swf",disableGlobalDnd:!0,paste:a.el+" #im-chatwin-textarea",fileVal:"data",server:b,fileSizeLimit:m.getUpMaxSize(),
accept:{title:"*",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"}});c.on("fileQueued",function(b){c.makeThumb(b,function(c,k){if(!c){var d={};d.dataContentType=b.type;d.base64Data=k;d.dataFileName="chat paste image";d.dataContentType&&0<=d.dataContentType.indexOf("image")&&(a.pasteUploadFile=new e({dataURL:k,uploadParam:d,callback:function(b){b.pasteData=d;a.sendChatPicMsg(a,b,!0)}}),a.pasteUploadFile.render())}})});c.on("uploadSuccess",function(b,e){a.sendChatPicMsg(a,e,!0)});c.on("uploadProgress",
function(a,b){});c.on("uploadError",function(a){m.notify("\u4e0a\u4f20\u51fa\u9519");c.refresh()});c.on("uploadComplete",function(a){})}},sendChatTipMsg:function(){var a=$(this.el).find(".j_im-notify-tip");a.removeClass("hide-im");var b="";window.imCacheData.i18nConfig&&(b=window.imCacheData.i18nConfig["im.chat.fre"][window.imCurrentUser.perLang]);a.find(".j_content-box").html('\x3ci class\x3d"icon-info-sign"\x3e '+b);window.imChatBoxTipTimer&&(clearTimeout(window.imChatBoxTipTimer),window.imChatBoxTipTimer=
void 0);window.imChatBoxTipTimer=setTimeout(function(){a.addClass("hide-im")},3E3)},sendChatShakeMsg:function(){var a={msgType:"11",msgTypeConf:"7000"};a.clitxt=window.imCurrentUser.name+"\u53d1\u4e86\u4e00\u4e2a\u7a97\u53e3\u6296\u52a8";a.notify={i18n:"im.chat.sk",kvs:{"%NAME%":window.imCurrentUser.name}};a.$scrollBar=$(this.el).find(".j_im-chatwin-msg-scrollbar");a.$listContainer=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");a.isAnonymous=this.isAnonymous;this.imChatView.sendChatMsgAndBack(a)},
refreshImGroupMemberList:function(a){if("groupChat"==this.chatType&&a.group_id==this.imChatGroup.id){a=$(".j_im-chatgroup-view .j_im-group-member-list");a.find(".j_im-chatwin-group-item").empty();var b=$(this.el).find("#im-chatwin-clone-field #im-chatwin-group-clone").clone();this.imChatView.renderGroupMembers(b,a)}},initImPortalChatUploaders:function(){var a=this,b={bindButtonClass:".j_im-chatwin-toolbar .j_tool-item #chat-image-mini",containerClass:".j_im-chatwin-toolbar"};b.uploadUrl="/base/chatattachment/uploadChatFile.json?ETEAMSID\x3d"+
ETEAMSID+"\x26type\x3dimage";b.filters=[{title:"\u56fe\u7247",extensions:"JPG,PNG,JPEG,GIF,BMP"}];b.maxFileSize=m.getUpMaxSize();b.failTip="\u56fe\u7247\u4e0a\u4f20\u5931\u8d25";switch(a.chatType){case "singleChat":b.refId=a.imChatUser.id;break;case "groupChat":b.refId=a.imChatGroup.id}a.imgUploader=f.bindFileUploader(b,function(b){a.sendChatPicMsg(a,b)});b={bindButtonClass:".j_im-chatwin-toolbar .j_tool-item #chat-attachment",containerClass:".j_im-chatwin-toolbar"};b.uploadUrl="/base/chatattachment/uploadChatFile.json?ETEAMSID\x3d"+
ETEAMSID+"\x26type\x3dattachment";b.maxFileSize=m.getUpMaxSize();b.failTip="\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25";switch(a.chatType){case "singleChat":b.refId=a.imChatUser.id;break;case "groupChat":b.refId=a.imChatGroup.id}a.attachmentUploader=f.bindFileUploader(b,function(b){a.sendChatFileMsg(a,b)})},updateCurrentGroupMember:function(a){var b=a.group_id;"groupChat"==this.chatType&&this.imChatGroup.id==b&&this.imGroupCacheManager.syncGroupMemberList({groupId:b,forceUpdate:!1},function(){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(b,
function(b){b&&($("#"+l.IM_GROUP_DETAIL_MODAL).trigger("refreshImGroupMemberList.ImGroupDetail",{groupId:b.id}),a.newImChatGroup=b,$("#"+l.IM_CHATWIN_EL).trigger("refreshImGroupMemberList.ImChatWin",a),a.modType="1",$("#"+l.IM_CHATWIN_EL).trigger("modifyImGroupNotify.ImChatWin",a))})})},scrollToReplyMsg:function(a){var b=this,e=a.id,c=$(b.el).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar"),k=$(b.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list").find("#"+e);0<k.length?(c.mCustomScrollbar("scrollTo",
"#"+e),k.addClass("im-div-flash"),setTimeout(function(){k.removeClass("im-div-flash")},2E3)):5>b.autoTurnByReplyPageNum&&(b.turnPage(),b.autoTurnByReplyPageNum+=1,setTimeout(function(){b.scrollToReplyMsg(a)},300))},renderWhenNoScrollbar:function(){var a=$(this.el),b=a.find(".j_im-chatwin-msg-container").find(".mCSB_scrollTools_vertical").css("display");if(b&&"none"==b&&(a=a.find(".j_im-chatwin-msg-container").find(".j_im-chatwin-msg-list .j_chat-message"))&&0<a.length){for(var b=[],e=0;e<a.length;e++)b.push(a[e].id);
this.setMsgReadStatusReq(b)}},snapshoot:function(a,b){if(a){var e=$("#im-chatwin-textarea").val();window.localStorage.setItem("ETIM_Session_Snapshoot_"+window.imCurrentUser.cid+window.imCurrentUser.uid+"_"+a.id,JSON.stringify({isAnonymous:!0===this.isAnonymous,input:e}))}},recovery:function(a){if(a=window.localStorage.getItem("ETIM_Session_Snapshoot_"+window.imCurrentUser.cid+window.imCurrentUser.uid+"_"+a.id))a=JSON.parse(a),a.isAnonymous&&$(this.el).find(".btn-anonymous-mode").click()},backToUnanonynous:function(){$(this.el).hasClass("mode-anonymous")&&
$(this.el).find(".btn-anonymous-mode").click()},remove:function(){$(this.el).off(".ImChatWin");$(this.el).empty();this.imChatView&&(this.imChatView.remove(),this.imChatView=void 0)}});p.exports=n});
define("im/minichat/ImFrameView",["im/component/imUtils","im/component/imContants","im/minichat/ImWinComView","im/minichat/ImAddrListView"],function(n,s,p){n("im/component/imUtils");var m=n("im/component/imContants"),l=n("im/minichat/ImWinComView"),h=n("im/minichat/ImAddrListView");n=Backbone.View.extend({initialize:function(g){this.el="#"+m.IM_FRAME_EL;this.options=g},delegateEvents:function(){var g=this,f=$(g.el);f.off("click.ImFrameView",".j_mini-chat-index-to-min").on("click.ImFrameView",".j_mini-chat-index-to-min",
function(a){a.stopPropagation();g.toMinSize()});f.off("toMinSize.ImFrameView").on("toMinSize.ImFrameView",function(a){a.stopPropagation();g.toMinSize()});f.off("saveWinComModule.ImFrameView").on("saveWinComModule.ImFrameView",function(a,d){a.stopPropagation();g.imWinComView.imMsgModuleView=d});f.off("renderAddrList.ImFrameView").on("renderAddrList.ImFrameView",function(a,d){a.stopPropagation();g.imAddrListView&&(g.imAddrListView.remove(),g.imAddrListView=void 0);g.imAddrListView=new h(g.options);
g.imAddrListView.render()})},openImFrameView:function(){this.imAddrListView.isOnline=!0;this.imWinComView&&this.imWinComView.imMsgModuleView&&(this.imWinComView.imMsgModuleView.isOnline=!0);if(this.imAddrListView.activeSessionType)switch(this.imAddrListView.activeSessionType){case "chat":var g=this.imAddrListView.$activeSession.attr("count");g&&0<g&&setTimeout(function(){$("#"+m.IM_CHATWIN_EL).trigger("triggerImChatRead.ImChatWin")},500)}},toMinSize:function(){$("#"+m.IM_FRAME_EL).hasClass("off")||
(this.imAddrListView.isOnline=!1,this.imWinComView&&this.imWinComView.imMsgModuleView&&(this.imWinComView.imMsgModuleView.isOnline=!1),$(this.el).addClass("off"),$("#"+m.IM_MINI_PAGE).find(".j_open-im-frame").removeClass("im-ui-highlight"))},render:function(){this.imAddrListView=new h(this.options);this.imWinComView=new l({});this.imAddrListView.render()},openImChatWin:function(g){},remove:function(){}});p.exports=n});
define("im/core/imWebsocket","im/component/imChatComponent im/component/imPCcomponent im/component/imContants im/minichat/miniChatPage im/cache/imSessionCacheManager im/cache/imGroupCacheManager im/recentlist/imReconnectView im/component/imUtils im/component/client".split(" "),function(n,s,p){var m=n("im/component/imChatComponent"),l=n("im/component/imPCcomponent"),h=n("im/component/imContants"),g=n("im/minichat/miniChatPage"),f=n("im/cache/imSessionCacheManager"),a=n("im/cache/imGroupCacheManager"),
d=n("im/recentlist/imReconnectView"),b=n("im/component/imUtils"),c=n("im/component/client");n=Backbone.View.extend({initialize:function(a){this.imSysMsgCBService;window.imWebsocketSdk=$.initEteamsImJson();window.imEteamsJsService=$.imEteamsJsService();window.imCacheData={imChatValCache:{},imChatShakeCache:{}};var b=window.localStorage.getItem("imStorage");b||(b={},window.localStorage.setItem("imStorage",JSON.stringify(b)));this.initI18nResource();window.imInitFunc={};m.initImSessionCache();window.imClientDev=
"5";if(void 0!=window.IsEteamsClient)switch(window.IsEteamsClient()){case 1:window.imClientDev="0";break;case 2:window.imClientDev="7"}this.imPCcomponent||(this.imPCcomponent=new l,this.imPCcomponent.render());if(!this.initEtClient()){$("body").data("im_LanResouces",{});this.imAppKey=a.imAppKey;a=TEAMS.service.imApiconnector;var b=TEAMS.currentUser.id.toString(),c={id:window.iminfoMap.uid,uid:window.iminfoMap.uid,cid:window.iminfoMap.cid,name:TEAMS.currentUser.name};TEAMS.currentUser.avatar&&(c.avatar=
TEAMS.currentUser.avatar.p5);m.setImChatUserCache("imUserCache-"+c.uid+"-"+c.cid,c);this.initImChatData(window.iminfoMap?{apiConnectorUrl:a,userToken:{uid:window.iminfoMap.uid,cid:window.iminfoMap.cid,gcid:window.iminfoMap.gcid,flag:1,corpAccount:TEAMS.currentTenant.tenantKey,ticket:window.iminfoMap.imTicketStr,clientType:window.imClientDev,appKey:this.imAppKey}}:{apiConnectorUrl:a,userToken:{uid:b,cid:TEAMS.iminfo.cid,gcid:TEAMS.iminfo.gcid,flag:1,corpAccount:TEAMS.currentTenant.tenantKey,ticket:TEAMS.iminfo.imTicketStr,
clientType:window.imClientDev,appKey:this.imAppKey}})}},delegateEvents:function(){var a=this;$("body").off("imLoginAndConnect.imWebsocket").on("imLoginAndConnect.imWebsocket",function(b){a.initImChatData(window.iminfoMap?{apiConnectorUrl:TEAMS.service.imApiconnector,userToken:{uid:TEAMS.currentUser.id.toString(),cid:window.iminfoMap.cid,gcid:window.iminfoMap.gcid,flag:1,corpAccount:TEAMS.currentTenant.tenantKey,ticket:window.iminfoMap.imTicketStr,clientType:window.imClientDev,appKey:a.imAppKey}}:
{apiConnectorUrl:TEAMS.service.imApiconnector,userToken:{uid:TEAMS.currentUser.id.toString(),cid:TEAMS.iminfo.cid,gcid:TEAMS.iminfo.gcid,flag:1,corpAccount:TEAMS.currentTenant.tenantKey,ticket:TEAMS.iminfo.imTicketStr,clientType:window.imClientDev,appKey:a.imAppKey}})});$("body").off("imInitConnectView.imWebsocket").on("imInitConnectView.imWebsocket",function(b){a.renderImConnectView()});$("body").off("initImView.imWebsocket").on("initImView.imWebsocket",function(b,c){a.initImView(c)});$("body").off("imLocalMarkReadNotify.imWebsocket").on("imLocalMarkReadNotify.imWebsocket",
function(b,c){a.markSysReadNotify(c,a)})},renderImConnectView:function(){this.imReconnectView||(this.imReconnectView=new d({parentEl:"#im-portal-recent-list-DIV"}))},initImView:function(a){var b=this;window.imInitFunc&&(window.imInitFunc.imRecentInitRender=function(a){$("body").trigger("imRefresh");$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage");b.miniChatPage?($("#"+h.IM_FRAME_EL).trigger("renderAddrList.ImFrameView"),b.imReconnectView&&(b.imReconnectView.remove(),b.imReconnectView=
void 0)):b.miniChatPage=new g});0<$.imSdkConfig.reconnectCount&&window.imInitFunc.imRecentInitRender(a)},initImChatData:function(a){var b=this;if($.imSdkConfig){var c=a.apiConnectorUrl;a=JSON.stringify(a.userToken);$.imSdkConfig.reconnectCount=0;$.ajax({type:"post",contentType:"application/json;charset\x3dUTF-8",url:c+"/user/buildToken.json",dataType:"JSON",async:!0,data:a,success:function(a){console.log(a);if(1003==a.actionMsg.code)console.log("im\u767b\u5165\u5931\u8d25\uff0c\u7528\u6237\u56e2\u961f\u5728im\u6570\u636e\u5e93\u4e2d\u4e0d\u5b58\u5728\uff01"),
window.imCurrentUser={uid:"-1"};else{a=a.data;var c={};c.uid=a.uid;c.cid=a.cid;var k="wss";"develop"==TEAMS.runMode&&(k="wss");c.wsUrl=k+"://"+a.host+":"+a.port+"/ws";c.apiUrl=TEAMS.service.imApiconnector;c.wsIdleTime=a.heartTime;c.sak=a.sak;c.tokenStr=a.tokenStr;c.dev="5";if(void 0!=window.IsEteamsClient)switch(window.IsEteamsClient()){case 1:c.dev="0";break;case 2:c.dev="7"}window.imClientDev=c.dev;b.initWebsocketConnection(c)}}})}},initWebsocketConnection:function(a){var b=this,c=a.wsUrl;a.global=
b.getWebClientGuid();console.log("connect websocket : "+c);var d={uid:TEAMS.currentUser.id.toString()},f={};f.wsUrl=c;f.wsIdleTime=a.wsIdleTime;window.imWebsocketChannel=$.imWebsocket(f,d,function(){$.imSdkConfig.reqRetryCount=0;b.imLoginFunc(a)});window.imWebsocketSdk.imJsonRequestMethods.updateImNoReadCount=b.updateImNoReadCount;b.initReceiveMethods()},imLoginFunc:function(b){var e=this;window.imWebsocketSdk.imJsonRequestMethods.loginReq(b,function(c){if("0"==c.message.ret.ret){$.imSdkConfig.reqRetryCount=
0;window.imCacheData.imCurrentUser=window.iminfoMap?{cid:c.headProtocol.cid.toString(),uid:c.headProtocol.uid.toString(),gcid:window.iminfoMap.gcid}:{cid:c.headProtocol.cid.toString(),uid:c.headProtocol.uid.toString(),gcid:TEAMS.iminfo.gcid};window.imCacheData.imSessionCacheManager||(window.imCacheData.imSessionCacheManager=new f);window.imCacheData.imGroupCacheManager||(window.imCacheData.imGroupCacheManager=new a);var d=!1;TEAMS.currentTenant.tenantType&&"enterpriseWeChat"==TEAMS.currentTenant.tenantType&&
(d=!0);window.imCurrentUser=window.iminfoMap?{cid:c.headProtocol.cid.toString(),uid:c.headProtocol.uid.toString(),name:TEAMS.currentUser.username,gcid:window.iminfoMap.gcid,hideChat:d,perLang:TEAMS.perLang?TEAMS.perLang.toLowerCase():"zh_cn"}:{cid:c.headProtocol.cid.toString(),uid:c.headProtocol.uid.toString(),name:TEAMS.currentUser.username,gcid:TEAMS.iminfo.gcid,hideChat:d,perLang:TEAMS.perLang?TEAMS.perLang.toLowerCase():"zh_cn"};imCurrentUser.cid=c.headProtocol.cid.toString();if(window.imInitFunc)for(var g in window.imInitFunc)(c=
window.imInitFunc[g])&&c();$.imSdkConfig.reconnectCount=1}else $.imSdkConfig&&2>$.imSdkConfig.reqRetryCount?setTimeout(function(){e.imLoginFunc(b);$.imSdkConfig.reqRetryCount++;console.log("\u767b\u5165\u91cd\u8bd5")},3E3):e.renderImConnectView();$.imDoErrorRequest&&$.imDoErrorRequest()});window.imWebsocketSdk.imJsonRequestMethods.updateImNoReadCount=e.updateImNoReadCount;e.initReceiveMethods();e.initPcClientMethods()},updateImNoReadCount:function(a){$("#im-recent-list").trigger("updateNoReadCount",
a)},initImSysMsgConfig:function(){var a={},b=window.localStorage.getItem("imStorage");b&&(b=JSON.parse(b));a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.gcid=window.iminfoMap?window.iminfoMap.gcid:TEAMS.iminfo.gcid;a.flag="1";a.uc="0";b.sgroupConfig&&(a.uc=b.sgroupConfig.uc);window.imWebsocketSdk.imJsonRequestMethods.getSysMsgGroupTypeUCReq(a,function(a){var c=a.message.groups,k=m.changeListToMap(c,"group");c&&0<c.length&&(b.sgroupConfig={sgroups:c,sgroupMap:k,uc:a.message.uc},window.localStorage.setItem("imStorage",
JSON.stringify(b)))});a.flag="2";b.stypeConfig&&(a.uc=b.stypeConfig.uc);window.imWebsocketSdk.imJsonRequestMethods.getSysMsgGroupTypeUCReq(a,function(a){m.setImSysMsgConfig("stypes",a.message.stypes);var c=a.message.types,k=m.changeListToMap(c,"type");c&&0<c.length&&(b.stypeConfig={stypes:c,stypeMap:k,uc:a.message.uc},window.localStorage.setItem("imStorage",JSON.stringify(b)))})},isRemindClient:function(a){return(a=window.imCacheData.imSessionCacheManager.getMsgRemindCacheData(a))&&"1"==a.reminder?
!1:!0},initReceiveMethods:function(){var a=this;window.imWebsocketSdk.imJsonRequestMethods.initImSingleChatNotifyMethod(function(b){a.imSingleChatNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initImGroupChatReceiveMethod(function(b){var c=a.imGroupMsgAtMe(b);a.imGroupChatNotify(b);var d=a.isRemindClient("2-"+b.message.group_id);d&&window.OnSocMessageCallback&&window.OnSocMessageCallback(JSON.stringify(b));c&&!d&&($("#"+h.IM_MINI_PAGE).trigger("ImWindowNotify.miniChatPage"),window.OnSocMessageCallback&&
window.OnSocMessageCallback(JSON.stringify(b)))});window.imWebsocketSdk.imJsonRequestMethods.initSysMsgNoticeMethod(function(b){a.imSysMsgNotify(b);a.isRemindClient("4-sgroup-"+b.message.datas.msg_type.group)&&window.OnSocMessageCallback&&window.OnSocMessageCallback(JSON.stringify(b))});window.imWebsocketSdk.imJsonRequestMethods.initMsgReadStatusNoticeMethods(function(b){if(b.message&&b.message.flag)switch(b.message.flag){case "0":a.markReadNotify(b,a);break;case "1":a.setTopNotify(b,a);break;case "2":a.setUnreadSessionNotify(b,
a);break;default:a.markReadNotify(b,a)}else a.markReadNotify(b,a)});window.imWebsocketSdk.imJsonRequestMethods.initSysMsgReadStatusNoticeMethods(function(b){a.markSysReadNotify(b,a)});window.imWebsocketSdk.imJsonRequestMethods.initKickOutNoticeMethods(function(a){$("#"+h.IM_MINI_PAGE).trigger("imKickOffNotify",a.message)});window.imWebsocketSdk.imJsonRequestMethods.makeSingleMsgWithdrawNotice&&window.imWebsocketSdk.imJsonRequestMethods.makeSingleMsgWithdrawNotice(function(b){a.markChatMsgBack(b,a,
1)});window.imWebsocketSdk.imJsonRequestMethods.makeGroupMsgWithdrawNotice&&window.imWebsocketSdk.imJsonRequestMethods.makeGroupMsgWithdrawNotice(function(b){a.markChatMsgBack(b,a,2)});if(window.imWebsocketSdk.imJsonRequestMethods.onMaskGroupMsg)window.imWebsocketSdk.imJsonRequestMethods.onMaskGroupMsg(a.onMaskGroupMsg);window.imWebsocketSdk.imJsonRequestMethods.initSysMsgUnReadStatusNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSysMsgUnReadStatusNoticeMethod(function(b){a.setSysMsgUnreadNotify(b)});
window.imWebsocketSdk.imJsonRequestMethods.initSetSingleMsgReadStatusNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSetSingleMsgReadStatusNoticeMethod(function(b){a.setSingleMsgReadStatusNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initSetGroupMsgReadStatusNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSetGroupMsgReadStatusNoticeMethod(function(b){a.setGroupMsgReadStatusNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initSendCommMsgNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSendCommMsgNoticeMethod(function(b){a.imSysMsgCBService||
(a.imSysMsgCBService=window.imEteamsJsService.ImSysMsgCBService);a.imSysMsgCBService&&a.imSysMsgCBService.receiveCommMsgNotice(b.message)});window.imWebsocketSdk.imJsonRequestMethods.initSetMsgRemindNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSetMsgRemindNoticeMethod(function(b){a.setMsgRemindNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initSysMsgBatchUnReadStatusNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSysMsgBatchUnReadStatusNoticeMethod(function(b){a.sysMsgBatchUnReadStatusNotify(b)});
window.imWebsocketSdk.imJsonRequestMethods.initSysMsgUpdateNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSysMsgUpdateNoticeMethod(function(b){a.sysMsgUpdateNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initSysMsgSetUndoNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSysMsgSetUndoNoticeMethod(function(b){a.sysMsgUpdateNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initModifyGroupInfoNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initModifyGroupInfoNoticeMethod(function(b){a.modifyGroupInfoNotify(b)});
window.imWebsocketSdk.imJsonRequestMethods.initInviteToGroupNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initInviteToGroupNoticeMethod(function(b){a.inviteToGroupNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initKickGroupMemberNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initKickGroupMemberNoticeMethod(function(b){a.kickGroupMemberNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initExitGroupNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initExitGroupNoticeMethod(function(b){a.exitGroupNotify(b)});
window.imWebsocketSdk.imJsonRequestMethods.initSetGroupAdminNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSetGroupAdminNoticeMethod(function(b){a.setGroupAdminNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initModifyGroupAvatarNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initModifyGroupAvatarNoticeMethod(function(b){a.modifyGroupAvatarNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initSetGroupRSOnOffNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initSetGroupRSOnOffNoticeMethod(function(b){a.setMsgReadStatusNotify(b)});
window.imWebsocketSdk.imJsonRequestMethods.initImHelperMsgNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initImHelperMsgNoticeMethod(function(b){a.imHelperMsgNotify(b)});window.imWebsocketSdk.imJsonRequestMethods.initImServiceGroupMsgNoticeMethod&&window.imWebsocketSdk.imJsonRequestMethods.initImServiceGroupMsgNoticeMethod(function(b){a.imServiceGroupMsgNotify(b)})},initPcClientMethods:function(){},imSingleChatNotify:function(a){var b=this;b.isRemindClient("1-"+a.message.from_uid)&&window.OnSocMessageCallback&&
window.OnSocMessageCallback(JSON.stringify(a));a=a.message;var c={};c.uid=window.imCurrentUser.uid;c.cid=window.imCurrentUser.cid;window.imCurrentUser.uid==a.from_uid?(c.fromUid=a.to_uid,c.fromCid=a.to_cid):(c.fromUid=a.from_uid,c.fromCid=a.from_cid);c.msgId=a.msgid;window.imWebsocketSdk.imJsonRequestMethods.activeSyncSingleMsgReq(c,function(a){window.imCacheData.imSessionCacheManager.receiveSingleChatMsg({resData:a.message},function(){b.triggerFuncMsg(a.message.datas);$("#"+h.IM_ADDRLIST_EL).trigger("singleChatNotify",
a);$("body").trigger("singleChatNotifyBell",a);$("#"+h.IM_CHATWIN_EL).trigger("imChatBoxNotify",a);b.notifyAllChatUnreadCounts();b.isRemindClient("1-"+a.message.datas.from_uid)&&window.OnSocMessageCallback&&window.OnSocMessageCallback(JSON.stringify(a))})})},triggerFuncMsg:function(a){switch(a.msg.type.toString()){case "11":if(a.from_uid==window.imCurrentUser.uid&&a.from_cid==window.imCurrentUser.cid)break;$("#"+h.IM_MINI_PAGE).trigger("imFrameShake.miniChatPage",{msgData:a})}},imGroupChatNotify:function(a){window.imCacheData.imSessionCacheManager.receiveGroupChatMsg(a.message);
$("#"+h.IM_ADDRLIST_EL).trigger("groupChatNotify",a);$("body").trigger("groupChatNotifyBell",a);$("#"+h.IM_CHATWIN_EL).trigger("imChatBoxNotify",a);this.notifyAllChatUnreadCounts()},notifyAllChatUnreadCounts:function(){var a=m.getImChatNoReadAllCounts(),b=0;a&&_.each(a,function(a){b+=parseInt(a.count)});$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")},imSysMsgNotify:function(a){$("#im-chat-mini").removeClass("hide");this.updateSysMsgUnreadCounts(a);window.imCacheData.imSessionCacheManager.receiveSysMsg(a.message.datas);
$("#"+h.IM_ADDRLIST_EL).trigger("sysMsgNotify",a);$("#im-chat-mini").trigger("sysMsgNotifyBell",a);$("#"+h.IM_SYSWIN_EL).trigger("imSysMsgNotify",a)},markReadNotify:function(a,b){var c=a;a.message&&(c=b.setReadChatMsgCount(a.message));$("#"+h.IM_ADDRLIST_EL).trigger("markReadNotify",c);$("#"+h.IM_MINI_PAGE).trigger("imMarkReadNotifyBell.miniChatPage",c);$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage");b.notifyAllChatUnreadCounts()},setTopNotify:function(a){a=a.message;$("#"+h.IM_ADDRLIST_EL).trigger("setTopNotify",
a);$("#im-mini-chat-index").trigger("setTopNotify",a)},markSysReadNotify:function(a,b){var c=a.message,d;switch(c.flag){case "1":var f=c.unread_datas;if(f&&0<f.length)for(var g=0;g<f.length;g++){var l=f[g],n="4-sgroup-"+l.group;(d=m.getImSysMsgNoReadCounts(n))&&"0"!=d.count&&(d.count=parseInt(d.count)-l.count+"",m.setImMsgNoReadCounts(n,d,"4"),window.imCacheData.imSessionCacheManager.setSessionRead("4",c.group,d.count),$("#"+h.IM_ADDRLIST_EL).trigger("markReadNotify",d),$("#"+h.IM_MINI_PAGE).trigger("imMarkReadNotifyBell.miniChatPage",
{type:"4"}),$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage"))}break;case "2":n="4-sgroup-"+c.group;d=m.getImSysMsgNoReadCounts(n);if(!d||"0"==d.count)return;d.count="0";m.setImMsgNoReadCounts(n,d,"4");window.imCacheData.imSessionCacheManager.setSessionRead("4",c.group,d.count);$("#"+h.IM_ADDRLIST_EL).trigger("markReadNotify",d);$("#"+h.IM_MINI_PAGE).trigger("imMarkReadNotifyBell.miniChatPage",{type:"4"});$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage");break;
case "4":n="4-sgroup-"+c.group;d=m.getImSysMsgNoReadCounts(n);if(!d||"0"==d.count)return;d.count=parseInt(d.count)-1+"";m.setImMsgNoReadCounts(n,d,"4");window.imCacheData.imSessionCacheManager.setSessionRead("4",c.group,d.count);$("#"+h.IM_ADDRLIST_EL).trigger("markReadNotify",d);$("#"+h.IM_MINI_PAGE).trigger("imMarkReadNotifyBell.miniChatPage",{type:"4"});$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")}b.notifyAllChatUnreadCounts()},updateSysMsgUnreadCounts:function(a){a=a.message;
var b=a.datas.msg_type.group;this.updateRecentByNotify("4","4-"+b,a,{type:"4",count:1,sgroup:b})},updateRecentByNotify:function(a,b,c,d){switch(a){case "4":c=m.getImSysMsgNoReadCounts(b);break;default:c=m.getImChatNoReadCounts(b)}c?c.count=parseInt(c.count)+1:c=d;m.setImMsgNoReadCounts(b,c,a)},setReadChatMsgCount:function(a){var b,c=a.info.session_type,d,f={count:"0",type:c};switch(c){case "1":a=a.info.fuser;b=c+"-"+a.uid;d=a.uid;f.user=a;break;case "2":b=c+"-"+a.info.group_id,d=f.group_id=a.info.group_id}(a=
m.getImChatNoReadCounts(b))||(a=f);a.count="0";m.setImMsgNoReadCounts(b,a,c);window.imCacheData.imSessionCacheManager.setSessionRead(c,d);return a},getWebClientGuid:function(){var a=window.localStorage.getItem("imWebClientId");if(a&&0<a.length)return a;a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};a="static-"+(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a());window.localStorage.setItem("imWebClientId",a);return a},markChatMsgBack:function(a,b,c){a=a.message;var d={};d.type=
c;d.isSelf=!1;switch(c){case 1:window.imCurrentUser.uid==a.fuser.uid?b=a.tuser.uid:(b=a.fuser.uid,"10000"==a.tuser.uid&&(b="10000"));d.imChatorId=b;d.msgId=a.msgid;d.fuser=a.fuser;d.objId=d.imChatorId;break;case 2:d.groupId=a.group_id,d.msgId=a.msgid,d.fuser=a.user,d.objId=d.groupId,"GROUPTYPE_N"==a.type&&(d.isHelper=!0)}d.isSelf=window.imCurrentUser.uid==d.fuser.uid;if(1===c||d.isHelper){c={v:"",i18n:"im.chat.b"};a="";if(window.imCurrentUser.uid!=d.fuser.uid){a=m.getImChatUserCache("imUserCache-"+
d.fuser.uid+"-"+d.fuser.cid);if(!a)return;c.kvs={"%NAME%":a.name};a=a.name}else a=window.imCurrentUser.name;d.msgObj={type:"10",dt:[{txt:c}],suid:d.fuser.uid,scid:d.fuser.cid,sname:a};$("#"+h.IM_CHATWIN_EL).trigger("markChatMsgBackNotify",d);$("#"+h.IM_ADDRLIST_EL).trigger("updateMarkBackTitle",d)}else 2===c&&window.imWebsocketSdk.imJsonRequestMethods.activeSyncGroupMsgReq({cid:window.imCurrentUser.cid,uid:window.imCurrentUser.uid,groupId:a.group_id,groupType:d.isHelper?"1":"0",msgId:a.msgid},function(a){d.msgObj=
a.message.datas.msg;$("#"+h.IM_CHATWIN_EL).trigger("markChatMsgBackNotify",d);$("#"+h.IM_ADDRLIST_EL).trigger("updateMarkBackTitle",d)})},onMaskGroupMsg:function(a){a=a.message;var c={groupId:a.group_id,msgId:a.msgid,isHelper:"GROUPTYPE_N"===a.type,isSelf:window.imCurrentUser.uid===a.user.uid},d={v:"",i18n:"im.chat.mask"},f=m.getImChatUserCache("imUserCache-"+a.user.uid+"-"+a.user.cid);f&&(d.v="\u8be5\u6d88\u606f\u5df2\u88ab\u7ba1\u7406\u5458 ["+f.name+"] \u4e8e ["+b.formatDate()+"] \u5c4f\u853d",
d.kvs={"%NAME%":f.name,"%TIME%":(new Date).getTime()},c.msgObj={type:"1",typeBak:"12",dt:[{txt:d}],suid:a.user.uid,scid:a.user.cid},$("#"+h.IM_CHATWIN_EL).trigger("onMaskGroupMsgNotify",c))},setSysMsgUnreadNotify:function(a){window.imCacheData.imSessionCacheManager.setSysMsgUnreadNotify(a.message.group,a.message.unread_data.unread_count);$("#"+h.IM_ADDRLIST_EL).trigger("setSysMsgUnreadNotify",a.message);var b=a.message.msgid;a=a.message.group;$("#"+h.IM_SYSWIN_EL).trigger("setSysMsgUnreadNotify.ImSysWin",
{msgIds:[b],sgroup:a});$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")},sysMsgBatchUnReadStatusNotify:function(a){window.imCacheData.imSessionCacheManager.setSysMsgUnreadNotify(a.message.group,a.message.unread_data.data);$("#"+h.IM_ADDRLIST_EL).trigger("setSysMsgUnreadNotify",a.message);var b=a.message.msgid;a=a.message.group;$("#"+h.IM_SYSWIN_EL).trigger("setSysMsgUnreadNotify.ImSysWin",{msgIds:b,sgroup:a});$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")},
setUnreadSessionNotify:function(a){a=a.message;var b=a.info;b.unread_count=1;var c;switch(b.session_type){case "1":c=b.fuser.uid;break;case "2":c=b.group_id}window.imCacheData.imSessionCacheManager.insertSessionData(c,b);$("#"+h.IM_ADDRLIST_EL).trigger("setUnreadSessionNotify",a);$("body").trigger("updateImChatCount");$("#"+h.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage")},setSingleMsgReadStatusNotify:function(a){var b=a.message;a=b.user;if((b=b.msgids)&&0<b.length){var c=[];b.forEach(function(a){c.push({msgid:a,
status:"1"})})}b={};b.user=a;b.datas=c;$("#"+h.IM_CHATWIN_EL).trigger("singleReadNotify",b)},setGroupMsgReadStatusNotify:function(a){var b=a.message;a=b.group_id;if((b=b.msgids)&&0<b.length){var c=[];b.forEach(function(a){c.push({msgid:a,status:"1"})})}b={};b.groupId=a;b.datas=c;$("#"+h.IM_CHATWIN_EL).trigger("groupReadNotify",b)},setMsgRemindNotify:function(a){a=a.message.remind;var b;switch(a.session_type){case "1":b="1-"+a.user.uid;break;case "2":b="2-"+a.group_id;break;case "4":b="4-sgroup-"+
a.group}if(b=window.imCacheData.imSessionCacheManager.getSessionCache(b)){var c={};c.sessionData=b;c.remindFlag=a.reminder;$("#"+h.IM_ADDRLIST_EL).trigger("setMsgNoReminderNotify.ImAddrList",c)}},sysMsgUpdateNotify:function(a){a={msgId:a.message.msgid,msgType:a.message.msg_type};$("#"+h.IM_ADDRLIST_EL).trigger("sysMsgUpdateNotify.ImAddrList",a);$("#"+h.IM_SYSWIN_EL).trigger("sysMsgUpdateNotify.ImSysWin",a)},imGroupMsgAtMe:function(a){a=a.message.datas;if(a.from_uid!=window.imCurrentUser.uid||a.from_cid!=
window.imCurrentUser.cid){a=a.msg;if("1"==a.type&&(a=a.dt[0].txt,a.aus&&0<a.aus.length))for(var b=0;b<a.aus.length;b++){var c=a.aus[b];if(c.id==window.imCurrentUser.uid||"2"==c.t)return!0}return!1}},modifyGroupInfoNotify:function(a){var b=a.message,c=b.mask;switch(parseInt(c)){case h.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_HOST:window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:b.group_id,forceUpdate:!1},function(){$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("updateImGroupHostNotify.ImGroupDetail",
b);$("#"+h.IM_CHATWIN_EL).trigger("refreshImGroupMemberList.ImChatWin",b)});break;default:window.imCacheData.imGroupCacheManager.updateImGroupCache([b.group_id],function(a){a={newImChatGroup:a[0],mask:parseInt(c)};$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("updateImGroupDetailNotify.ImGroupDetail",a);$("#"+h.IM_ADDRLIST_EL).trigger("updateImGroupDetailNotify.ImAddrList",a);$("#"+h.IM_CHATWIN_EL).trigger("updateImGroupDetailNotify.ImChatWin",a)})}},initEtClient:function(){if(window.EteamsClient)return window.iminfoMap&&
(window.imCurrentUser={uid:window.iminfoMap.uid,cid:window.iminfoMap.cid,name:TEAMS.currentUser.username,gcid:window.iminfoMap.gcid,perLang:TEAMS.perLang?TEAMS.perLang.toLowerCase():"zh_cn"},console.log(JSON.stringify({appkey:window.iminfoMap.imAppKey,ticket:window.iminfoMap.imTicketStr,gcid:window.iminfoMap.gcid,userAccount:TEAMS.currentUser.loginAccount,corpAccount:TEAMS.currentTenant.tenantKey,imCurrentUser:{uid:window.iminfoMap.uid,cid:window.iminfoMap.cid,name:TEAMS.currentUser.name,avatar:TEAMS.currentUser.avatar},
perLang:TEAMS.perLang,jsessionid:ETEAMSID,dlUrl:crmContext.remoteDownloadUrl})),window.EteamsClient.OnLogin(JSON.stringify({appkey:window.iminfoMap.imAppKey,ticket:window.iminfoMap.imTicketStr,gcid:window.iminfoMap.gcid,userAccount:TEAMS.currentUser.loginAccount,corpAccount:TEAMS.currentTenant.tenantKey,imCurrentUser:{uid:window.iminfoMap.uid,cid:window.iminfoMap.cid,name:TEAMS.currentUser.name,avatar:TEAMS.currentUser.avatar},perLang:TEAMS.perLang,jsessionid:ETEAMSID,dlUrl:crmContext.remoteDownloadUrl})),
new c),!0},inviteToGroupNotify:function(a){a=a.message;$("#"+h.IM_CHATWIN_EL).trigger("updateCurrentGroupMember.ImChatWin",a)},exitGroupNotify:function(a){var b=a.message;window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(b.group_id,function(a){window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:b.group_id,forceUpdate:!1},function(){$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("refreshImGroupMemberList.ImGroupDetail",{groupId:b.group_id});$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("updateGroupRolesNotify.ImGroupDetail",
{groupId:b.group_id});b.newImChatGroup=a;$("#"+h.IM_CHATWIN_EL).trigger("refreshImGroupMemberList.ImChatWin",b);b.modType="3";$("#"+h.IM_CHATWIN_EL).trigger("modifyImGroupNotify.ImChatWin",b)})})},kickGroupMemberNotify:function(a){var b=a.message;window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(b.group_id,function(a){window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:b.group_id,forceUpdate:!1},function(){$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("refreshImGroupMemberList.ImGroupDetail",
{groupId:b.group_id});$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("updateGroupRolesNotify.ImGroupDetail",{groupId:b.group_id});b.newImChatGroup=a;$("#"+h.IM_CHATWIN_EL).trigger("refreshImGroupMemberList.ImChatWin",b);b.modType="2";$("#"+h.IM_CHATWIN_EL).trigger("modifyImGroupNotify.ImChatWin",b)})})},setGroupAdminNotify:function(a){var b=a.message;a=b.group_id;b={flag:b.flag,adminUsers:b.datas,groupId:a};window.imCacheData.imGroupCacheManager.modifyAdminUsers(b);$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("setGroupAdminNotify.ImGroupDetail",
b);$("#"+h.IM_CHATWIN_EL).trigger("refreshImGroupMemberList.ImChatWin",{group_id:a})},modifyGroupAvatarNotify:function(a){a=a.message;$("#"+h.IM_GROUP_DETAIL_MODAL).trigger("updateGroupAvatarNotify",{groupAvatar:a.avatar,groupId:a.group_id});window.imCacheData.imGroupCacheManager.updateImGroupCache([a.group_id],function(a){a={newImChatGroup:a[0],mask:h.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_AVATAR};$("#"+h.IM_ADDRLIST_EL).trigger("updateImGroupDetailNotify.ImAddrList",a);$("#"+h.IM_CHATWIN_EL).trigger("updateImGroupDetailNotify.ImChatWin",
a)})},imHelperMsgNotify:function(a){var b=this;a=a.message;var c={};c.uid=window.imCurrentUser.uid;c.cid=window.imCurrentUser.cid;c.msgId=a.ser_msgid;c.fromUid="10000";c.fromCid="10000";window.imWebsocketSdk.imJsonRequestMethods.activeSyncSingleMsgReq(c,function(a){a.isHelper=!0;window.imCacheData.imSessionCacheManager.receiveSingleChatMsg({resData:a.message,isHelper:!0},function(){$("#"+h.IM_ADDRLIST_EL).trigger("singleChatNotify",a);$("body").trigger("singleChatNotifyBell",a);$("#"+h.IM_CHATWIN_EL).trigger("imChatBoxNotify",
a);b.notifyAllChatUnreadCounts();b.isRemindClient("1-10000")&&window.OnSocMessageCallback&&window.OnSocMessageCallback(JSON.stringify(a))})})},imServiceGroupMsgNotify:function(a){var b=this;a=a.message;var c={};c.uid=window.imCurrentUser.uid;c.cid=window.imCurrentUser.cid;c.groupId=a.group_id;c.groupType="0";c.msgId=a.ser_msgid;window.imWebsocketSdk.imJsonRequestMethods.activeSyncHelperGroupMsgReq(c,function(a){a.isHelper=!0;window.imCacheData.imSessionCacheManager.receiveGroupChatMsg(a.message,"7");
window.imCacheData.imSessionCacheManager.receiveGroupChatMsg(a.message,"3");$("#"+h.IM_ADDRLIST_EL).trigger("serviceGroupChatNotify.ImAddrList",a);$("body").trigger("serviceGroupChatBell",a);$("#"+h.IM_CHATWIN_EL).trigger("imChatBoxNotify",a);b.notifyAllChatUnreadCounts();b.isRemindClient("7-"+a.message.group_id)&&window.OnSocMessageCallback&&window.OnSocMessageCallback(JSON.stringify(a))})},initI18nResource:function(){var a=this;b.isFirefox()?a.initFirefoxStorage():localforage.getItem("im.i18nConfig",
function(b){b&&(window.imCacheData.i18nConfig=b,localforage.getItem("im.sysConfigMap",function(a){window.imCacheData.sysConfigMap=a}));$.ajax({type:"get",url:"https://cdn.eteams.cn/cdnstatic/config/summary?"+Math.random(),timeout:3E3,dataType:"json",success:function(b){localforage.getItem("im.i18nSummary",function(c){if(c){var e={};c.forEach(function(a){e[a.type]=a});for(c=0;c<b.length;c++){var d=b[c];switch(d.type){case 1:var f=e[1];if(f&&f.version<d.version){var g=d.url;localforage.getItem("im.i18nConfig",
function(a){$.ajax({type:"get",url:g,dataType:"json",success:function(a){window.imCacheData.i18nConfig=a;localforage.setItem("im.i18nConfig",a)}})})}break;case 2:f=e[2],f.version<d.version&&$.ajax({type:"get",url:d.url,dataType:"json",success:function(b){b=a.buildSysConfigMap(b);window.imCacheData.sysConfigMap=b;localforage.setItem("im.sysConfigMap",b)}})}}localforage.setItem("im.i18nSummary",b)}else localforage.setItem("im.i18nSummary",b,function(){b.forEach(function(b){switch(b.type){case 1:$.ajax({type:"get",
url:b.url,dataType:"json",success:function(a){window.imCacheData.i18nConfig=a;localforage.setItem("im.i18nConfig",a)}});break;case 2:$.ajax({type:"get",url:b.url,dataType:"json",success:function(b){b=a.buildSysConfigMap(b);window.imCacheData.sysConfigMap=b;localforage.setItem("im.sysConfigMap",b)}})}})})})}})})},buildSysConfigMap:function(a){var b={},c={};a.types.forEach(function(a){b[a.type]=a});a.groups.forEach(function(a){c[a.group]=a});return{stypeMap:b,sgroupMap:c}},initFirefoxStorage:function(){var a=
this,b=window.localStorage.getItem("imStorage");b&&(b=JSON.parse(b));b.i18nConfig&&(window.imCacheData.i18nConfig=b.i18nConfig,window.imCacheData.sysConfigMap=b.sysConfigMap);$.ajax({type:"get",url:"https://cdn.eteams.cn/cdnstatic/config/summary?"+Math.random(),timeout:3E3,async:!1,dataType:"json",success:function(c){var d=b.i18nSummary;if(d){var f={};d.forEach(function(a){f[a.type]=a});for(d=0;d<c.length;d++){var g=c[d];switch(g.type){case 1:var h=f[1];h&&h.version<g.version&&$.ajax({type:"get",
url:g.url,dataType:"json",async:!1,success:function(a){window.imCacheData.i18nConfig=a;b.i18nConfig=a;window.localStorage.setItem("imStorage",JSON.stringify(b))}});break;case 2:h=f[2],h.version<g.version&&$.ajax({type:"get",url:g.url,dataType:"json",async:!1,success:function(c){c=a.buildSysConfigMap(c);window.imCacheData.sysConfigMap=c;b.sysConfigMap=c}})}}}else c.forEach(function(c){switch(c.type){case 1:$.ajax({type:"get",url:c.url,async:!1,dataType:"json",success:function(a){window.imCacheData.i18nConfig=
a;b.i18nConfig=a}});break;case 2:$.ajax({type:"get",url:c.url,dataType:"json",async:!1,success:function(c){c=a.buildSysConfigMap(c);window.imCacheData.sysConfigMap=c;b.sysConfigMap=c}})}}),window.localStorage.setItem("imStorage",JSON.stringify(b))}})},setMsgReadStatusNotify:function(a){a=a.message;$("#"+h.IM_CHATWIN_EL).trigger("setMsgReadStatusNotify.ImChatWin",{groupId:a.group_id,flag:a.rs_onoff})}});p.exports=n});
define("im/chat/imCommonChatView",["im/component/imUtils","teams/base/preview","im/component/imChatComponent","im/component/imContants","im/component/group/anonymous"],function(n,s,p){var m=n("im/component/imUtils"),l=n("teams/base/preview"),h=n("im/component/imChatComponent"),g=n("im/component/imContants"),f=n("im/component/group/anonymous");n=Backbone.View.extend({initialize:function(a){this.el=a.el;this.imRecentEl="#im-recent-list";this.chatType=a.chatType;this.imChatUser=a.imChatUser;this.imChatGroup=
a.imChatGroup;this.$scrollBar=a.$scrollBar;this.count=a.count;this.isUnread=a.isUnread;this.minMsgId;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.isFirst=!0;this.stypeMap=h.getImSysMsgConfig("stypeMap","stype")},delegateEvents:function(){$(this.el)},renderSynChatMsgDatas:function(a,d,b,c,k){this.minMsgId&&(this.isFirst=!1);$(this.el).find(".j_im-more-chatMessage").addClass("hide");a&&0<a.length&&"0"!=a[a.length-1].next_id&&$(this.el).find(".j_im-more-chatMessage").removeClass("hide");
$(this.el).find("#im-chat-list-loading").addClass("hide");if(this.isFirst){var e=b.height();b.find(".mCSB_container").css("top",e+"px")}null!=a&&0<a.length?(this.minMsgId=a[a.length-1].next_id,this.renderChatMsgList(a,d,b,c,k)):$(this.el).find(".j_im-more-chatMessage").addClass("hide")},renderChatMsgList:function(a,d,b,c,k){if(void 0!=a&&0<a.length&&(d=!1,0<this.count&&(this.count-=a.length,d=!0),a))for(var e=0;e<a.length;e++){var f=a[e],f={mesData:f,kind:f.kind,msgObj:f.msg,msgId:f.ser_msgid,fromUid:f.from_uid,
fromCid:f.from_cid,direction:f.from_uid==TEAMS.currentUser.id?"right":"left",container:$(this.el),listContainer:c,addMethod:"prepend",chatType:"singleChat",needReposition:!0,isUnread:d,$scrollBar:b,isHelper:k};this.createChatMesBody(f,function(){b.mCustomScrollbar("update")})}},createChatMesBody:function(a,d){var b=a.container,c=a.listContainer,k=a.mesData,e=a.kind;if(!this.msgKind||this.msgKind==e){var g=a.msgObj,u=a.msgType;u||(u=g.type.toString());var l=a.fromUid,m=a.fromCid,n=a.direction,x=a.addMethod,
v=a.chatType,q=a.needReposition,p=a.msgId,s=a.isUnread,D=a.$scrollBar,G=a.failMsg,e=a.msgStatusUnread,E=a.isCurrentChat,B=a.isHelper,H=a.tipMsgKey,F="1"===a.msgObj.display;if(p&&!(0<c.find("#"+p).length)){var t=b.find("#im-chat-message-clone").clone().removeAttr("id").attr("id",p);"singleChat"==this.chatType?(t.find(".j_avatar_te img").remove(),t.find(".j_name").addClass("j_trigger-usercard")):"groupChat"==this.chatType&&t.find(".j_name, .j_im-chat-name-at").addClass("j_im-chat-quick-at");h.getImUserInfo({uid:l,
cid:m},function(a){t.find(".j_avatar img").data("imChatUser",a);"right"!=n&&t.find(".j_name").text(a.name);a.avatar&&(a=crmContext.remoteDownloadUrl+"/noauth/"+a.avatar+"?type\x3dsmall",t.find(".j_avatar img").attr("src",a));"10000"==l&&"10000"==m&&(t.find(".j_avatar img").attr("src","/static/img/global/service.png"),t.find(".j_im-chat-content .j_name").removeClass("im-cp"))});if(B||"singleChat"==this.chatType)t.find(".j_im-chat-name-at").remove(),t.find(".j_im-chat-quick-at").removeClass("j_im-chat-quick-at");
F&&(F=f.getAvatar(),t.addClass("msg-type-anonymous").find(".usercard-toggle").removeClass("usercard-toggle").end().find(".j_im-user-avatar-trigger").removeClass("j_im-user-avatar-trigger im-cp").end().find(".j_im-chat-quick-at").removeClass("j_im-chat-quick-at").end().find(".j_im-chat-name-at").remove().end().find(".j_avatar img").attr("src",F),t.find(".j_name").text(g.sname),l===TEAMS.currentUser.id?t.find(".j_name").prepend('\x3ci class\x3d"tag-anonymous"\x3e'+f.il8n("anonymous")+"\x3c/i\x3e"):
t.find(".j_name").append('\x3ci class\x3d"tag-anonymous"\x3e'+f.il8n("anonymous")+"\x3c/i\x3e"));t.attr("msg-type",u);switch(u){case "1":if(g.typeBak)switch(g.typeBak.toString()){case "5":this.renderLocalChatBubble(g,t,v,b);break;case "10":window.imCurrentUser.uid==l&&(g.dt[0].txt.i18n="im.chat.b.self");t=this.renderChatNotifyMsg(p,g,t,b,k);break;case "12":window.imCurrentUser.uid==k.msg.suid&&(g.dt[0].txt.i18n="im.chat.mask.self");this.renderTextChatBubble(p,g,t,v,b,s,E);break;default:this.renderTextChatBubble(p,
g,t,v,b,s,E)}else this.renderTextChatBubble(p,g,t,v,b,s,E);break;case "2":this.renderPicChatBubble(g,t,v,b,B);break;case "3":this.renderVoiceChatBubble(p,g,t,v,b,B);break;case "4":this.renderAttachmentChatBubble(g,t,v,b,B);break;case "5":this.renderLocalChatBubble(g,t,v,b);break;case "8":this.renderEntityChatBubble(g,t,v,b);break;case "9":this.renderI18nTextChatBubble(p,g,t,v,b,s);break;case "10":window.imCurrentUser.uid==l&&(g.dt[0].txt.i18n="im.chat.b.self");t=this.renderChatNotifyMsg(p,g,t,b,k);
break;case "11":window.imCurrentUser.uid==l&&(g.dt[0].txt.i18n="im.chat.sk.self");t=this.renderChatNotifyMsg(p,g,t,b,k);break;case "12":window.imCurrentUser.uid==a&&(g.dt[0].txt.i18n="im.chat.msg.self");this.renderTextChatBubble(p,g,t,v,b,s,E);break;case "100":t=this.renderChatTipMsg(p,H,t,b,k);break;default:this.renderNotSupportBubble(p,g,t,v,b,s)}"singleChat"==this.chatType?"10000"==this.imChatUser.cid||"10000"==this.imChatUser.cid||this.msgKind&&"0"!=this.msgKind||(t.find(".j_im-chatmsg-readStatus").text("\u672a\u8bfb"),
t.find(".j_im-chatmsg-readStatus").removeClass("hide-im")):"groupChat"!=this.chatType||this.msgKind&&"0"!=this.msgKind||(t.find(".j_im-chatmsg-readStatus").addClass("j_im-groupmsg-readStatus"),t.find(".j_im-chatmsg-readStatus").addClass("im-cp"),b=this.imChatGroup.userNum-1,B&&(b-=1),t.find(".j_im-chatmsg-readStatus").attr("count",b),B="\u5168\u90e8\u5df2\u8bfb",1<this.imChatGroup.userNum?B=b+"\u4eba\u672a\u8bfb":t.find(".j_im-chatmsg-readStatus").removeClass("unread"),t.find(".j_im-chatmsg-readStatus").text(B),
"1"==this.imChatGroup.rsOnOff&&t.find(".j_im-chatmsg-readStatus").removeClass("hide-im"));k?(k.msg||(k.msg=g),t.data("mesData",k),k=Date.create(1E3*k.msgtime),k.is("today")?t.find(".chat-time time").text(k.format("{HH}:{mm}:{ss}")).data("lastDate",k.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")):t.find(".chat-time time").text(k.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")).data("lastDate",k.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"))):(k=new Date,t.find(".chat-time time").text(k.format("{HH}:{mm}:{ss}")).data("lastDate",
k.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")));"right"==n&&t.addClass(n);1==G&&(t.find(".j_send-msg-again").removeClass("hide"),a.pasteData?t.find(".j_send-msg-again").data("pasteData",a.pasteData):t.find(".j_send-msg-again").data("file",a.file),t.find(".j_send-msg-again").data("tempMsgId",p));c[x](t);q?this.rePosition(t,D,c):((c=$(this.el).find(".j_im-chatwin-msg-container").data("msgHeightDatas"))||(c={msgMaxHeight:-50,msgHeightList:[]}),e&&(t.addClass("j_single-unread"),c.msgHeightList.push({msgId:t.attr("id"),
pTop:c.msgMaxHeight+t.height()+16})),c.msgMaxHeight+=t.height()+16,$(this.el).find(".j_im-chatwin-msg-container").data("msgHeightDatas",c));d&&d(t);return t}}},renderEntityChatBubble:function(a,d,b,c){var k=$(this.el),e=a.dt[0].entity;a=e.id;b=e.nm;c=e.me;var e=e.etype,f=this.stypeMap[e],k=k.find("#chat-content-clone #chat-entity-clone").clone().removeClass("hide"),g=k.find(".j_entity-msg-content").attr("id",a),h="\u3010\u4e8b\u9879\u3011",l=f.name,m=l.zh_cn;l[TEAMS.perLang.toLocaleLowerCase()]&&
(m=l[TEAMS.perLang.toLocaleLowerCase()]);f&&(h="\u3010"+m+"\u3011");g.attr("data-id",a);g.attr("data-module",c);g.find(".info .title").text(b);a=TEAMS.service.imWebapp+"/static/img/mobile/stypeImg/stype_"+e+".png";g.find(".j_im-stype-img").attr("src",a);g.find(".extra .j_chat-entity-bubble-module").text(h);d.find("div.bubble").addClass("hide");d.find(".j_chat-content").html(k.html())},renderChatNotifyMsg:function(a,d,b,c,k){b=c.find("#j_chat-back-msg-clone").clone().removeAttr("id").attr("id",a);
a=m.getMsgContent(d,window.imCurrentUser,f.il8n("anonymity"));b.find("span").text(a);return b},renderChatTipMsg:function(a,d,b,c){b=c.find("#j_chat-back-msg-clone").clone().removeAttr("id").attr("id",a);a=m.processMsgByType(void 0,d);b.find("span").text(a);return b},renderSysMsg:function(a,d,b){a=b.find("#tpl-im-msg-sys").clone().attr("id",a);d=m.processMsgByType(d);a.find("span").text(d);return a},markChatMsgBack:function(a,d,b,c,k){b=c.find("#j_chat-back-msg-clone").clone().removeAttr("id").attr("id",
a);window.imCurrentUser.uid==k.from_uid&&(d.dt[0].txt.i18n="im.chat.b.self");a=m.processMsgByType(d);b.find("span").text(a)},renderNotSupportBubble:function(a,d,b,c,k,e){d.dt[0].txt.v&&(a=k.find("#chat-content-clone #chat-text-clone").clone().removeClass("hide"),a.find(".bubble").html("\u6682\u4e0d\u652f\u6301\u6b64\u6d88\u606f\u7c7b\u578b"),b.find(".j_chat-content").html(a))},renderTextChatBubble:function(a,d,b,c,k,e,w){var u=d.dt[0].txt;if(u.v){var l=u.v,n=u.v,r=m.initMessage(u.v);c=r;var x=k.find("#chat-content-clone #chat-text-clone").clone().removeClass("hide");
u.aus&&(c=$('\x3ca class\x3d"at-user j_at-obj-trigger"\x3e\x3c/a\x3e'),l=h.completeAtContent(u.aus,n,r,c,TEAMS.perLang,!0,l),l.isAtme&&e&&this.renderChatAtOne(a,l.txtValueName,d),c=l.txtValue,l=l.originContent);u.i18n&&(c=m.processMsgByType(d),l=m.processMsgByType(d));x.find(".bubble").html(c);l=m.changeHtmlBr(l);x.find(".bubble").attr("txtValueName",l);b.find(".j_chat-content").html(x);w||$("#"+g.IM_CHATWIN_EL).trigger("showAtHeadView.ImChatWin");if(d.rmsg&&d.rmsg.fuser){a=k.find(".j_chatmsg-reply-bubble-clone").clone();
b.find(".j_bubble").addClass("bubble-reply");b.find(".j_bubble").html(a.children());"1"===d.rmsg.display?b.find(".j_reply-info .j_name").text("["+f.il8n("anonymity")+"] "+d.rmsg.fname):h.getImUserInfo(d.rmsg.fuser,function(a){b.find(".j_reply-info .j_name").text(a.name)});a=d.rmsg.rcon;a=$.faceConvert(a);switch(d.rmsg.t){case "1":d.rmsg.aus&&(a=h.buildReplyMsgTitle(d.rmsg.aus,d.rmsg.rcon,d.rmsg.t));d.rmsg.msg&&"12"===d.rmsg.msg.typeBak&&(a=m.getMsgContent(d.rmsg.msg,window.imCurrentUser));break;default:a=
m.getLastTxtByMsgType(d.rmsg.t)}b.find(".j_reply-info").data("rmsg",d.rmsg);b.find(".j_reply-details").html(a);b.find(".j_reply-content").html(c);d=Date.create(parseInt(d.rmsg.time));b.find(".j_date").text(d.format("{HH}:{mm}:{ss}"))}}},renderChatAtOne:function(a,d,b){var c=this,k=$(c.el).find(".j_chat-head-at-read"),e="1"===b.display;k.data("msgId",a);k.find(".j_content-box div").addClass("hide");k.removeClass("hide-im");var g=h.getImChatUserCache("imUserCache-"+b.suid+"-"+b.scid);if(g){var l=g.avatar?
"/base/download/"+g.avatar:"/static/images/avatar.png",A=g.name;e&&(l=f.getAvatar(),A="["+f.il8n("anonymity")+"] "+b.sname);g=$(c.el).find("#chat-at-notify-clone").clone().addClass("hide").attr("id","atmsg-"+a);g.data("msgId",a);A=A+"\uff1a"+d;200<A.length&&(A=A.substring(0,200)+"...");A=m.initTitle(A);g.find(".message").html(A).end().find(".avatar img").attr("src",l);k.find(".j_content-box").empty();k.find(".j_content-box").prepend(g);k.find(".j_content-box div.content").first().removeClass("hide")}else h.getImUserInfo({uid:b.suid,
cid:b.scid},function(g){var h=g.avatar?"/base/download/"+g.avatar:"/static/images/avatar.png",w=g.name;e&&(h=f.getAvatar(),w="["+f.il8n("anonymity")+"] "+b.sname);g=$(c.el).find("#chat-at-notify-clone").clone().addClass("hide").attr("id","atmsg-"+a);w=w+"\uff1a"+d;2E3<w.length&&(w=w.substring(0,200)+"...");w=m.initTitle(w);g.find(".message").html(w).end().find(".avatar img").attr("src",h);k.find(".j_content-box").empty();k.find(".j_content-box").prepend(g);k.find(".j_content-box div.content").first().removeClass("hide")})},
renderPicChatBubble:function(a,d,b,c,k){b=$(this.el);a=a.dt[0].img;b=b.find("#chat-content-clone #chat-image-clone").clone().removeClass("hide");c=crmContext.remoteDownloadUrl+"/noauth/"+a.src+"?type\x3dsmall";k=crmContext.remoteDownloadUrl+"/noauth/"+a.src;b.find(".bubble").find("a").attr("imghref",k);b.find(".bubble").find("img").attr("src",c);a.h&&"0"!=a.h||(a.h="100");a.h&&b.find(".j_bubble").css("height",parseInt(a.h)+14);a.w&&b.find(".j_bubble").css("width",parseInt(a.w)+22);b.find("img").css("max-width",
"200px");b.find("img").css("max-height","200px");d.find(".j_chat-content").html(b)},renderLocalChatBubble:function(a,d,b,c){b=$(this.el);if(a=a.dt[0].location){c=a.name;var k=a.addr;b=b.find("#chat-content-clone #chat-location-clone").clone().attr("id","").removeClass("hide");b.find(".info").text(k);c&&c!=k&&(b.find(".title").removeClass("hide"),b.find(".title").text(c));c="https://api.map.baidu.com/staticimage/v2?ak\x3dlZVLz80fXoVh3VVsN5ChL6bb\x26amp;scale\x3d2\x26width\x3d300\x26amp;height\x3d120\x26amp;center\x3d"+
a.lng+","+a.lat+"\x26amp;markers\x3d"+a.lng+","+a.lat+"\x26zoom\x3d15\x26amp;markerStyles\x3dl,,0xff0000\x26amp";b.find(".content").html("\x3ca class\x3d'j_check-addr'\x3e\x3cimg src\x3d"+c+"/\x3e\x3c/a\x3e");d.find(".j_chat-content").html(b.html());d.find(".j_check-addr").data("location",a)}else a=c.find("#chat-content-clone #chat-text-clone").clone().removeClass("hide"),a.find(".bubble").html("\u4e0d\u652f\u6301\u7684\u7c7b\u578b"),a.find(".bubble").attr("txtValueName","\u4e0d\u652f\u6301\u7684\u7c7b\u578b"),
d.find(".j_chat-content").html(a)},renderVoiceChatBubble:function(a,d,b,c,k,e){e=$(this.el);var f=!1;if(void 0!=window.IsEteamsClient)switch(window.IsEteamsClient()){case 2:f=!0}f?(d.type=1,d.dt[0].txt={v:"[\u6682\u4e0d\u652f\u6301\u6b64\u7c7b\u6d88\u606f]"},this.renderTextChatBubble(a,d,b,c,k)):(a=d.dt[0].video,d=1,a.dur&&(d=parseInt(a.dur/1E3)),c=d+"%",e=e.find("#chat-content-clone #chat-video-clone").clone().removeClass("hide").attr("id",a.id),e.find(".dur-width").css("width",c),e.find(".j_time span").text(d),
d=crmContext.remoteDownloadUrl+"/remotedownload/"+a.src+"/"+ETEAMSID+"/true?type\x3damr2mp3",d=crmContext.remoteDownloadUrl+"/noauth/"+a.src+"?type\x3damr2mp3",e.find("audio").attr("src",d),b.attr("type",3),b.find(".j_chat-content").html(e.html()))},renderAttachmentChatBubble:function(a,d,b,c,k){b=$(this.el);(a=a.dt[0].file)?(b=b.find("#chat-content-clone #chat-attachment-clone").clone().removeClass("hide"),c=crmContext.remoteDownloadUrl+"/remotedownload/"+a.id+"/"+ETEAMSID+"/true",c=crmContext.remoteDownloadUrl+
"/noauth/"+a.id,k=$("\x3ca class\x3d'im-bubble-download' href\x3d'"+c+"' data-value\x3d"+a.id+"\x3e"+a.nm+"\x3c/a\x3e"),b.find(".j_download").append(k),a={id:a.id,image:-1<a.dt.indexOf("image")?!0:!1,docType:a.dt,fileSize:a.size,name:a.nm,extName:a.ext},(new l({container:b,afterJqObj:b.find(".j_preview span"),fileObj:a,module:"im"})).render(),d.find(".j_chat-content").html(b),a.image&&d.find(".gallery-pic").attr("imghref",c)):(b=c.find("#chat-content-clone #chat-text-clone").clone().removeClass("hide"),
b.find(".bubble").html("\u6682\u4e0d\u652f\u6301\u8be5\u7c7b\u578b\u6d88\u606f,\u3000\u8bf7\u5230\u6700\u65b0\u7248app\u7aef\u67e5\u770b\u3002"),d.find(".j_chat-content").html(b))},rePosition:function(a,d,b){b=d.find(".mCSB_container").css("top");b=b.replace("px","");var c=a.height()+16;this.saveMsgHeightData(a,b,c);this.newPagePosition=b-=c;d.find(".mCSB_container").css("top",b+"px")},saveMsgHeightData:function(a,d,b){(d=$(this.el).find(".j_im-chatwin-msg-container").data("msgHeightDatas"))||(d=
{msgMaxHeight:-50,msgHeightList:[]});a.hasClass("j_single-unread");for(var c=0;c<d.msgHeightList.length;c++){var k=d.msgHeightList[c];k.pTop=parseInt(k.pTop)+parseInt(b)}d.msgMaxHeight+=parseInt(b);a&&!a.hasClass("right")&&(a={msgId:a.attr("id"),pTop:0},d.msgHeightList.push(a));$(this.el).find(".j_im-chatwin-msg-container").data("msgHeightDatas",d)},updateChatMesBody:function(a,d){var b=a.$msgBody,c=a.listContainer,k=a.msgDateTime,e=a.chatType,f=a.msgId;if(f)if(0<c.find("#"+f).length)b.remove();else return b.attr("id",
f),"singleChat"==e&&b.find(".j_im-chat-name-at").remove(),k&&(b.data("msgDateTime",k),c=Date.create(1E3*k),c.is("today")?b.find(".chat-time time").text(c.format("{HH}:{mm}:{ss}")).data("lastDate",c.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")):b.find(".chat-time time").text(c.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}")).data("lastDate",c.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"))),d&&d(),b},sendChatMsgAndBack:function(a){var d={msgObj:a.msg,msgType:a.msgType,msgId:a.tempMsgId,tipMsgKey:a.tipMsgKey,direction:"right",
container:$(this.el),listContainer:$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),$scrollBar:a.$scrollBar,imChatUserId:this.imChatUserId,imChatGroupId:this.imChatGroupId,fromUid:window.imCurrentUser.uid,fromCid:window.imCurrentUser.cid,addMethod:"append",chatType:this.chatType,needReposition:!1,failMsg:a.failMsg,file:a.file,pasteData:a.pasteData,isHelper:a.isHelper};this.createChatMesBody(d,function(b){setTimeout(function(){a.$scrollBar.mCustomScrollbar("scrollTo","bottom")},
50)});$("#"+g.IM_ADDRLIST_EL).trigger("checkChatUnreadNum.ImAddrList",{chatType:this.chatType,imChatUser:this.imChatUser,imChatGroup:this.imChatGroup})},sendChaTipMsg:function(a){var d={direction:"right",container:$(this.el),$scrollBar:a.$scrollBar,listContainer:$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),imChatUserId:this.imChatUserId,imChatGroupId:this.imChatGroupId,fromUid:window.imCurrentUser.uid,fromCid:window.imCurrentUser.cid,addMethod:"append",chatType:this.chatType,
needReposition:!1};this.createChatMesBody(d,function(){setTimeout(function(){a.$scrollBar.mCustomScrollbar("scrollTo","bottom")},50)})},updateMsgBubble:function(a){var d=a.msg,b=a.tempMsgId;a=a.isHelper;var c=$(this.el),k=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"),e=this.chatType,k=k.find("#"+b);k.attr("msg-type",d.type.toString());switch(d.type.toString()){case "1":if(d.typeBak)switch(d.typeBak.toString()){case "5":this.renderLocalChatBubble(d,k,e,c)}else this.renderTextChatBubble(b,
d,k,e,c,!1);break;case "2":this.renderPicChatBubble(d,k,e,c,a);break;case "3":this.renderVoiceChatBubble(b,d,k,e,c,a);break;case "4":this.renderAttachmentChatBubble(d,k,e,c,a);break;case "5":this.renderLocalChatBubble(d,k,e,c);break;case "8":this.renderEntityChatBubble(d,k,e,c);break;case "10":this.renderChatBackMsg(b,d,k,c,mesData);break;case "12":this.renderTextChatBubble(b,d,k,e,c,!1);break;default:this.renderNotSupportBubble(b,d,k,e,c,!1)}},remove:function(){$("body").off(".ChatChannel");this.chatHistoryView&&
this.chatHistoryView.remove()}});p.exports=n});
define("im/chat/imMsgReadStatusView",["im/component/imUtils","im/component/imContants","im/component/imChatComponent","im/component/imUsercard"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/component/imChatComponent"),g=n("im/component/imUsercard");n=Backbone.View.extend({initialize:function(f){this.groupId=f.groupId;this.msgId=f.msgId;this.el="#"+l.IM_MSG_READ_STATUS_MODAL;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imChatMsgCBService=
window.imEteamsJsService.ImChatMsgCBService;$(this.el).remove();$("body").append(m.template("imchat.immsgreadstatus"))},delegateEvents:function(){var f=this,a=$(f.el);a.off("click.ImMsgReadStatus",".j_im-group-member-avatar-trigger").on("click.ImMsgReadStatus",".j_im-group-member-avatar-trigger",function(a){a.stopPropagation();var b=$(this),c=b.parents(".j_group-member").data("imChatUser");c.cid==window.imCurrentUser.cid?f.imChatMsgCBService.clickSenderAvatar(c,b):($("#"+l.IM_USERCARD).trigger("closePanel"),
0<$("#usercard").length&&$("#usercard").trigger("closeUsercard"),(new g({targetEl:b,pointX:a.pageX,pointY:a.pageY,uidCid:{uid:c.uid,cid:c.cid},isHelper:!0,chatType:"groupChat"})).render())});a.off("closeImMsgReadStatusPanel.ImMsgReadStatus").on("closeImMsgReadStatusPanel.ImMsgReadStatus",function(a){f.close()});$("body").off("click.ImMsgReadStatus").on("click.ImMsgReadStatus",function(a){a=$(a.target);a.hasClass("j_closeImMsgReadPanel")&&f.close();"im-frame-container"==a.attr("id")||0<a.parents("#im-frame-container").length||
a.hasClass("j_im-chat-msgreadstatus-modal-show")||0<a.parents(".j_im-chat-msgreadstatus-modal-show").length||0<$("#usercard").length||f.close()})},render:function(){var f=this;f.imWebReqMethods.getGroupMsgReadDetailReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,msgId:f.msgId,groupId:f.groupId},function(a){var d=$(f.el),b=d.find(".j_msg-readed-container"),c=d.find(".j_msg-unread-container");if((a=a.message.datas)&&0<a.length){var k=0,e=0;a=m.sortBy(a,"time");a.forEach(function(a){switch(a.status){case "0":e+=
1;break;case "1":k+=1}f.renderMsgDetailOne(a,b,c)});b.find(".j_count").text("("+k+")");c.find(".j_count").text("("+e+")")}else if((a=h.getImGroupMemberCache("groupMemberKeyArray-"+f.groupId))&&a.groupMemberKeyArray&&0<a.groupMemberKeyArray.length){a=a.groupMemberKeyArray;for(var d=[],g=0;g<a.length;g++){var l=h.getImChatUserCache("imChatUserNameKey-"+a[g]);d.push(l)}d.forEach(function(a){a.uid=a.id;f.renderMsgDetailOne({user:a,status:"1"},b,c)})}});$(f.el).modal()},renderMsgDetailOne:function(f,a,
d){var b=$(this.el),c=a.find(".j_msg-readed-list"),k=d.find(".j_msg-unread-list"),e=b.find("#im-chat-msgreadstatus-modal-clone-field #group-member-clone").clone().attr("id",f.user.uid);h.getImUserInfo({uid:f.user.uid,cid:f.user.cid},function(b){e.find(".j_name").text(b.name);var g="/static/images/avatar.png";b.avatar&&(g=crmContext.remoteDownloadUrl+"/noauth/"+b.avatar+"?type\x3dsmall");"10000"==b.uid&&"10000"==b.cid&&(g="/static/img/global/avatar_assistant.png");e.find(".j_avatar").attr("src",g);
e.data("imChatUser",b);switch(f.status){case "0":d.removeClass("hide");k.append(e);break;case "1":f.time&&(b=Date.create(1E3*f.time),b=b.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"),e.attr("title","\u9605\u8bfb\u65f6\u95f4\uff1a"+b)),a.removeClass("hide"),c.prepend(e)}})},close:function(){$(this.el).modal("hide")},remove:function(){$(this.el).off(".ImMsgReadStatus");$("body").off(".ImMsgReadStatus")}});p.exports=n});
define("im/chat/imGroupChatView","im/component/imUtils im/component/imContants im/chat/imCommonChatView im/component/imChatComponent im/component/imCommonModel im/component/imCommonRender im/component/group/anonymous".split(" "),function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/chat/imCommonChatView"),g=n("im/component/imChatComponent"),f=n("im/component/imCommonModel"),a=n("im/component/imCommonRender"),d=n("im/component/group/anonymous");n=Backbone.View.extend({initialize:function(a){this.chatType=
a.chatType;this.imChatGroup=a.imChatGroup;this.minMsgId;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imJsonUtils=window.imWebsocketSdk.imJsonUtils;this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;this.el=a.el;this.count=a.count;this.$scrollBar=a.$scrollBar;this.imCommonChatView=new h({chatType:this.chatType,imChatGroup:this.imChatGroup,el:this.el,$scrollBar:this.$scrollBar,count:a.count,isUnread:a.isUnread});this.isFirst=!0;"chatWin"===a.fromView&&(this.anonymousModel=
d.init(a.view,a.imChatGroup))},delegateEvents:function(){$(this.el)},render:function(a,c){this.imCommonChatView.msgKind=void 0;this.renderGroupChatHistory(a,c)},renderByKind:function(a,c){this.imCommonChatView.msgKind=a.kind;a.isHelper&&!a.groupExist||this.renderGroupChatHistoryByKind(a,c)},renderGroupChatHistory:function(a,c){var d=this,e=a.renderOrder,f=a.isHelper;d.loadGroupChatHistory(a,function(g){void 0==e&&(e="down");(g=g.message.datas[0].datas)&&0<g.length?(g=m.sortBy(g,"ser_msgid"),d.minMsgId=
g[g.length-1].next_id,d.imCommonChatView.renderSynChatMsgDatas(g,e,a.$scrollBar,a.$listContainer,f),d.getGroupMsgReadStatusReq(g)):g=[];g&&c&&c(g)})},renderGroupChatHistoryByKind:function(a,c){var d=this,e=a.renderOrder;d.loadGroupChatHistoryByKind(a,function(f){void 0==e&&(e="down");f=f.message;var g=[];f.datas&&0<f.datas.length&&(g=f.datas)&&g&&0<g.length&&(g=m.sortBy(g,"ser_msgid"),d.minMsgId=g[g.length-1].next_id,d.imCommonChatView.renderSynChatMsgDatas(g,e,a.$scrollBar,a.$listContainer));g&&
c&&c(g)})},loadGroupChatHistoryByKind:function(a,c){a||(a={});var d=a.isHelper;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.groupId=this.imChatGroup.id;a.groupType="GROUPTYPE_Q";a.dev=window.imClientDev;a.start="9223372036854775807";this.minMsgId&&(a.start=this.minMsgId);a.end="0";a.maxNum="10";this.imWebReqMethods[d?"syncKindHelpGroupMsgReq":"syncKindGroupMsgReq"](a,function(a){c&&c(a)})},loadGroupChatHistory:function(a,c){var d="syncGroupMsgReq",d=a.isHelper,e=a.groupExist;a||
(a={});a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.maxNum||(a.maxNum="10");a.order||(a.order="desc");if(!a.datas){var f=[],g={groupId:this.imChatGroup.id,maxNum:"10"};a.maxNum&&(g.maxNum=a.maxNum);this.minMsgId&&(g.start=this.minMsgId);f.push(g);a.datas=f}$(this.el).find(".j_im-more-chatMessage").addClass("hide");d=d?"syncHelperGroupMsgReq":"syncGroupMsgReq";e||(d="syncExistGroupMsgReq");this.imWebReqMethods[d](a,function(a){c&&c(a)})},sendChatMsgAndBack:function(a){var c=this,
d=a.isHelper;a.dev=window.imClientDev;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.toCid=window.imCurrentUser.cid;a.sname=c.getSenderName();var e=c.imWebReqMethods.initTempMsgId().toString();a.tempMsgId&&(e=a.tempMsgId);a.tempMsgId=e;var f=a.$listContainer;f||(f=$(c.el).find("#chatMessageList"));a.groupId=c.imChatGroup.id;if("1002"==a.msgTypeConf){var g=a.aus,h=[],m=a.clitxt;if(g&&0<g.length){for(var n=0;n<g.length;n++){var x=g[n];-1<m.indexOf(":@"+x.id+";")&&h.push(x)}0==h.length&&
(a.msgTypeConf="1001")}}var v=c.imWebReqMethods.buildJsonChatMsg(a),q=c.imWebReqMethods[d?"sendCustomMsgReq":"sendGroupMsgReq"](a,function(g){g=g.message;if("0"==g.ret.ret){var h=f.find("#"+e);h&&(g.kind=a.msgTypeConf,g.sname=a.sname,g.msg||(g.msg=v.msg),h.data("mesData",g));h={msgDateTime:g.msgtime,$msgBody:h,msgId:g.ser_msgid,direction:"right",container:$(c.el),listContainer:f,imChatUserId:c.imChatUserId,imChatGroupId:c.imChatGroupId,addMethod:"append",chatType:c.chatType,needReposition:!1};c.imCommonChatView.updateChatMesBody(h);
"1"==a.msgType&&c.sendAtInfoReq(g,a.msg,q);h={type:"2"};d&&(h.type="7");h.groupId=c.imChatGroup.id;h.msgObj={ser_msgid:g.ser_msgid,msg:a.msg,msgtime:g.msgtime};g=$("#"+l.IM_ADDRLIST_EL);0<g.length&&g.trigger("updateLastMessage.ImAddrList",h)}});q.$scrollBar=a.$scrollBar;q.isHelper=d;a.isRetry?c.imCommonChatView.updateMsgBubble(q):c.imCommonChatView.sendChatMsgAndBack(q);return q},sendUploadFailMsg:function(a){a.dev=window.imClientDev;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.toCid=
window.imCurrentUser.cid;a.sname=this.getSenderName();var c=this.imWebReqMethods.initTempMsgId().toString();a.tempMsgId=c;a.groupId=this.imChatGroup.id;if("1002"==a.msgTypeConf){var c=a.aus,d=[],e=a.clitxt;if(c&&0<c.length){for(var f=0;f<c.length;f++){var g=c[f];-1<e.indexOf(":@"+g.id+";")&&d.push(g)}0==d.length&&(a.msgTypeConf="1001")}}c=this.imJsonUtils.buildJsonChatMsg(a);a.msg=c.msgObj;a.subtitle=c.subtitleObj;a.failMsg=!0;this.imCommonChatView.sendChatMsgAndBack(a)},turnPage:function(a,c){a.kind?
this.renderGroupChatHistoryByKind(a,c):this.renderGroupChatHistory(a,c)},sendAtInfoReq:function(a,c,d){var e=c.dt[0].txt;c=void 0;if(e.aus&&0<e.aus.length){c=[];for(var f=0;f<e.aus.length;f++){var g=e.aus[f];if("2"==g.t){c=[];break}else"1"==g.t&&c.push({uid:g.id,cid:window.imCurrentUser.cid})}}e={};e.uid=window.imCurrentUser.uid;e.cid=window.imCurrentUser.cid;e.type="0";e.serMsgId=a.ser_msgid;e.groupId=this.imChatGroup.id;c&&(0<c.length&&(e.users=c),this.imWebReqMethods.sendAtInfoReq(e,function(a){}));
d&&d.replyMsg&&(e.users=[d.replyMsg.fuser],e.remindFlag="2",this.imWebReqMethods.sendAtInfoReq(e,function(a){}))},imChatBoxNotify:function(a,c,d,e,f){var g=a.isHelper;f||(f=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"));var h="left";a.message.datas.from_uid==window.imCurrentUser.uid&&(c=!0,h="right");a.message.group_id==this.imChatGroup.id&&(a=a.message.datas,d={mesData:a,msgObj:a.msg,fromUid:a.from_uid,fromCid:a.from_cid,msgId:a.ser_msgid,direction:h,container:$(this.el),
listContainer:f,imChatUserId:this.imChatUserId,addMethod:"append",chatType:"groupChat",needReposition:!1,isUnread:!0,msgStatusUnread:!e,isCurrentChat:d,isHelper:g},this.createChatMesBody(d),c||this.setChatMsgRead({groupId:this.imChatGroup.id,isHelper:g}))},createChatMesBody:function(a,c){this.imCommonChatView.createChatMesBody(a,c)},syncGroupMemberListClone:function(a){var c=[];c.uid=window.imCurrentUser.uid;c.cid=window.imCurrentUser.cid;c.groupId=this.imChatGroup.id;c.type="0";c.syncType="0";c.memberMask=
l.MASK_GROUP_MEM_CID|l.MASK_GROUP_MEM_UID|l.MASK_GROUP_MEM_ROLE|l.MASK_GROUP_MEM_ADD_TIME;c.clientUc="0";this.imWebReqMethods.syncGroupMemberListReq(c,function(c){a&&a(c)})},syncGroupMemberList:function(a){var c=this,d=[];d.uid=window.imCurrentUser.uid;d.cid=window.imCurrentUser.cid;d.groupId=c.imChatGroup.id;d.type="0";d.syncType="1";d.memberMask=l.MASK_GROUP_MEM_CID|l.MASK_GROUP_MEM_UID|l.MASK_GROUP_MEM_ROLE|l.MASK_GROUP_MEM_ADD_TIME;var e="0",f=g.getImGroupMemberCache("groupMemberKeyArray-"+c.imChatGroup.id);
f?e=f.clientUc:f={};g.setImGroupMemberCache("groupMemberKeyArray-"+c.imChatGroup.id,f);d.clientUc=e;c.imWebReqMethods.syncGroupMemberListReq(d,function(e){var d=[];if("0"==e.message.ret.ret){var k=e.message.server_uc,f=e.message.datas;for(e=0;e<f.length;e++){var h=f[e];d.push({uid:h.uid,cid:h.cid})}g.getBatchImUserInfo(d,function(e){c.initGroupMemberCache(e,k,f,a)})}else a&&a()})},renderGroupMembers:function(a,c){var d=this;d.syncGroupMemberListClone(function(e){c.empty();var f=e.message.datas;if(f&&
0<f.length){var h={};e=[];f.forEach(function(a){h[a.uid]=a});d.canMask(h);if((f=g.getImGroupMemberCache("groupMemberKeyArray-"+d.imChatGroup.id))&&f.imGroupMemberCacheMap){var m={},n;for(n in f.imGroupMemberCacheMap){var r=f.imGroupMemberCacheMap[n];if(r){if(h&&h[r.id]){var x=h[r.id];r.role_type=x.role_type;r.add_time=x.add_time;"4"==x.role_type&&$("#"+l.IM_CHATWIN_EL).trigger("setHelperGroupNameDatas.ImChatWin",{imChatUser:x});r.order=l.groupMemberOrder.OFFLINE;switch(x.role_type){case "3":r.subOrder=
l.groupMemberOrder.MASTER;break;case "2":r.subOrder=l.groupMemberOrder.MANAGER;break;case "4":r.subOrder=l.groupMemberOrder.CLIENT;break;case "5":r.subOrder=l.groupMemberOrder.SERVER;break;default:r.subOrder=l.groupMemberOrder.DEFAULT}}m[r.uid]=r;e.push(r)}}var v=[];e.forEach(function(a){v.push({uid:a.uid,cid:a.cid})});d.renderUserStatus(v,m,function(e){e.forEach(function(e){var f=a.clone();d.renderGroupMembersOne(e,f,c)})})}}})},refreshImGroupMemberList:function(a,c){var d=this,e=g.getImGroupMemberCache("groupMemberKeyArray-"+
d.imChatGroup.id);if(e&&e.groupMemberKeyArray&&0<e.groupMemberKeyArray.length){for(var e=e.groupMemberKeyArray,f=[],h=0;h<e.length;h++){var l=g.getImChatUserCache("imChatUserNameKey-"+e[h]);f.push(l)}var m=[];f.forEach(function(a){m.push({uid:a.uid,cid:a.cid})});d.renderUserStatus(m,memberObjMap,function(e){e.forEach(function(e){var f=a.clone();d.renderGroupMembersOne(e,f,c)})});f.forEach(function(e){var f=a.clone();d.renderGroupMembersOne(e,f,c)})}},renderGroupMembersOne:function(b,c,d){c.attr("id",
b.uid);c.data("imChatUser",b);c.find(".j_name").text(b.name);c.find(".j_user-status-dev").removeClass("hide-im");b.avatar&&c.find(".j_avatar img").attr("src",crmContext.remoteDownloadUrl+"/noauth/"+b.avatar+"?type\x3dsmall");"10000"==b.uid&&(c.find(".j_avatar").attr("src","/static/img/global/avatar_assistant.png"),c.find(".j_name").text({zh_CN:"eteams\u5c0f\u52a9\u624b",zh_TW:"eteams\u5c0f\u52a9\u624b",en_US:"eteams Assistant"}[window.imCurrentUser.perLang]));var e,f,g=c.find(".j_im-group-member-role");
switch(b.role_type){case "3":g.removeClass("hide-im");f="\u7fa4\u4e3b";e=TEAMS.service.imWebapp+"/static/img/pc/chat/head-pic/group-master.png";break;case "2":g.removeClass("hide-im");f="\u7ba1\u7406\u5458";e=TEAMS.service.imWebapp+"/static/img/pc/chat/head-pic/group-manager.png";break;case "4":g.removeClass("hide-im");f="\u5ba2\u6237";e=TEAMS.service.imWebapp+"/static/img/pc/chat/head-pic/group-client.png";break;case "5":g.removeClass("hide-im"),f="\u5ba2\u6237\u7ecf\u7406",e=TEAMS.service.imWebapp+
"/static/img/pc/chat/head-pic/group-server.png"}c.find(".j_im-group-member-role img").attr("src",e);c.find(".j_im-group-member-role img").attr("title",f);e=c.find(".j_user-status-dev").removeClass("hide-im");a.renderUserStatus(b,e);1>d.find("#"+b.uid).length&&d.append(c)},modifyChatGroupName:function(a,c){var d=this;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.groupId=d.imChatGroup.id;a.type="0";a.mask||(a.mask="0");var e=a.groupName,f=a.groupAnnounce,g={};e&&(g.name=e);f&&(g.announce=
f);a.info=g;d.imWebReqMethods.modifyGroupInfoReq(a,function(a){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(d.imChatGroup.id);c&&c(a)})},changeChatGroupHost:function(a,c){var d=this;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.groupId=d.imChatGroup.id;a.type="0";a.mask||(a.mask="0");var e=a.groupHost,f={};e&&(f.host=e);a.info=f;d.imWebReqMethods.modifyGroupInfoReq(a,function(a){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(d.imChatGroup.id);c&&c(a)})},modifyChatGroupAvatar:function(a,
c){var d=this;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.groupId=d.imChatGroup.id;a.avatar=a.groupAvatar;d.imWebReqMethods.modifyGroupAvatarReq(a,function(a){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(d.imChatGroup.id);c&&c(a)})},setGroupAdminReq:function(a,c){a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.groupId=this.imChatGroup.id;this.imWebReqMethods.setGroupAdminReq(a,function(a){c&&c(a)})},inviteToGroup:function(a,c){var d=a.isHelper;a.users&&
(a.uid=window.imCurrentUser.uid,a.cid=window.imCurrentUser.cid,a.groupId=this.imChatGroup.id,a.type="0",d&&(a.type="1"),this.imWebReqMethods.inviteToGroupReq(a,function(a){c&&c(a)}))},exitGroupReq:function(a,c){var d={};d.uid=window.imCurrentUser.uid;d.cid=window.imCurrentUser.cid;d.groupId=this.imChatGroup.id;d.type="0";d.dev=window.imClientDev;var e="exitGroupReq";a.isHelper&&(e="exitHelperGroupReq",d.type="1");this.imWebReqMethods[e](d,function(a){"1211"==a.message.ret.ret?m.notify({zh_CN:"\u60a8\u662f\u5ba2\u6237\u7684\u552f\u4e00\u8d1f\u8d23\u4eba\uff0c\u8bf7\u79fb\u4ea4\u8d1f\u8d23\u4eba\u540e\u518d\u9000\u51fa\u7fa4\u7ec4",
zh_TW:"\u60a8\u662f\u5ba2\u6236\u7684\u552f\u4e00\u8ca0\u8cac\u4eba\uff0c\u8acb\u79fb\u4ea4\u8ca0\u8cac\u4eba\u5f8c\u518d\u9000\u51fa\u7fa4\u7d44",en_US:"You are the only server of this client\uff0c please changer the server to other one"}[TEAMS.perLang]):c&&c(a)})},setChatMsgRead:function(a,c){var d=a.isHelper;a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;var e="2";d&&(e="7");a.info={sessionType:e,groupId:a.groupId};a.dev=window.imClientDev;var f=e+"-"+a.groupId,h=g.getImChatNoReadCounts(f,
e);h||(h={type:e,count:0,group_id:a.groupId});d&&((d=g.getImChatNoReadCounts("3-serviceGroup"))?d.count=parseInt(d.count)-h.count:d={type:e,count:0,group_id:a.groupId},g.setImMsgNoReadCounts("3-serviceGroup",d,"3"),this.imWebReqMethods.triggerMsgReadStatusNoticeMethods(d));h.count="0";g.setImMsgNoReadCounts(f,h,e);this.imWebReqMethods.triggerMsgReadStatusNoticeMethods(h);this.imSessionCacheManager.setSessionRead(e,a.groupId);this.imWebReqMethods.setSessionReq(a,function(a){c&&c(a)})},markMsgBack:function(a,
c){var d=a.isHelper;a.groupId=this.imChatGroup.id;a.objId=this.imChatGroup.id;a.type="0";a.suid=window.imCurrentUser.uid;a.scid=window.imCurrentUser.cid;a.display=a.isAnonymous?"1":"0";var e="makeGroupMsgWithdrawReq";d&&(e="hgMsgRecallReq");return this.imWebReqMethods[e](a,c)},maskMsg:function(a,c){a.groupId=this.imChatGroup.id;a.type=a.isHelp?"1":"0";a.dev=window.imClientDev;a.time=(new Date).getTime();a.display=a.isAnonymous?"1":"0";return this.imWebReqMethods.maskGroupMsg(a,c)},isGroupMemberReq:function(a,
c){a={};var d=[];d.push(this.imChatGroup.id);a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type="0";a.groupIds=d;this.imWebReqMethods.isGroupMemberReq(a,c)},getGroupMsgReadStatusReq:function(a,c){if(a&&0<a.length){var d=this.imChatGroup.id,e=[],f=[];a.forEach(function(a){a.from_uid==window.imCurrentUser.uid&&a.from_cid==window.imCurrentUser.cid?e.push(a.ser_msgid):f.push(a.ser_msgid)});var g={};g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;g.groupId=d;e&&0<e.length&&
(g.msgIds=e);f&&0<f.length&&(g.recvMsgIds=f);this.imWebReqMethods.getGroupMsgReadStatusReq(g,function(a){a=a.message;a={datas:a.datas,recvMsgIds:a.recv_msgids,groupId:d};$("#"+l.IM_CHATWIN_EL).trigger("groupReadNotify",a)})}},setGroupMsgReadStatusReq:function(a,c){var d=a.isHelper,e={};e.uid=window.imCurrentUser.uid;e.cid=window.imCurrentUser.cid;e.groupId=a.groupId;e.msgIds=a.recvMsgIds;var f="setGroupMsgReadStatusReq";d&&(f="setHgMsgReadStatusReq");this.imWebReqMethods[f](e,function(a){c&&c(a)})},
renderUserStatus:function(a,c,d){var e=this;f.renderUserStatus({users:a},function(f){if(f&&0<f.length){var g=0;f.forEach(function(a){var b=c[a.user.uid];switch(a.status){case "1":b.order=l.groupMemberOrder.ONLINE;break;case "2":b.order=l.groupMemberOrder.LEAVE;break;case "8":b.order=l.groupMemberOrder.PUSH}b.status=a.status;b.dev=a.dev;"0"!=a.status&&"8"!=a.status&&g++})}f=[];for(var h in c)f.push(c[h]);f.sort(m.sortGroupMember);e.imChatGroup.userNum||(e.imChatGroup.userNum=a.length);h=g+"/"+e.imChatGroup.userNum;
$("#"+l.IM_CHATWIN_EL).find(".j_im-group-member-panel .j_group-member-online").text(h);d&&d(f)})},syncImChatGroupPageCache:function(a){this.imChatGroup=a;this.imCommonChatView.imChatGroup=a},getSenderName:function(){if(this.anonymousModel&&this.anonymousModel.state.isAnonymous){if(""===this.anonymousModel.state.name)throw Error("anonymous name is required");return this.anonymousModel.state.name}return window.imCurrentUser.name},canMask:function(a){var c=!1;(a=a[window.imCurrentUser.uid])&&(c="2"===
a.role_type||"3"===a.role_type);this.allowMask=c;$(this.el).data("allowMask",c)},remove:function(){}});p.exports=n});
define("im/chat/imGroupDetailView","im/component/imUtils im/component/imContants im/component/imChatComponent im/component/imAvatarUploader im/component/imUserSelector im/chat/imGroupChatView im/component/imCommonModel im/component/imUserSelectorPanel".split(" "),function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/component/imChatComponent"),g=n("im/component/imAvatarUploader"),f=n("im/component/imUserSelector"),a=n("im/chat/imGroupChatView"),d=n("im/component/imCommonModel"),
b=n("im/component/imUserSelectorPanel");n=Backbone.View.extend({initialize:function(b){this.imChatGroup=b.imChatGroup;this.imGroupChatView=new a(b);this.selfRoleType="1";this.el="#"+l.IM_GROUP_DETAIL_MODAL;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;this.imGroupCacheManager=window.imCacheData.imGroupCacheManager;this.tabType="detail";this.imChatMsgCBService=window.imEteamsJsService.ImChatMsgCBService;this.wheelPageUnlLocked=
!0;this.chatGroupAdmins=[];this.isHelper=b.isHelper;$(this.el).remove();$("body").append(m.template("imchat.imgroupdetail"))},delegateEvents:function(){var a=this,d=$(a.el);d.off("click.ImGroupDetail",".j_im-exit-group").on("click.ImGroupDetail",".j_im-exit-group",function(b){m.confirm("\u786e\u8ba4\u9000\u51fa\u7fa4\u7ec4?",function(b){b&&a.exitImChatGroup()})});d.off("blur.ImGroupDetail",".j_im-group-detail .j_im-chat-name-input").on("blur.ImGroupDetail",".j_im-group-detail .j_im-chat-name-input",
function(b){b=$(this);b.attr("readonly")||(b=$(this),a.modifyChatGroupName(b))});d.off("keydown.ImGroupDetail",".j_im-group-detail .j_im-chat-name-input").on("keydown.ImGroupDetail",".j_im-group-detail .j_im-chat-name-input",function(a){13==a.keyCode&&($(this).blur(),a.preventDefault())});d.off("blur.ImGroupDetail",".j_group-announce .j_group-announce-content").on("blur.ImGroupDetail",".j_group-announce .j_group-announce-content",function(b){b=$(this);a.modifyChatGroupAnnounce(b)});d.off("refreshImGroupMemberList.ImGroupDetail").on("refreshImGroupMemberList.ImGroupDetail",
function(b,d){"member"==a.tabType&&d.groupId==a.imChatGroup.id&&a.renderGroupMembers()});d.off("updateGroupRolesNotify.ImGroupDetail").on("updateGroupRolesNotify.ImGroupDetail",function(b,d){"detail"==a.tabType&&d.groupId==a.imChatGroup.id&&a.updateGroupRoles()});d.off("updateImGroupDetailNotify.ImGroupDetail").on("updateImGroupDetailNotify.ImGroupDetail",function(b,d){b.stopPropagation();a.updateImGroupDetailNotify(d)});d.off("updateImGroupHostNotify.ImGroupDetail").on("updateImGroupHostNotify.ImGroupDetail",
function(b,d){b.stopPropagation();d.group_id==a.imChatGroup.id&&a.updateImGroupHostNotify(d)});d.off("click.ImGroupDetail",".j_im-group-member-avatar-trigger").on("click.ImGroupDetail",".j_im-group-member-avatar-trigger",function(b){b.stopPropagation();b=$(this);var d=b.data("imChatUser");d.id||(d.id=d.uid);a.imChatMsgCBService.clickSenderAvatar(d,b)});d.off("click.ImGroupDetail",".j_im-upload-group-avatar").on("click.ImGroupDetail",".j_im-upload-group-avatar",function(b){b.stopPropagation();$(this);
$(a.el).find(".j_main-content").addClass("hide");$(a.el).removeClass("im-groupsetting-modal");a.imAvatarUploader=new g({imChatGroup:a.imChatGroup});a.imAvatarUploader.render()});d.off("click.ImGroupDetail",".j_im-change-groupmaster").on("click.ImGroupDetail",".j_im-change-groupmaster",function(b){b.stopPropagation();$(this);$(a.el).find(".j_main-content").addClass("hide");$(a.el).removeClass("im-groupsetting-modal");a.imUserSelector=new f({imChatGroup:a.imChatGroup,selectType:1,limitUserCount:1,confirmFunc:function(b){b&&
0<b.length?(m.notify("\u7fa4\u4e3b\u8f6c\u8ba9\u6210\u529f"),a.changeChatGroupHost({uid:b[0].uid,cid:b[0].cid})):m.notify("\u8bf7\u9009\u62e9\u4eba\u5458")}});a.imUserSelector.render()});d.off("click.ImGroupDetail",".j_im-set-group-manager").on("click.ImGroupDetail",".j_im-set-group-manager",function(b){b.stopPropagation();$(a.el).find(".j_main-content").addClass("hide");$(a.el).removeClass("im-groupsetting-modal");b=[];b=b.concat(a.chatGroupAdmins);a.imUserSelector=new f({imChatGroup:a.imChatGroup,
selectType:0,limitUserCount:5,selectedUserArray:b,confirmFunc:function(b){a.setGroupAdminReq(b)}});a.imUserSelector.render()});d.off("click.ImGroupDetail",".j_im-msg-noremind .j_switch").on("click.ImGroupDetail",".j_im-msg-noremind .j_switch",function(b){b.stopPropagation();b=$(this);var d=0;switch(b.attr("flag").toString()){case "0":d="1";b.attr("flag",d);b.addClass("open");break;case "1":d="0",b.attr("flag",d),b.removeClass("open")}b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;
b.remind={sessionType:"2",groupId:a.imChatGroup.id,reminder:d};a.imWebReqMethods.setMsgRemindReq(b,function(b){b={};var e=window.imCacheData.imSessionCacheManager.getSessionCache("2-"+a.imChatGroup.id);e||(e={session_type:"2",group_id:a.imChatGroup.id},a.isHelper&&(e.session_type="7"));b.sessionData=e;b.remindFlag=d;$("#"+l.IM_ADDRLIST_EL).trigger("setMsgNoReminderNotify.ImAddrList",b)})});d.off("click.ImGroupDetail",".j_im-msg-readstatus .j_switch").on("click.ImGroupDetail",".j_im-msg-readstatus .j_switch",
function(b){b.stopPropagation();b=$(this);var d=0;switch(b.attr("flag").toString()){case "0":d="1";b.attr("flag",d);b.addClass("open");break;case "1":d="0",b.attr("flag",d),b.removeClass("open")}b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;b.groupId=a.imChatGroup.id;b.rsOnOff=d;a.imChatGroup.rsOnOff=d;a.imWebReqMethods.setGroupRSOnOffReq(b,function(b){b={groupId:a.imChatGroup.id,flag:d};$("#"+l.IM_CHATWIN_EL).trigger("setMsgReadStatusNotify.ImChatWin",b)})});d.off("click.ImGroupDetail",
".j_im-group-detail-tab").on("click.ImGroupDetail",".j_im-group-detail-tab",function(b){b.stopPropagation();b=$(this);$(a.el+" .j_im-group-detail-tab-field .j_im-group-detail-tab").removeClass("active");b.addClass("active");a.renderByTab(b.attr("type"));b=$("#usercard");0<b.length&&b.trigger("closeUsercard")});d.off("closeImMsgReadStatusPanel.ImGroupDetail").on("closeImMsgReadStatusPanel.ImGroupDetail",function(b){a.close()});d.off("updateGroupAvatar.ImGroupDetail").on("updateGroupAvatar.ImGroupDetail",
function(b,d){a.modifyChatGroupAvatar(d)});d.off("updateGroupAvatarNotify.ImGroupDetail").on("updateGroupAvatarNotify.ImGroupDetail",function(b,d){d.groupId==a.imChatGroup.id&&(a.imChatGroup.avatar=d.groupAvatar,a.renderChatGroupAvatar())});d.off("setGroupAdminNotify.ImGroupDetail").on("setGroupAdminNotify.ImGroupDetail",function(b,d){a.setGroupAdminNotify(d)});d.off("click.ImGroupDetail",".j_im-group-kickout").on("click.ImGroupDetail",".j_im-group-kickout",function(b,d){b.stopPropagation();var k=
$(this).parents(".j_im-group-member"),f=k.data("imChatUser");a.kickGroupMemberReq(f);k.detach();m.notify("\u79fb\u9664\u6210\u529f")});d.off("kickGroupAdmin.ImGroupDetail").on("kickGroupAdmin.ImGroupDetail",function(b,d){b.stopPropagation();var k=d.kickee;if(d.groupId==a.imChatGroup.id){for(var f=[],g=!1,h=0;h<a.chatGroupAdmins.length;h++){var l=!1,m=a.chatGroupAdmins[h];k.forEach(function(a){a.uid==m.uid&&(l=g=!0)});l||f.push(m)}g&&(a.chatGroupAdmins=f,a.renderChatGroupAdmins())}});$("body").off("click.ImGroupDetail").on("click.ImGroupDetail",
function(b){b.stopPropagation();b=$(b.target);b.hasClass("j_closeImGroupDetailPanel")||0<b.parents(".j_closeImGroupDetailPanel").length||"im-frame-container"==b.attr("id")||0<b.parents("#im-frame-container").length||b.hasClass("j_im-chat-imgroupdetail-modal-content")||0<b.parents(".j_im-chat-imgroupdetail-modal-content").length||b.hasClass("j_im-chat-imgroupdetail-modal-show")||0<b.parents(".j_im-chat-imgroupdetail-modal-show").length||"selector-employee"==b.attr("id")||0<b.parents("#selector-employee").length||
0<$("#usercard").length||b.hasClass("btn")&&1==b.attr("data-handler")||a.close()});d.off("confirmHandler.ImGroupDetail",".j_im-group-add-member").on("confirmHandler.ImGroupDetail",".j_im-group-add-member",function(b,d){b.stopPropagation();var k=$(this),f=d.objs;if(!(1>f.length)){var g=[];f&&f.length&&f.forEach(function(b){var e=!1;a.groupExistIdArray&&0<a.groupExistIdArray.length&&a.groupExistIdArray.forEach(function(a){a==b.id&&(e=!0)});e||g.push(b)});g&&0<g.length&&a.inviteToGroup(k,g);a.groupExistIdArray=
[]}});d.off("click.ImGroupDetail",".j_im-group-add-member").on("click.ImGroupDetail",".j_im-group-add-member",function(e,d){e.stopPropagation();var k=$(this);a.groupExistIdArray=[];var f=[],g=h.getImGroupMemberCache("groupMemberKeyArray-"+a.imChatGroup.id),l;for(l in g.imGroupMemberCacheMap){var m=g.imGroupMemberCacheMap[l];m&&f.push({uid:m.uid,cid:m.cid})}a.imUserSelectorPanel=new b({selectType:0,limitUserCount:200,componentType:1,existUsers:f,confirmFunc:function(b){if(b&&0<b.length){var e=[];b.forEach(function(a){a&&
"singleChat"==a.chatType&&e.push(a.imChatUser)});e&&0<e.length&&a.inviteToGroup(k,e)}}});a.imUserSelectorPanel.render()});d.off("returnGroupDetail.ImGroupDetail").on("returnGroupDetail.ImGroupDetail",function(b){a.returnGroupDetail()});d.off("shown.bs.modal.ImGroupDetail").on("shown.bs.modal.ImGroupDetail",function(a){d.find(".j_group-announce-content").trigger("autosize.resize")});$(a.el).off("click.ImGroupDetail",".j_more_show").on("click ",".j_more_show",function(b){b.stopPropagation();b=$(this);
var d=b.parents(".j_im-note-box");b.addClass("hide").siblings(".j_more_hide").removeClass("hide");b.parents(".j_invite-member-list").find(".j_group-new-member").show();b=h.getImChatGroupCache(a.imChatGroup.id);b={uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,groupId:b.id,id:d.attr("id")};a.imWebReqMethods.getGroupOperRelReq(b,function(b){b=b.message.users;var e=d.find(".j_invite-member-list");e.empty();for(var k=0;k<b.length;k++){var f=b[k],g=$(a.el).find("#im-chat-imgroupdetail-modal-clone-field #im-group-new-member-clone").clone().attr("id",
f.uid+"-"+f.cid);h.getImUserInfo({uid:f.uid,cid:f.cid},function(a){g.find(".j_name").text(a.name);a.avatar&&(a="/base/download/"+a.avatar,g.find(".j_avatar").attr("src",a));e.append(g)})}e.append('\x3cspan class\x3d"j_more_btn more-btn"\x3e\x3cspan class\x3d"j_more_show hide"\x3e\x3ca\x3e\u663e\u793a\u66f4\u591a...\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d"j_more_hide"\x3e\x3ca\x3e\u6536\u8d77\x3c/a\x3e\x3c/span\x3e\x3c/span\x3e')})});$(a.el).off("click.ImGroupDetail",".j_more_hide").on("click ",".j_more_hide",
function(a){a.stopPropagation();a=$(this);a.addClass("hide").siblings(".j_more_show").removeClass("hide");a.parents(".j_invite-member-list").find(".j_group-new-member:lt(5)").show();a.parents(".j_invite-member-list").find(".j_group-new-member:gt(4)").hide()});$(a.el).off("keyup.ImGroupDetail",".j_group-announce-content").on("keyup.ImGroupDetail",".j_group-announce-content",function(b){a.countWordNum($(this))})},render:function(){var a=this,b=$(a.el);a.isHelper&&b.find(".j_im-group-detail-tab[type\x3dmember]").addClass("hide-im");
b.modal({keyboard:!1,backdrop:"static"});a.renderGroupDetail();m.layout(".j_chat-imgroupdetailScr",{whileScrolling:function(){a.mcsTopPct=this.mcs.topPct;100!=a.mcsTopPct&&97<a.mcsTopPct&&a.wheelPageUnlLocked&&a.turnPage(function(){a.wheelPageUnlLocked=!0})}},[{scrollInertia:500,mouseWheel:{scrollAmount:350},otoTopButton:!1}])},turnPage:function(a){var b=this;switch(b.tabType){case "groupNote":b.wheelPageUnlLocked=!1;var e=h.getImChatGroupCache(b.imChatGroup.id);b.imWebReqMethods.getGroupOperNoteReq({uid:window.imCurrentUser.uid,
cid:window.imCurrentUser.cid,groupId:e.id,id:b.lastNoteId},function(e){e={noteDatas:e.message.datas,$listContainer:$(b.el).find(".j_im-group-note-container .j_im-groupnote-list")};b.renderGroupNoteList(e);a&&a()})}},renderByTab:function(a){this.tabType=a;$(this.el+" .j_modal-body .j_im-group-detail-list").addClass("hide");switch(a){case "detail":$(this.el+" .j_modal-body .j_im-group-detail-container").removeClass("hide");this.renderGroupDetail();break;case "member":$(this.el+" .j_modal-body .j_im-group-member-container").removeClass("hide");
this.renderGroupMembers();break;case "groupNote":$(this.el+" .j_modal-body .j_im-group-note-container").removeClass("hide"),this.renderGroupNote()}},renderGroupDetail:function(){var a=this,b=$(a.el);a.imGroupCacheManager.getGroupInfoUcReq(a.imChatGroup.id,function(e){if(e){a.imChatGroup=e;a.chatGroupAdmins=[];var d=b.find(".j_im-group-detail-container");d.find(".j_im-chat-name-input").val(e.name);d.find(".j_im-chat-name-input").attr("title",e.name);a.renderGroupAvatar();b.find(".j_group-announce textarea").attr("groupAnnounce",
e.announce);b.find(".j_group-announce textarea").trigger("autosize.destroy");b.find(".j_group-announce textarea").val(e.announce);b.find(".j_group-announce textarea").autosize();a.countWordNum(b.find(".j_group-announce textarea"));a.updateGroupRoles();var f="2-"+e.id;a.isHelper&&(f="7-"+e.id);(e=a.imSessionCacheManager.getMsgRemindCacheData(f))&&"1"==e.reminder&&(d.find(".j_group-switch-filed .j_im-msg-noremind .j_switch").addClass("open"),d.find(".j_group-switch-filed .j_im-msg-noremind .j_switch").attr("flag",
1));"1"==a.imChatGroup.rsOnOff&&(d.find(".j_group-switch-filed .j_im-msg-readstatus .j_switch").addClass("open"),d.find(".j_group-switch-filed .j_im-msg-readstatus .j_switch").attr("flag",1));a.renderOptionButton()}})},renderGroupNote:function(){var a=this;$(a.el);var b=h.getImChatGroupCache(a.imChatGroup.id);a.imWebReqMethods.getGroupOperNoteReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,groupId:b.id},function(b){var d=$(a.el).find(".j_im-group-note-container .j_im-groupnote-list");
d.empty();a.renderGroupNoteList({noteDatas:b.message.datas,$listContainer:d})})},renderGroupNoteList:function(a){var b=this,e=a.noteDatas,d=a.$listContainer;e&&0<e.length&&($(b.el).find(".j_no-result").addClass("hide-im"),b.lastNoteId=e[e.length-1].id,10>e.length&&(b.wheelPageUnlLocked=!1),e.forEach(function(a){var c=$(b.el).find("#im-chat-imgroupdetail-modal-clone-field #im-groupnote-clone").clone().attr("id",a.id);h.getImUserInfo({uid:a.user.uid,cid:a.user.cid},function(a){c.find(".j_optuser-name").text(a.name);
c.find(".j_avatar").data("imChatUser",a);c.find(".j_optuser-name").data("imChatUser",a);a.avatar&&(a="/base/download/"+a.avatar,c.find(".j_avatar img").attr("src",a))});var e=Date.create(1E3*a.time);c.find(".j_box-date").text(e.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"));a=a.content;var f,e=b.noteI18keys[a.t];switch(parseInt(a.ct)){case 0:f=e[TEAMS.perLang];break;case 1:if(a=a.cks)for(var g in a)f=e[TEAMS.perLang].replace(new RegExp(g,"gm"),a[g]);break;case 2:if(f=e[TEAMS.perLang],c.find(".j_box-content").removeClass("hide"),
a.users&&a.users.length){a.users=m.sortBy(a.users,"uid","asc");e=c.find(".j_invite-member-list");for(g=0;g<a.users.length;g++){var l=a.users[g],n=$(b.el).find("#im-chat-imgroupdetail-modal-clone-field #im-group-new-member-clone").clone().attr("id",l.uid+"-"+l.cid);e.append(n);h.getImUserInfo({uid:l.uid,cid:l.cid},function(a){n.find(".j_name").text(a.name);n.data("imChatUser",a);a.avatar&&(a="/base/download/"+a.avatar,n.find(".j_avatar").attr("src",a))})}5<a.userNum&&e.append('\x3cspan class\x3d"j_more_btn more-btn"\x3e\x3cspan class\x3d"j_more_show"\x3e\x3ca\x3e\u663e\u793a\u66f4\u591a...\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d"j_more_hide hide"\x3e\x3ca\x3e\u6536\u8d77\x3c/a\x3e\x3c/span\x3e\x3c/span\x3e')}}c.find(".j_title .j_event").text(f);
d.append(c)}))},renderMsgDetailOne:function(a,b,e){var d=$(this.el),f=b.find(".j_msg-readed-list"),g=e.find(".j_msg-unread-list"),l=d.find("#im-chat-msgreadstatus-modal-clone-field #im-group-manager-clone").clone().attr("id",a.user.uid);h.getImUserInfo({uid:a.user.uid,cid:a.user.cid},function(d){l.find(".j_name").text(d.name);var h="/static/images/avatar.png";d.avatar&&(h="/base/download/"+d.avatar);l.find(".j_avatar").attr("src",h);l.data("imChatUser",d);switch(a.status){case "0":e.removeClass("hide");
g.append(l);break;case "1":a.time&&(d=Date.create(1E3*a.time),d=d.format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"),l.attr("title","\u9605\u8bfb\u65f6\u95f4\uff1a"+d)),b.removeClass("hide"),f.prepend(l)}})},renderGroupMembers:function(){var a=$(this.el),b=a.find(".j_group-member-list");b.empty();var e=h.getImGroupMemberCache("groupMemberKeyArray-"+this.imChatGroup.id),d=[];if(e&&e.imGroupMemberCacheMap)for(var f in e.imGroupMemberCacheMap){var g=e.imGroupMemberCacheMap[f];g&&g&&d.push(g)}if(d&&0<d.length)for(d=
m.sortBy(d,"add_time","asc","uid"),e=0;e<d.length;e++)g=d[e],f=a.find("#im-chat-imgroupdetail-modal-clone-field #im-group-member-clone").clone().attr("id",g.id),this.renderGroupMembersOne(f,g,b)},updateImGroupDetailNotify:function(a){var b=this,e=$(b.el),d=a.newImChatGroup;if(b.imChatGroup.id==d.id){a=a.mask;var f=e.find(".j_im-group-detail");switch(a){case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_NAME:f.find(".j_im-chat-name-input").val(d.name);f.find(".j_im-chat-name-input").attr("data-original-title",
d.name);break;case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_ANNOUNCE:f.find(".j_group-announce-content").trigger("autosize.destroy");f.find(".j_group-announce-content").val(d.announce);f.find(".j_group-announce-content").attr("groupAnnounce",d.announce);f.find(".j_group-announce-content").autosize();b.countWordNum(e.find(".j_group-announce textarea"));break;case l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_HOST:d.hostUid==window.imCurrentUser.uid&&d.hostCid==window.imCurrentUser.cid?(b.selfRoleType="3",
b.renderOptionButton()):"3"==b.selfRoleType&&(b.selfRoleType="1",b.renderOptionButton()),h.getImUserInfo({uid:d.hostUid,cid:d.hostCid},function(a){b.renderChatGroupHost(a)})}}},modifyChatGroupName:function(a){var b=this,e=$.trim(a.val()),d=$.trim(a.attr("groupName"));e&&0!=e.length?60<e.length?m.notify({zh_CN:"\u7fa4\u540d\u79f0\u6700\u957f60\u4e2a\u5b57",zh_TW:"\u7fa4\u540d\u7a31\u6700\u957760\u500b\u5b57",en_US:"The max length is 60"}[TEAMS.perLang]):m.testSpecialMark(e)?m.notify("\u7fa4\u540d\u79f0\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26"):
e!=d&&(d={},d.groupName=e,d.mask=l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_NAME,a.attr("data-original-title",e),b.imGroupChatView.modifyChatGroupName(d,function(a){"0"==a.message.ret.ret&&(m.notify("\u7fa4\u7ec4\u540d\u79f0\u4fee\u6539\u6210\u529f"),b.imChatGroup.name=e,a={newImChatGroup:b.imChatGroup,mask:l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_NAME},$("#"+l.IM_ADDRLIST_EL).trigger("updateImGroupDetailNotify.ImAddrList",a),$("#"+l.IM_CHATWIN_EL).trigger("updateImGroupDetailNotify.ImChatWin",a))})):
m.notify("\u8bf7\u8f93\u5165\u7fa4\u540d\u79f0")},modifyChatGroupAvatar:function(a){var b=this,e={};b.imChatGroup.avatar=a.groupAvatar;e.groupAvatar=a.groupAvatar;b.imGroupChatView.modifyChatGroupAvatar(e,function(a){"0"==a.message.ret.ret&&(m.notify("\u7fa4\u7ec4\u5934\u50cf\u4fee\u6539\u6210\u529f"),b.renderChatGroupAvatar())})},renderChatGroupAvatar:function(){this.renderGroupAvatar();var a={newImChatGroup:this.imChatGroup,mask:l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_AVATAR};$("#"+l.IM_ADDRLIST_EL).trigger("updateImGroupDetailNotify.ImAddrList",
a);$("#"+l.IM_CHATWIN_EL).trigger("updateImGroupDetailNotify.ImChatWin",a)},modifyChatGroupAnnounce:function(a){var b=this,e=$.trim(a.val());a=$.trim(a.attr("groupAnnounce"));200<e.length?m.notify({zh_CN:"\u7fa4\u516c\u544a\u6700\u957f200\u4e2a\u5b57",zh_TW:"\u7fa4\u516c\u544a\u6700\u9577200\u500b\u5b57",en_US:"The max length is 200"}[TEAMS.perLang]):m.testSpecialMark(e)?m.notify("\u7fa4\u516c\u544a\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5b57\u7b26"):e!=a&&(a={},a.groupAnnounce=e,a.mask=l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_ANNOUNCE,
b.imGroupChatView.modifyChatGroupName(a,function(a){"0"==a.message.ret.ret&&(m.notify("\u7fa4\u7ec4\u516c\u544a\u4fee\u6539\u6210\u529f"),b.imChatGroup.announce=e)}))},inviteToGroup:function(a,b){var e=this;$(e.el);if(b&&0<b.length){var d={},f=1;b.forEach(function(a){d["inviteUserArray-"+f]||(d["inviteUserArray-"+f]=[]);a&&d["inviteUserArray-"+f].push({uid:a.id,cid:window.imCurrentUser.cid,name:a.name});10==d["inviteUserArray-"+f].length&&f++});for(var g=1;g<=f;g++){var h=d["inviteUserArray-"+g];
h&&0<h.length&&e.imGroupChatView.inviteToGroup({users:h},function(a){window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:e.imChatGroup.id,forceUpdate:!1},function(){window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(e.imChatGroup.id,function(a){e.imChatGroup=a;e.renderGroupMembers();$("#"+l.IM_CHATWIN_EL).trigger("syncImChatGroupPageCache.ImChatWin",{imChatGroup:a})})})})}m.notify("\u9080\u8bf7\u6210\u529f")}},renderGroupMembersOne:function(a,b,e){a=$(this.el).find("#im-chat-imgroupdetail-modal-clone-field #im-group-member-clone").clone().attr("id",
b.id);a.data("imChatUser",b);a.find(".j_name").data("imChatUser",b);a.find(".j_avatar").data("imChatUser",b);a.attr("role-type",b.role_type);if(b.avatar){var d="/base/download/"+b.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID;a.find(".j_avatar").attr("src",d)}a.find(".j_name").text(b.name);switch(b.role_type){case "1":a.find(".j_leader-mark").addClass("hide");a.find(".j_leader-mark").addClass("hide");break;case "2":a.find(".j_leader-mark").addClass("admin");a.find(".j_leader-mark").text("\u7ba1\u7406\u5458");
break;case "3":a.find(".j_leader-mark").text("\u7fa4\u4e3b")}a.find(".j_im-group-kickout").addClass("hide-im");if(b.id!=window.imCurrentUser.uid)switch(this.selfRoleType){case "2":"1"==b.role_type&&a.find(".j_im-group-kickout").removeClass("hide-im");break;case "3":a.find(".j_im-group-kickout").removeClass("hide-im")}switch(b.role_type){case "1":e.append(a);break;case "2":(b=e.find('.j_im-group-member[role-type\x3d"2"]'))&&0<b.length?b.last().after(a):(b=e.find('.j_im-group-member[role-type\x3d"3"]'))&&
0<b.length?b.after(a):e.prepend(a);break;case "3":e.prepend(a)}},close:function(){$(this.el).modal("hide")},noteI18keys:{"im.g.cr":{zh_CN:"\u521b\u5efa\u7fa4\u7ec4",zh_TW:"\u5275\u5efa\u7fa4\u7d44",en_US:"Create group"},"im.inv":{zh_CN:"\u9080\u8bf7\u4e86\u65b0\u6210\u5458",zh_TW:"\u9080\u8acb\u4e86\u65b0\u6210\u54e1",en_US:"Invited new member"},"im.g.exit":{zh_CN:"\u9000\u51fa\u7fa4\u7ec4",zh_TW:"\u9000\u51fa\u7fa4\u7d44",en_US:"Leave group"},"im.g.fexit":{zh_CN:"\u8e22\u51fa\u7fa4\u7ec4\u6210\u5458",
zh_TW:"\u8e22\u51fa\u7fa4\u7d44\u6210\u54e1",en_US:"Kick out group member"},"im.g.up.n":{zh_CN:"\u4fee\u6539\u7fa4\u7ec4\u540d\u79f0",zh_TW:"\u4fee\u6539\u7fa4\u7d44\u540d\u7a31",en_US:"Modify group name"},"im.g.up.bull":{zh_CN:"\u4fee\u6539\u4e86\u7fa4\u516c\u544a",zh_TW:"\u4fee\u6539\u4e86\u7fa4\u516c\u544a",en_US:"Modified group notice"},"im.g.up.head":{zh_CN:"\u4e0a\u4f20\u4e86\u7fa4\u7ec4\u5934\u50cf",zh_TW:"\u4e0a\u50b3\u4e86\u7fa4\u7d44\u982d\u50cf",en_US:"Uploaded group alias"},"im.g.set.a":{zh_CN:"\u8bbe\u7f6e\u7fa4\u6210\u5458\u4e3a\u7ba1\u7406\u5458",
zh_TW:"\u8a2d\u7f6e\u7fa4\u6210\u54e1\u70ba\u7ba1\u7406\u54e1",en_US:"Set group member as administrator"},"im.g.re.a":{zh_CN:"\u53d6\u6d88\u7ba1\u7406\u5458",zh_TW:"\u53d6\u6d88\u7ba1\u7406\u54e1",en_US:"Cancel administrator"},"im.g.set.owner":{zh_CN:"\u7fa4\u4e3b\u79fb\u4ea4",zh_TW:"\u7fa4\u4e3b\u79fb\u4ea4",en_US:"Transfer ownership"},"im.g.up.n.c":{zh_CN:"\u4fee\u6539\u7fa4\u7ec4\u540d\u79f0\u4e3a",zh_TW:"\u4fee\u6539\u7fa4\u7d44\u540d\u7a31\u70ba",en_US:"%g_n% Modified group name as %g_n%"}},
kickGroupMemberReq:function(a){var b=this;$(b.el);var e=[];e.push({uid:a.id,cid:window.imCurrentUser.cid});b.imGroupCacheManager.kickGroupMemberReq({groupId:b.imChatGroup.id,users:e},function(a){window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:b.imChatGroup.id,forceUpdate:!1});window.imCacheData.imGroupCacheManager.getGroupInfoUcReq(b.imChatGroup.id,function(a){b.imChatGroup=a;var c={group_id:b.imChatGroup.id,newImChatGroup:a,modType:"0"};$("#"+l.IM_CHATWIN_EL).trigger("modifyImGroupNotify.ImChatWin",
c);$("#"+l.IM_CHATWIN_EL).trigger("syncImChatGroupPageCache.ImChatWin",{imChatGroup:a})})})},changeChatGroupHost:function(a){var b=this,e={};e.groupHost=a;e.mask=l.kMaskModifyGroupInfo.MASK_MODIFY_GROUP_HOST;b.imGroupChatView.changeChatGroupHost(e,function(a){window.imCacheData.imGroupCacheManager.syncGroupMemberList({groupId:b.imChatGroup.id,forceUpdate:!1},function(){b.selfRoleType="1";b.updateGroupRoles();b.renderOptionButton();b.returnGroupDetail()})})},setGroupAdminReq:function(a){var b=this,
e=[],d=[];a&&0<a.length?(a.forEach(function(a){for(var c=!1,e=0;e<b.chatGroupAdmins.length;e++){var f=b.chatGroupAdmins[e];a.uid==f.uid&&a.cid==f.cid&&(c=!0)}c||d.push({uid:a.uid,cid:a.cid})}),b.chatGroupAdmins.forEach(function(b){for(var d=!1,f=0;f<a.length;f++){var k=a[f];b.uid==k.uid&&b.cid==k.cid&&(d=!0)}d||e.push({uid:b.uid,cid:b.cid})})):b.chatGroupAdmins.forEach(function(a){e.push({uid:a.uid,cid:a.cid})});b.chatGroupAdmins=a;b.renderChatGroupAdmins();if(d&&0<d.length){var f={users:d,flag:"0"};
b.imGroupChatView.setGroupAdminReq(f,function(a){a=f.users;var c=h.getImGroupMemberCache("groupMemberKeyArray-"+b.imChatGroup.id);a.forEach(function(a){for(var b=0;b<c.groupMemberKeyArray.length;b++){var e=c.groupMemberKeyArray[b];if(-1<e.indexOf(a.uid)){h.getImChatUserCache("imChatUserNameKey-"+e).role_type="2";break}}})})}if(e&&0<e.length){var g={users:e,flag:"1"};b.imGroupChatView.setGroupAdminReq(g,function(a){a=g.users;var c=h.getImGroupMemberCache("groupMemberKeyArray-"+b.imChatGroup.id);a.forEach(function(a){for(var b=
0;b<c.groupMemberKeyArray.length;b++){var e=c.groupMemberKeyArray[b];if(-1<e.indexOf(a.uid)){h.getImChatUserCache("imChatUserNameKey-"+e).role_type="1";break}}})})}(0<e.length||0<d.length)&&m.notify("\u8bbe\u7f6e\u7fa4\u7ec4\u7ba1\u7406\u5458\u6210\u529f");$("#"+l.IM_CHATWIN_EL).trigger("refreshImGroupMemberList.ImChatWin",{group_id:b.imChatGroup.id});b.returnGroupDetail()},setGroupAdminNotify:function(a){var b=this,e=a.adminUsers,d=[];switch(a.flag){case "0":e.forEach(function(a){h.getImUserInfo({uid:a.uid,
cid:a.cid},function(a){var c=!1;b.chatGroupAdmins.forEach(function(b){b.uid==a.uid&&(c=!0)});c||(a.uid==window.imCurrentUser.uid&&(b.selfRoleType="2",b.renderChatGroupAdmins()),b.chatGroupAdmins.push(a))})});break;case "1":for(a=0;a<b.chatGroupAdmins.length;a++){var f=!1,g=b.chatGroupAdmins[a];e.forEach(function(a){a.uid==window.imCurrentUser.uid&&(b.selfRoleType="1",b.renderChatGroupAdmins());a.uid==g.uid&&(f=!0)});f||d.push(g)}b.chatGroupAdmins=d}b.renderChatGroupAdmins();b.renderOptionButton()},
renderChatGroupAdmins:function(){var a=$(this.el),b=a.find(".j_im-group-detail-container .j_group-manager .j_group-manager-list");b.find(".j_im-chatgroup-member").remove();this.chatGroupAdmins&&0<this.chatGroupAdmins.length&&this.chatGroupAdmins.forEach(function(e){var d=a.find("#im-chat-imgroupdetail-modal-clone-field #im-group-manager-clone").clone().attr("id",e.uid);d.find("span").text(e.name);d.data("imChatUser",e);e.avatar&&(e="/base/download/"+e.avatar,d.find(".j_avatar").attr("src",e));b.prepend(d)})},
renderChatGroupHost:function(a){var b=$(this.el).find(".j_im-group-detail-container .j_group-master-member");b.find("span").text(a.name);b.data("imChatUser",a);a.avatar&&(a="/base/download/"+a.avatar,b.find(".j_avatar").attr("src",a))},returnGroupDetail:function(){var a=$(this.el);a.addClass("im-groupsetting-modal");a.removeClass("im-avataruploader-modal");a.removeClass("im-groupadd-modal");a.find(".j_main-content").removeClass("hide");a.find(".j_other-content").addClass("hide");a.find(".j_other-content").empty()},
renderOptionButton:function(){var a=$(this.el);switch(this.selfRoleType){case "1":a.find(".j_im-change-groupmaster").addClass("hide-im");a.find(".j_im-set-group-manager").addClass("hide-im");a.find(".j_im-upload-group-avatar").addClass("hide-im");a.find(".j_im-group-kickout").addClass("hide-im");a.find(".j_im-chat-name-input").attr("readonly","readonly");a.find(".j_group-announce-content").attr("disabled","disabled");a.find(".j_im-msg-readstatus").parents(".j_group-switch-filed").addClass("hide-im");
break;case "2":a.find(".j_im-change-groupmaster").addClass("hide-im");a.find(".j_im-upload-group-avatar").removeClass("hide-im");a.find(".j_im-set-group-manager").addClass("hide-im");a.find(".j_im-group-kickout").removeClass("hide-im");a.find(".j_im-chat-name-input").removeAttr("readonly");a.find(".j_group-announce-content").removeAttr("disabled");a.find(".j_im-msg-readstatus").parents(".j_group-switch-filed").removeClass("hide-im");break;case "3":a.find(".j_im-change-groupmaster").removeClass("hide-im"),
a.find(".j_im-upload-group-avatar").removeClass("hide-im"),a.find(".j_im-set-group-manager").removeClass("hide-im"),a.find(".j_im-group-kickout").removeClass("hide-im"),a.find(".j_im-chat-name-input").removeAttr("readonly"),a.find(".j_group-announce-content").removeAttr("disabled"),a.find(".j_im-msg-readstatus").parents(".j_group-switch-filed").removeClass("hide-im")}},renderGroupAvatar:function(){var a=$(this.el).find(".j_im-group-detail-container");if(this.imChatGroup.avatar){var b="/base/download/"+
this.imChatGroup.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID;a.find(".j_group-avatar img").attr("src",b)}else a.find(".j_group-avatar img").attr("src",TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png")},updateImGroupHostNotify:function(a){this.updateGroupRoles();this.renderOptionButton()},updateGroupRoles:function(){this.chatGroupAdmins=[];var a=h.getImGroupMemberCache("groupMemberKeyArray-"+this.imChatGroup.id);if(a&&a.imGroupMemberCacheMap){for(var b in a.imGroupMemberCacheMap){var e=
a.imGroupMemberCacheMap[b];if(e)switch(e.role_type){case "2":window.imCurrentUser.uid==e.uid&&window.imCurrentUser.cid==e.cid&&(this.selfRoleType="2",this.renderOptionButton());this.chatGroupAdmins.push(e);break;case "3":window.imCurrentUser.uid==e.uid&&window.imCurrentUser.cid==e.cid&&(this.selfRoleType="3",this.renderOptionButton()),this.renderChatGroupHost(e)}}this.renderChatGroupAdmins()}},exitImChatGroup:function(){d.exitGroupReq({isHelper:this.isHelper,groupId:this.imChatGroup.id},function(a){"1211"==
a.message.ret.ret?m.notify({zh_CN:"\u60a8\u662f\u5ba2\u6237\u7684\u552f\u4e00\u8d1f\u8d23\u4eba\uff0c\u8bf7\u79fb\u4ea4\u8d1f\u8d23\u4eba\u540e\u518d\u9000\u51fa\u7fa4\u7ec4",zh_TW:"\u60a8\u662f\u5ba2\u6236\u7684\u552f\u4e00\u8ca0\u8cac\u4eba\uff0c\u8acb\u79fb\u4ea4\u8ca0\u8cac\u4eba\u5f8c\u518d\u9000\u51fa\u7fa4\u7d44",en_US:"You are the only server of this client\uff0c please change the server to other one"}[TEAMS.perLang]):"0"==a.message.ret.ret&&$("#"+l.IM_ADDRLIST_EL).trigger("exitImChatGroup",
a.message)})},countWordNum:function(a){(a=a.val())||$(this.el+" .j_im-hint-limit").text("");a=a.length+"/200";$(this.el+" .j_im-hint-limit").text(a)},remove:function(){$(this.el).off(".ImGroupDetail");$("body").off(".ImGroupDetail")}});p.exports=n});
define("im/chat/history/imChatHistoryView","im/component/emojiarea im/component/imUtils im/chat/imSingleChatView im/component/imChatComponent im/chat/imGroupChatView im/component/group/anonymous".split(" "),function(n,s,p){var m=n("im/component/emojiarea"),l=n("im/component/imUtils"),h=n("im/chat/imSingleChatView"),g=n("im/component/imChatComponent"),f=n("im/chat/imGroupChatView"),a=n("im/component/group/anonymous");n=Backbone.View.extend({initialize:function(a){this.el="#chat-histroy-modal";this.imChatUser=
a.imChatUser;this.chatType=a.chatType;this.imChatGroup=a.imChatGroup;this.isHelper=a.isHelper;this.pageUpMsgId;this.pageDownMsgId;$("body #chat-histroy-modal").remove();$("body").append(l.template("im.chat.history"));ZeroClipboard.config({swfPath:"/static/swf/clipboard.swf",activeClass:"zeroclipboard-is-active"});"singleChat"==this.chatType?this.imChatView=new h({chatType:this.chatType,imChatUser:this.imChatUser,count:this.count,$scrollBar:$(".j_chat-history"),el:this.el}):"groupChat"==this.chatType&&
(this.imChatView=new f({chatType:this.chatType,imChatGroup:this.imChatGroup,count:this.count,$scrollBar:$(".j_chat-history"),el:this.el}));m($)},delegateEvents:function(){var a=this,b=$(a.el);$("#chat-histroy-modal").on("hidden.bs.modal",function(){a.remove()});$(a.el).on("click.chatHistory",".page-first",function(){if(!$(this).hasClass("disabled")){l.gotoTop(".j_chat-history");var b={order:"asc"},b=a.buildTurnPageParams(b);a.loadHistory(b,function(b){$(a.el).find(".pagination .page-first").addClass("disabled");
$(a.el).find(".pagination .page-pre").addClass("disabled")})}});$(a.el).on("click.chatHistory",".page-pre",function(){if(!$(this).hasClass("disabled")){l.gotoTop(".j_chat-history");var b={order:"desc",pageType:"prePage"},b=a.buildTurnPageParams(b,parseInt(a.pageDownMsgId)-1);a.loadHistory(b)}});$(a.el).on("click.chatHistory",".page-next",function(){if(!$(this).hasClass("disabled")){l.gotoTop(".j_chat-history");var b={order:"asc",pageType:"nextPage"},b=a.buildTurnPageParams(b,parseInt(a.pageUpMsgId)+
1);a.loadHistory(b)}});$(a.el).on("click.chatHistory",".page-last",function(){if(!$(this).hasClass("disabled")){l.gotoTop(".j_chat-history");var b={order:"desc"},b=a.buildTurnPageParams(b);a.loadHistory(b,function(b){$(a.el).find(".pagination .page-last").addClass("disabled");$(a.el).find(".pagination .page-next").addClass("disabled")})}});$("body").on("keydown.chatHistory",function(b){27==b.which&&a.close()});b.off("click.chatHistory",".j_check-addr").on("click.chatHistory",".j_check-addr",function(b){b=
$(this).data("location");a.mapWindowView&&(g.removeChatMap(a.mapWindowView),a.mapWindowView=null);a.mapWindowView=g.openChatMap(b)});b.off("click.chatHistory",".j_im-video-play").on("click.chatHistory",".j_im-video-play",function(b,f){var e=$(this);clearInterval(e.timer);var h=e.parents(".j_weixinAudio"),e=$(this).parents(".j_audio_area"),h=h.find("audio"),l=h.attr("status"),m=$(a.el).find("#chat-history-view").find(".chat-message[type\x3d3]");if(m&&0<m.length)for(var n=0;n<m.length;n++){var r=$(m[n]);
g.optAudioMsg(r.find(".j_audio_area"),r.find("audio"),"close")}"off"==l&&g.optAudioMsg(e,h,"open")})},buildTurnPageParams:function(a,b){switch(this.chatType){case "singleChat":var c=[],f={fromCid:this.imChatUser.cid,fromUid:this.imChatUser.id,maxNum:"10"};b&&(f.start=b);c.push(f);a.syncMsgUsers=c;break;case "groupChat":c=[],f={groupId:this.imChatGroup.id,maxNum:"10"},b&&(f.start=b),c.push(f),a.datas=c}return a},render:function(){var a=this;$(a.el).modal("toggle");var b={isFirst:!0};"groupChat"==a.chatType&&
void 0==a.groupExist?a.imChatView.isGroupMemberReq({},function(c){"1"==c.message.datas[0].ret&&(a.groupExist=!0,b.groupExist=!0);a.renderCallback(b)}):a.renderCallback(b)},renderCallback:function(a){var b=this;a.groupExist=b.groupExist;b.loadHistory(a,function(a){var d=$(b.el);a=a.message.datas[0].datas;a&&0<a.length||(d.find(".chat-history-view").text("\u65e0\u5386\u53f2\u6d88\u606f\u3002"),d.find(".pagination").addClass("hide"))});l.layout(b.el+" .j_chat-history")},searchByMsgId:function(a){var b=
this;l.layout(b.el+" .j_chat-history");"groupChat"==b.chatType&&void 0==b.groupExist?b.imChatView.isGroupMemberReq({},function(c){"1"==c.message.datas[0].ret&&(b.groupExist=!0,a.groupExist=!0);b.renderSearchByMsgId(a)}):b.renderSearchByMsgId(a)},renderSearchByMsgId:function(a){var b=this;$(b.el).modal("toggle");var c={},f=a.msgId;c.order="desc";c.groupExist=b.groupExist;c=b.buildTurnPageParams(c,a.msgId);c.notNeedEmpty=!0;c.pendMethod="append";c.sortOrder="asc";b.loadHistory(c,function(){var c={};
c.groupExist=b.groupExist;c.order="asc";c.notNeedEmpty=!0;c.pendMethod="append";c.sortOrder="desc";c=b.buildTurnPageParams(c,a.msgId);b.loadHistory(c,function(){setTimeout(function(){$(b.el+" .j_chat-history").mCustomScrollbar("scrollTo","#"+f+".j_his-list-item");var a=$(b.el).find("#"+f);a&&0<a.length&&a.addClass("im-div-flash");setTimeout(function(){a.removeClass("im-div-flash")},2E3)},300)})})},close:function(){$("#chat-histroy-modal").modal("hide")},loadHistory:function(a,b){var c=this;a.groupExist=
c.groupExist;a.isHelper=c.isHelper;var f="desc";a.sortOrder&&(f=a.sortOrder);"groupChat"==c.chatType?(c.imChatView.syncGroupMemberList(),c.imChatView.loadGroupChatHistory(a,function(e){var g=e.message,h=g.datas[0].datas;if("0"==g.ret.ret&&null!=h&&0<h.length){var h=l.sortBy(h,"ser_msgid"),g=h[0],m=h[h.length-1];c.pageUpMsgId=g.ser_msgid;c.pageDownMsgId=m.ser_msgid;if(1==h.length&&a.pageType)switch(a.pageType){case "prePage":g=void 0;break;case "nextPage":m=void 0}c.changeButton(g,m,a.isFirst);h=l.sortBy(h,
"ser_msgid",f);c.renderSynChatMsgDatas(h,a.notNeedEmpty,a.pendMethod)}b&&b(e)})):c.imChatView.loadSingleChatHistory(a,function(e){var g=e.message,h=g.datas[0].datas;if("0"==g.ret.ret&&null!=h&&0<h.length){var h=l.sortBy(h,"ser_msgid"),g=h[0],m=h[h.length-1];c.pageUpMsgId=g.ser_msgid;c.pageDownMsgId=m.ser_msgid;if(1==h.length&&a.pageType)switch(a.pageType){case "prePage":g=void 0;break;case "nextPage":m=void 0}c.changeButton(g,m,a.isFirst);h=l.sortBy(h,"ser_msgid",f);c.renderSynChatMsgDatas(h,a.notNeedEmpty,
a.pendMethod)}b&&b(e)})},renderSynChatMsgDatas:function(a,b,c){var f=$("#chat-histroy-modal .chat-history-view");c||(c="append");b||f.empty();b=$(this.el).find("#chat-histroy-modal-clone-field #chat-daybox-clone").find(".chat-history-list").clone();for(var e=0;e<a.length;e++){var g=a[e],h=!1;if(e<a.length-1){var l=a[e+1],m=this.confirmDate(1E3*g.msgtime),l=this.confirmDate(1E3*l.msgtime);m==l&&(h=!0)}if((m=this.renderSynChatMsgDatasOne(g))&&1>f.find("#"+m.attr("id")).length)b[c](m);h||(this.addChatBox(b,
g.msgtime,f,c),b=$(this.el).find("#chat-histroy-modal-clone-field #chat-daybox-clone").find(".chat-history-list").clone())}},renderSynChatMsgDatasOne:function(d){var b=d.ser_msgid,c=d.msg,f=g.getImChatUserCache("imUserCache-"+d.from_uid+"-"+d.from_cid),e=$(this.el).find("#chat-histroy-modal-clone-field #chat-box-clone").clone();if(f){window.imCurrentUser.uid!=f.id&&e.removeClass("mine");var h=a.blurMsgInfo(f,c);e.removeClass("hide");e.attr("id",d.ser_msgid);e.find(".info").attr("id",f.id);e.find(".info").find("span").html(h.name);
e.find(".info").find("time").html(Date.create(1E3*d.msgtime).format("{HH}:{mm}:{ss}"));f=e.find(".content");switch(c.type.toString()){case "1":if(c.typeBak)switch(c.typeBak.toString()){case "5":this.renderLocalChatBubble(c,e);break;case "10":b=$(this.el).find("#j_chat-back-msg-clone").clone().removeAttr("id").attr("id",b);window.imCurrentUser.uid==d.from_uid&&(c.dt[0].txt.i18n="im.chat.b.self");c=l.processMsgByType(c);b.find("span").text(c);f.html(b);break;case "12":c=l.getMsgContent(c,window.imCurrentUser);
f.html(c);break;default:this.renderTextChatBubble(b,f,c)}else this.renderTextChatBubble(b,f,c);break;case "2":c=c.dt[0].img;f.html("\x3cimg  class\x3d'artZoom' data-artZoom-show\x3d'/base/download/"+c.src+"?ETEAMSID\x3d"+ETEAMSID+"' data-artZoom-source\x3d'/base/download/"+c.src+"?ETEAMSID\x3d"+ETEAMSID+"' src\x3d'/base/download/"+c.src+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID+"' \x3e");f.find(".artZoom").artZoom();break;case "3":e.addClass("chat-message");e.attr("type",3);d=!1;if(void 0!=window.IsEteamsClient)switch(window.IsEteamsClient()){case 2:d=
!0}d?(c.type=1,c.dt[0].txt={v:"[\u6682\u4e0d\u652f\u6301\u6b64\u7c7b\u6d88\u606f]"},this.renderTextChatBubble(b,f,c)):this.renderVoiceChatBubble(b,f,c);break;case "4":c=c.dt[0].file;f.html("\x3cspan\x3e\x3ca href\x3d'/base/download/"+c.id+"?download\x3dtrue' data-value\x3d"+c.id+"\x3e"+c.nm+"\x3c/a\x3e");break;case "5":this.renderLocalChatBubble(c,e);break;case "8":c=c.dt[0].entity;d=c.nm;switch(c.me){case "task":d="[\u4efb\u52a1]"+c.nm;break;case "document":d="[\u6587\u6863]"+c.nm;break;case "customer":d=
"[\u5ba2\u6237]"+c.nm;break;case "workflow":d="[\u5ba1\u6279]"+c.nm;break;case "mainline":d="[\u9879\u76ee]"+c.nm;break;case "user":d="[\u7528\u6237]"+c.nm;break;case "tag":d="[\u6807\u7b7e]"+c.nm;break;case "share":d="[\u5206\u4eab]"+c.nm;break;case "workreport":d="[\u62a5\u544a]"+c.nm;break;case "formdatareport":d="[\u8868\u5355\u6570\u636e]"+c.nm;break;case "cale\tndar":d="[\u65e5\u7a0b]"+c.nm;break;case "saleChance":d="[\u5546\u673a]"+c.nm;break;case "production":d="[\u4ea7\u54c1]"+c.nm;break;
case "competitor":d="[\u5bf9\u624b]"+c.nm;break;case "marketactivity":d="[\u6d3b\u52a8]"+c.nm;break;case "clue":d="[\u7ebf\u7d22]"+c.nm;break;case "contact":d="[\u8054\u7cfb\u4eba]"+c.nm;break;case "contract":d="[\u5408\u540c]"+c.nm}f.html("\x3ca class\x3d'entitybox-toggle' data-value\x3d'"+c.id+"' data-module\x3d'"+c.me+"' data-id\x3d'"+c.id+"'\x3e"+d+"\x3c/a\x3e");break;default:return}return e}},renderTextChatBubble:function(a,b,c){a=c.dt[0].txt;if(a.v){c=a.v;var f=l.initMessage(a.v);if(a.aus)var e=
$('\x3ca class\x3d"at-user c-blue j_at-obj-trigger"\x3e\x3c/a\x3e'),f=g.completeAtContent(a.aus,c,f,e,TEAMS.perLang,!0).txtValueName,f=l.initMessage(f);b.html(f)}},renderVoiceChatBubble:function(a,b,c){a=$(this.el);c=c.dt[0].video;var f=1;c.dur&&(f=parseInt(c.dur/1E3));var e=f+"%";a=a.find("#chat-histroy-modal-clone-field #chat-video-clone").clone().removeClass("hide").attr("id",c.id);a.find(".dur-width").css("width",e);a.find(".j_time span").text(f);a.find("audio").attr("src",crmContext.remoteDownloadUrl+
"/remotedownload/"+c.src+"/"+ETEAMSID+"/true?type\x3damr2mp3");b.attr("type",3);b.html(a)},renderLocalChatBubble:function(a,b,c,f){c=$(this.el);a=a.dt[0].location;f=a.name;var e=a.addr;c=c.find("#chat-histroy-modal-clone-field #chat-location-clone").clone().attr("id","").removeClass("hide");c.find(".info").text(e);f&&f!=e&&(c.find(".title").removeClass("hide"),c.find(".title").text(f));f="https://api.map.baidu.com/staticimage/v2?ak\x3dlZVLz80fXoVh3VVsN5ChL6bb\x26amp;scale\x3d2\x26width\x3d300\x26amp;height\x3d120\x26amp;center\x3d"+
a.lng+","+a.lat+"\x26amp;markers\x3d"+a.lng+","+a.lat+"\x26zoom\x3d15\x26amp;markerStyles\x3dl,,0xff0000\x26amp";c.find(".content").html("\x3ca class\x3d'j_check-addr'\x3e\x3cimg src\x3d"+f+"/\x3e\x3c/a\x3e");b.find(".j_chat-box-bubble").html(c);b.find(".j_check-addr").data("location",a)},changeButton:function(a,b,c){$(this.el).find(".pagination .page-first").removeClass("disabled");$(this.el).find(".pagination .page-pre").removeClass("disabled");$(this.el).find(".pagination .page-last").removeClass("disabled");
$(this.el).find(".pagination .page-next").removeClass("disabled");a&&"0"==a.next_id&&($(this.el).find(".pagination .page-last").addClass("disabled"),$(this.el).find(".pagination .page-next").addClass("disabled"));b&&"0"==b.next_id&&($(this.el).find(".pagination .page-first").addClass("disabled"),$(this.el).find(".pagination .page-pre").addClass("disabled"));c&&($(this.el).find(".pagination .page-last").addClass("disabled"),$(this.el).find(".pagination .page-next").addClass("disabled"))},confirmDate:function(a){a=
Date.create(a);a.format("{MM}-{dd}");var b=a.format("{yyyy}-{MM}-{dd}");a.is("today")?b="\u4eca\u5929":a.is("yesterday")&&(b="\u6628\u5929");return b},addChatBox:function(a,b,c,f){b=this.confirmDate(1E3*b);var e=$(this.el).find("#chat-daybox-clone").clone();e.removeClass("hide");e.attr("id",b);e.find(".date").find("time").html(b);e.find(".chat-history-list").html(a.children());c[f](e)},remove:function(){$(this.el).off(".chatHistory");window.lastPlayAudioMsg&&(g.optAudioMsg(window.lastPlayAudioMsg.$button,
window.lastPlayAudioMsg.$video,"close"),window.lastPlayAudioMsg=void 0)}});p.exports=n});
define("im/chat/imSingleChatView",["im/component/imUtils","im/component/imContants","im/chat/imCommonChatView","im/component/imChatComponent"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/chat/imCommonChatView"),g=n("im/component/imChatComponent");n=Backbone.View.extend({initialize:function(f){this.chatType=f.chatType;this.minMsgId;this.imChatUser=f.imChatUser;this.$scrollBar=f.$scrollBar;this.imPortalChatEl="#im-chat-window";this.imMiniChatBoxEl="#im-mini-chat-box";
this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;this.imJsonUtils=window.imWebsocketSdk.imJsonUtils;this.count=f.count;this.el=f.el;this.imCommonChatView=new h({chatType:this.chatType,imChatUser:this.imChatUser,el:this.el,$scrollBar:this.$scrollBar,count:f.count});this.isFirst=!0},delegateEvents:function(){$(this.el)},render:function(f,a){this.imCommonChatView.msgKind=void 0;"10000"!==this.imChatUser.id&&g.setImChatUserCache("imUserCache-"+
this.imChatUser.id+"-"+this.imChatUser.cid,this.imChatUser);this.renderSingleChatHistory(f,a)},renderByKind:function(f,a){this.imCommonChatView.msgKind=f.kind;this.renderSingleChatHistoryByKind(f,a)},loadSingleChatHistory:function(f,a){var d=this.imChatUser.id,b=this.imChatUser.cid;b||(b=window.imCurrentUser.cid);f||(f={});f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.order||(f.order="desc");this.minMsgId&&(f.start=this.minMsgId.toString());if(!f.syncMsgUsers){var c=[],d={fromCid:b,
fromUid:d,maxNum:"10"};f.maxNum&&(d.maxNum=f.maxNum);this.minMsgId&&(d.start=this.minMsgId);c.push(d);f.syncMsgUsers=c}$(this.el).find(".j_im-more-chatMessage").addClass("hide");this.imWebReqMethods.syncSingleMsgReq(f,function(b){a&&a(b)})},loadSingleChatHistoryByKind:function(f,a){var d=this.imChatUser.id,b=this.imChatUser.cid;b||(b=window.imCurrentUser.cid);f||(f={});f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.dev=window.imClientDev;f.user={uid:d,cid:b};f.start="9223372036854775807";
this.minMsgId&&(f.start=this.minMsgId);f.end="0";f.maxNum="10";this.imWebReqMethods.syncKindSingleMsgReq(f,function(b){a&&a(b)})},renderSingleChatHistory:function(f,a){var d=this,b=f.isHelper,c=f.renderOrder;d.loadSingleChatHistory(f,function(g){void 0==c&&(c="down");(g=g.message.datas[0].datas)&&0<g.length?(g=m.sortBy(g,"ser_msgid"),d.minMsgId=g[g.length-1].next_id,d.imCommonChatView.renderSynChatMsgDatas(g,c,f.$scrollBar,f.$listContainer,b),d.getSingleMsgReadStatusReq({mesDatas:g,isHelper:b})):
g=[];g&&a&&a(g)})},renderSingleChatHistoryByKind:function(f,a){var d=this,b=f.renderOrder;d.loadSingleChatHistoryByKind(f,function(c){void 0==b&&(b="down");c=c.message;var g=[];c.datas&&0<c.datas.length&&(g=c.datas)&&g&&0<g.length&&(g=m.sortBy(g,"ser_msgid"),d.minMsgId=g[g.length-1].next_id,d.imCommonChatView.renderSynChatMsgDatas(g,b,f.$scrollBar,f.$listContainer));g&&a&&a(g)})},sortBy:function(f){return function(a,d){var b,c;if("object"===typeof a&&"object"===typeof d&&a&&d)return b=a[f],c=d[f],
b===c?0:typeof b===typeof c?b>c?-1:1:typeof b>typeof c?-1:1;throw"error";}},sendChatMsgAndBack:function(f){var a=this,d="sendSingleMsgReq",b=f.isHelper,c=f.msgType,g=f.tipMsgKey;f.dev=window.imClientDev;f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.toCid=a.imChatUser.cid;a.imChatUser.cid||(f.toCid=window.imCurrentUser.cid);f.toUid=a.imChatUser.id;f.sname=window.imCurrentUser.name;var e=a.imWebReqMethods.initTempMsgId().toString();f.tempMsgId&&(e=f.tempMsgId);f.tempMsgId=e;var h=
f.container,u=f.$listContainer;u||(u=$(a.el).find("#chatMessageList"));var m=a.imWebReqMethods.buildJsonChatMsg(f),d=b?"sendHelperMsgReq":"sendSingleMsgReq",n={};if("100"!=c)return n=a.imWebReqMethods[d](f,function(b){b=b.message;if("0"==b.ret.ret){var c=u.find("#"+e);c&&(b.kind=f.msgTypeConf,b.sname=f.sname,b.msg||(b.msg=m.msg),c.data("mesData",b));a.imCommonChatView.updateChatMesBody({msgDateTime:b.msgtime,$msgBody:c,msgId:b.ser_msgid,direction:"right",container:h,listContainer:u,imChatUserId:a.imChatUser.id,
addMethod:"append",chatType:a.chatType,needReposition:!1});c={type:"1"};c.msgObj={ser_msgid:b.ser_msgid,msg:f.msg,msgtime:b.msgtime,from_uid:window.imCurrentUser.uid,from_id:window.imCurrentUser.uid,to_uid:f.toUid,to_cid:f.toCid};b=$("#"+l.IM_ADDRLIST_EL);0<b.length&&b.trigger("updateLastMessage.ImAddrList",c)}}),n.$scrollBar=f.$scrollBar,n.isHelper=b,f.isRetry?a.imCommonChatView.updateMsgBubble(n):a.imCommonChatView.sendChatMsgAndBack(n),n;n.$scrollBar=f.$scrollBar;n.tempMsgId=f.tempMsgId;n.msgType=
"100";n.tipMsgKey=g;a.imCommonChatView.sendChatMsgAndBack(n)},sendUploadFailMsg:function(f){f.dev=window.imClientDev;f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.toCid=this.imChatUser.cid;this.imChatUser.cid||(f.toCid=window.imCurrentUser.cid);f.toUid=this.imChatUser.id;f.sname=window.imCurrentUser.name;var a=this.imWebReqMethods.initTempMsgId().toString();f.tempMsgId=a;$(this.el).find("#chatMessageList");a=this.imJsonUtils.buildJsonChatMsg(f);f.msg=a.msgObj;f.subtitle=a.subtitleObj;
f.failMsg=!0;this.imCommonChatView.sendChatMsgAndBack(f)},setChatMsgRead:function(f,a){f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.info={sessionType:"1",fuser:f.user};f.dev=window.imClientDev;var d=f.user,b="1-"+d.uid,c=g.getImChatNoReadCounts(b);c||(c={type:"1",count:"0",user:{uid:d.uid,cid:d.cid}});c.count="0";g.setImMsgNoReadCounts(b,c,"1");this.imWebReqMethods.triggerMsgReadStatusNoticeMethods(c);this.imSessionCacheManager.setSessionRead("1",f.user.uid);this.imWebReqMethods.setSessionReq(f,
function(b){a&&a(b)})},imChatBoxNotify:function(f,a,d,b,c){c||(c=$(this.el).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list"));var g=f.isHelper,e={uid:f.message.from_uid,cid:f.message.from_cid},h="left";f.message.datas.from_uid==window.imCurrentUser.uid&&(a=!0,h="right");e.uid==this.imChatUser.id&&(f=f.message.datas,d={mesData:f,msgObj:f.msg,fromUid:f.from_uid,fromCid:f.from_cid,msgId:f.ser_msgid,direction:h,container:$(this.el),listContainer:c,imChatUserId:this.imChatUserId,addMethod:"append",
chatType:"singleChat",needReposition:!1,msgStatusUnread:!b,isCurrentChat:d,isHelper:g},this.createChatMesBody(d),a||this.setChatMsgRead({user:e}))},createChatMesBody:function(f,a){this.imCommonChatView.createChatMesBody(f,a)},turnPage:function(f,a){f.kind?this.renderSingleChatHistoryByKind(f,a):this.renderSingleChatHistory(f,a)},createImGroup:function(f,a){var d=[];d.uid=window.imCurrentUser.uid;d.cid=window.imCurrentUser.cid;d.createSource="0";d.type="0";d.transfer="create demo";for(var b=[],c="",
g=0;g<f.length;g++){var e=f[g],h={cid:window.imCurrentUser.cid,uid:e.id};5>g&&(c+="\u3001"+e.username);b.push(h)}(c=c.substring(1,c.length))&&60<c.length&&(c=c.substring(0,60));c=m.replaceSpecialMark(c);d.name=c;d.users=b;30<b.length?m.notify({zh_CN:"\u521b\u5efa\u7fa4\u7ec4\u65f6\u6700\u591a\u9009\u62e930\u4e2a\u4eba",zh_TW:"\u5275\u5efa\u7fa4\u7d44\u6642\u6700\u591a\u9078\u64c730\u500b\u4eba",en_US:"A maximum of 30 people when you creat group"}[TEAMS.perLang]):this.imWebReqMethods.createGroupReq(d,
function(b){a&&a(b)})},markMsgBack:function(f,a){var d=f.isHelper,b={uid:this.imChatUser.id,cid:this.imChatUser.cid};f.objId=this.imChatUser.id;f.user=b;f.suid=window.imCurrentUser.uid;f.scid=window.imCurrentUser.cid;b="makeSingleMsgWithdrawReq";d&&(b="helperMsgRecallReq");return this.imWebReqMethods[b](f,a)},getSingleMsgReadStatusReq:function(f,a){var d=f.mesDatas,b=f.isHelper;if(d&&0<d.length){var c={uid:this.imChatUser.id,cid:this.imChatUser.cid},g=[],e=[];d.forEach(function(a){a.from_uid==window.imCurrentUser.uid&&
a.from_cid==window.imCurrentUser.cid?g.push(a.ser_msgid):e.push(a.ser_msgid)});f={};f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.user=c;g&&0<g.length&&(f.msgIds=g);e&&0<e.length&&(f.recvMsgIds=e);d="getSingleMsgReadStatusReq";b&&(d="getHelperMsgReadStatusReq",f.msgIds=void 0);this.imWebReqMethods[d](f,function(a){a=a.message;a={datas:a.datas,recvMsgIds:a.recv_msgids,user:c};$("#"+l.IM_CHATWIN_EL).trigger("singleReadNotify",a)})}},setSingleMsgReadStatusReq:function(f,a){var d=f.isHelper,
b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;b.user=f.singleReadUser;b.msgIds=f.recvMsgIds;var c="setSingleMsgReadStatusReq";d&&(b.user={uid:"10000",cid:"10000"},c="setHelperMsgReadStatusReq");this.imWebReqMethods[c](b,function(b){a&&a(b)})},renderUserStatus:function(f,a){f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;this.imWebReqMethods.getStatusReq(f,function(d){if((d=d.message.infos)&&0<d.length){d=d[0].dev_infos;for(var b={},c=0;c<d.length;c++){var f=d[c];
b[f.dev]=f.status}d=m.judgeUserStatus(b);a&&a(d)}})},remove:function(){}});p.exports=n});define("im/client/client",["im/client/map"],function(n,s,p){var m=n("im/client/map");p.exports={init:function(){window.imPCcomponent&&(window.imPCcomponent={});this.initMap()},initMap:function(){window.imPCcomponent.openMapDetail=m.open;window.imPCcomponent.closeMapDetail=m.close;window.imPCcomponent.getMapPicSrc=m.getPic}}});
define("im/client/map",["im/component/imChatComponent","im/config"],function(n,s,p){var m=n("im/component/imChatComponent"),l=n("im/config").baiduAK;p.exports={open:function(h,g,f){h=m.openChatMap({addr:h,lng:g,lat:f});$(h.el).find(".modal-dialog").css({width:"100%",margin:"0"});return h},close:function(h){m.removeChatMap(h)},getPic:function(h,g,f,a,d){scale=2;return"https://api.map.baidu.com/staticimage/v2?ak\x3d"+l+"\x26scale\x3d"+scale+"\x26width\x3d"+(f||300)+"\x26height\x3d"+(a||120)+"\x26center\x3d"+
h+","+g+"\x26markers\x3d"+h+","+g+"\x26zoom\x3d"+(d||15)+"\x26markerStyles\x3dl,,0xff0000\x26/"}}});define("im/config",function(n){return{baiduAK:"55c74c0fd7fc2c4dbca87c09d86910c7"}});
define("im/cache/imSessionCacheManager",["im/component/imChatComponent","im/component/imContants"],function(n,s,p){var m=n("im/component/imChatComponent"),l=n("im/component/imContants");n=Backbone.View.extend({initialize:function(h){this.recentEl="#im-recent-list";this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.supportSgroups=window.imEteamsJsService.ImRecentListCBService.supportSgroups;this.minSessionId=this.maxSessionId=0;this.initSessionCache()},delegateEvents:function(){},
render:function(h){var g=this,f=$("body").data("imCacheData").sessionCacheDatas,a=$("body").data("imCacheData").msgReminderCacheDatas;if(h){var d=[],b;for(b in f.sessionMap)f.sessionMap[b]&&d.push(f.sessionMap[b]);h({sessionArray:d,hasNext:f.hasNext,imMsgRemindMap:a.imMsgRemindMap})}d={};d.uid=window.imCacheData.imCurrentUser.uid;d.cid=window.imCacheData.imCurrentUser.cid;d.sessionId=f.maxSessionId;d.clientUc=f.clientUc;d.reqType="0";g.imWebReqMethods.newGetSessionReq(d,function(b){if(b.message){var d=
b.message,e=d.datas;if("0"==b.message.ret.ret&&(f.clientUc=d.server_uc,e&&0<e.length)){f=$("body").data("imCacheData").sessionCacheDatas;for(b=0;b<e.length;b++)switch(d=e[b],d.session_type){case "1":var l=f.sessionMap["1-"+d.fuser.uid];l&&l.ownerObj&&(d.ownerObj=l.ownerObj);f.sessionMap["1-"+d.fuser.uid]=d;break;case "2":(l=f.sessionMap["2-"+d.group_id])&&l.ownerObj&&(d.ownerObj=l.ownerObj);f.sessionMap["2-"+d.group_id]=d;break;case "3":(l=f.sessionMap["3-serviceGroup"])&&l.ownerObj&&(d.ownerObj=
l.ownerObj);f.sessionMap["3-serviceGroup"]=d;break;case "4":(l=f.sessionMap["4-sgroup-"+d.group])&&l.ownerObj&&(d.ownerObj=l.ownerObj);f.sessionMap["4-sgroup-"+d.group]=d;break;case "7":(l=f.sessionMap["7-"+d.group_id])&&l.ownerObj&&(d.ownerObj=l.ownerObj),f.sessionMap["7-"+d.group_id]=d}g.updateSessionIdConfig(f.sessionMap);if(h){e=[];for(b in f.sessionMap)f.sessionMap[b]&&e.push(f.sessionMap[b]);h({sessionArray:e,hasNext:f.hasNext,imMsgRemindMap:a.imMsgRemindMap})}}}});g.imWebReqMethods.getMsgRemindReq(d,
function(b){if(b.message){var d=b.message.datas;d&&0<d.length&&(d.forEach(function(b){switch(b.session_type){case "1":a.imMsgRemindMap["1-"+b.user.uid]=b;break;case "2":a.imMsgRemindMap["2-"+b.group_id]=b;break;case "3":a.imMsgRemindMap["3-serviceGroup"]=b;break;case "4":a.imMsgRemindMap["4-sgroup-"+b.group]=b;break;case "7":a.imMsgRemindMap["7-"+b.group_id]=b}}),a.cliUc=b.message.ser_uc)}})},sumServiceSessionUnread:function(){var h=$("body").data("imCacheData").serviceSessionCacheDatas,g=0,f;for(f in h.sessionMap){var a=
h.sessionMap[f];a&&a.unread_count&&0<parseInt(a.unread_count)&&(g+=parseInt(a.unread_count))}h=$("body").data("imCacheData").sessionCacheDatas;h.sessionMap["3-serviceGroup"]&&(h.sessionMap["3-serviceGroup"].unread_count=g)},renderServiceSessionCache:function(h){var g=this,f=$("body").data("imCacheData").serviceSessionCacheDatas,a=$("body").data("imCacheData").msgReminderCacheDatas;if(h){var d=[],b;for(b in f.sessionMap)f.sessionMap[b]&&d.push(f.sessionMap[b]);h({sessionArray:d,hasNext:f.hasNext,imMsgRemindMap:a.imMsgRemindMap})}d=
{};d.uid=window.imCacheData.imCurrentUser.uid;d.cid=window.imCacheData.imCurrentUser.cid;d.sessionId=f.maxSessionId;d.clientUc=f.clientUc;d.reqType="0";g.imWebReqMethods.newGetServiceSessionReq(d,function(b){if(b.message){var d=b.message,e=d.datas;if("0"==b.message.ret.ret&&(f.clientUc=d.server_uc,e&&0<e.length)){f=$("body").data("imCacheData").serviceSessionCacheDatas;for(b=0;b<e.length;b++)switch(d=e[b],d.session_type){case "7":var l=f.sessionMap["7-"+d.group_id];l&&l.ownerObj&&(d.ownerObj=l.ownerObj);
f.sessionMap["7-"+d.group_id]=d}g.updateSessionIdConfig(f.sessionMap);if(h){e=[];for(b in f.sessionMap)f.sessionMap[b]&&e.push(f.sessionMap[b]);h({sessionArray:e,hasNext:f.hasNext,imMsgRemindMap:a.imMsgRemindMap})}}}});g.imWebReqMethods.getMsgRemindReq(d,function(b){if(b.message){var d=b.message.datas;d&&0<d.length&&(d.forEach(function(b){switch(b.session_type){case "1":a.imMsgRemindMap["1-"+b.user.uid]=b;break;case "2":a.imMsgRemindMap["2-"+b.group_id]=b;break;case "4":a.imMsgRemindMap["4-sgroup-"+
b.group]=b;break;case "7":a.imMsgRemindMap["7-"+b.group_id]=b}}),a.cliUc=b.message.ser_uc)}})},turnPage:function(h,g){var f=this,a=$("body").data("imCacheData").sessionCacheDatas,d=h.isHelper;d&&(a=$("body").data("imCacheData").serviceSessionCacheDatas);if(a.hasNext){var b=$("body").data("imCacheData").msgReminderCacheDatas;h||(h={});h.uid=window.imCacheData.imCurrentUser.uid;h.cid=window.imCacheData.imCurrentUser.cid;h.lastMsgid=a.last_msgid;h.pageSize=11;f.imWebReqMethods.getSessionByPageReq(h,
function(c){if(c.message){var k=c.message.datas;if(k&&0<k.length){c={};a=$("body").data("imCacheData").sessionCacheDatas;d&&(a=$("body").data("imCacheData").serviceSessionCacheDatas);var e=k.length;k&&10<k.length?(a.hasNext=!0,e=10):a.hasNext=!1;for(var h=0;h<e;h++){var l=k[h];switch(l.delta_flag){case "0":switch(l.session_type){case "1":a.sessionMap["1-"+l.fuser.uid]=l;c["1-"+l.fuser.uid]=l;break;case "2":a.sessionMap["2-"+l.group_id]=l;c["2-"+l.group_id]=l;break;case "4":a.sessionMap["4-sgroup-"+
l.group]=l;c["4-sgroup-"+l.group]=l;break;case "7":a.sessionMap["7-"+l.group_id]=l,c["7-"+l.group_id]=l}}}f.updateLastMsgIdConfig(k);if(g){k=[];for(h in c)c[h]&&k.push(c[h]);g({sessionArray:k,hasNext:a.hasNext,imMsgRemindMap:b.imMsgRemindMap})}}}})}},initSessionCache:function(){var h=this,g={sessionArray:[],sessionMap:{},clientUc:0,maxSessionId:0,minSessionId:1E16,minMsgId:1E16,tempSessionId:1,hasSysSession:!1,hasNext:!0};$("body").data("imCacheData").sessionCacheDatas=g;$("body").data("imCacheData").serviceSessionCacheDatas=
{sessionArray:[],sessionMap:{},clientUc:0,maxSessionId:0,minSessionId:1E16,minMsgId:1E16,tempSessionId:1,hasSysSession:!1,hasNext:!0};var f={};f.uid=window.imCacheData.imCurrentUser.uid;f.cid=window.imCacheData.imCurrentUser.cid;f.reqType="1";h.imWebReqMethods.newGetSessionReq(f,function(a){a.message&&(a=a.message,g.clientUc=a.server_uc,a.datas&&0<a.datas.length&&(a=h.sessionArrayToMap(a.datas),g.sessionMap=a.resultMap,g.hasSysSession=a.hasSysSession,h.updateSessionIdConfig(g.sessionMap,!0)),$("body").trigger("imRefresh"),
$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage"))})},loadServiceSessionData:function(h){$("body").data("imCacheData").serviceSessionCacheDatas?this.renderServiceSessionCache(h):this.initServiceSessionCache(h)},initServiceSessionCache:function(h){var g=this,f=$("body").data("imCacheData").serviceSessionCacheDatas,a={};a.uid=window.imCacheData.imCurrentUser.uid;a.cid=window.imCacheData.imCurrentUser.cid;a.reqType="1";g.imWebReqMethods.newGetServiceSessionReq(a,function(a){if(a.message&&
(a=a.message,f.clientUc=a.server_uc,a.datas&&0<a.datas.length&&(a=g.sessionArrayToMap(a.datas),f.sessionMap=a.resultMap,f.hasSysSession=a.hasSysSession,g.updateSessionIdConfig(f.sessionMap,!0)),h)){a=[];for(var b in f.sessionMap)f.sessionMap[b]&&a.push(f.sessionMap[b]);h({sessionArray:a,hasNext:f.hasNext})}})},initMsgReminderCache:function(h){var g=this,f={imMsgRemindMap:{},cliUc:"0"};$("body").data("imCacheData").msgReminderCacheDatas=f;var a={};a.uid=window.imCacheData.imCurrentUser.uid;a.cid=window.imCacheData.imCurrentUser.cid;
a.cliUc="0";g.imWebReqMethods.getMsgRemindReq(a,function(a){if(a.message){var b=g.msgRemindArrayToMap(a.message.datas);f.imMsgRemindMap=b.resultMap;f.cliUc=a.message.ser_uc}h&&h(a)})},saveMsgReminderCache:function(h,g){var f=$("body").data("imCacheData").msgReminderCacheDatas;f&&(f.imMsgRemindMap[h]=g)},sessionArrayToMap:function(h){var g=this,f={},a=!1,d=m.getImMsgNoReadCountsAll(),b=m.getImChatNoReadAllCounts();h.forEach(function(c){switch(c.session_type){case "1":f["1-"+c.fuser.uid]=c;var k={type:"1",
count:c.unread_count,user:c.fuser};c="1-"+c.fuser.uid;b[c]=k;break;case "2":f["2-"+c.group_id]=c;k={type:"2",count:c.unread_count,group_id:c.group_id};c="2-"+c.group_id;b[c]=k;break;case "3":f["3-serviceGroup"]=c;k={type:"3",count:c.unread_count,group_id:c.group_id};b["3-serviceGroup"]=k;break;case "4":if(-1<g.supportSgroups.indexOf(c.group))a=!0;else break;f["4-sgroup-"+c.group]=c;k={type:"4",count:c.unread_count,sgroup:c.group};c="4-"+c.group;d[c]=k;break;case "7":f["7-"+c.group_id]=c,k={type:"7",
count:c.unread_count,group_id:c.group_id},c="7-"+c.group_id,b[c]=k}});$("body").trigger("imRefresh");$("#"+l.IM_MINI_PAGE).trigger("miniChatAllCountNotify.miniChatPage");return{resultMap:f,hasSysSession:a}},msgRemindArrayToMap:function(h){var g={};h&&0<h.length&&(g={},h.forEach(function(f){switch(f.session_type){case "1":g["1-"+f.user.uid]=f;break;case "2":g["2-"+f.group_id]=f;break;case "4":g["4-sgroup-"+f.group]=f;break;case "7":g["7-"+f.group_id]=f}}));return{resultMap:g}},updateSessionIdConfig:function(h,
g){if(h){var f=$("body").data("imCacheData").sessionCacheDatas,a;for(a in h){var d=h[a];d&&f.maxSessionId<parseInt(d.session_id)&&(f.maxSessionId=parseInt(d.session_id));g&&!d.orderType&&"0"==d.unread_count&&f.minSessionId>parseInt(d.session_id)&&(f.minSessionId=parseInt(d.session_id))}}},updateLastMsgIdConfig:function(h){if(h&&0<h.length){var g=$("body").data("imCacheData").sessionCacheDatas;h.forEach(function(f){!f.orderType&&"0"==f.unread_count&&g.minMsgId>parseInt(f.last_msgid)&&(g.minMsgId=parseInt(f.last_msgid))})}},
markSessionOwner:function(h,g){var f=$("body").data("imCacheData").sessionCacheDatas.sessionMap;f[h]&&(f[h].ownerObj=g)},isExist:function(h,g,f){var a=$("body").data("imCacheData").sessionCacheDatas;"7"==h&&(a=$("body").data("imCacheData").serviceSessionCacheDatas);if(a=a.sessionMap)for(var d in a){var b=a[d];if(!b)return!1;if(b.session_type==h.toString())switch(parseInt(h)){case 1:if(b.fuser.uid==g.fuser.uid)return b.update_tm=g.update_tm,b.last_msgid=g.last_msgid,f||(b.unread_count=parseInt(b.unread_count)+
1),!0;break;case 7:case 2:if(b.group_id==g.group_id)return b.update_tm=g.update_tm,b.last_msgid=g.last_msgid,f||(b.unread_count=parseInt(b.unread_count)+1),!0;break;case 3:return b.update_tm=g.update_tm,b.last_msgid=g.last_msgid,b.group_id=g.group_id,f||(b.unread_count=parseInt(b.unread_count)+1),!0;case 4:if(b.group==g.group)return b.update_tm=g.update_tm,b.last_msgid=g.last_msgid,f||(b.unread_count=parseInt(b.unread_count)+1),!0}}else return!1},receiveSysMsg:function(h){var g=$("body").data("imCacheData").sessionCacheDatas;
h={session_type:"4",group:h.msg_type.group,update_tm:h.msgtime,last_msgid:h.ser_msgid,session_id:g.tempSessionId,delta_flag:"0",orderType:1};g.tempSessionId+=1;this.isExist(4,h)||(h.unread_count="1",g.sessionMap["4-sgroup-"+h.group]=h)},receiveSingleChatMsg:function(h,g){var f=this,a=h.resData,d=h.isHelper,b=a.datas,c={uid:b.from_uid,cid:b.from_cid},k=!0;b&&window.imCurrentUser.uid!=b.from_uid&&(k=!1);window.imCurrentUser.uid==c.uid&&(c={uid:b.to_uid,cid:b.to_cid});var e=$("body").data("imCacheData").sessionCacheDatas,
l={session_type:"1",fuser:c,update_tm:a.msgtime,last_msgid:a.ser_msgid,session_id:e.tempSessionId,delta_flag:"0",orderType:1};d&&(l.fuser={uid:"10000",cid:"10000"});m.getImUserInfo({uid:c.uid,cid:c.cid},function(a){l.ownerObj=a;e.tempSessionId+=1;f.isExist(1,l,k)||(l.unread_count=k?"0":"1",e.sessionMap["1-"+l.fuser.uid]=l);g&&g()})},receiveGroupChatMsg:function(h,g){var f=h.group_id,a=h.datas;g||(g="2");var d=!0;a&&window.imCurrentUser.uid!=a.from_uid&&(d=!1);var b=$("body").data("imCacheData").sessionCacheDatas;
"7"==g&&(b=$("body").data("imCacheData").serviceSessionCacheDatas);b&&(f={session_type:g,group_id:f,session_id:b.tempSessionId,delta_flag:"0",orderType:1},a?(f.update_tm=a.msgtime,f.last_msgid=a.ser_msgid):f.update_tm=parseInt((new Date).getTime()/1E3)+"",b.tempSessionId+=1,this.isExist(g,f,d)||(f.unread_count=d?"0":"1",b.sessionMap[g+"-"+f.group_id]=f))},setSysMsgUnreadNotify:function(h,g){var f=$("body").data("imCacheData").sessionCacheDatas,a=f["4-sgroup-"+h];a?a.unread_count=g:a={session_type:"4",
group:h,delta_flag:"0",orderType:1,unread_count:g};this.isExist(4,a)||(f.sessionMap["4-sgroup-"+sessionTemp.group]=sessionTemp)},setSessionRead:function(h,g,f){var a=$("body").data("imCacheData").sessionCacheDatas;if(a.sessionMap&&g)switch(h){case "1":if(h=a.sessionMap["1-"+g])h.unread_count="0";break;case "2":if(h=a.sessionMap["2-"+g])h.remind_flag="0",h.remind_msgid="0",h.unread_count="0",a.sessionMap["2-"+g]=h;break;case "4":if(h=a.sessionMap["4-sgroup-"+g])h.unread_count=f,a.sessionMap["4-sgroup-"+
g]=h;break;case "7":if(h=a.sessionMap["7-"+g])h.remind_flag="0",h.remind_msgid="0",h.unread_count="0",a.sessionMap["7-"+g]=h}},insertSessionData:function(h,g){var f=$("body").data("imCacheData").sessionCacheDatas,a=g.session_type;"7"==a&&(f=$("body").data("imCacheData").serviceSessionCacheDatas);f.sessionMap&&h&&(f.sessionMap[a+"-"+h]=g)},setSessionTop:function(h,g,f){var a=$("body").data("imCacheData").sessionCacheDatas;if(a.sessionMap&&g)switch(h){case "1":if(h=a.sessionMap["1-"+g])h.top_status=
f;break;case "7":case "2":if(h=a.sessionMap[h+"-"+g])h.top_status=f;break;case "4":if(h=a.sessionMap["4-sgroup-"+g])h.top_status=f}},getSessionCache:function(h,g){var f=$("body").data("imCacheData").sessionCacheDatas;"7"==g&&(f=$("body").data("imCacheData").serviceSessionCacheDatas);if(f.sessionMap[h])return f.sessionMap[h]},addSessionCache:function(h){},updateSessionCache:function(h){},delSessionCache:function(h){var g=$("body").data("imCacheData").sessionCacheDatas;g.sessionMap[h]&&(g.sessionMap[h].delta_flag=
"1")},getAllMsgRemindCache:function(){return $("body").data("imCacheData").msgReminderCacheDatas.imMsgRemindMap},getMsgRemindCacheData:function(h){return $("body").data("imCacheData").msgReminderCacheDatas.imMsgRemindMap[h]},remove:function(){}});p.exports=n});
define("im/cache/imGroupCacheManager",["im/component/imChatComponent","im/component/imUtils","im/component/imContants"],function(n,s,p){var m=n("im/component/imChatComponent"),l=n("im/component/imUtils"),h=n("im/component/imContants");n=Backbone.View.extend({initialize:function(g){this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods},delegateEvents:function(){},render:function(g){},getGroupInfoUcReq:function(g,f){var a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type=
"0";var d=m.getImChatGroupCache(g);a.groups=d?[{groupId:d.id,clientUc:d.clientUc}]:[{groupId:g,clientUc:0}];this.imWebReqMethods.getGroupInfoUcReq(a,function(a){var c;if(a.message.datas){a=a.message.datas;for(var d=0;d<a.length;d++){c=a[d];var e=c.groupinfo;"100"==c.ret?c=m.getImChatGroupCache(e.group_id):(c={id:e.group_id,name:e.name,exist:"1",avatar:e.avatar,clientUc:c.uc,userNum:e.user_num,announce:e.announce,rsOnOff:e.rs_onoff,taskId:e.task_id,mask:e.mask},m.setImChatGroupCache(c.id,c))}}f&&f(c)})},
getImGroupCache:function(g,f){var a,d=m.queryImSessionCacheByKey("imChatGroupCacheMap");d&&(a=d["imChatGroup-"+g.toString()]);a?f&&f(a):(a={},a.uid=window.imCurrentUser.uid,a.cid=window.imCurrentUser.cid,a.type="0",a.groups=[{groupId:g,clientUc:"0"}],this.imWebReqMethods.getGroupInfoUcReq(a,function(a){var c=[],d=[];if(a.message.datas){a=a.message.datas;for(var e=0;e<a.length;e++){var g=a[e],h=g.groupinfo;d.push({groupId:h.group_id});"100"!=g.ret&&(g={id:h.group_id,name:h.name,hostUid:h.host_uid,
hostCid:h.host_cid,exist:"1",avatar:h.avatar,clientUc:g.uc,userNum:h.user_num,announce:h.announce,rsOnOff:h.rs_onoff,mask:h.mask},c.push(g))}g=c[0];m.setImChatGroupCacheList(c)}f&&f(g)}))},updateImGroupCache:function(g,f){if(g&&0<g.length){var a=m.getImChatGroupAllCache(),d={};g.forEach(function(b){d["groupIdArray-1"]||(d["groupIdArray-1"]=[]);var f=a["imChatGroup-"+b];f?d["groupIdArray-1"].push({groupId:b,clientUc:f.clientUc}):d["groupIdArray-1"].push({groupId:b,clientUc:"0"})});var b={};b.uid=window.imCurrentUser.uid;
b.cid=window.imCurrentUser.cid;b.type="0";b.groups=d["groupIdArray-1"];this.imWebReqMethods.getGroupInfoUcReq(b,function(a){var b=[],e=[];if(a.message.datas){a=a.message.datas;for(var d=0;d<a.length;d++){var g=a[d],h=g.groupinfo;e.push({groupId:h.group_id});"100"!=g.ret&&b.push({id:h.group_id,name:h.name,hostUid:h.host_uid,hostCid:h.host_cid,exist:"1",avatar:h.avatar,clientUc:g.uc,userNum:h.user_num,announce:h.announce,rsOnOff:h.rs_onoff,mask:h.mask})}m.setImChatGroupCacheList(b)}f&&f(b)})}},getGroupInfoListReq:function(g,
f){var a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type="0";a.groups=g;this.imWebReqMethods.getGroupInfoUcReq(a,function(a){var b=[],c=[];if(a.message.datas){a=a.message.datas;for(var g=0;g<a.length;g++){var e=a[g],h=e.groupinfo;c.push({groupId:h.group_id});"100"!=e.ret&&b.push({id:h.group_id,name:h.name,exist:"1",avatar:h.avatar,clientUc:e.uc,userNum:h.user_num,announce:h.announce,rsOnOff:h.rs_onoff,mask:h.mask})}m.setImChatGroupCacheList(b)}f&&f(c)})},kickGroupMemberReq:function(g,
f){var a=this;a.getImGroupCache(g.groupId,function(d){var b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;b.type="0";b.groupId=g.groupId;var c=b.users=g.users;a.imWebReqMethods.kickGroupMemberReq(b,function(a){d.userNum=parseInt(d.userNum);d.userNum-=c.length;var b="";c.forEach(function(a){b+="-"+a.uid});var g=[];(a=m.getImGroupMemberCache("groupMemberKeyArray-"+d.id))&&a.groupMemberKeyArray&&a.groupMemberKeyArray.forEach(function(a){var c=a.split("-")[0];1>b.indexOf(c)&&g.unshift(a)});
a.groupMemberKeyArray=g;m.setImGroupMemberCache("groupMemberKeyArray-"+d.id,a);f&&f({newImChatGroup:d,returnGroupMemberArray:g})})})},modifyAdminUsers:function(g){var f=g.adminUsers,a=g.flag;this.getImGroupCache(g.groupId,function(d){var b=m.getImGroupMemberCache("groupMemberKeyArray-"+d.id);switch(a){case "0":f.forEach(function(a){for(var d=0;d<b.groupMemberKeyArray.length;d++){var e=b.groupMemberKeyArray[d];if(-1<e.indexOf(a.uid)){m.getImChatUserCache("imChatUserNameKey-"+e).role_type="2";break}}});
break;case "1":f.forEach(function(a){for(var d=0;d<b.groupMemberKeyArray.length;d++){var e=b.groupMemberKeyArray[d];if(-1<e.indexOf(a.uid)){m.getImChatUserCache("imChatUserNameKey-"+e).role_type="1";break}}})}})},searchMemberByName:function(g,f,a){void 0!=f&&0<f.length&&(f=f.trim());g=m.getImGroupMemberCache("groupMemberKeyArray-"+g.id).groupMemberKeyArray;for(var d=[],b=[],c="0",k=0;k<g.length;k++)if(-1<g[k].indexOf(f)){var e=m.getImChatUserCache("imChatUserNameKey-"+g[k]);d.push(e);e.atmeTime&&
(b.push(e),c+=","+e.id)}b=l.sortBy(b,"atmeTime");for(k=0;k<d.length;k++)0>c.indexOf(d[k].id)&&b.push(d[k]);a&&a(b)},renderGroupMembers:function(g,f){var a=this;a.syncGroupMemberListClone(function(d){f.empty();if((d=d.message.datas)&&0<d.length){var b={};d.forEach(function(a){b[a.uid]=a});if((d=m.getImGroupMemberCache("groupMemberKeyArray-"+a.imChatGroup.id))&&d.groupMemberKeyArray&&0<d.groupMemberKeyArray.length){d=d.groupMemberKeyArray;for(var c=[],k=0;k<d.length;k++){var e=m.getImChatUserCache("imChatUserNameKey-"+
d[k]);b&&b[e.id]&&(e.role_type=b[e.id].role_type,e.add_time=b[e.id].add_time);c.push(e)}c.forEach(function(b){var c=g.clone();a.renderGroupMembersOne(b,c,f)})}}})},syncGroupMemberList:function(g,f){var a=this,d=[],b=g.groupId,c=g.forceUpdate;d.uid=window.imCurrentUser.uid;d.cid=window.imCurrentUser.cid;d.groupId=b;d.type="0";d.syncType="1";d.memberMask=h.MASK_GROUP_MEM_CID|h.MASK_GROUP_MEM_UID|h.MASK_GROUP_MEM_ROLE|h.MASK_GROUP_MEM_ADD_TIME;var k="0",e=m.getImGroupMemberCache("groupMemberKeyArray-"+
b);e&&!c?k=e.clientUc:e={};m.setImGroupMemberCache("groupMemberKeyArray-"+b,e);d.clientUc=k;a.imWebReqMethods.syncGroupMemberListReq(d,function(c){var d=[];if("0"==c.message.ret.ret){var g=c.message.server_uc,k=c.message.datas;if(k){for(c=0;c<k.length;c++){var h=k[c];d.push({uid:h.uid,cid:h.cid})}m.getBatchImUserInfo(d,function(c){a.initGroupMemberCache(b,c,g,k,f)})}else console.log("\u7fa4\u6210\u5458\u7248\u672c\u66f4\u65b0\uff0c\u6ca1\u6709\u8fd4\u56de\u8be5\u8fd4\u56de\u7684\u4eba\u5458\u6570\u636e"),
f&&f(e)}else f&&f(e)})},initGroupMemberCache:function(g,f,a,d,b){var c=m.getImGroupMemberCache("groupMemberKeyArray-"+g);c.groupMemberKeyArray||(c.groupMemberKeyArray=[]);c.clientUc=a;this.modifyGroupMemberCache2(g,f,c,d,b)},modifyGroupMemberCache2:function(g,f,a,d,b){a.groupMemberKeyArray||(a.groupMemberKeyArray=[]);a.imGroupMemberCacheMap||(a.imGroupMemberCacheMap={});var c=[],k;d&&0<d.length&&(k={},d.forEach(function(a){k[a.uid]=a}));for(var e=0;e<f.length;e++){var h=!1,l=f[e],n=l.uid+"-"+l.name+
"-"+l.pinyin;-1<a.groupMemberKeyArray.indexOf(n)||a.groupMemberKeyArray.push(n);if(k&&k[l.id])switch(k[l.id].oper_type){case "2":a.groupMemberKeyArray.remove(n),a.imGroupMemberCacheMap[n]=void 0,h=!0}if(h){var y=[];a.groupMemberKeyArray&&0<a.groupMemberKeyArray.length&&a.groupMemberKeyArray.forEach(function(a){a&&y.push(a)});a.groupMemberKeyArray=y}else h={id:l.uid,uid:l.uid,cid:l.cid,name:l.name,pinyin:l.pinyin,avatar:l.avatar,mobile:l.mobile,email:l.email,tel:l.tel},k&&k[l.id]?(h.role_type=k[l.id].role_type,
h.add_time=k[l.id].add_time):(h.role_type="1",h.add_time=(new Date).getTime().toString().substring(0,8)),m.setImChatUserCache("imUserCache-"+h.id+"-"+h.cid,h),(l=m.getImChatUserCache("imChatUserNameKey-"+n))&&l.atmeTime&&(h.atmeTime=l.atmeTime),a.imGroupMemberCacheMap[n]=h,m.setImChatUserCache("imChatUserNameKey-"+n,h),c.push(h)}if(d&&0<d.length){var r={};a.groupMemberKeyArray.forEach(function(a){var b=a.split("-");r[b[0]]=a});d.forEach(function(a){"2"==a.oper_type&&(r[a.uid]=void 0)});f=[];for(e in r)r[e]&&
f.push(r[e]);a.groupMemberKeyArray=f}m.setImGroupMemberCache("groupMemberKeyArray-"+g,a);b&&b(a)},remove:function(){}});p.exports=n});
define("im/component/imFuncPanel",["im/component/imUtils","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants");n=Backbone.View.extend({initialize:function(h){this.el="#imFuncPanel";this.targetEl=h.targetEl;this.mesData=h.mesData;this.chatType=h.chatType;this.msgType=h.msgType;this.mesData&&this.mesData.msg.typeBak&&"1"==this.mesData.msg.type.toString()&&(this.msgType=this.mesData.msg.typeBak.toString());this.sessionData=h.sessionData;this.funcType=
h.funcType;this.pointX=h.pointX;this.pointY=h.pointY;this.selectedText=h.selectedText;this.isHelper=h.isHelper;this.crmList=h.crmList;this.miniChatBoxEl="#"+l.IM_ADDRLIST_EL;this.miniChatIndexEl="#"+l.IM_ADDRLIST_EL;this.targetEl.addClass("j_ImFuncTarget");$("body").append(m.template("im.pc.component.imfuncpanel",TEAMS))},delegateEvents:function(){var h=this,g=$("body"),f=$("#imFuncPanel");g.on("click.imFuncPanel",function(a){$(a.target).hasClass("disable")||h.remove()});g.on("keyup.imFuncPanel",
function(a){27==a.which&&h.remove()});f.off("click.imFuncPanel",".j_im-openCustomer-win").on("click.imFuncPanel",".j_im-openCustomer-win",function(a){a.stopPropagation();a=$(this).data("customer");h.openCustomerWin(a);h.remove()});f.off("openCustomerWin.imFuncPanel").on("openCustomerWin.imFuncPanel",function(a,d){a.stopPropagation();h.openCustomerWin(d.customer)});f.on("closePanel.imFuncPanel",function(a){h.remove()});$("body").on("click.imFuncPanel",function(a){a=$(this);!a.hasClass("j_im-chat-func-panel")&&
1>a.parents(".j_im-chat-func-panel").length&&h.remove()});f.on("click.imFuncPanel",".j_im-chat-opt-button",function(a){a=$(this);if(!a.hasClass("disable")){var d={};switch(a.attr("type")){case "markBack":d.mesData=h.mesData;$("#"+l.IM_ADDRLIST_EL).trigger("markMsgBack",d);$("#"+l.IM_CHATWIN_EL).trigger("markMsgBack",d);break;case "maskMsg":d.mesData=h.mesData;$("#"+l.IM_CHATWIN_EL).trigger("onMaskGroupMsg",d);break;case "setSessionTop":h.sessionData.top_status="1";d.sessionData=h.sessionData;$("#"+
l.IM_ADDRLIST_EL).trigger("setSessionTop",d);break;case "cancelSessionTop":h.sessionData.top_status="0";d.sessionData=h.sessionData;$("#"+l.IM_ADDRLIST_EL).trigger("setSessionTop",d);break;case "setUnreadSession":d.sessionData=h.sessionData;$("#"+l.IM_ADDRLIST_EL).trigger("setUnreadSession",d);break;case "setMsgNoReminder":d.sessionData=h.sessionData;d.remindFlag="1";$("#"+l.IM_ADDRLIST_EL).trigger("setMsgNoReminder",d);break;case "cancelMsgNoReminder":d.sessionData=h.sessionData;d.remindFlag="0";
$("#"+l.IM_ADDRLIST_EL).trigger("setMsgNoReminder",d);break;case "imSessionDelete":d.sessionData=h.sessionData;$("#"+l.IM_ADDRLIST_EL).trigger("imSessionDelete",d);break;case "replyChatMsg":d.mesData=h.mesData;$("#"+l.IM_CHATWIN_EL).trigger("replyChatMsg",d);break;case "forwardMsg":d.mesData=h.mesData;h.mesData.msg.suid=window.imCurrentUser.uid;h.mesData.msg.scid=window.imCurrentUser.cid;h.mesData.msg.sname=window.imCurrentUser.name;switch(h.mesData.kind){case "1002":h.mesData="1001"}$("#"+l.IM_CHATWIN_EL).trigger("forwardMsg",
d)}}});f.on("contextmenu.imFuncPanel",function(a){a.stopPropagation();a.preventDefault();return!1})},render:function(){var h=$(this.el).find(".j_im-func-list");switch(this.funcType){case "chatMsg":this.renderChatBoxList(h);break;case "sessionOpt":this.renderSessionFuncList(h);break;case "customerList":this.renderCustomerList(h)}var h=this.pointY,g=this.pointX;0>$(window).height()-h-$("#imFuncPanel").height()&&(h-=$("#imFuncPanel").height());var f={};f.left=g+"px";f.top=h+"px";$("#imFuncPanel").css(f)},
renderCustomerList:function(h){if(this.crmList&&0<this.crmList.length)if(1==this.crmList.length)$(this.el).trigger("openCustomerWin.imFuncPanel",{customer:this.crmList[0]});else for(var g=0;g<this.crmList.length;g++){var f=this.crmList[g],a=$(this.el).find("#imFuncPanel-clone .j_im-chat-opt-button-clone").clone();a.removeClass("j_im-chat-opt-button-clone");a.text(f.name);a.attr("id",f.id);a.data("customer",f);a.addClass("j_im-openCustomer-win");$(this.el).removeClass("hide-im");h.append(a)}},renderChatBoxList:function(h){var g=
!0;this.mesData.from_uid&&window.imCurrentUser.uid!=this.mesData.from_uid&&(g=!1);var f=[{type:"markBack",content:"\u64a4\u56de",flag:"0"},{type:"copyMsg",content:"\u590d\u5236",flag:"1"},{type:"forwardMsg",content:"\u8f6c\u53d1",flag:"2"},{type:"replyChatMsg",content:"\u56de\u590d",flag:"3"}];if("groupChat"===this.chatType){var a=$("#im-chatwin-container").data("allowMask"),d="12"===this.mesData.msg.typeBak,b={type:"maskMsg",content:"\u5c4f\u853d",flag:"4",disable:!a||d};a?d&&(b.tip="\uff08\u5df2\u5c4f\u853d\uff09"):
(b.tip="\uff08\u6ca1\u6709\u6743\u9650\uff09",b.tooltip="\u4ec5\u7fa4\u4e3b\u548c\u7ba1\u7406\u5458\u53ef\u64cd\u4f5c");f.push(b)}if("12"===this.mesData.msg.type||"12"===this.mesData.msg.typeBak)f[0].disable=!0,f[2].disable=!0;for(a=0;a<f.length;a++)if(d=f[a],b=$(this.el).find("#imFuncPanel-clone .j_im-chat-opt-button-clone").clone(),b.removeClass("j_im-chat-opt-button-clone"),b.attr("type",d.type),b.text(d.content),d.disable&&b.addClass("disable"),d.tip&&b.text(d.content+d.tip),"maskMsg"===d.type&&
d.tooltip&&b.append(' \x3ci class\x3d"icon-info-sign" data-toggle\x3d"tooltip" data-original-title\x3d"'+d.tooltip+'"\x3e\x3c/i\x3e'),g||"0"!=d.flag)if(!g&&"groupChat"==this.chatType&&!this.isHelper||"3"!=d.flag)if("1"!=d.flag||this.renderCopyButton(b,d))$(this.el).removeClass("hide-im"),h.append(b);this.mesData&&this.mesData.msgtime&&(h=1E3*this.mesData.msgtime,864E5<(new Date).getTime()-h&&$(this.el).find(".j_im-chat-opt-button[type\x3dmarkBack]").addClass("disable").text("\u64a4\u56de\uff08\u8d85\u8fc7\u4e00\u5929\uff09"))},
renderCopyButton:function(h,g){var f=this;if("copyMsg"==g.type)switch(f.msgType){case "1":var a;f.targetEl&&0<f.targetEl.length&&(a=f.targetEl.attr("txtValueName"));h.attr("data-clipboard-text",a);f.clipboard=f.selectedText&&0<f.selectedText.length?new Clipboard(".j_im-chat-opt-button[type\x3dcopyMsg]",{text:function(){return f.selectedText}}):new Clipboard(".j_im-chat-opt-button[type\x3dcopyMsg]",{text:function(){return h.attr("data-clipboard-text")}});return!0;default:return!1}},renderSessionFuncList:function(h){if(this.sessionData){var g=
[];switch(this.sessionData.top_status){case "0":g.push({type:"setSessionTop",content:"\u7f6e\u9876"});break;case "1":g.push({type:"cancelSessionTop",content:"\u53d6\u6d88\u7f6e\u9876"});break;default:this.remove();return}"4"!=this.sessionData.session_type&&(0==this.sessionData.unread_count&&"7"!==this.sessionData.session_type&&g.push({type:"imSessionDelete",content:"\u79fb\u9664\u8be5\u4f1a\u8bdd"}),1>this.sessionData.unread_count&&g.push({type:"setUnreadSession",content:"\u6807\u8bb0\u672a\u8bfb"}));
switch(this.sessionData.reminder){case "0":g.push({type:"setMsgNoReminder",content:"\u8bbe\u7f6e\u514d\u6253\u6270"});break;case "1":g.push({type:"cancelMsgNoReminder",content:"\u53d6\u6d88\u514d\u6253\u6270"});break;default:g.push({type:"setMsgNoReminder",content:"\u8bbe\u7f6e\u514d\u6253\u6270"})}for(var f=0;f<g.length;f++){var a=g[f],d=$(this.el).find("#imFuncPanel-clone .j_im-chat-opt-button-clone").clone();d.removeClass("j_im-chat-opt-button-clone");d.attr("type",a.type);d.text(a.content);$(this.el).removeClass("hide-im");
h.append(d)}}else this.remove()},openCustomerWin:function(h){window.imEteamsJsService.ImSysMsgCBService.openSysMsgEntity({imEntity:{id:h.id,me:"customer"}})},remove:function(){this.clipboard=void 0;this.targetEl.removeClass("j_ImFuncTarget");$("body").off(".j_im-chat-func-panel");$("#imFuncPanel").off(".j_im-chat-func-panel");$("#imFuncPanel").remove()}});p.exports=n});
define("im/component/imUtils",["teams/utils","im/component/imTemplate","imi18n/i18n_lan_conf"],function(n,s,p){s=n("teams/utils");var m=n("im/component/imTemplate");n("imi18n/i18n_lan_conf");p.exports=$.extend({},s,{template:function(l,h){var g=m[l];return h?_.template(g,h):g},sortBy:function(l,h,g,f){return l.sort(function(a,d){var b=1,b=g?-1:1,c,k;if("object"===typeof a&&"object"===typeof d&&a&&d)return c=a[h],k=d[h],c===k?f?(c=a[f],k=d[f],c===k?0:typeof c===typeof k?c>k?-1*b:1*b:typeof c>typeof k?
-1*b:1*b):0:typeof c===typeof k?c>k?-1*b:1*b:typeof c>typeof k?-1*b:1*b;throw"error";})},sortGroupMember:function(l,h){var g=l.order,f=h.order,a=l.subOrder,d=h.subOrder;g||(g=99);f||(f=99);a||(a=99);d||(d=99);return g<f?-1:g>f?1:a<d?-1:a>d?1:(g=l.pinyin)?g.localeCompare(h.pinyin):1},confirmDate:function(l,h){l=l||(new Date).getTime();var g=Date.create(l),f=g.format("{MM}-{dd}"),a=g.format("{yyyy}-{MM}-{dd}"),g=g.is("today")?g.format("{HH}:{mm}"):f;return h?a:g},formatDate:function(l){l=l||(new Date).getTime();
l=Date.create(l);return l=l.is("today")?l.format("{HH}:{mm}:{ss}"):l.is("this month")?l.format("{MM}-{dd} {HH}:{mm}"):l.is("this year")?l.format("{MM}-{dd} {HH}:{mm}"):l.format("{yyyy}-{MM}-{dd} {HH}:{mm}")},replaceSpecialMark:function(l){l&&(l=l.replace(RegExp("[`~!@#$^\x26*()\x3d|{}':;'\\[\\].\x3c\x3e/?~\uff01@#\uffe5\u2026\u2026\x26*\uff08\uff09\u2014\u2014|{}\u3010\u3011\u2018\uff1b\uff1a\u201d\u201c']","gm"),""));return l},testSpecialMark:function(l){return l?RegExp("[`~!@#$^\x26*()\x3d|{}':;'\\[\\].\x3c\x3e/?~\uff01@#\uffe5\u2026\u2026\x26*\uff08\uff09\u2014\u2014|{}\u3010\u3011\u2018\uff1b\uff1a\u201d\u201c'\"]",
"gm").test(l)?!0:!1:!1},mcSlowInit:function(l){l.addClass("mc-speed");l.addClass("hide")},mcSlowIn:function(l){l.removeClass("hide");setTimeout(function(){l.addClass("mc-slow-in");$(window).resize()},300)},mcSlowOut:function(l){l.removeClass("mc-slow-in")},timeoutControll:function(l,h){if(l.hasClass("j_timeout"))return console.log("click too quick, please wait a second"),!1;l.addClass("j_timeout");setTimeout(function(){l.hasClass("j_timeout")&&l.removeClass("j_timeout")},h);return!0},jsDoAsyn:function(l){setTimeout(function(h){l(h)},
1)},queryModuleName:function(l,h){var g="";switch(l){case "task":g="\u4efb\u52a1";break;case "document":g="\u6587\u6863";break;case "customer":g="\u5ba2\u6237";break;case "workflow":g="\u5ba1\u6279";break;case "mainline":g="\u9879\u76ee";break;case "user":g="\u7528\u6237";break;case "tag":g="\u6807\u7b7e";break;case "share":g="\u5206\u4eab";break;case "workreport":g="\u62a5\u544a";break;case "formdatareport":g="\u8868\u5355\u6570\u636e";break;case "calendar":g="\u65e5\u7a0b";break;case "user":g="\u7528\u6237";
break;case "saleChance":g="\u5546\u673a";break;case "production":g="\u4ea7\u54c1";break;case "competitor":g="\u5bf9\u624b";break;case "clue":g="\u7ebf\u7d22";break;case "placard":g="\u516c\u544a";break;case "contract":g="\u5408\u540c";break;case "blog":g="\u65e5\u62a5";break;case "hrcontract":g="\u4eba\u4e8b\u5408\u540c";break;case "hruserinfo":g="\u4eba\u4e8b\u8be6\u60c5";break;case "contactRemind":g="\u8054\u7cfb\u63d0\u9192";break;case "biaoge":g="\u8868\u5355";break;case "contact":g="\u8054\u7cfb\u4eba";
break;case "agenda":g="\u65e5\u7a0b";break;case "marketactivity":g="\u5e02\u573a\u6d3b\u52a8"}if(void 0==h||0!=h)g=" \u3010"+g+"\u3011 ";return g},sortListDom:function(l,h,g){var f=$("\x3cdiv\x3e\x3c/div\x3e\x3e"),a=h.find(".j_menu-item:not(.j_im-list-locked)");a.sort(function(a,b){var c=1*a.getAttribute(l),f=1*b.getAttribute(l),e=1;g&&(e=-1);return c>f?1*e:c<f?-1*e:0});f.append(a);h.detach(".j_menu-item:not(.j_im-list-locked)");h.append(f.children())},getImPasteUrl:function(){return crmContext.remoteUploadUrl+
"/impaste.json"},getImUploadUrl:function(){return crmContext.remoteUploadUrl+"/imupload.json"},initMessage:function(l){l=l.replace(/</g,"\x26lt").replace(/>/g,"\x26gt").replace(/\r\n|\n/g," \x3cbr/\x3e");l=l.replace(/(((http:\/\/|https:\/\/|ftp:\/\/|mms:\/\/)?((\w|=|\?|\.|\/|&|-|\||,|\*|:){1,})(\.+)(com|cn|im|xin|shop|ltd|club|top|wang|xyz|site|vip|net|cc|ren|biz|red|link|mobi|info|org|com.cn|net.cn|org\.cn|gov\.cn|name|io|tt|coop|biz|aero|travel|pub|edu|CC|ink|pro|tv|kim|group|\u6211\u7231\u4f60|\u4e2d\u56fd|\u516c\u53f8|\u7f51\u7edc|\u7f51\u5740|\u96c6\u56e2)((\w|=|\?|\.|\/|&|-|\||,|\*|:|%){0,})))|(^(http:\/\/|https:\/\/|ftp:\/\/|mms:\/\/){1,}((\w|=|\?|\.|\/|&|-|\||,|\*|:){1,})(\.+)((\w|=|\?|\.|\/|&|-|\||,|\*|:|%){1,}))/g,
function(h){return h=0==h.indexOf("http")||0==h.indexOf("https")||0==h.indexOf("ftp")?"\x3ca href\x3d'"+h+"' target\x3d'_blank' \x3e"+h+"\x3c/a\x3e":"\x3ca href\x3d'http://"+h+"' target\x3d'_blank' \x3e"+h+"\x3c/a\x3e"}).replace(/\n/g,"\x3cbr /\x3e");return l=$.faceConvert(l)},changeHtmlBr:function(l){return l.replace(/<br\/>/g,"\n")},initTitle:function(l){l||(l="");l=l.replace(/</g,"\x26lt").replace(/>/g,"\x26gt").replace(/\r\n|\n/g,"");return l=$.faceConvert(l)},handleOpenUrl:function(l){0>l.indexOf("http")&&
0>l.indexOf("https")&&0>l.indexOf("ftp")?window.open("http://"+l,"_blank"):window.open(l,"_blank")},checkEmoji:function(l){return(new RegExp(SPECIAL_REGEX["im.chat.send.emoji.filter"].join("|"),"g")).test(l)?!0:!1},initUrl:function(l,h){if(!l)return h;for(var g="",f=0;f<l.length;f++){var a=$.trim(l[f]);if(!(0<=g.indexOf(a))){if(0==a.indexOf("http")||0==a.indexOf("https")||0==a.indexOf("ftp"))for(var d=h.split(a),b="",c=0;c<d.length-1;c++)b+=d[c]+'\x3ca target\x3d"_blank" href\x3d"'+a+'"\x3e'+a+"\x3c/a\x3e";
else for(d=h.split(a),b="",c=0;c<d.length-1;c++)b+=d[c]+'\x3ca target\x3d"_blank" href\x3d"http://'+a+'"\x3e'+a+"\x3c/a\x3e";h=b+d[d.length-1];g+=l[f]+"  "}}return h},getLastTxtByMsgType:function(l){var h="";switch(l){case "1":break;case "2":h="[\u56fe\u7247]";break;case "3":h="[\u8bed\u97f3]";break;case "4":h="[\u6587\u4ef6]";break;case "5":h="[\u5730\u7406\u4f4d\u7f6e]";break;case "6":h="[\u56fe\u6587\u6d88\u606f]";break;case "7":h="[\u5c0f\u89c6\u9891]";break;case "8":h="[\u4e8b\u9879\u6d88\u606f]";
break;default:h="[\u6682\u4e0d\u652f\u6301\u6b64\u6d88\u606f\u7c7b\u578b]"}return h},processMsgByType:function(l,h,g){g=!1!==g;var f;if(l)switch(l.type){case "1":h=l.dt[0].txt;f=h.v;g&&(f=this.initMessage(f));var a=h.i18n;if(a&&(g=h.kvs,window.imCacheData.i18nConfig&&!_.isEmpty(window.imCacheData.i18nConfig[a])&&(f=window.imCacheData.i18nConfig[a][window.imCurrentUser.perLang]),f&&g))for(var d in g)a=g[d],"12"===l.typeBak&&"%TIME%"===d&&(a=this.formatDate(parseInt(g[d]))),f=f.replace(d,a);f||(f=h.v);
break;case "9":case "10":case "11":h=l.dt[0].txt;(f=h.v)||(f="");g&&(f=this.initMessage(f));if(a=h.i18n)if(g=h.kvs,l=h.skv,window.imCacheData.i18nConfig&&!_.isEmpty(window.imCacheData.i18nConfig[a])&&(f=window.imCacheData.i18nConfig[a][window.imCurrentUser.perLang]),f&&g)for(d in g){var b,c=g[d];b=c;if(l&&l[d]){var k=l[d],a=$('\x3ca class\x3d""\x3e\x3c/a\x3e');a.text(c);switch(k.t.toString()){case "1":a.addClass("j_im-fastchat");(b=k.u)&&a.attr({chatType:"singleChat","user-uid":b.uid,"user-cid":b.cid,
name:c});b=a[0].outerHTML;break;case "3":a.addClass("j_im-click-entity"),(c=k.e)&&a.attr({"entity-id":c.id,name:c.name,module:c.module}),b=a[0].outerHTML}}f=f.replace(new RegExp(d,"gm"),b)}f||(f=h.v);break;default:h=l.dt[0].txt,f=h.v,g&&(f=this.initMessage(f))}else window.imCacheData.i18nConfig&&(d=window.imCacheData.i18nConfig[h])&&(f=d[window.imCurrentUser.perLang]);return f},getMsgReminderStatus:function(l,h,g){return l?(l=l[g])?l.reminder:"0":h.reminder?h.reminder:"0"},judgeUserStatus:function(l){var h=
{status:"0",dev:"0"},g=l["0"],f=l["7"],a=l["5"],d=l["6"],b=l["1"],c=l["2"];l=l["9"];for(var k=0;1>k;k++)if(g&&"0"!=g&&(h.status=g,h.dev="0"),l&&"0"!=l&&(h.status=l,h.dev="0"),f&&"0"!=f&&(h.status=f,h.dev="0"),"1"!=h.status)if(a&&"0"!=a){"2"==h.status?"1"==a&&(h.status=a,h.dev="5"):(h.status=a,h.dev="5");break}else{if("0"==h.status){if(b&&"0"!=b){h.status=b;h.dev="1";break}if(c&&"0"!=c){h.status=c;h.dev="2";break}if(d&&"0"!=d){h.status=d;h.dev="2";break}}}else break;return h},modCookie:function(l,
h,g){if("undefined"!=typeof h){g=g||{};null===h&&(h="",g.expires=-1);var f="";g.expires&&("number"==typeof g.expires||g.expires.toUTCString)&&("number"==typeof g.expires?(f=new Date,f.setTime(f.getTime()+864E5*g.expires)):f=g.expires,f="; expires\x3d"+f.toUTCString());var a=g.path?"; path\x3d"+g.path:"",d=g.domain?"; domain\x3d"+g.domain:"";g=g.secure?"; secure":"";document.cookie=[l,"\x3d",encodeURIComponent(h),f,a,d,g].join("")}else{h=null;if(document.cookie&&""!=document.cookie)for(g=document.cookie.split(";"),
f=0;f<g.length;f++)if(a=jQuery.trim(g[f]),a.substring(0,l.length+1)==l+"\x3d"){h=decodeURIComponent(a.substring(l.length+1));break}return h}},sgroupFilter:function(l){if(!l||"0"==l)return!1;var h=window.imEteamsJsService.ImRecentListCBService.notSupportSgroups,g=!0;if(h&&0<h.length)for(var f=0;f<h.length;f++)if(l==h[f]){g=!1;break}return g},isFirefox:function(){return-1<navigator.userAgent.indexOf("Firefox")?!0:!1},subStringByLength:function(l,h){if(l&&l.length>2*(h+1)){for(var g=0,f=0,a=0;a<l.length&&
!(g=0<=l.charCodeAt(a)&&255>=l.charCodeAt(a)?g+1:g+2,f+=1,g>2*h);a++);l=l.substring(0,f);l+="..."}return l},getMsgContent:function(l,h,g){return"10"===l.typeBak||"10"===l.type?(h.uid===l.suid&&(l.dt[0].txt.i18n="im.chat.b.self"),"1"===l.display&&g&&(l.dt[0].txt.kvs["%NAME%"]="["+g+"] "+l.sname),this.processMsgByType(l)):"12"===l.typeBak||"12"===l.type?(h.uid===l.suid&&(l.dt[0].txt.i18n="im.chat.mask.self"),this.processMsgByType(l)):l.dt[0].txt.i18n?this.processMsgByType(l):l.dt[0].txt.v}})});
define("im/component/atmearea",["im/component/imUtils","im/component/imChatComponent"],function(n,s,p){return function(m){(function(l,h,g){var f=n("im/component/imUtils"),a=n("im/component/imChatComponent");l.atmearea={path:"",icons:{},defaults:{button:null,buttonLabel:'\x3ci class\x3d"icon-at"\x3e\x3c/i\x3e',buttonPosition:"after",buttonClass:null,buttonParent:null,buttonRoot:null,onlyUser:!1,componentType:"target",groupId:void 0,viewModule:void 0,atmeHeight:0,atmeLeft:0,buttonChild:null,needTargetMember:!0}};
l.fn.atmearea=function(a){a=l.extend({},l.atmearea.defaults,a);return this.each(function(){var b=l(this);new c(b,a)})};var d=function(){};d.prototype.setup=function(){var a=this;this.$editor.on("focus",function(){a.hasFocus=!0});this.$editor.on("blur",function(){a.hasFocus=!1});this.setupButton()};d.prototype.atTrigger=function(){var a=this.options.atmeview;a.getFocusPos();var b=a.$input[0].selectionStart,c=a.$input[0].selectionEnd;a.areaStartIndex=b;a.areaEndIndex=c;a.$input.trigger("focusin.at");
a.insertAtMemberToArea(" @",a.$input[0],b,c);(b=this.$textarea.data("simditor"))&&b.focus();a.render();a.search("");this.$textarea.focus()};d.prototype.setupButton=function(){var a=this,c;if(this.options.button)c=l(this.options.button);else if(!1!==this.options.button)if(c=l('\x3ca href\x3d"javascript:void(0)" data-original-title\x3d"\u70b9\u51fb@\u4eba\u5458" title\x3d"" data-toggle\x3d"tooltip" data-placement\x3d"top"\x3e'),c.html(this.options.buttonLabel),null!==this.options.buttonClass?c.addClass(this.options.buttonClass):
c.addClass("emoji-button"),c.attr({title:"\u70b9\u51fb@\u4eba\u5458"}),null!==this.options.buttonRoot&&null!==this.options.buttonChild){var d="."+this.options.buttonClass;l(this.options.buttonRoot).find(this.options.buttonChild).each(function(){if(0<l(this).find(d).length)return!0;l(this).append(c);return!1})}else if(null!==this.options.buttonParent)l(this.options.buttonParent).append(c);else this.$editor[this.options.buttonPosition](c);else c=l("");c.on("click",function(c){"chat-at-component"==a.options.componentType&&
(a.options.groupId=l("#smwx_box").data("targetId"));new b(a);c.stopPropagation()});this.$button=c};var b=function(a){if(!(0<l("#imatme-area").length)){var b=this,c=l(g.body);l(h);this.visible=!1;this.atmearea=a;this.$atMenu=l('\x3cdiv id\x3d"imatme-area" class\x3d"controls atme-transition hide" style\x3d"position: absolute;z-index:9999;"\x3e'+f.template("im.pc.component.atselector")+"\x3c/div\x3e");this.$atMenu.addClass("atme-menu");this.$atMenu.find(".j_atselect-tab").removeClass("hide");a.options.onlyUser&&
this.$atMenu.find(".atselector-tab").addClass("hide");a.options.needTargetMember||this.$atMenu.find(".j_buttom-list").addClass("hide");c.append(this.$atMenu);f.layout("body .atme-menu .j_atmeMenuScr",[{gotoTopButton:!1}]);c.mouseover(function(a){a=l(a.target);0==a.closest(".atme-menu").length&&null==a.parents(".atme-menu").get(0)&&a.mousewheel(function(a,d,f,g){null!=c.find(".atme-menu").get(0)&&b.remove()})});c.on("click",function(a){a=l(a.target);0==a.closest(".atme-menu").length&&null==a.parents(".atme-menu").get(0)&&
b.remove()});this.$atMenu.on("click","p",function(a){var c=l(a.target);if(void 0==c.data("obj")){if(!c.attr("at-type")||1>c.attr("at-type").length)c=c.parents("p");"channelMember"==c.attr("at-type")&&(c.data("obj",{id:"88",name:"\u5168\u4f53\u6210\u5458",atType:"channelMember"}),c.data("atType","2"))}b.chooseAtMember(b,c);a.stopPropagation();return!1});this.$atMenu.on("keyup",".j_search",function(a){var c=l("#imatme-area");a.preventDefault();var d=a.keyCode;13==d?l(c).find("#im-atselector-container p.active").trigger("click"):
27==d?b.remove():40==d?(d=l(c).find("#im-atselector-container #im-atselector-list").find("p.active"),1>d.length?l(c).find("#im-atselector-container #im-atselector-list").find("p").first().addClass("active"):(d.removeClass("active"),0<d.next().length?(d=d.next(),l(d).hasClass("hide")&&(d=l(c).find("#im-atselector-container #im-atselector-list").find("p").first())):d.hasClass("all-user")?d=l(c).find("#im-atselector-container #im-atselector-list").find("p").first():(d=l(c).find("#im-atselector-container #im-atselector-list .j_buttom-list").find("p").first(),
d.hasClass("hide")&&(d=d.next(),d.hasClass("hide")&&(d=l(c).find("#im-atselector-container #im-atselector-list").find("p").first()))),d.addClass("active"))):38==d?(d=l(c).find("#im-atselector-container #im-atselector-list").find("p.active"),1>d.length?l(c).find("#im-atselector-container #im-atselector-list").find("p").last().addClass("active"):(d.removeClass("active"),0<d.prev().length?d.prev().hasClass("at-bottom-boder")?d=l(c).find("#im-atselector-container #im-atselector-list .j_up-list").find("p").last():
(d=d.prev(),d.hasClass("hide")&&(d=l(c).find("#im-atselector-container #im-atselector-list .j_up-list").find("p").last())):(d=l(c).find("#im-atselector-container #im-atselector-list").find("p").last(),l(d).hasClass("hide")&&(d=d.prev(),l(d).hasClass("hide")&&(d=l(c).find("#im-atselector-container #im-atselector-list .j_up-list").find("p").last()))),d.addClass("active"))):setTimeout(function(){var c=l(a.target);b.keywords=c.val();void 0!=b.keywords&&(b.keywords=b.keywords.trim());b.renderList(b,!1)},
50);a.stopPropagation()});this.$atMenu.on("click",".atselector-tab li",function(a){var c=l("#imatme-area"),d=l(a.target).attr("type");b.searchType=d;c.find(".j_search").val(void 0);b.keywords=void 0;c.find(".atselector-tab li").removeClass("active");c.find(".atselector-tab li.j_"+d+"").addClass("active");b.renderList(b,!1);a.stopPropagation();return!1});this.renderList(b,!0)}};b.prototype.chooseAtMember=function(a,b){var c=this.atmearea.options.atmeview,d=b.data("obj"),f=b.data("atType");c.getFocusPos();
var g=c.$input[0].selectionStart,h=c.$input[0].selectionEnd;c.areaStartIndex=g;c.areaEndIndex=h;c.$input.trigger("focusin.at");var l=c.$input.data("userData"),m=d.name,n="@"+m+" ",d={userId:d.id,userName:m,atIndex:0,atType:f};if(l)for(f=0;f<l.length;f++)0<=l[f].atIndex&&(l[f].atIndex+=("@"+m+" ").length);else l=[];l.push(d);c.insertAtMemberToArea(n,c.$input[0],g,h);c.$input.data("userData",l);c.$input.focus();a.remove()};b.prototype.remove=function(){l(".atme-menu .j_atmeMenuScr").hasClass("mCustomScrollbar")&&
f.destroyLayout(".atme-menu .j_atmeMenuScr");this.$atMenu.removeClass("atme-transition-open");h.setTimeout(function(){l(".atme-menu").remove()},300)};b.prototype.reposition=function(){var a=this.atmearea.$button,b=this.atmearea.options,c=a.offset();this.$atMenu.removeClass("hide");var d=l("#imatme-area #im-atselector-container"),d={height:l(h).height(),width:l(h).width()}.height-c.top-d.height();0>d&&(c.top=c.top+d-30);c.top=parseInt(c.top+"px");c.left=parseInt(c.left-a.outerWidth())+parseInt(b.atmeLeft)+
30+"px";this.$atMenu.css({top:c.top,left:c.left});this.$atMenu.addClass("atme-transition-open")};b.prototype.renderList=function(b,c){var d=b.atmearea,g=l("#imatme-area");b.searchType="employee";g.find(".atselector-tab li.j_employee").addClass("active");var m=d.options.groupId,d=b.keywords;void 0!=d&&0<d.length&&(d=d.trim(),d=d.replace(/'/g,""));for(var n=a.getImGroupMemberCache("groupMemberKeyArray-"+m).groupMemberKeyArray,m=[],r=[],p="0",v=0;v<n.length;v++)if(!d||-1<n[v].indexOf(d)){var q=a.getImChatUserCache("imChatUserNameKey-"+
n[v]);m.push(q);q.atmeTime&&(r.push(q),p+=","+q.id)}r=f.sortBy(r,"atmeTime");d=5;m&&5>m.length&&(d=m.length);for(v=0;v<d;v++)0>p.indexOf(m[v].id)&&r.push(m[v]);g.find("#im-atselector-list").addClass("hide");g.find("#im-atselector-container .loading_small").show();var s=g.find("#im-atselector-container #im-atselector-list .j_up-list");s.empty();g.find("#im-atselector-container #im-atselector-list .all-user").removeClass("active");g.find(".j_buttom-list p.j_target").addClass("hide");g.find(".j_buttom-list p.j_chat").removeClass("hide");
r&&0!=r.length?(g.find("#im-atselector-container #j_no-result").remove(),g.find("#im-atselector-list .j_buttom-list").removeClass("hide")):(g.find("#im-atselector-list .j_buttom-list").addClass("hide"),g.find("#im-atselector-list").find("p actvie").removeClass("active"),s.append('\x3cdiv id\x3d"j_no-result" class\x3d"no-result nobd"\x3e\u65e0\u641c\u7d22\u7ed3\u679c!\x3c/div\x3e'));var C=b.searchType;"employee"==C&&(C="user");_.each(r,function(a){var c=g.find("#im-atselector-container-clone-field .j_"+
b.searchType+"-list p").clone();a.username&&(a.name=a.username);c.data("obj",a);c.data("atType",C);c.attr("title",a.name);c.find("span").text(a.name);0==a.isPrivate?(c.append('\x3ci class\x3d"sys-public-mark"\x3e\u516c\u5171\x3c/i\x3e'),c.children("span").css("padding-right","30px")):c.children("span").css("padding-right","0px");a.avatar&&c.find(".avatar").attr("src","/base/download/"+a.avatar);s.append(c)});g.find("#im-atselector-list").removeClass("hide");g.find("#im-atselector-container .loading_small").hide();
0<g.find("#im-atselector-list").find("p actvie").length?(g.find("#im-atselector-list").find("p actvie").removeClass("active"),g.find("#im-atselector-list").find("p").eq(0).addClass("active")):0==g.find("#im-atselector-container #j_no-result").length&&g.find("#im-atselector-list").find("p").eq(0).addClass("active");h.setTimeout(function(){l("#imatme-area").find(".j_search").focus()},100);c&&b.reposition()};var c=function(a,b){this.options=b;"calendar"==this.options.viewModule&&(this.options.onlyUser=
!0);this.$editor=this.$textarea=a;this.setup();a.atmeareaObj=this};(function(a,b){"undefined"!==typeof a&&a||(a={});if("object"===typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a})(c.prototype,d.prototype)})(jQuery,window,document)}});
define("im/component/imCommonRender",["im/component/imUtils","im/component/imContants"],function(n,s,p){n("im/component/imUtils");n("im/component/imContants");p.exports={renderUserStatus:function(m,l){l.removeClass("offline");switch(m.status){case "0":l.addClass("offline");l.attr("data-original-title","\u8be5\u7528\u6237\u4e0d\u5728\u7ebf");break;case "1":if(-1<["0","5","7","9"].indexOf(m.dev))l.addClass("pc"),l.attr("data-original-title","\u7535\u8111\u7aef\u5728\u7ebf");else switch(l.addClass("mobile"),
m.dev){case "1":var h={zh_cn:"android\u79fb\u52a8\u7aef\u5728\u7ebf",zh_tw:"android\u79fb\u52d5\u7aef\u5728\u7dda",en_us:"android online"};l.attr("title",h[window.imCurrentUser.perLang]);break;case "2":h={zh_cn:"iphone\u79fb\u52a8\u7aef\u5728\u7ebf",zh_tw:"iphone\u79fb\u52d5\u7aef\u5728\u7dda",en_us:"iphone online"};l.attr("data-original-title",h[window.imCurrentUser.perLang]);break;default:l.attr("data-original-title","\u7528\u6237\u79fb\u52a8\u7aef\u5728\u7ebf")}break;case "2":switch(m.dev){case "5":h=
{zh_cn:"\u7528\u6237\u7684web\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",zh_tw:"The user's web client is left",en_us:"\u7528\u6236\u7684web\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"};l.attr("title",h[window.imCurrentUser.perLang]);break;default:h={zh_cn:"\u7528\u6237\u7684\u7535\u8111\u7aef\u5904\u4e8e\u79bb\u5f00\u72b6\u6001",zh_tw:"The user's computer terminal is left",en_us:"\u7528\u6236\u7684\u96fb\u8166\u7aef\u8655\u65bc\u96e2\u958b\u72c0\u614b"}}l.attr("data-original-title",h[window.imCurrentUser.perLang]);
l.addClass("leave");break;case "8":l.attr("data-original-title","\u7528\u6237\u79bb\u7ebf\u4f46\u53ef\u4ee5\u63a5\u6536\u5230\u79bb\u7ebf\u6d88\u606f\u63a8\u9001"),l.addClass("push")}}}});
define("im/component/mapWindowView",["im/component/imUtils"],function(n,s,p){var m=n("im/component/imUtils");s=Backbone.View.extend({initialize:function(l){this.el=l.container||"#im-mapwindow-modal";this.userId=l.userId||window.imCurrentUser.uid;this.longitude=l.longitude||116.404287;this.latitude=l.latitude||39.914889;this.address=l.address||null;this.level=l.level||11;$("body").append(m.template("im.pc.component.mapwindow",TEAMS))},delegateEvents:function(){var l=this,h=$(l.el);h.on("hidden.bs.modal.imMapWindow",
function(g){l.remove()});h.on("shown.bs.modal.imMapWindow",function(g){l.renderMap(l.longitude,l.latitude,l.address,l.level,l.address?!0:!1)});h.on("click.imMapWindow","#im-mapwindow-close",function(g){h.modal("hide")})},render:function(){$(this.el).modal()},renderMap:function(l,h,g,f,a){var d=this;window.HOST_TYPE="2";window.BMap_loadScriptTime=(new Date).getTime();n.async(["https://api.map.baidu.com/getscript?v\x3d2.0\x26ak\x3dlZVLz80fXoVh3VVsN5ChL6bb\x26services\x3d\x26t\x3d"+TEAMS.version],function(){var b=
new BMap.Map("j_mapArea",{enableMapClick:!1});new BMap.Geocoder;var c=new BMap.Point(l,h);b.centerAndZoom(c,f);b.enableDragging();b.enableScrollWheelZoom();a&&d.addMarker(b,c,g,!0)})},addMarker:function(l,h,g,f){var a=new BMap.Marker(h);g=new BMap.InfoWindow(g,{offset:new BMap.Size(-4,-14),enableCloseOnClick:!1});a.infoWindow=g;l.clearOverlays();l.addOverlay(a);f&&l.openInfoWindow(g,h);$("#loading").hide()},remove:function(){$(this.el).modal("hide");$(".modal-backdrop").remove();$(this.el).off(".imMapWindow");
$(this.el).remove()}});p.exports=s});
define("im/component/imRecentListComponent",["im/component/imUtils","im/component/imChatComponent","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imChatComponent"),h=n("im/component/imContants");n=Backbone.View.extend({initialize:function(g){this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods},delegateEvents:function(){},syncLastSingleMsg:function(g,f){var a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.order="desc";for(var d=
[],b=0;b<g.length;b++)d.push({fromCid:g[b].cid,fromUid:g[b].uid,maxNum:"1"});a.syncMsgUsers=d;this.imWebReqMethods.syncSingleMsgReq(a,function(a){f&&f(a)})},syncLastGroupMsg:function(g,f){var a=g.groupIdArray,d=g.isHelper,b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;b.order="desc";for(var c=[],k=0;k<a.length;k++)c.push({groupId:a[k],maxNum:"1"});b.datas=c;this.imWebReqMethods[d?"syncHelperGroupMsgReq":"syncGroupMsgReq"](b,function(a){f&&f(a)})},syncGroupListByPageReq:function(g,
f){g||(g={});g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;g.type="0";g.pageSize="11";this.imWebReqMethods.syncGroupListByPageReq(g,function(a){f&&f(a)})},getSessionByPageReq:function(g,f){g||(g={});g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;this.imWebReqMethods.getSessionByPageReq(g,function(a){f&&f(a)})},getSessionByGroupReq:function(g,f){g||(g={});g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;this.imWebReqMethods.getSessionByGroupReq(g,function(a){f&&
f(a)})},getGroupInfoReq:function(g,f){var a=l.getImChatGroupCache("imChatGroup-"+g);if(a)f&&f(a);else{a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type="0";a.mask=h.MASK_GROUP_ID|h.MASK_GROUP_NAME|h.MASK_GROUP_TYPE|h.MASK_GROUP_USER_NUM|h.MASK_GROUP_EXIST;var d=[];d.push(g);a.groupIdList=d;this.imWebReqMethods.getGroupInfoReq(a,function(a){if(a.message.datas){a=a.message.datas[0];var c={id:a.group_id,name:a.name,exist:a.exist,userNum:a.user_num,announce:a.announce,rsOnOff:a.rs_onoff,
mask:a.mask};l.setImChatGroupCache("imChatGroup-"+g,c)}f&&f(c)})}},getGroupInfoListReq:function(g,f){var a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type="0";a.groups=g;this.imWebReqMethods.getGroupInfoUcReq(a,function(a){var b=[],c=[];if(a.message.datas){a=a.message.datas;for(var g=0;g<a.length;g++){var e=a[g],h=e.groupinfo;c.push({groupId:h.group_id});"100"!=e.ret&&b.push({id:h.group_id,name:h.name,exist:"1",avatar:h.avatar,clientUc:e.uc,userNum:h.user_num,announce:h.announce,
rsOnOff:h.rs_onoff,mask:h.mask})}l.setImChatGroupCacheList(b)}f&&f(c)})},getGroupInfoUcReq:function(g,f){var a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.type="0";var d=l.getImChatGroupCache(g);a.groups=d?[{groupId:d.id,clientUc:d.clientUc}]:[{groupId:g,clientUc:0}];this.imWebReqMethods.getGroupInfoUcReq(a,function(a){var c;if(a.message.datas){a=a.message.datas;for(var d=0;d<a.length;d++){c=a[d];var e=c.groupinfo;"100"==c.ret?c=l.getImChatGroupCache(e.group_id):(c={id:e.group_id,
name:e.name,exist:"1",avatar:e.avatar,clientUc:c.uc,userNum:e.user_num,announce:e.announce,rsOnOff:e.rs_onoff,mask:e.mask},l.setImChatGroupCache(c.id,c))}}f&&f(c)})},getSysMsgGroupSubtitle:function(g,f){g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;g.dev=window.imClientDev;g.flag="0";for(var a=g.sysMsgGroupArray,d=[],b=0;b<a.length;b++){var c=a[b];d.push({msgType:{group:c.sgroup},maxNum:"1",flag:"0",start:c.msgId})}g.datas=d;g.order="desc";this.imWebReqMethods.syncSysMsgReq(g,f)},
loadMembers:function(g,f){$.ajax({type:"post",url:"/base/employee/pageQuery.json",dataType:"json",data:g,success:function(a){f&&f(a)}})},queryChatUserByName:function(g,f){$.ajax({type:"post",url:"/base/employee/pageQuery.json",dataType:"json",data:g,success:function(a){f&&f(a)}})},searchChatGroupByName:function(g,f){g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;g.name=g.queryName;g.mask=h.MASK_USER_GROUP_ID|h.MASK_USER_GROUP_NAME|h.MASK_USER_GROUP_TYPE;this.imWebReqMethods.searchGroupReq(g,
function(a){f&&f(a)})},initRecentListReceiveFunc:function(g){this.imWebReqMethods.setImPortalSysMsgReceiveMethod(g)},deleteRecentItem:function(g,f){g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;this.imWebReqMethods.deleteSessionReq(g,function(a){f&&f(a)})},getSysMsgSessionRequest:function(g,f){g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;this.imWebReqMethods.getSessionRequest(g,function(a){f&&f(a)})},setSessionTop:function(g,f){g.uid=window.imCurrentUser.uid;g.cid=
window.imCurrentUser.cid;g.info={sessionType:"2",groupId:g.groupId};g.dev=window.imClientDev;this.imWebReqMethods.setSessionReq(g,function(a){f&&f(a)})},setUnreadSession:function(g,f){var a={};a.uid=window.imCurrentUser.uid;a.cid=window.imCurrentUser.cid;a.flag="2";a.info={sessionType:g.session_type,tuid:g.tuid,tcid:g.tcid,groupId:g.group_id,group:g.group,fuser:g.fuser,topStatus:g.top_status,deltaFlag:g.delta_flag,sessionId:g.session_id,unreadCount:g.unread_count,updateTm:g.update_tm,remindFlag:g.remind_flag,
remindMsgId:g.remind_msgid,lastMsgId:g.last_msgid,title:g.title};a.dev=window.imClientDev;this.imWebReqMethods.setSessionReq(a,function(a){f&&f(a)})},renderUserStatus:function(g,f){g.uid=window.imCurrentUser.uid;g.cid=window.imCurrentUser.cid;this.imWebReqMethods.getStatusReq(g,function(a){a=a.message.infos;var d=[];if(a&&0<a.length){for(var b=0;b<a.length;b++){for(var c=a[b],g=c.dev_infos,e={},h=0;h<g.length;h++){var l=g[h];e[l.dev]=l.status}g=m.judgeUserStatus(e);d.push({user:c.user,status:g.status,
dev:g.dev})}f&&f(d)}})},remove:function(){}});p.exports=n});
define("im/component/imUserSelectorPanel",["im/component/imUtils","im/component/imChatComponent","im/component/imContants","im/component/imRecentListComponent","im/component/imCommonModel"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imChatComponent"),h=n("im/component/imContants"),g=n("im/component/imRecentListComponent"),f=n("im/component/imCommonModel");n=Backbone.View.extend({initialize:function(a){this.userId=window.imCurrentUser.uid;this.selectType=a.selectType;this.limitUserCount=
a.limitUserCount;this.tabs=a.tabs;this.componentType=a.componentType;this.componentType||(this.componentType=0);this.defaultCreateObjArray=a.defaultCreateObjArray;this.selectedObjArray=a.selectedObjArray;this.selectedObjArray||(this.selectedObjArray=[]);this.confirmFunc=a.confirmFunc;this.entity=a.entity;this.el="#"+h.IM_USER_SELECTOR_PANEL_MODAL;this.wheelPageUnlLocked=!0;this.autoTurnPageCount=1;this.chatIndexType="session";this.groupIndexType="group";this.orgPageNo=this.addressPageNo=1;this.orgPageSize=
40;this.pageDeptId;this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;this.imSessionCacheManager=window.imCacheData.imSessionCacheManager;this.imGroupCacheManager=window.imCacheData.imGroupCacheManager;this.imChatGroup=a.imChatGroup;this.existUsers=a.existUsers;this.imRecentListComponent=new g({});$("body").append(m.template("im.component.imuserselectorpanel"));$(this.el).find(".j_main-content").append(m.template("im.component.imuserselector")).removeClass("hide");$(this.el).addClass("im-groupadd-modal")},
delegateEvents:function(){var a=this,d=$(a.el);d.off("click.ImUserSelectPanel",".j_im-addrlist-tab").on("click.ImUserSelectPanel",".j_im-addrlist-tab",function(b,c){b.stopPropagation();var f=$(this);f.find("div").hasClass("active")||(d.find(".j_im-addrlist-tab div").removeClass("active"),f.find("div").addClass("active"),f=f.attr("type"),a.renderByTab(f))});$("body").off("click.ImUserSelectPanel").on("click.ImUserSelectPanel",function(b){b=$(b.target);"im-frame-container"==b.attr("id")||0<b.parents("#im-frame-container").length||
b.hasClass("j_im-userselector-modal-show")||0<b.parents(".j_im-userselector-modal-show").length||b.hasClass("j_closeImSelectorPanel")||0<b.parents(".j_closeImSelectorPanel").length||a.close()});d.off("click.ImUserSelectPanel",".j_returnGroupDetail").on("click.ImUserSelectPanel",".j_returnGroupDetail",function(b){a.close()});d.off("click.ImUserSelectPanel",".j_confirm-button").on("click.ImUserSelectPanel",".j_confirm-button",function(b){0==a.selectedObjArray.length?m.notify("\u8bf7\u5148\u9009\u62e9\u4eba\u5458\u518d\u70b9\u51fb\u786e\u5b9a"):
(a.confirmFunc(a.selectedObjArray),a.close())});d.off("click.ImUserSelectPanel",".j_cancel-button").on("click.ImUserSelectPanel",".j_cancel-button",function(b){a.close()});d.off("click.ImUserSelectPanel",".j_im-select-item").on("click.ImUserSelectPanel",".j_im-select-item",function(b){b.stopPropagation();b=$(this);b.find(".j_opt").hasClass("hide-im")||(b.hasClass("selected")?a.removeObjInSelect(b.attr("id")):a.addObjToSelect(b),a.markCheckAll(b.parents(".j_im-select-left-list")))});d.off("click.ImUserSelectPanel",
".j_remove-select").on("click.ImUserSelectPanel",".j_remove-select",function(b){b.stopPropagation();b=$(this).parents(".j_im-select-item");a.removeObjInSelect(b.attr("id"))});$("body").on("keydown.ImUserSelectPanel",function(a){27==a.which&&container.find("img.avatar-img").imgAreaSelect({instance:!0}).cancelSelection()});d.off("click.ImAddrList",".j_im-clear-search-value").on("click.ImAddrList",".j_im-clear-search-value",function(b,c){b.stopPropagation();b.preventDefault();var d=$(this),e=$(a.el).find(".j_im-member-search-input");
e.val("");e.text("");d.css("display","none");var d=$(a.el).find(".j_selectorSearch-container"),e=$(a.el).find(".j_im-addr-user-list"),f=$(a.el).find(".j_im-addrlist-tab-container");e.removeClass("hide-im");f.removeClass("hide-im");d.addClass("hide-im");a.returnMemberList();a.checkExistChatObj()});d.off("click.ImUserSelectPanel",".j_im-member-search-input").on("click.ImUserSelectPanel",".j_im-member-search-input",function(b,c){b.stopPropagation();b.preventDefault();$(a.el).find(".j_im-clear-search-value").css("display",
"block")});d.off("keyup.ImUserSelectPanel",".j_im-member-search-input").on("keyup.ImUserSelectPanel",".j_im-member-search-input",function(b){var c=$(this),c=$.trim(c.val()),d=$(a.el).find(".j_selectorSearch-container"),e=$(a.el).find(".j_im-addr-user-list"),f=$(a.el).find(".j_im-addrlist-tab-container");0<c.length&&(e.addClass("hide-im"),d.removeClass("hide-im"),f.addClass("hide-im"),a.renderSearchList(c));b=b.keyCode;8!=b&&46!=b||0!=c.length||(e.removeClass("hide-im"),f.removeClass("hide-im"),d.addClass("hide-im"),
a.returnMemberList(),a.checkExistChatObj())});d.off("click.ImUserSelectPanel",".j_im-org").on("click.ImUserSelectPanel",".j_im-org",function(b){b.stopPropagation();b.preventDefault();b=$(this).data("corp-data");b.name=b.nodeObj.name;a.addOrgIndex(b,!0);a.spreadOrgList(void 0,function(){a.spreadOrgUserList(!1)})});d.off("click.ImUserSelectPanel",".j_im-entity-participants").on("click.ImUserSelectPanel",".j_im-entity-participants",function(b){b.stopPropagation();b.preventDefault();$(this);a.spreadParticipantList()});
d.off("click.ImUserSelectPanel",".j_im-org-list-return").on("click.ImUserSelectPanel",".j_im-org-list-return",function(b){b.stopPropagation();b.preventDefault();a.returnOrgList()});d.off("click.ImUserSelectPanel",".j_choose-org-index").on("click.ImUserSelectPanel",".j_choose-org-index",function(b){b.stopPropagation();b.preventDefault();a.orgPageNo=1;a.autoTurnPageCount=1;var c=$(this).parents(".j_org-item").data("orgData");$(a.el).find(".j_im-org-header .j_im-org-tree").find("#"+c.id).nextAll().detach();
a.pageDeptId=c.id;c.hasSubs?a.spreadOrgList(c.id,function(){a.spreadOrgUserList(c.id,!1)}):a.spreadOrgUserList(c.id)});d.off("click.ImUserSelectPanel",".j_org-department").on("click.ImUserSelectPanel",".j_org-department",function(b){b.stopPropagation();b.preventDefault();b=$(this).parents(".j_im-selectdept");var c=b.attr("id"),d=b.attr("sub-type"),e=b.data("org");e.name=e.nodeObj.name;a.addOrgIndex(e);switch(d){case "user":a.spreadOrgUserList(c,!0);break;case "department":a.spreadOrgList(c,function(){a.spreadOrgUserList(e.id,
!1)})}});d.off("click.ImUserSelectPanel",".j_group-member-level").on("click.ImUserSelectPanel",".j_group-member-level",function(b){b.stopPropagation();b.preventDefault();b=$(this).parents(".j_im-selectgroup").data("imChatGroup");a.addOrgIndex(b,!0);a.spreadGroupMemberList(b,!0)});d.off("click.ImUserSelectPanel",".j_selector-checkall").on("click.ImUserSelectPanel",".j_selector-checkall",function(b){b.stopPropagation();b.preventDefault();var c=$(this),d;switch(a.chatIndexType){case "org":d=$(a.el).find(".j_im-org-select-container .j_im-org-select-list")}"member"==
a.groupIndexType&&(d=$(a.el).find(".j_im-groupmember-select-container .j_im-groupmember-select-list"));if(c.hasClass("selected")){if(d&&0<d.length&&(b=d.find(".j_im-select-item"))&&0<b.length)for(var e=0;e<b.length;e++){var f=$(b[e]);a.removeObjInSelect(f.attr("id"))}c.removeClass("selected")}else b=function(){var b=d.find(".j_im-select-item");if(b&&0<b.length)if(a.selectedObjArray.length+b.length>a.limitUserCount)m.notify("\u8d85\u51fa\u9009\u62e9\u4e0a\u9650");else{for(var e=$(a.el).find(".j_im-selected-list"),
f=0;f<b.length;f++){var g=$(b[f]);0<e.find("#"+g.attr("id")).length||a.addObjToSelect(g)}c.addClass("selected")}},d&&0<d.length&&("org"==a.chatIndexType?a.autoTurnOrgPage(b):b())})},renderByTab:function(a,d){$(this.el).find(".j_selector-checkall").addClass("hide-im");this.wheelPageUnlLocked=!0;this.chatIndexType=a;this.autoTurnPageCount=this.orgPageNo=this.addressPageNo=1;switch(a){case "session":this.renderRecentSessions();break;case "user":this.syncAndRenderAddrUserList();break;case "group":this.syncAndRenderAddrGroupList();
break;case "org":this.syncAndRenderOrganization();break;case "entity":this.syncAndRenderEntity()}},render:function(){var a=this,d=$(a.el);d.modal({keyboard:!1,backdrop:"static"});d.find(".j_im-addrlist-tab-container").removeClass("hide-im");d.find(".j_im-addr-user-list").removeClass("hide-im");if(a.tabs){d.find(".j_im-addrlist-tab-container .j_im-addrlist-tab").addClass("hide-im");var b=a.tabs[0];a.tabs.forEach(function(a){d.find(".j_im-addrlist-tab-container .j_im-addrlist-tab[type\x3d"+a+"]").removeClass("hide-im")});
a.renderByTab(b)}else a.defaultCreateObjArray&&0<a.defaultCreateObjArray.length&&a.defaultCreateObjArray.forEach(function(b){a.addObjToSelect(void 0,b)}),a.renderRecentSessions();$(a.el).find(".j_selector-list .j_limit-count").text(a.selectedObjArray.length+"/"+a.limitUserCount);m.layout(a.el+" .j_im-addr-user-list-scroll",{whileScrolling:function(){a.mcsTopPct=this.mcs.topPct;90<a.mcsTopPct&&a.wheelPageUnlLocked&&(a.wheelPageUnlLocked=!1,a.turnPage(function(){a.wheelPageUnlLocked=!0}))}},[{scrollInertia:500,
mouseWheel:{scrollAmount:300},gotoTopButton:!1}]);d.find(".j_selectorMainScr").attr("height","462");m.layout(a.el+" .j_selector-list.j_selectorMainScr",[{scrollInertia:500,gotoTopButton:!1,mouseWheel:{scrollAmount:350}}]);m.layout(a.el+" .j_im-addrlist-select-container .j_selectorSearch-container",[{scrollInertia:500,gotoTopButton:!1,mouseWheel:{scrollAmount:350}}]);d.find(".j_im-groupmember-select-container").attr("height","410");m.layout(a.el+" .j_im-groupmember-select-container",[{scrollInertia:500,
gotoTopButton:!1,mouseWheel:{scrollAmount:350}}]);d.find(".j_im-org-select-container").attr("height","410");m.layout(a.el+" .j_im-org-select-container",{whileScrolling:function(){a.mcsTopPct=this.mcs.topPct;90<a.mcsTopPct&&a.wheelPageUnlLocked&&(a.wheelPageUnlLocked=!1,a.turnPage(function(){a.wheelPageUnlLocked=!0}))}},[{scrollInertia:500,gotoTopButton:!1,mouseWheel:{scrollAmount:350}}])},turnPage:function(a){switch(this.chatIndexType){case "user":this.addressPageNo&&(this.addressPageNo+=1,this.turnPageAddressList(a));
break;case "group":this.indexGroupTurnPage(a);break;case "session":this.turnPageRecentList(a);break;case "org":this.turnPageOrgUserList(a)}},turnPageRecentList:function(a){var d=this,b={sessionType:"0"};b.sessionId=d.minSessionId;b.pageSize=10;d.imSessionCacheManager.turnPage(b,function(b){d.turnPageRecentSessions(b.sessionArray);a&&a()})},turnPageRecentSessions:function(a){var d=$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container"),b;if(a&&0<a.length){this.minSessionId=
a[a.length-1].session_id;for(var c={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]},f={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]},e=0;e<a.length;e++)b=this.renderRecentSessionOne(a[e],d,d,c,f);this.renderSessionNameTitle(b,d);this.checkExistChatObj()}},turnPageAddressList:function(a){var d=this,b={};b.pageNo=d.addressPageNo;b.pageSize=20;b["employee.status"]="normal";b["employee.extra"]=!1;b.isContainsSub=!0;var c=$(d.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container");
d.imRecentListComponent.loadMembers(b,function(b){d.renderAddressList(b,c);a&&a()})},turnPageOrgUserList:function(a){var d=this,b=$(d.el),c=b.find(".j_im-org-select-container"),g=c.find(".j_im-org-select-list");d.orgPageNo+=1;var e={};e.pageNo=d.orgPageNo;e.pageSize=d.orgPageSize;e["employee.status"]="normal";e["employee.department"]=d.pageDeptId;e["employee.extra"]=!1;e.isContainsSub=!1;e.type="department";f.loadMembers(e,function(b){d.renderOrgUserList(b.page.result,g);a&&(a(),b.page.hasNext||(d.wheelPageUnlLocked=
!1))});b=500-b.find(".j_im-org-header").height();c.height(b)},indexGroupTurnPage:function(a){var d=this,b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;b.type="0";b.pageSize="20";b.addTime=d.pageDownAddTime;var c=$(d.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container ul");d.imWebReqMethods.syncGroupListByPageReq(b,function(b){(b=b.message.datas)&&0<b.length&&(b=m.sortBy(b,"add_time"),d.pageDownAddTime=b[b.length-1].add_time,d.renderIndexGroupList(b,
c),19<b.length&&a&&a())})},renderIndexGroupList:function(a,d){if(a&&0<a.length){for(var b=[],c=0;c<a.length;c++){var f=a[c];b.push({groupId:f.group_id});this.renderIndexGroupListOne(f,d)}this.checkExistChatObj()}},renderAddressList:function(a,d){for(var b=a.page,c=0;c<b.result.length;c++)this.renderAddressOne(b.result[c],d);d.attr("pageNo",this.addressPageNo);this.checkExistChatObj()},renderRecentSessions:function(a){var d=this;d.imSessionCacheManager.render(function(b){d.renderRecentSessionsView(b.sessionArray,
!0,b.msgReminderCacheDatas);a&&a()})},renderRecentSessionsView:function(a,d,b){var c=$(this.el),f=$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container");f.empty();c=c.find("#im-userselector-modal-clone-field #im-pinyin-clone").clone().attr("id","session");f.append(c);var c=f.clone(),e;$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").removeClass("hide-im");if(a&&0<a.length){this.minSessionId=a[a.length-1].session_id;for(var g={userArray:[],
groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]},h={userArray:[],groupIdArray:[],sysMsgGroupArray:[],uidArray:[],sgroupIdArray:[]},l=0;l<a.length;l++)e=this.renderRecentSessionOne(a[l],c,f,g,h,b);d&&(a=this.sortRecentListDom(c.find("ul")),f.find("ul").append(a.children()));0<f.find(".j_im-select-li").length&&$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").addClass("hide-im");this.renderSessionNameTitle(e,f);this.checkExistChatObj()}},renderSessionNameTitle:function(a,
d){this.renderSingleChatUser(a.idArrayObj.userArray,d);this.renderGroupChat(a.idArrayObj.groupIdArray,d)},renderSingleChatUser:function(a,d){var b=this;l.getBatchImUserInfo(a,function(a){for(var f=[],e=0;e<a.length;e++){var g=a[e];b.imSessionCacheManager.markSessionOwner("1-"+g.uid,g);f.push(g);var h=$('\x3cdiv id\x3d"'+g.uid+'"\x3e\x3c/div\x3e');b.renderRecentSingleChatOne(h,g,void 0,d,!0)}l.setImChatUserCacheList(f)})},renderGroupChat:function(a,d){var b=this;if(a&&0<a.length){var c=l.getImChatGroupAllCache(),
f={},e=1;a.forEach(function(a){f["groupIdArray-"+e]||(f["groupIdArray-"+e]=[]);var g=c["imChatGroup-"+a];if(g){b.imSessionCacheManager.markSessionOwner("2-"+g.id,g);var h=$('\x3cdiv id\x3d"'+g.id+'"\x3e\x3c/div\x3e');b.renderRecentGroupChatOne(h,g,d,!0);f["groupIdArray-"+e].push({groupId:a,clientUc:g.clientUc})}else f["groupIdArray-"+e].push({groupId:a,clientUc:"0"});10==f["groupIdArray-"+e].length&&e++});for(var g=1;g<=e;g++){var h=f["groupIdArray-"+g];h&&0<h.length&&b.imRecentListComponent.getGroupInfoListReq(h,
function(a){for(var c=l.getImChatGroupAllCache(),e=0;e<a.length;e++){var f=c["imChatGroup-"+a[e].groupId];b.imSessionCacheManager.markSessionOwner("2-"+f.id,f);var g=$('\x3cdiv id\x3d"'+f.id+'"\x3e\x3c/div\x3e');b.renderRecentGroupChatOne(g,f,d,!0)}(!a||1>a.length)&&console.log("null group")})}}},renderRecentSessionOne:function(a,d,b,c,f,e){var g=this;b=$(g.el);var h=b.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone();h.addClass("im-cp");e=a.session_type;switch(e){case "2":h=
b.find("#im-userselector-modal-clone-field #im-selectgroup-clone").clone()}h.data("data",a);h.attr("last-msg-id",a.last_msgid);h.attr("order",100);"1"==a.top_status&&(h.attr("order",8),h.addClass("j_im-in-session-top"),h.addClass("list-item-stick"));a.orderType&&h.attr("order",9);a&&0<a.unread_count&&h.attr("order",10);switch(e){case "1":h.addClass("j_im-singleChat");e=a.fuser;if("10000"==e.uid||window.imCurrentUser.uid==e.uid&&window.imCurrentUser.cid==e.cid)return{idArrayObj:c,titleArrayObj:f};
b=e.uid;c.uidArray.push(b);c.userArray.push({uid:e.uid,cid:e.cid});a.ownerObj?g.renderRecentSingleChatOne(h,a.ownerObj,void 0,d):l.getImUserInfo({uid:e.uid,cid:e.cid},function(b){a.ownerObj=b;g.renderRecentSingleChatOne(h,a.ownerObj,void 0,d)});break;case "2":h.addClass("j_im-groupChat");b=a.group_id;"1"==a.remind_flag&&h.find(".j_atme").removeClass("hide-im");c.groupIdArray.push(a.group_id);a.ownerObj&&g.renderRecentGroupChatOne(h,a.ownerObj,d);break;default:return{idArrayObj:c,titleArrayObj:f}}h.attr("id",
b);a.orderType&&h.attr("order",9);"1"==a.top_status?(h.attr("order",8),h.addClass("j_im-in-session-top"),h.addClass("list-item-stick")):h.removeClass("list-item-stick");1>d.find("#"+b).length&&"0"==a.delta_flag&&d.find("ul").append(h);return{idArrayObj:c,titleArrayObj:f,$clone:h}},sortRecentListDom:function(a){var d=$("\x3cdiv\x3e\x3c/div\x3e\x3e");a=a.find(".j_im-select-li:not(.j_im-list-locked)");a.sort(function(a,c){var d=1*a.getAttribute("order"),e=1*c.getAttribute("order"),f=1,f=-1;if(d>e)return-1*
f;if(d<e)return 1*f;if(d==e){d=a.getAttribute("last-msg-id");e=c.getAttribute("last-msg-id");if(d>e)return 1*f;if(d<e)return-1*f}return 0});d.append(a);return d},syncAndRenderAddrUserList:function(){var a=this,d={};d.pageNo=a.addressPageNo;d.pageSize=20;d["employee.status"]="normal";d["employee.extra"]=!1;d.isContainsSub=!0;var b=$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container");b.empty();a.imRecentListComponent.loadMembers(d,function(c){$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").removeClass("hide-im");
var d=[];c=c.page;if(0<c.result.length&&(1!=c.result.length||c.result[0].id!=window.imCurrentUser.uid)){$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").addClass("hide-im");for(var e=0;e<c.result.length;e++){var f=c.result[e];d.push({uid:f.id,cid:window.imCurrentUser.cid});a.renderAddressOne(f,b);a.checkExistChatObj()}}})},renderAddressOne:function(a,d){var b=$(this.el),c;if(a.id!=window.imCurrentUser.uid){var f=$.trim(a.pinyin);f&&0<f.length?(c=f.substring(0,1).toLocaleUpperCase(),
/[a-zA-Z]$/.test(c)||(c="degit")):c="degit";var e="pinyin-"+c,f=d.find("#"+e);c&&1>f.length&&(f=b.find("#im-userselector-modal-clone-field #im-pinyin-clone").clone().attr("id",e),f.removeClass("hide"),f.find(".j_index").text(c),f.find(".j_index").removeClass("hide-im"),"degit"==c&&f.find(".j_index").text("#"),d.append(f));b=b.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone().attr("id",a.id);b.addClass("im-cp");c={id:a.id,uid:a.id,cid:window.imCurrentUser.cid,name:a.name,avatar:a.avatar};
b.data("imChatUser",c);b.data("chatType","singleChat");b.find(".j_name").text(c.name).attr("title",c.name);c.avatar&&c.avatar.p5&&(e="/base/download/"+c.avatar.p5,b.find(".j_avatar").attr("src",e),c.imgSrc=e);b.attr({id:c.uid,"data-entity":"employee"});f&&f.find(".j_user-list").append(b)}},syncAndRenderAddrGroupList:function(){var a=this,d=$(a.el),b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;b.type="0";b.pageSize="20";var c=$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container"),
d=d.find("#im-userselector-modal-clone-field #im-pinyin-clone").clone().attr("id","group");c.empty();c.append(d);a.imWebReqMethods.syncGroupListByPageReq(b,function(b){$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").removeClass("hide-im");b=b.message.datas;var d=c.find("ul");d.empty();b&&0<b.length?($(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").addClass("hide-im"),b=m.sortBy(b,"add_time"),a.pageDownAddTime=b[b.length-1].add_time,a.renderIndexGroupList(b,
d),a.checkExistChatObj(),c.find(".j_no-result").addClass("hide")):c.find(".j_no-result").removeClass("hide")})},autoTurnOrgPage:function(a){var d=this;5<d.autoTurnPageCount?a&&a():d.turnPageOrgUserList(function(){d.wheelPageUnlLocked?(d.autoTurnPageCount+=1,d.autoTurnOrgPage(a)):a&&a()})},syncAndRenderOrganization:function(a){var d=$(this.el);$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").addClass("hide-im");a=$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container");
a.empty();d=d.find("#im-userselector-modal-clone-field #im-selectdept-clone").clone();d.removeClass("j_im-selectuser");d.addClass("j_im-org");var b={id:"root",nodeObj:{name:TEAMS.currentTenant.tenantName},hasSubs:!0};d.data("corp-data",b);d.attr("id",b.id);d.find(".j_name").text(b.nodeObj.name);d.find(".j_org-department").remove();a.append(d)},syncAndRenderEntity:function(){var a=this,d=$(a.el);f.queryEntityShareEntry({entityId:a.entity.id,name:a.entity.name,module:a.entity.module,shareTypes:["creater",
"primary","participants"]},function(b){$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_no-result").addClass("hide-im");var c=$(a.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container");c.empty();var f=d.find("#im-userselector-modal-clone-field #im-selectdept-clone").clone();f.removeClass("j_im-selectuser");f.addClass("j_im-entity-participants");f.find(".j_name").text("\u53c2\u4e0e\u4eba");f.find(".j_org-department").remove();c.append(f);b=b.map.resultShareEntry;
a.entity.shareEntryList=b;for(f=0;f<b.length;f++){var e=b[f];"creater"!=e.shareType&&"primary"!=e.shareType||l.getImUserInfo({uid:e.sid,cid:window.imCurrentUser.cid},function(a){if(1>c.find("#"+a.uid).length){var b=d.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone();b.attr("id",a.uid);b.find(".j_name").text(a.name);b.data("imChatUser",a);b.data("chatType","singleChat");c.append(b)}})}})},renderIndexGroupListOne:function(a,d){var b=$(this.el),c={id:a.group_id,name:a.name,avatar:a.avatar,
exist:"1",imgSrc:TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png"},b=b.find("#im-userselector-modal-clone-field #im-selectgroup-clone").clone().attr("id",c.id);this.renderRecentGroupChatOne(b,c);d.append(b)},renderRecentSingleChatOne:function(a,d,b,c,f){$(this.el);c&&0<c.length&&(b=a.attr("id"),(c=c.find("#"+b))&&0<c.length&&(a=c));a.data("chatType","singleChat");d&&(a.data("imChatUser",d),a.find(".j_name").text(d.name).attr("title",d.name),d.avatar&&(c="/base/download/"+d.avatar,
a.find(".j_avatar").attr("src",c),d.imgSrc=c));return a},renderRecentGroupChatOne:function(a,d,b){if(b&&0<b.length){var c=a.attr("id");(b=b.find("#"+c))&&0<b.length&&(a=b)}a.data("chatType","groupChat");d&&(a.data("imChatGroup",d),1==this.componentType&&(a.find(".j_opt").addClass("disabled"),a.hasClass("selected")?a.find(".j_opt").attr("title","\u4e0d\u53ef\u53d6\u6d88\u9009\u4e2d"):a.find(".j_opt").attr("title","\u6682\u4e0d\u652f\u6301\u90e8\u95e8\u548c\u7fa4\u7ec4\u7684\u9009\u4e2d"),a.removeClass("im-cp"),
a.removeClass("j_im-select-item"),"group"==this.chatIndexType&&a.find(".j_opt").remove()),a.find(".j_name").text(d.name).attr("title",d.name),b=TEAMS.service.imWebapp+"/static/img/pc/chat/group-avatar-default.png",d.avatar&&0<d.avatar.length&&(b="/base/download/"+d.avatar+"?type\x3dsmall\x26ETEAMSID\x3d"+ETEAMSID),a.find(".j_avatar").attr("src",b))},addObjToSelect:function(a,d){if(1==this.selectType&&0<this.selectedObjArray.length)m.notify("\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u6210\u5458");else if(0==
this.selectType&&this.selectedObjArray&&this.selectedObjArray.length>this.limitUserCount-1)m.notify("\u8d85\u51fa\u9009\u62e9\u4e0a\u9650");else if(1==this.selectType&&0<this.selectedUserArray.length)m.notify("\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u6210\u5458");else if(0==this.selectType&&this.selectedUserArray&&this.selectedUserArray.length>this.limitUserCount-1)m.notify("\u8d85\u51fa\u9009\u62e9\u4e0a\u9650");else{var b,c,f,e;a?(c=a.data("imChatUser"),f=a.data("imChatGroup"),e=a.data("chatType"),
a.addClass("selected"),b=a.clone()):(c=d.imChatUser,f=d.imChatGroup,e=d.chatType,b=$(this.el).find("#im-userselector-modal-clone-field #im-selectgroup-clone").clone(),b.attr("id",d.imChatUser.uid),b.find(".j_name").text(d.imChatUser.name),b.data({chatType:d.chatType,imChatUser:d.imChatUser}));b.find(".j_opt").addClass("hide-im");b.find(".j_remove-select").removeClass("hide");b.find(".j_group-member-level").remove();switch(e){case "singleChat":this.selectedObjArray.push({chatType:e,imChatUser:c});
b.data("imChatUser",c);b.data("chatType","singleChat");break;case "groupChat":this.selectedObjArray.push({chatType:e,imChatGroup:f}),b.data("imChatGroup",f),b.data("chatType","groupChat")}c=$(this.el).find(".j_im-selected-list");$(this.el).find(".j_selector-list .j_limit-count").text(this.selectedObjArray.length+"/"+this.limitUserCount);c.prepend(b)}},removeObjInSelect:function(a){var d=this,b=$(d.el).find(".j_im-selected-list"),c=$(d.el).find(".j_selectorSearch-container"),f=$(d.el).find(".j_selector-list-container");
switch(d.chatIndexType){case "org":c=$(d.el).find(".j_im-org-select-container")}"member"==d.groupIndexType&&(c=$(d.el).find(".j_im-groupmember-select-container"));f=f.find("#"+a);c.find("#"+a).removeClass("selected");f.removeClass("selected");d.markCheckAll(c);a=b.find("#"+a);if(0<a.length){b=a.data("imChatUser");c=a.data("imChatGroup");if(d.selectedObjArray&&0<d.selectedObjArray.length){for(var f=[],e=0;e<d.selectedObjArray.length;e++){var g=d.selectedObjArray[e];switch(g.chatType){case "singleChat":var h=
g.imChatUser;b&&b.uid==h.uid&&b.cid==h.cid&&f.push(g);break;case "groupChat":h=g.imChatGroup,c&&c.id==h.id&&f.push(g)}}0<f.length&&(f.forEach(function(a){d.selectedObjArray.remove(a)}),$(d.el).find(".j_selector-list .j_limit-count").text(d.selectedObjArray.length+"/"+d.limitUserCount))}a.detach()}},renderSearchList:function(a){var d=this,b=$(d.el),c=b.find(".j_selectorSearch-container .j_im-selectuser-search-list");c.empty();b=b.find("#im-userselector-modal-clone-field #im-pinyin-clone").clone().attr("id",
"search");c.append(b);var f=c.find("ul");a&&0<a.length&&(b={pageNo:1,pageSize:20},b["employee.username"]=a.trim(),b["employee.status"]="normal",b["employee.extra"]=!1,b.isContainsSub=!0,$(d.el).find(".j_im-addrlist-select-container .j_selectorSearch-container .j_no-result").removeClass("hide-im"),d.imRecentListComponent.queryChatUserByName(b,function(a){if((a=a.page.result)&&0<a.length){$(d.el).find(".j_im-addrlist-select-container .j_selectorSearch-container .j_no-result").addClass("hide-im");for(var b=
0;b<a.length;b++){c.find(".j_no-result").addClass("hide");var g=a[b];d.renderSearchUserOne({id:g.imUid,uid:g.imUid,cid:g.imCid,name:g.username,avatar:g.avatar},f)}d.checkExistChatObj()}}),a={queryName:a.trim(),type:"0"},d.imRecentListComponent.searchChatGroupByName(a,function(a){if((a=a.message.datas)&&0<a.length){$(d.el).find(".j_im-addrlist-select-container .j_selectorSearch-container .j_no-result").addClass("hide-im");a=m.sortBy(a,"add_time");for(var b=[],c=0;c<a.length;c++)b.push({groupId:a[c].group_id}),
d.renderIndexGroupListOne(a[c],f);d.checkExistChatObj()}}))},renderSearchUserOne:function(a,d){var b=$(this.el);if(window.imCurrentUser.uid!=a.uid||window.imCurrentUser.cid!=a.cid){b=b.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone().attr("id",a.uid);b.addClass("im-cp");b.data("imChatUser",a);b.data("chatType","singleChat");b.find(".j_name").text(a.name).attr("title",a.name);if(a.avatar&&a.avatar.p5){var c="/base/download/"+a.avatar.p5;b.find(".j_avatar").attr("src",c);a.imgSrc=
c}b.attr({id:a.uid,"data-entity":"employee"});d.prepend(b)}},returnMemberList:function(){$(this.el).find(".j_im-selectuser-list").removeClass("hide-im");$(this.el).find(".j_selectorSearch-container").addClass("hide-im");var a=$(this.el).find(".j_im-selectuser-list");a.find("li.selected").removeClass("selected");this.selectedObjArray&&0<this.selectedObjArray.length&&this.selectedObjArray.forEach(function(d){a.find("#"+d.uid+".j_im-selectuser").addClass("selected")})},close:function(){var a=this;$(a.el).modal("hide");
setTimeout(function(){a.remove()},500)},checkExistChatObj:function(){var a=$(this.el).find(".j_im-addr-user-list .j_im-selectuser-list .j_selector-list-container");switch(this.chatIndexType){case "org":a=$(this.el).find(".j_im-org-select-container .j_im-org-select-list")}"member"==this.groupIndexType&&(a=$(this.el).find(".j_im-groupmember-select-container .j_im-groupmember-select-list"));var d=$(this.el).find(".j_im-addrlist-select-container .j_im-selectuser-search-list");this.selectedObjArray.forEach(function(b){switch(b.chatType){case "singleChat":var c=
b.imChatUser;b=a.find("#"+c.uid);c=d.find("#"+c.uid);b&&0<b.length&&b.addClass("selected");c&&0<c.length&&c.addClass("selected");break;case "groupChat":c=b.imChatGroup,b=a.find("#"+c.id),c=d.find("#"+c.id),b&&0<b.length&&b.addClass("selected"),c&&0<c.length&&c.addClass("selected")}});this.existUsers&&0<this.existUsers.length&&this.existUsers.forEach(function(b){var c=a.find("#"+b.uid);b=d.find("#"+b.uid);c&&0<c.length&&(c.addClass("selected"),c.find(".j_opt").addClass("disabled"),c.hasClass("selected")?
c.find(".j_opt").attr("title","\u4e0d\u53ef\u53d6\u6d88\u9009\u4e2d"):c.find(".j_opt").attr("title","\u6682\u4e0d\u652f\u6301\u90e8\u95e8\u548c\u7fa4\u7ec4\u7684\u9009\u4e2d"),c.removeClass("im-cp"),c.removeClass("j_im-select-item"));b&&0<b.length&&(b.addClass("selected"),b.find(".j_opt").addClass("disabled"),c.hasClass("selected")?c.find(".j_opt").attr("title","\u4e0d\u53ef\u53d6\u6d88\u9009\u4e2d"):c.find(".j_opt").attr("title","\u6682\u4e0d\u652f\u6301\u90e8\u95e8\u548c\u7fa4\u7ec4\u7684\u9009\u4e2d"),
c.removeClass("im-cp"),b.removeClass("j_im-select-item"))})},spreadOrgList:function(a,d){var b=$(this.el);this.pageDeptId=a;"root"==a&&(a=void 0);b.find(".j_sch-input").addClass("hide-im");b.find(".j_im-addrlist-select-container").addClass("hide-im");var c=b.find(".j_im-org-select-container");c.removeClass("hide-im");var g=c.find(".j_im-org-select-list");g.empty();f.queryOrgDatas({id:a},function(c){c.nodes.forEach(function(c){if(c.id!=a&&"root"!=c.parentId){var d=b.find("#im-userselector-modal-clone-field #im-selectdept-clone").clone();
d.attr("id",c.id);d.attr("sub-type","user");c.hasSubs&&d.attr("sub-type","department");d.find(".j_name").text(c.nodeObj.name);d.data("org",c);g.append(d)}});f.countMembers({id:a},function(a){a.nodes.forEach(function(a){var b=g.find("#"+a.id),c=b.find(".j_name").text(),c=c+"("+a.attachment+")";b.find(".j_name").text(c);0==a.attachment&&b.find(".j_org-department").remove()})});d&&d()});var e=500-b.find(".j_im-org-header").height();c.height(e)},spreadOrgUserList:function(a,d){var b=this,c=$(b.el);c.find(".j_selector-checkall").removeClass("hide-im");
"root"==a&&(a=void 0);c=$(b.el);c.find(".j_sch-input").addClass("hide-im");c.find(".j_im-addrlist-select-container").addClass("hide-im");var g=c.find(".j_im-org-select-container");g.removeClass("hide-im");var e=g.find(".j_im-org-select-list");d&&e.empty();var h=c.find("#im-userselector-modal-clone-field .j_selector-checkall").clone();e.append(h);h={};b.pageDeptId=a;h.pageNo=b.orgPageNo;h.pageSize=b.orgPageSize;h["employee.status"]="normal";h["employee.department"]=b.pageDeptId;h["employee.extra"]=
!1;h.isContainsSub=!1;h.type="department";f.loadMembers(h,function(a){b.renderOrgUserList(a.page.result,e);b.wheelPageUnlLocked=a.page.hasNext});c=500-c.find(".j_im-org-header").height();g.height(c)},renderOrgUserList:function(a,d){var b=$(this.el);a&&0<a.length&&a.forEach(function(a){var f=b.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone();f.addClass("im-cp");f.attr("id",a.id);f.find(".j_info").addClass("employee");f.find(".j_name").text(a.username);a.grade&&(f.find(".j_work-title").text(a.grade.name),
f.addClass("list-item-hasinfo"));f.data("imChatUser",{id:a.id,uid:a.id,name:a.username,cid:window.imCurrentUser.cid});f.data("chatType","singleChat");d.append(f)});this.selectedObjArray&&0<this.selectedObjArray.length&&this.selectedObjArray.forEach(function(a){d.find("#"+a.imChatUser.uid+".j_im-selectuser").addClass("selected")});this.checkExistChatObj();this.markCheckAll(d)},renderEntityUserList:function(a){var d=$(this.el);d.find(".j_im-org-header").removeClass("hide-im");var b=[];this.entity.shareEntryList.forEach(function(a){"participants"==
a.shareType&&b.push({uid:a.sid,cid:window.imCurrentUser.cid})});l.getBatchImUserInfo(b,function(b){b.forEach(function(b){var c=d.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone();c.addClass("im-cp");c.attr("id",b.uid);c.find(".j_name").text(b.name);c.data("imChatUser",b);c.data("chatType","singleChat");a.append(c)})});this.selectedObjArray&&0<this.selectedObjArray.length&&this.selectedObjArray.forEach(function(b){a.find("#"+b.imChatUser.uid+".j_im-selectuser").addClass("selected")});
this.checkExistChatObj();this.markCheckAll(a)},spreadGroupMemberList:function(a,d){var b=this,c=$(b.el);c.find(".j_selector-checkall").removeClass("hide-im");b.groupIndexType="member";c.find(".j_sch-input").addClass("hide-im");c.find(".j_im-addrlist-select-container").addClass("hide-im");var f=c.find(".j_im-groupmember-select-container");f.removeClass("hide-im");var e=f.find(".j_im-groupmember-select-list");d&&e.empty();var g=c.find("#im-userselector-modal-clone-field .j_selector-checkall").clone();
e.append(g);b.imGroupCacheManager.syncGroupMemberList({groupId:a.id},function(a){for(var d in a.imGroupMemberCacheMap){var g=a.imGroupMemberCacheMap[d];if(g){var h=c.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone();h.addClass("im-cp");h.attr("id",g.uid);h.find(".j_name").text(g.name);h.data("imChatUser",{id:g.uid,uid:g.uid,cid:g.cid,name:g.name});h.data("chatType","singleChat");e.append(h)}}b.selectedObjArray&&0<b.selectedObjArray.length&&b.selectedObjArray.forEach(function(a){e.find("#"+
a.imChatUser.uid+".j_im-selectuser").addClass("selected")});a=500-c.find(".j_im-org-header").height();f.height(a);b.checkExistChatObj();b.markCheckAll(e)})},spreadParticipantList:function(){var a=$(this.el);a.find(".j_sch-input").addClass("hide-im");a.find(".j_im-addrlist-select-container").addClass("hide-im");this.addOrgIndex({id:"participant",name:"\u53c2\u4e0e\u4eba"},!0);var d=a.find(".j_im-org-select-container");d.removeClass("hide-im");var b=d.find(".j_im-org-select-list");b.empty();this.renderEntityUserList(b);
a=500-a.find(".j_im-org-header").height();d.height(a)},returnOrgList:function(){var a=$(this.el);a.find(".j_selector-checkall").addClass("hide-im");a.find(".j_im-addrlist-select-container").removeClass("hide-im");a.find(".j_im-org-select-container").addClass("hide-im");a.find(".j_im-groupmember-select-container").addClass("hide-im");a.find(".j_im-org-header").addClass("hide-im");a.find(".j_sch-input").removeClass("hide-im");this.groupIndexType="group";this.autoTurnPageCount=this.orgPageNo=1},addOrgIndex:function(a,
d){var b=$(this.el);b.find(".j_im-org-header").removeClass("hide-im");var c=b.find(".j_im-org-tree"),f=b.find("#im-userselector-modal-clone-field #im-head-choose-item-clone").clone().attr("id",a.id);d&&(c.removeClass("hide-im"),c.empty(),b.find(".j_im-org-header .j_im-org-header-title").text(a.name));var e=c.find(".j_current-dept");if(e&&0<e.length){var g=e.data("orgData"),b=b.find("#im-userselector-modal-clone-field #im-head-choose-item-clone").clone().attr("id",g.id);b.find(".j_org-name").text(g.name);
b.data("orgData",g);e.replaceWith(b)}f.attr("id",a.id);f.data("orgData",a);f.text(a.name);f.addClass("j_current-dept");c.append(f)},markCheckAll:function(a){var d=a.find(".j_im-select-item:not(.selected)");0==a.find(".j_im-select-item").length&&a.find(".j_selector-checkall").remove();0==d.length?a.find(".j_selector-checkall").addClass("selected"):a.find(".j_selector-checkall").removeClass("selected")},remove:function(){$(this.el).off(".ImUserSelectPanel");$("body").off(".ImUserSelectPanel");$(this.el).remove()}});
p.exports=n});
define("im/component/imCommonSysMsgView",function(n,s,p){n=Backbone.View.extend({initialize:function(m){this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods},delegateEvents:function(){$(this.el)},syncSysMsgReq:function(m,l){this.imWebReqMethods.syncSysMsgReq(m,l)},setSysMsgReadStatusReq:function(m,l){switch(m.flag){case "2":if(!m.sgroup){console.log("\u5168\u90e8\u6807\u8bb0\u5df2\u8bfb\uff0c\u6ca1\u4f20sgroup");return}break;case "4":var h=m.datas;if(h&&0<h.length){if(h&&0<h.length){for(var g=
0;g<h.length;g++){var f=h[g],a=[];a.push(f.msgId);f.msgId=a}m.datas=h}}else{console.log("\u5355\u4e2a\u6807\u8bb0\u5df2\u8bfb\uff0c\u6ca1\u4f20datas");return}}this.imWebReqMethods.setSysMsgReadStatusReq(m,l)},querySysMsgRel:function(m,l){var h={};h.uid=window.imCurrentUser.uid;h.cid=window.imCurrentUser.cid;h.gcid=window.imCurrentUser.gcid;h.flag="3";h.uc="0";var g=[];g.push({group:m,uc:"0"});h.datas=g;this.imWebReqMethods.getSysMsgGroupTypeUCReq(h,function(f){(f=f.message.datas)&&0<f.length&&(f=
f[0].types,l&&l(f))})},setSysMsgUnReadStatusReq:function(m,l){m.uid=window.imCurrentUser.uid;m.cid=window.imCurrentUser.cid;this.imWebReqMethods.setSysMsgUnReadStatusReq(m,function(h){l&&l(h)})},sysMsgUpdateNotify:function(m,l){this.imWebReqMethods.activeSyncSysMsgReq({cid:window.imCurrentUser.cid,uid:window.imCurrentUser.uid,dev:window.imClientDev,msgType:m.msgType,msgId:m.msgId},function(h){l&&l(h)})},remove:function(){}});p.exports=n});
define("im/component/imContants",function(n,s,p){p.exports={IM_FRAME_EL:"im-frame-container",IM_ADDRLIST_EL:"im-addrlist-container",IM_WINCOM_EL:"im-wincom-container",IM_CHATWIN_EL:"im-chatwin-container",IM_SYSWIN_EL:"im-syswin-container",IM_THIRDWIN_EL:"im-thirdwin-container",IM_MINI_PAGE:"im-chat-mini",IM_MSG_READ_STATUS_MODAL:"im-chat-msgreadstatus-modal",IM_GROUP_DETAIL_MODAL:"im-chat-imgroupdetail-modal",IM_AVATAR_UPLOADER_MODAL:"im-avataruploader-modal",IM_USER_SELECTOR_MODAL:"im-userselector-modal",
IM_USER_SELECTOR_PANEL_MODAL:"im-userselector-panel-modal",IM_USERCARD:"im-usercard",MASK_GROUP_ID:1,MASK_GROUP_NAME:2,MASK_GROUP_ANNOUNCE:4,MASK_GROUP_CREATE_TIME:8,MASK_GROUP_DESTROY_TIME:16,MASK_GROUP_TYPE:32,MASK_GROUP_STATE:64,MASK_GROUP_HOST_CID:128,MASK_GROUP_HOST_UID:256,MASK_GROUP_LAST_TIME:512,MASK_GROUP_USER_LIST_UC:1024,MASK_GROUP_USER_NUM:2048,MASK_GROUP_CREATE_SOURCE:4096,MASK_GROUP_EXIST:8192,MASK_USER_GROUP_ID:1,MASK_USER_GROUP_MSG_SETTING:2,MASK_USER_GROUP_DISPLAY:4,MASK_USER_GROUP_CREATE_TM:8,
MASK_USER_GROUP_TYPE:16,MASK_USER_GROUP_NAME:32,MASK_GROUP_MEM_NAME:1,MASK_GROUP_MEM_CID:2,MASK_GROUP_MEM_UID:4,MASK_GROUP_MEM_ROLE:8,MASK_GROUP_MEM_INVITE_CID:16,MASK_GROUP_MEM_INVITE_UID:32,MASK_GROUP_MEM_INVITE_TIME:64,MASK_GROUP_MEM_ADD_TIME:128,MASK_GROUP_MEM_CREATE_TIME:256,MASK_GROUP_MSG_SETTING:512,kMaskModifyGroupInfo:{MASK_MODIFY_GROUP_NAME:0,MASK_MODIFY_GROUP_ANNOUNCE:1,MASK_MODIFY_GROUP_TYPE:2,MASK_MODIFY_GROUP_STATE:3,MASK_MODIFY_GROUP_HOST:4,MASK_MODIFY_GROUP_DISPLAY:5,MASK_MODIFY_GROUP_MSG_SETTING:6,
MASK_MODIFY_GROUP_MAX:7,MASK_MODIFY_GROUP_AVATAR:"avatar"},kMaskCorpInfo:{MASK_CORP_CID:1,MASK_CORP_GCID:2,MASK_CORP_ACCOUNT:4,MASK_CORP_TENANT_KEY:8,MASK_CORP_NAME:16,MASK_CORP_HEAD_PIC:32,MASK_CORP_EXPIRE_TM:64,MASK_CORP_STATE:128,MASK_CORP_CREATE_TM:256,MASK_CORP_CONTACT:512,MASK_CORP_TEL:1024,MASK_CORP_ADDRESS:2048},kMaskUserInfo:{MASK_USER_ACCOUNT:4,MASK_USER_NAME:8,MASK_USER_ROLE:16,MASK_USER_MOBILE:32,MASK_USER_EMAIL:64,MASK_USER_HEAD_PIC:128,MASK_USER_AUTHORITY:256,MASK_USER_STATE:512,MASK_USER_CREATE_TM:1024,
MASK_USER_PINYIN:2048,MASK_USER_TEL:4096},groupMemberOrder:{MASTER:1,MANAGER:2,SERVER:3,CLIENT:4,ONLINE:11,LEAVE:12,PUSH:13,OFFLINE:14,DEFAULT:99},imWebDev:5,ImFrametitleWords:{zh_cn:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u7ec4\u5408\u952e\uff08Alt + Z\uff09\u8fdb\u884c\u7a97\u53e3\u7684\u5c55\u5f00\u548c\u6700\u5c0f\u5316",zh_tw:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u7d44\u5408\u9375\uff08Alt + Z\uff09\u9032\u884c\u7a97\u53e3\u7684\u5c55\u958b\u548c\u6700\u5c0f\u5316",en_us:"You can use Shortcut\uff08Alt + Z\uff09to minimize or maximize Work Message window"},
assistantNameObj:{zh_cn:"eteams\u5c0f\u52a9\u624b",zh_tw:"eteams\u5c0f\u52a9\u624b",en_us:"eteams Assistant"}}});
define("im/component/imCommonModel",["im/component/imUtils","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants");p.exports={renderUserStatus:function(h,g){h.uid=window.imCurrentUser.uid;h.cid=window.imCurrentUser.cid;window.imWebsocketSdk.imJsonRequestMethods.getStatusReq(h,function(f){f=f.message.infos;var a=[];if(f&&0<f.length){for(var d=0;d<f.length;d++){for(var b=f[d],c=b.dev_infos,h={},e=0;e<c.length;e++){var l=c[e];h[l.dev]=l.status}c=m.judgeUserStatus(h);
a.push({user:b.user,status:c.status,dev:c.dev})}g&&g(a)}})},exitGroupReq:function(h,g){var f={};f.uid=window.imCurrentUser.uid;f.cid=window.imCurrentUser.cid;f.groupId=h.groupId;f.type="0";f.dev=window.imClientDev;var a="exitGroupReq";h.isHelper&&(a="exitHelperGroupReq",f.type="1");window.imWebsocketSdk.imJsonRequestMethods[a](f,function(a){g&&g(a)})},queryOrgDatas:function(h,g){$.ajax({type:"post",url:"/base/tree/orgDepartment.json",dataType:"json",data:h,success:function(f){g&&g(f)}})},loadMembers:function(h,
g){$.ajax({type:"post",url:"/base/employee/pageQuery.json",dataType:"json",data:h,success:function(f){g&&g(f)}})},countMembers:function(h,g){$.ajax({type:"post",url:"/base/tree/deptCountUsers.json",dataType:"json",data:h,success:function(f){g&&g(f)}})},queryEntityShareEntry:function(h,g){$.ajax({type:"post",contentType:"application/json;charset\x3dUTF-8",url:"/share/queryRolesByTargetList.json",dataType:"json",data:JSON.stringify(h),success:function(f){g&&g(f)}})},getEntityIdByTenantKeyAndModule:function(h,
g){$.ajax({type:"post",url:"/crmapp/common/getEntityIdByTenantKeyAndModule.json",dataType:"json",data:h,success:function(f){g&&g(f)}})},syncCorpInfoReq:function(h,g){window.imWebsocketSdk.imJsonRequestMethods.syncCorpInfoReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,cids:[h],mask:l.kMaskCorpInfo.MASK_CORP_CID|l.kMaskCorpInfo.MASK_CORP_NAME|l.kMaskCorpInfo.MASK_CORP_TEL|l.kMaskCorpInfo.MASK_CORP_ACCOUNT},function(f){g&&g(f.message)})},checkEntityGroup:function(h,g){$.ajax({type:"post",
contentType:"application/json;charset\x3dUTF-8",url:TEAMS.service.imApiconnector+"/group/entity/checkEntityGroup",dataType:"json",data:JSON.stringify(h),success:function(f){g&&g(f)}})},createAndJoinEntityGroup:function(h,g){$.ajax({type:"post",contentType:"application/json;charset\x3dUTF-8",url:TEAMS.service.imApiconnector+"/group/entity/createAndJoinEntityGroup",dataType:"json",data:JSON.stringify(h),success:function(f){g&&g(f)}})},joinEntityGroup:function(h,g){$.ajax({type:"post",contentType:"application/json;charset\x3dUTF-8",
url:TEAMS.service.imApiconnector+"/group/entity/joinEntityGroup",dataType:"json",data:JSON.stringify(h),success:function(f){g&&g(f)}})},shareEntityGroup:function(h,g){$.ajax({type:"post",contentType:"application/json;charset\x3dUTF-8",url:TEAMS.service.base+"/share/processImGroupShare.json",dataType:"json",data:JSON.stringify(h),success:function(f){g&&g(f)}})}}});
define("im/component/atmeview",["teams/utils","im/component/imUtils","teams/component/atmemodel","im/component/imChatComponent"],function(n,s,p){n("teams/utils");var m=n("im/component/imUtils"),l=n("teams/component/atmemodel");n("im/component/imChatComponent");n=Backbone.View.extend({initialize:function(h){this.$input=h.$input;this.channelId=h.channelId;this.inputId=h.inputId;this.componentType=h.componentType;this.textAreaPos=0;this.atmeModel=new l;this.componentId=void 0==h.componentId?atmeBox:
h.componentId;this.topPosition=void 0==h.topPosition?0:h.topPosition;this.pageSize=void 0==h.pageSize?10:h.pageSize;this.hasRecentTen=!1;this.areaStartIndex;this.areaEndIndex;this.areaPosition=h.areaPosition;this.needTargetMember=this.used=!0;this.divId="j_div_"+this.componentId;this.spanId="j_span_"+this.componentId;this.positionId="j_position_"+this.componentId;this.remote=h.remote||"/search/suggestion.json";this.module=h.module;this.el="#im-atdiv";this.searchType="employee";this.focusPos;1>$("#im-atdiv").length&&
$("body").append('\x3cdiv id\x3d"im-atdiv" class\x3d"controls j_im-frame-show-panel hide" style\x3d"position: absolute;z-index:9999;"\x3e'+m.template("im.pc.component.atselector")+"\x3c/div\x3e")},render:function(){var h=this.$input[0].getBoundingClientRect(),g=this.$input[0].offsetWidth,f=this.$input[0].offsetHeight;$("#"+this.divId).css({top:h.top,left:h.left,width:g,height:f,SCTOP:"0"});this.delegateEvents()},delegateEvents:function(){var h=this,g=$(h.el),f=h.$input;$(window).off("resize.at").on("resize.at",
function(a){0<$("#im-atdiv").length&&!$("#im-atdiv").hasClass("hide")&&h.$input.trigger("keyup.at")});f.off("click.at").on("click.at",function(a){f.trigger("keydown.at")});$("body").off("click.at").on("click.at",function(a){var d=$(a.target);0<d.parents("."+h.divId).length||d.hasClass("j_btn-send")||1>$(a.target).parents("#im-atdiv").length&&h.hide()});f.off("keydown.at").on("keydown.at",function(a){var d=(a||window.event).keyCode;if((38==d||40==d)&&g.find("#im-atselector-container p").hasClass("employee"))return h.preventEvent(a),
!1;13==d&&g.find("#im-atselector-container p").hasClass("active")&&(13==a.keyCode&&a.preventDefault(),h.preventEvent(a))});f.off("focusin.at").on("focusin.at",function(a){h.getCursorPosition(h.$input);h.getFocusPos()});$("body .j_detail_scroll").off("mousewheel.at").on("mousewheel.at",function(a){0<$("#im-atdiv").length&&!$("#im-atdiv").hasClass("hide")&&h.$input.trigger("keydown.at")});f.off("keydown.at").on("keydown.at",function(a){$(a.target);if(h.used){h.getFocusPos();var d=h.$input[0].getBoundingClientRect();
d&&$("#"+h.divId).css({top:d.top});d=(a||window.event).keyCode;13==d?($("#im-atdiv").hasClass("hide")||13==a.keyCode&&a.preventDefault(),$(a.target),g.find("#im-atselector-container p.active").trigger("click.at")):27==d?h.hide():38==d?(a.preventDefault(),a=g.find("#im-atselector-container #im-atselector-list").find("p.active"),1>a.length?g.find("#im-atselector-container #im-atselector-list").find("p").last().addClass("active"):(a.removeClass("active"),0<a.prev().length?a.prev().hasClass("at-bottom-boder")?
a=g.find("#im-atselector-container #im-atselector-list .j_up-list").find("p").last():(a=a.prev(),a.hasClass("hide")&&(a=g.find("#im-atselector-container #im-atselector-list .j_up-list").find("p").last())):(a=g.find("#im-atselector-container #im-atselector-list").find("p").last(),$(a).hasClass("hide")&&(a=a.prev(),$(a).hasClass("hide")&&(a=g.find("#im-atselector-container #im-atselector-list .j_up-list").find("p").last()))),a.addClass("active"))):40==d?(a.preventDefault(),a=g.find("#im-atselector-container #im-atselector-list").find("p.active"),
1>a.length?g.find("#im-atselector-container #im-atselector-list").find("p").first().addClass("active"):(a.removeClass("active"),0<a.next().length?(a=a.next(),$(a).hasClass("hide")&&(a=g.find("#im-atselector-container #im-atselector-list").find("p").first())):a.hasClass("all-user")?a=g.find("#im-atselector-container #im-atselector-list").find("p").first():(a=g.find("#im-atselector-container #im-atselector-list .j_buttom-list").find("p").first(),a.hasClass("hide")&&(a=a.next(),a.hasClass("hide")&&(a=
g.find("#im-atselector-container #im-atselector-list").find("p").first()))),a.addClass("active"))):setTimeout(function(){var a=h.getCursorPosition(f);if(!a)return h.hide();var c=h.getInputContent();if(c&&-1!=c.indexOf("@")&&$.trim(c.substr(-1))){if(-1==c.substr(c.lastIndexOf("@"),a).indexOf(" "))if(h.getFocusPos(),a=c.substr(c.lastIndexOf("@")),g.find("#im-atselector-container #im-atselector-list"),a&&""!=a)"chat-at"==h.componentType&&h.chatSearch($.trim(a.replace("@","")));else return h.hide()}else{if((a=
h.inputAtName?h.inputAtName:h.suggestion)&&""!=a){-1!=a.indexOf("@")&&(a=a.split("@")[1]);var d=[];g.find("#im-atselector-container #im-atselector-list").find("p").each(function(){var a=$(this).data("obj");a&&d.push(a.username||a.name)});if(0==d.length)return;if(-1!=d.indexOf(a)){var c=g.find("#im-atselector-container #im-atselector-list p[title\x3d'"+a+"']").data("obj"),a=c.username||c.name,c={userId:c.id,userName:a,atIndex:0,atType:"user"},e=f.data("userData");if(e)for(var l=0;l<e.length;l++)0<=
e[l].atIndex&&(e[l].atIndex+=("@"+a+" ").length);else e=[];e.push(c);f.data("userData",e)}}return h.hide()}},50)}});g.off("click.at","#im-atselector-container p").on("click.at","#im-atselector-container p",function(a){var d=$(this).data("obj");a=$(this).attr("at-type");"targetMember"==a&&(d={id:"99",name:"\u4e8b\u9879\u6210\u5458",atType:"targetMember"});"channelMember"==a&&(d={id:"88",name:"\u5168\u4f53\u6210\u5458",atType:"channelMember"});d.atType=a;setTimeout(function(){h.chooseAtMember(d)},50)})},
preventEvent:function(h){h&&h.preventDefault?h.preventDefault():window.event.returnValue=!1;h.stopPropagation()},insertAtMember:function(h){this.areaStartIndex=this.$input[0].selectionStart;this.areaEndIndex=this.$input[0].selectionEnd;var g=this.$input.data("userData"),f=h.name,a="@"+f+" ";h={userId:h.id,userName:f,atIndex:0,atType:h.atType};if(g)for(var d=0;d<g.length;d++)0<=g[d].atIndex&&(g[d].atIndex+=("@"+f+" ").length);else g=[];g.push(h);this.insertAtMemberToArea(a,this.$input[0],this.areaStartIndex,
this.areaEndIndex);this.$input.focus();this.$input.data("userData",g);this.$input.focus()},chooseAtMember:function(h){h.atmeTime=(new Date).getTime();this.showList();if(this.clickHandler)this.clickHandler(h,$input);else{var g=this.$input.data("userData"),f=h.id,a=h.name,d=h.atType,b=a+" ",c=0;"chat-at"==this.componentType&&(h={},h.channelId=this.channelId,h.atEmployeeId=f,this.atmeModel.updateLastAtTime(h))}f={userId:f,userName:a,atIndex:c,atType:d};if(g)for(d=0;d<g.length;d++)c<=g[d].atIndex&&(g[d].atIndex+=
("@"+a+" ").length);else g=[];g.push(f);$("#im-atdiv").hasClass("hide")||"none"==$("#im-atdiv").css("display")||(this.insertAtMemberToArea(b,this.$input[0],this.areaStartIndex,this.areaEndIndex),this.$input.focus());this.$input.data("userData",g);this.$input.focus();this.hide()},insertAtMemberToArea:function(h,g,f,a){this.inputAtName=$.trim(h);var d=g.value,b=$(g).data("simditor");if(b)if($(b.selection._selection.focusNode).closest(".simditor-body").length)b.trigger("selectionchanged"),b.selection.insertNode(document.createTextNode(h)),
b.trigger("valuechanged"),b.trigger("selectionchanged");else{var c=b.getValue(),k=c;$(c).last().is("p")?(c=$(c).last().append(h),k=$("\x3cdiv/\x3e").append(c).html()):k=c+h;b.setValue(k)}"undefined"!=typeof g.selectionStart&&"undefined"!=typeof g.selectionEnd?(b=0,void 0!=this.suggestion&&(b=this.suggestion.length),f-=b,g.value=0<=f?d.substring(0,f)+h+d.substring(a):d.substring(0,d.lastIndexOf("@"))+"@"+h+d.substring(a),this.areaEndIndex=this.areaStartIndex=f+=h.length,g.selectionStart=g.selectionEnd=
g.value.length):"undefined"!=typeof document.selection&&"undefined"!=typeof document.selection.createRange&&(g.focus(),g=document.selection.createRange(),g.text=h,g.select());this.inputAtName=this.suggestion=void 0},getCursorPosition:function(h){this.$input.caret("pos",{iframe:null});if(document.selection&&document.selection.length){h.focus();var g=null,g=document.selection.createRange(),f=g.duplicate();f.moveToElementText(h[0]);f.setEndPoint("EndToEnd",g);h[0].selectionStart=f.text.length-g.text.length;
h[0].selectionEnd=h[0].selectionStart+g.text.length}this.textAreaPos=h[0].selectionStart;return h[0].selectionStart},chatSearch:function(h){var g=this;h&&(h=h.replace(/'/g,""));g.suggestion=h;g.hide();var f=$(g.el);f.find("#im-atselector-container .loading_small").show();f.find("#im-atselector-list").hide();window.imCacheData.imGroupCacheManager.searchMemberByName({id:g.channelId},h,function(a){g.renderChatAtList(a)?g.hide():(g.showList(),f.find(".j_up-list p").eq(0).addClass("active"),f.find(".j_buttom-list p.j_target").addClass("hide"),
f.find(".j_buttom-list p.j_chat").removeClass("hide"))})},renderChatAtList:function(h){var g=$(this.el),f=!0;if(h){this.$el=g;g.find("#im-atselector-container #im-atselector-list .j_up-list").empty();for(var a=5<h.length?5:h.length,d=0;d<a;d++){var b=h[d],c=$("#im-atselector-container-clone-field .j_"+this.searchType+"-list p").clone(),k=b.name;c.data("obj",b);c.attr("title",k);c.find("span").text(k);b.avatar&&c.find(".avatar").attr("src","/base/download/"+b.avatar);g.find("#im-atselector-container #im-atselector-list .j_up-list").append(c)}0<
h.length&&(f=!1)}return f},getWindowSize:function(){return{height:$(window).height(),width:$(window).width()}},getFocusPos:function(){var h=this.$input,g=h.caret("pos",{iframe:null});this.focusPos=h.caret("offset",g-1,{iframe:null})},resPosition:function(){this.$input.focus();this.getFocusPos();this.areaStartIndex=this.$input[0].selectionStart;this.areaEndIndex=this.$input[0].selectionEnd;var h=$("#im-atdiv #im-atselector-container");this.$el.removeClass("hide");var g=window.navigator.userAgent.toLowerCase();
this.$input.data("left");this.$input.data("top");"true"==this.$input.attr("isoffsetpx")&&1<this.$input.val().slice(0,this.textAreaPos).split("\n").length&&(this.$input.data("offsetpx"),g.indexOf("firefox"));var f=this.getWindowSize(),g=f.height-this.focusPos.top-h.height(),f=f.width-this.focusPos.left-h.width();0<g&&"up"!=this.areaPosition?(g=this.focusPos.top,this.$el.addClass("atme-container")):(g=this.focusPos.top-h.height()-5,this.$el.removeClass("atme-container"));h=0<f?this.focusPos.left:this.focusPos.left-
h.width()-5;this.$el.css({top:g,left:h})},hide:function(){var h=$(this.el);h.find("#im-atselector-container").hide();h.find("#im-atselector-container").find(".active").removeClass("active");h.css("display","none");h.addClass("hide")},showList:function(){var h=$(this.el),g=this.textAreaPos,f=this.getInputContent();f&&-1!=f.indexOf("@")&&$.trim(f.substr(-1))&&-1==f.substr(f.lastIndexOf("@"),g).indexOf(" ")&&(h.find("#im-atselector-container .loading_small").hide(),h.find("#im-atselector-container").show(),
h.find("#im-atselector-list").show(),h.css("display","block"),h.removeClass("hide"),this.needTargetMember||h.find(".j_buttom-list .j_target").addClass("hide"),this.resPosition())},getInputContent:function(){var h=this.textAreaPos;if(!h)return this.hide();h=this.$input.val().slice(0,h);return h.slice(-h.length)},resetView:function(){this.hasRecentTen=!1;this.$input.removeData("userData");$(this.el).find("#im-atselector-list p").removeClass("active")},keyDownFilter:function(h){13!=h.keyCode&&38!=h.keyCode&&
40!=h.keyCode||$("#im-atdiv").hasClass("hide")||"none"==$("#im-atdiv").css("display")||h.preventDefault()},remove:function(){$(this.el).hide()}});p.exports=n});
define("im/component/client",["im/component/imCommonModel"],function(n,s,p){var m=n("im/component/imCommonModel");n=function(){if(!window.imCurrentUser)throw Error("can not get Object window.imCurrent");window.ETIM||(this.initETIM(),this.delegateEvents(),window.imMainloaded=!0)};n.prototype={action:{CREATE:"create",SEND:"send"},session:{TYPE_SINGLE:"single",TYPE_GROUP:"group"},delegateEvents:function(){var l=this;$("#im-chat-mini").on("openEntityUserSelector.miniChatPage",function(h,g){l.handleEntity(g.flag,
g.entity)}).on("imFastChat.miniChatPage",function(h,g){var f;if("singleChat"===g.chatType)f={type:l.session.TYPE_SINGLE,id:g.imChatUser.uid,ext:{cid:g.imChatUser.cid}};else if("groupChat"===g.chatType)f={type:l.session.TYPE_GROUP,id:g.groupId,ext:{groupType:g.isHelper?"1":"0"}};else return!1;window.EteamsClient.onOpenSession(JSON.stringify(f))});window.ETIM.on("entityHandler",function(h,g){l.handleEntity(g.flag,g.entity)})},initETIM:function(){window.ETIM={};_.extend(window.ETIM,Backbone.Events)},
handleEntity:function(l,h){var g=this;switch(l){case this.action.CREATE:m.checkEntityGroup({entityId:h.id,uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid},function(f){switch(f.actionMsg.code){case 1:m.queryEntityShareEntry({entityId:h.id,name:h.name,module:h.module,shareTypes:["creater","primary","participants"]},function(a){var d={entityId:h.id,entityName:h.name};20<d.entityName.length&&(d.entityName=d.entityName.substring(0,19)+"...");a=a.map.resultShareEntry;for(var b={},c=[{uid:window.imCurrentUser.uid,
cid:window.imCurrentUser.cid}],f=0;f<a.length;f++){var e=a[f];"primary"==e.shareType&&(b={uid:e.sid,cid:window.imCurrentUser.cid});"user"==e.entryType&&e.sid!=window.imCurrentUser.uid&&c.push({uid:e.sid,cid:window.imCurrentUser.cid})}d.owner=b;d.users=c;m.createAndJoinEntityGroup(d,function(a){g.shareEntityGroup(a.data,h);EteamsClient.onCreateEntityGroup(JSON.stringify({id:a.data,entity:h}))})});break;case 10:m.joinEntityGroup({entityId:h.id,uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid},
function(a){window.EteamsClient.onOpenSession(JSON.stringify({type:"group",id:a.data,ext:{groupType:"0"}}))});break;case 100:window.EteamsClient.onOpenSession(JSON.stringify({type:"group",id:f.data,ext:{groupType:"0"}}))}$("#entitybox").trigger("closeView")});break;case this.action.SEND:window.EteamsClient.onForwardEntityMsg(JSON.stringify({entity:h}))}},shareEntityGroup:function(l,h,g,f){f=f||0;if(!(5<f)){var a=this;m.shareEntityGroup({entityId:h.id,module:h.module,sid:l,cid:window.imCurrentUser.cid,
etype:"group"},function(d){100!==JSON.parse(d.msg).code?window.setTimeout(function(){a.shareEntityGroup(l,h,g,f+1)},2E3):g&&g()})}}};p.exports=n});define("im/component/imLoginComponent",function(n,s,p){p.exports={}});
define("im/component/pasteuploadfile",["im/component/imUtils","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants");n=Backbone.View.extend({el:"",initialize:function(h){this.el="#pasteimg";this.dataURL=h.dataURL;this.uploadUrl=m.getImPasteUrl()+"?module\x3dim\x26ETEAMSID\x3d"+ETEAMSID;this.uploadParam=h.uploadParam;this.callback=h.callback;1>$("body").find("#pasteimg").length&&$("body").append(m.template("minichat.pasteimage"))},delegateEvents:function(){var h=
this,g=$(h.el);g.on("hidden.bs.modal",function(f){$("#"+l.IM_CHATWIN_EL).trigger("closePasteImgNotify.ImChatWin");h.remove()});g.off("click.pasteuploadfile",".btn-sm").on("click.pasteuploadfile",".btn-sm",function(f){m.timeoutControll($(this),1E3)&&(m.notify("\u6b63\u5728\u4e0a\u4f20\uff0c\u8bf7\u7a0d\u7b49..."),$("#"+l.IM_CHATWIN_EL).trigger("uploadPasteImage.ImChatWin"),g.modal("hide"))});$("body").off("keydown.pasteuploadfile").on("keydown.pasteuploadfile",function(f){f=event||window.event;27==
f.keyCode&&$("#pasteimg").modal("hide")});$("body").off("keyup.pasteuploadfile").on("keyup.pasteuploadfile",function(f){13==(f||window.event).keyCode&&g.find(".btn-sm").trigger("click.pasteuploadfile")})},preventEvent:function(h){h&&h.preventDefault?h.preventDefault():window.event.returnValue=!1;h.stopPropagation()},render:function(){var h=$(this.el);h.modal();h.find("img").attr("src",this.dataURL)},remove:function(){var h=$(this.el);h.off(".pasteuploadfile");h.remove()}});p.exports=n});
define("im/component/group/anonymous",function(n,s,p){var m={anonymous:{en_us:"anonymous",zh_cn:"\u533f\u540d",zh_tw:"\u533f\u540d"},anonymity:{en_us:"anonymity",zh_cn:"\u533f\u540d",zh_tw:"\u533f\u540d"},sendTip:{en_us:"Send anonymous message",zh_cn:"\u53d1\u9001\u533f\u540d\u6d88\u606f",zh_tw:"\u767c\u9001\u533f\u540d\u6d88\u606f"},gettingName:{en_us:"The anonymous code is getting...",zh_cn:"\u83b7\u53d6\u533f\u540d\u4ee3\u53f7\u4e2d...",zh_tw:"\u7372\u53d6\u533f\u540d\u4ee3\u865f\u4e2d..."}},l=
{develop:"all",test:"all",release:"884322548286750720,879649154475753472",production:"874152414695915520"},h=function(){if(!TEAMS||!TEAMS.runMode)return!1;var g=l[TEAMS.runMode];if(!g)return!1;if("all"===g||"string"===typeof g&&-1!==g.split(",").indexOf(window.imCurrentUser.cid))return!0;if(_.isArray(g))return-1!==g.indexOf(window.imCurrentUser.cid);if(_.isObject(g))for(var f in g){if(f===window.imCurrentUser.cid&&"all"===g[f])return!0;if("string"===typeof g[f]){var a=g[f].split(",");if(f===window.imCurrentUser.cid&&
-1!==a.indexOf(window.imCurrentUser.uid))return!0}if(_.isArray(g[f])&&f===window.imCurrentUser.cid&&-1!==g[f].indexOf(window.imCurrentUser.uid))return!0}return!1};p.exports={init:function(g,f){if(!g.isHelper&&f&&h())return this.$container=$(g.el),this.view=g,this.group=f,this.state=this.initState(),this.render().delegateEvents(),this},initState:function(){return{loading:!1,name:"",avatar:"",isAnonymous:!1}},stateHandler:function(g,f){var a=this.view;switch(g){case "loading":f?(this.$container.addClass("anonymous-loading"),
0===this.$container.find(".anonymous-loading-editor").length&&this.$container.find(".chat-editor").append('\x3cdiv class\x3d"anonymous-loading-editor"\x3e'+this.il8n("gettingName")+"\x3c/div\x3e")):this.$container.removeClass("anonymous-loading");a.anonymousInfo=a.anonymousInfo||{};a.anonymousInfo.loading=f;break;case "name":console.log(f);a.anonymousInfo=a.anonymousInfo||{};a.anonymousInfo.name=f;window.localStorage.setItem(this._getStorageKey(),JSON.stringify({time:(new Date).getTime(),name:f}));
break;case "isAnonymous":f?this.$container.addClass("mode-anonymous").find(".view-head").append('\x3cdiv class\x3d"tag-anonymous"\x3e'+this.il8n("anonymous")+"\x3c/div\x3e"):this.$container.find(".view-head .tag-anonymous").remove().end().removeClass("mode-anonymous"),a.isAnonymous=f}},onStateChange:function(g){var f=this;$.each(g,function(a,d){f.state[a]!==d&&(f.stateHandler(a,d),f.state[a]=d)})},render:function(){this.$container.find("#im-chatwin-history").after('\x3cdiv class\x3d"tool-bar-right fr"\x3e\x3ca class\x3d"btn-anonymous-mode" href\x3d"javascript:void(0)" data-toggle\x3d"tooltip" data-original-title\x3d"'+
this.il8n("sendTip")+'"\x3e\x3ci class\x3d"etim-iconfont icon-niming"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e');return this},delegateEvents:function(){var g=this;g.$container.off("click.ImChatWin",".btn-anonymous-mode").on("click.ImChatWin",".btn-anonymous-mode",function(){g.$container.hasClass("mode-anonymous")?g.cancel():g.open();g.$container.find("#im-chatwin-textarea").focus()}).off("stateChange.anonymous").on("stateChange.anonymous",function(f,a){g.onStateChange(a)});return this},open:function(){var g=
this,f=g.view;f.isAnonymous=!0;f.anonymousInfo=f.anonymousInfo||{};f.anonymousInfo.loading=!0;g.onStateChange({isAnonymous:!0,loading:!0});g.getName(function(a){var d=g._getAvatar();g.onStateChange({loading:!1,name:a,avatar:d})})},cancel:function(){this.onStateChange({isAnonymous:!1,loading:!1})},getName:function(g,f){var a="",d=this.view;this.state.name&&g(d.anonymousInfo.name);if(d.anonymousInfo&&d.anonymousInfo.name)g(d.anonymousInfo.name);else{var b=window.localStorage.getItem(this._getStorageKey());
if(b&&(b=JSON.parse(b),5E3>=(new Date).getTime()-b.time)){g(b.name);return}this.view.imWebReqMethods.getGroupAnonymousUserName({cid:window.imCurrentUser.cid,uid:window.imCurrentUser.uid,groupIds:[d.imChatGroup.id]},function(b){(a=b.message.datas[0].name)&&"function"===typeof g?g(a):a||"function"!==typeof f||f()})}},getAvatar:function(){return this._getAvatar()},il8n:function(g,f){f=f||TEAMS.perLang||"zh_cn";return m[g]?m[g][f.toLowerCase()]:g},blurMsgInfo:function(g,f){var a=g.name,d=g.avatar;"1"===
f.display&&(a="["+this.il8n("anonymity")+"] "+f.sname,d=this._getAvatar());return{name:a,avatar:d}},_getAvatar:function(){return TEAMS.service.imWebapp+"/static/img/pc/chat/anonymous-avatar-default.png"},_getStorageKey:function(){return window.imCurrentUser.cid+"_"+window.imCurrentUser.uid+"_"+this.group.id+"_anonymousName"}}});
define("im/component/imTemplate",function(n,s,p){p.exports={"im.chat.history":'\x3cdiv id\x3d"chat-histroy-modal" class\x3d"chat-histroy-modal modal fade j_chat_filterSlip_js"\x3e\x3cdiv class\x3d"modal-dialog"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"modal-header"\x3e\x3ca class\x3d"close" data-dismiss\x3d"modal"\x3e\u00d7\x3c/a\x3e\x3ch5 class\x3d"modal-title"\x3e\u804a\u5929\u8bb0\u5f55\x3c/h5\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-body im-history-modal-body j_chat-history scrollwrapper"\x3e\x3cdiv  id\x3d"chat-history-view" class\x3d"chat-history-view"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-footer ta-r"\x3e\x3cul class\x3d"pagination nomg va-t"\x3e\x3cli class\x3d"page-first page-buttons"\x3e\x3ca title\x3d"\u7b2c\u4e00\u9875"\x3e\x3ci class\x3d"icon-step-backward"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"page-pre page-buttons"\x3e\x3ca title\x3d"\u4e0a\u4e00\u9875"\x3e\x3ci class\x3d" icon-chevron-left"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"page-next page-buttons"\x3e\x3ca title\x3d"\u4e0b\u4e00\u9875"\x3e\x3ci class\x3d" icon-chevron-right"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"page-last page-buttons"\x3e\x3ca title\x3d"\u6700\u540e\u9875"\x3e\x3ci class\x3d"icon-step-forward"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-histroy-modal-clone-field" class\x3d"hide"\x3e\x3cdiv id\x3d"chat-daybox-clone" class\x3d"daybox"\x3e\x3cdiv class\x3d"date"\x3e\x3ctime\x3e2015-8-12\x3c/time\x3e\x3chr\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-history-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-box-clone" class\x3d"list-item j_his-list-item mine"\x3e\x3cdiv class\x3d"info"\x3e\x3cspan\x3e\u59d3\u540d\x3c/span\x3e\x3ctime\x3e12:00:02\x3c/time\x3e\x3c/div\x3e\x3cdiv class\x3d"j_chat-box-bubble"\x3e\x3cdiv class\x3d"content break"\x3e\u6d4b\u8bd5\u5185\u5bb9\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-location-clone" class\x3d"content content-position"\x3e\x3cdiv class\x3d"hd"\x3e\x3cdiv class\x3d"title hide"\x3e\u54c8\u58eb\u5947\u56fd\u9645\u9152\u5e97\x3c/div\x3e\x3cdiv class\x3d"info"\x3e\u4e0a\u6d77\u5e02\u95f5\u884c\u533a\u4e09\u9c81\u8def5588\u53f7\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"content"\x3e\x3ca class\x3d\'j_check-addr\'\x3e\x3cimg src\x3d""/\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"j_chat-back-msg-clone" class\x3d"im-chat-back-msg"\x3e\x3cspan\x3e\u64a4\u56de\u4e86\u4e00\u6761\u6d88\u606f\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"tpl-im-msg-sys" class\x3d"im-msg-sys"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-video-clone" class\x3d"hide chat-video-content"\x3e\x3cp class\x3d"weixinAudio j_weixinAudio"\x3e\x3caudio src\x3d""status\x3d"off"width\x3d"1" height\x3d"1" preload\x3e\x3c/audio\x3e\x3cspan class\x3d"db audio_area j_audio_area"\x3e\x3cspan class\x3d"db bubble dur-width j_im-video-play j_im-chat-msg-opt"\x3e\x3cspan class\x3d"audio_play_area"\x3e\x3ci class\x3d"icon_audio_default"\x3e\x3c/i\x3e\x3ci class\x3d"icon_audio_playing"\x3e\x3c/i\x3e\x3c/span\x3e\x3cspan class\x3d"time j_time"\x3e\x3cspan\x3e10\x3c/span\x3e"\x3c/span\x3e\x3c/span\x3e\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',"im.portal.imcommonwindow":'\x3cdiv id\x3d"j_communi-content" class\x3d"im-communicate-panel"\x3e\x3cdiv id \x3d "im-sys-window" class\x3d"channel-bd"\x3e\x3c/div\x3e\x3cdiv id \x3d "im-chat-window" class\x3d"channel-bd"\x3e\x3c/div\x3e\x3c/div\x3e',
"im.portal.imsysmsg":'\x3cdiv class\x3d"j_im-portal-sysmsg-head im-communicate-hd im-events-hd"\x3e\x3cdiv class\x3d"j_im-sysmsg-brand brand"\x3e\x3cimg/\x3e\x3c/div\x3e\x3cp class\x3d"j_name title ellipis"\x3e\x3c/p\x3e\x3cul class\x3d"nav j_im-sysmsg-list-switch"\x3e\x3cli class\x3d"j_unread active"\x3e\x3ca\x3e\u672a\u8bfb\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"j_readed"\x3e\x3ca\x3e\u5df2\u8bfb\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d"toollist-box"\x3e\x3cul class\x3d"j_sysmsg-head-toolbar toolkit-list"\x3e\x3cli class\x3d"j_sysmsg-stype-selector toolkit-item hide"\x3e\x3cdiv class\x3d"e-selectui dropdown dropdown-menu-toggle im-remind-dropdown dropdown-gettext"\x3e\x3ca class\x3d"selectui-result dropdown-toggle"\x3e\x3cspan class\x3d"j_select-result"\x3e\u5168\u90e8\x3c/span\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d"dropdown-menu border-dropdown j_stype-list" style\x3d"display: none;"\x3e\x3cli class\x3d"j_sysmsg-toolbar-stype"\x3e\x3ca\x3e\u5168\u90e8\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e\x3cli class\x3d"j_im-sysmsg-read-btn toolkit-item dropdown-arrow-pre hide"\x3e\x3ca class\x3d"j_im-sysmsg-read-all  btn btn-sm btn-primary"\x3e\u5168\u90e8\u6807\u8bb0\u5df2\u8bfb\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"j_im-sysmsg-read-btn toolkit-item dropdown-arrow hide"\x3e\x3cdiv class\x3d"btn-group dropdown dropdown-menu-toggle"\x3e\x3ca class\x3d"dropdown-toggle btn btn-sm btn-primary"\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d"dropdown-menu dropdown-menu-right border-dropdown"\x3e\x3cli\x3e\x3ca class\x3d"j_im-sysmsg-read-page"\x3e\u5f53\u9875\u6807\u8bb0\u5df2\u8bfb\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e\x3cli class\x3d"j_tip toolkit-item hide"\x3e\x3ci class\x3d"icon-help" data-toggle\x3d"tooltip" data-html\x3d"true" data-placement\x3d"bottom" title\x3d""data-template\x3d"\x3cdiv class\x3d\'tooltip i-tooltip\' role\x3d\'tooltip\'\x3e\x3cdiv class\x3d\'tooltip-arrow i-tooltip-arrow\'\x3e\x3c/div\x3e\x3cdiv class\x3d\'tooltip-inner i-tooltip-inner\'\x3e\x3c/div\x3e\x3c/div\x3e"\x3e\x3c/i\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"i-message-view" class\x3d"i-message-channel"\x3e\x3cdiv class\x3d"channel-bd j_hasMesInfo"\x3e\x3cdiv class\x3d"j_msglist-wrapper im-events-message-view scrollwrapper"\x3e\x3cdiv class\x3d"j_meslist im-events-message-list"\x3e\x3c/div\x3e\x3cdiv class\x3d"loading_small hide"\x3e\x3cspan\x3e\u6b63\u5728\u52a0\u8f7d\u6570\u636e\uff0c\u8bf7\u7a0d\u540e...\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"j_mesmore common-more hide"\x3e\u66f4\u591a \x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"guide-div" class\x3d"nodata-holder mt-70 j_noMesInfo hide"\x3e\x3cdiv\x3e\x3ci class\x3d"ico message"\x3e\x3c/i\x3e\x3ch4\x3e\u6682\u65f6\u6ca1\u6709\u6d88\u606f\u54e6\uff01\x3c/h4\x3e\x3cp class\x3d"small"\x3e\u6d88\u606f\uff0c\u8ba9\u60a8\u53ca\u65f6\u63a5\u6536\u5e76\u5904\u7406\u4e8b\u9879\uff0c\u63d0\u9ad8\u5185\u90e8\u5de5\u4f5c\u6548\u7387\uff01\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-sysmsg-portal-clone hide"\x3e\x3cdiv id\x3d"j_sysmsg-list-clone" class\x3d"event-message j_sysmsg-item j_read-sysmsg-item"\x3e\x3cem class\x3d"j_status status"\x3e\x3ci class\x3d"icon-envelope-alt"\x3e\x3c/i\x3e\x3c/em\x3e\x3cimg class\x3d"j_avatar avatar j_im-user-avatar-trigger cs-p" src\x3d"/static/images/avatar.png"\x3e\x3cdiv class\x3d"message-box"\x3e\x3cdiv class\x3d"hd mb-5"\x3e\x3ca class\x3d"j_user user bold c-grey j_im-user-avatar-trigger cs-p"\x3e\x3c/a\x3e\x3cdiv class\x3d"j_event event ds-i ml-5"\x3e\x3cspan class\x3d"text j_text"\x3e\x3c/span\x3e\x3cspan class\x3d"text j_entity"\x3e\x3ca class\x3d\'router j_im-sysmsg-entity-toggle hide\' data-id\x3d\'\' data-module\x3d\'\'\x3e\u4e8b\u9879\u540d\u79f0\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d\'j_im-sysmsg-option ml-10 ds-ibm hide\'\x3e\x3ca class\x3d\'btn btn-xs btn-success w-50 j_agree\'\x3e\u63a5\u53d7\x3c/a\x3e\x3ca class\x3d\'btn btn-xs btn-danger w-50 ml-10 j_refuse\'\x3e\u62d2\u7edd\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_content content mb-5"\x3e\x3cspan\x3e\x3c/span\x3e\x3ca class\x3d"j_im-sysmsg-entity-toggle"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"j_time"\x3e\x3ctime class\x3d"fs-12 c-999 date"\x3e\x3c/time\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cli class\x3d"j_sysmsg-toolbar-stype" stype\x3d"all"\x3e\x3ca\x3e\u5168\u90e8\x3c/a\x3e\x3c/li\x3e\x3ca class\x3d"at-user c-blue j_at-obj-trigger"\x3e\x3c/a\x3e\x3cdiv id\x3d"j_mesNormalBoxClone" class\x3d"event-message clearfix j_mesitem"\x3e\x3cem class\x3d"j_status status"\x3e\x3ci class\x3d"icon-envelope-alt"\x3e\x3c/i\x3e\x3c/em\x3e\x3cimg class\x3d"j_avatar avatar j_im-user-avatar-trigger cs-p hide" src\x3d"/static/images/avatar.png"/\x3e\x3cdiv class\x3d"j_mesBox message-box"\x3e\x3cdiv class\x3d"hd mb-5"\x3e\x3ca class\x3d"j_user user bold c-grey j_im-user-avatar-trigger"\x3e\x3c/a\x3e\x3cdiv class\x3d"j_event event ds-i ml-5"\x3e\x3cspan class\x3d"j_text text"\x3e\x3ca class\x3d\'router j_im-sysmsg-entity-toggle hide\' data-id\x3d\'\'data-module\x3d\'\'\x3e\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d\'j_im-sysmsg-option ml-10 ds-ibm hide\'\x3e\x3ca class\x3d\'btn btn-xs btn-success w-50 j_agree\'\x3e\u63a5\u53d7\x3c/a\x3e\x3ca class\x3d\'btn btn-xs btn-danger w-50 ml-10 j_refuse\'\x3e\u62d2\u7edd\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_content content mb-5"\x3e\x3ca class\x3d\'router j_im-sysmsg-entity-toggle hide\' data-id\x3d\'\' data-module\x3d\'\'\x3e\u4e8b\u9879\u540d\u79f0\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv\x3e\x3ctime class\x3d"fs-12 c-999 date j_date"\x3e\x3c/time\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.portal.imchatmsg":'\x3cdiv class\x3d"im-communicate-hd im-chat-hd j_im-portal-chat-head"\x3e\x3cdiv class\x3d"j_avatar cover"\x3e\x3cimg src\x3d"/static/images/avatar.png"/\x3e\x3ci class\x3d"j_user-status-dev user-status hide-im" data-toggle\x3d"tooltip" data-html\x3d"true" data-placement\x3d"bottom" title\x3d""data-template\x3d"\x3cdiv class\x3d\'tooltip i-tooltip\' role\x3d\'tooltip\'\x3e\x3cdiv class\x3d\'tooltip-arrow i-tooltip-arrow\'\x3e\x3c/div\x3e\x3cdiv class\x3d\'tooltip-inner i-tooltip-inner\'\x3e\x3c/div\x3e\x3c/div\x3e"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-name"\x3e\x3cdiv class\x3d"j_name j_im-chat-name-input chat-name-input disabled" contenteditable\x3d"false"\x3e\x3c/div\x3e\x3cdiv class\x3d"a-addmember j_members"\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"quit-channel j_im-exit-group hide-im" title\x3d"\u9000\u51fa\u7fa4\u7ec4"\x3e\x3ci class\x3d"icon-logout"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv\x3e\x3cul class\x3d"nav j_im-chat-head-tab-field ds-ib va-m"\x3e\x3cli class\x3d"j_im-chat-tab active" type\x3d"chat"\x3e\x3ca\x3e\u804a\u5929\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cul class\x3d"nav-child j_im-chat-head-tab-more-tag ds-ib va-m hide"\x3e\x3cli class\x3d"dropdown dropdown-menu-toggle"\x3e\x3ca class\x3d"dropdown-toggle"\x3e\u66f4\u591a\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d"j_im-chat-head-tab-more dropdown-menu border-dropdown"\x3e\x3c/ul\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"addmember-layer j_im-group-member-panel"\x3e\x3cdiv class\x3d"inner"\x3e\x3cul\x3e\x3cdiv class\x3d"j_chat-group-list-ul"\x3e\x3c/div\x3e\x3cli class\x3d"add"\x3e\x3ca title\x3d"\u6dfb\u52a0\u6210\u5458" class\x3d"j_im-group-add-member" data-entity\x3d"employee" data-multi\x3d"true"\x3e\x3ci class\x3d"icon-plus-thin"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-chat-view" class\x3d"im-chat-view"\x3e\x3cdiv id\x3d"im-chat-msg-container" class\x3d"chat-message-list j_im-chat-scrollbar scrollwrapper" marginbottom\x3d"178"\x3e\x3cdiv id\x3d"im-chat-list-loading" class\x3d"im-chat-loading-super-chat hide"\x3e\x3cimg style\x3d"position:absolute;" src\x3d"/static/img/global/loading_dynamic.gif"\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-list-more"\x3e\x3ca class\x3d"j_im-more-chatMessage hide"\x3e\x3ci class\x3d"icon-time"\x3e\x3c/i\x3e\u67e5\u770b\u66f4\u591a\u6d88\u606f\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"chatMessageList"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-chat-kind-msg-container" class\x3d"chat-message-kind-list j_im-chat-scrollbar scrollwrapper hide"\x3e\x3cdiv id\x3d"im-chat-list-loading" class\x3d"im-chat-loading-super-chat hide"\x3e\x3cimg style\x3d"position:absolute;" src\x3d"/static/img/global/loading_dynamic.gif"\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-list-more"\x3e\x3ca class\x3d"j_im-more-chatMessage hide"\x3e\x3ci class\x3d"icon-time"\x3e\x3c/i\x3e\u67e5\u770b\u66f4\u591a\u6d88\u606f\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"chatMessageKindList"\x3e\x3c/div\x3e\x3cdiv id\x3d"guide-div" class\x3d"nodata-holder mt-70 j_noMesInfo hide"\x3e\x3cdiv\x3e\x3ci class\x3d"ico message"\x3e\x3c/i\x3e\x3ch4\x3e\u6682\u65f6\u6ca1\u6709\u6d88\u606f\u54e6\uff01\x3c/h4\x3e\x3cp class\x3d"small"\x3e\u6d88\u606f\uff0c\u8ba9\u60a8\u53ca\u65f6\u63a5\u6536\u5e76\u5904\u7406\u4e8b\u9879\uff0c\u63d0\u9ad8\u5185\u90e8\u5de5\u4f5c\u6548\u7387\uff01\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-call j_chat-head-at-read hide" style\x3d"cursor:pointer;"\x3e\x3cdiv class\x3d"j_content-box" style\x3d"width:90%;"\x3e\x3c/div\x3e\x3ca class\x3d"close j_chat-head-at-close"\x3e\x3ci class\x3d"icon-plus-thin"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-push-top j_im-chat-unread-top hide"\x3e\x3cdiv class\x3d"item"\x3e\x3cspan class\x3d"icon-content j_im-chat-unread-top"\x3e\x3ci class\x3d"icon-angle-left"\x3e\x3c/i\x3e\x3ciclass\x3d"icon-angle-left"\x3e\x3c/i\x3e\x3c/span\x3e\x3cspan class\x3d"text j_im-chat-unread-top" number\x3d"0"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-push-bottom j_im_chat_bottom_push hide"\x3e\x3cdiv class\x3d"item"\x3e\x3cspan class\x3d"icon-content j_im-chat-scroll-bottom"\x3e\x3ci class\x3d"icon-angle-left"\x3e\x3c/i\x3e\x3ciclass\x3d"icon-angle-left"\x3e\x3c/i\x3e\x3c/span\x3e\x3cspan class\x3d"text j_im-chat-scroll-bottom" number\x3d"0"\x3e\x3c/span\x3e\x3ca class\x3d"close j_im-chat-scroll-remove"\x3e\u00d7\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-editor-div" class\x3d"chat-editor j_ichat_size_toolbox"\x3e\x3cdiv class\x3d"tool-bar j_portalchat_tool"\x3e\x3cdiv class\x3d"a-tools fl"\x3e\x3ca id\x3d"chat-image-mini" data-toggle\x3d"tooltip" data-placement\x3d"top"title\x3d"\u8bf7\u9009\u62e9\u56fe\u7247\uff0c\u53ef\u4f7f\u7528 ctrl+v \u7684\u5feb\u6377\u952e\u622a\u56fe\u9ecf\u8d34\uff0c\u6682\u65f6\u53ea\u652f\u6301chrome\u6d4f\u89c8\u5668\u3002" class\x3d"chat-pic"\x3e\x3ci class\x3d"icon-image2"\x3e\x3c/i\x3e\x3c/a\x3e\x3ca id\x3d"chat-attachment" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u8bf7\u9009\u62e9\u9644\u4ef6" class\x3d"chat-attach"\x3e\x3ci class\x3d"graph graph-upload mr-3"\x3e\x3c/i\x3e\x3c/a\x3e\x3ca id\x3d"chat-entity" data-toggle\x3d"tooltip" component-type\x3d"chat" data-placement\x3d"top" title\x3d"\u8bf7\u9009\u62e9\u4e8b\u9879"class\x3d"j_im-entity-selector-toggle chat-relevance" inputor-id\x3d"#j_message-textarea"\x3e\x3ci class\x3d"graph graph-link mr-3"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3ca id\x3d"im-portal-chat-history" class\x3d"a-his fr"\x3e\x3ci class\x3d"icon-history icoinline"\x3e\x3c/i\x3e\u804a\u5929\u8bb0\u5f55\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"content"\x3e\x3ctextarea id\x3d"j_message-textarea" class\x3d"area j_im-chat-input-area"\x3e\x3c/textarea\x3e\x3c/div\x3e\x3cdiv class\x3d"action-bar j_actionbar"\x3e\x3cdiv class\x3d"fl"\x3e\x3cspan class\x3d"j_key-tip key-tip c-666"\x3e\x3ci class\x3d"icon-exclamation-sign icoinline"\x3e\x3c/i\x3e\u6309Ctrl+Enter\u952e\u53d1\u9001\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"toolkit-list send-btns fr"\x3e\x3cli class\x3d"toolkit-item dropdown-arrow fr"\x3e\x3cdiv class\x3d"btn-group dropdown dropdown-menu-toggle"\x3e\x3ca class\x3d"dropdown-toggle btn btn-sm btn-primary"\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d"dropdown-menu dropdown-menu-right border-dropdown j_sendType_menu"\x3e\x3cli data-type\x3d"Enter"\x3e\x3ca class\x3d"sendType"\x3e\x3ci class\x3d"icon-checkmark"\x3e\x3c/i\x3e\x3cspan\x3e\u6309Enter\u53d1\u9001\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e\x3cli data-type\x3d"CtrlEnter" class\x3d"active"\x3e\x3ca class\x3d"sendType"\x3e\x3ci class\x3d"icon-checkmark"\x3e\x3c/i\x3e\x3cspan\x3e\u6309Ctrl+Enter\u53d1\u9001\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e\x3cli class\x3d"toolkit-item fr mr-0 dropdown-arrow-pre"\x3e\x3ca class\x3d"btn btn-sm w-60 btn-primary j_btn-send"\x3e\u53d1\u9001\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cspan id\x3d"limitTip" class\x3d"limit-tip c-999 fr mr-10"\x3e\u8fd8\u53ef\u4ee5\u8f93\u51651000\u5b57\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-portal-chat-clone-field" class\x3d"hide"\x3e\x3cli class\x3d"j_im-chat-tab-clone j_im-chat-tab" type\x3d"chat"\x3e\x3ca\x3e\u804a\u5929\x3c/a\x3e\x3c/li\x3e\x3ca class\x3d"at-user c-blue j_at-obj-trigger"\x3e\x3c/a\x3e\x3cli id\x3d"group-member-clone" class\x3d"j_im-user-avatar-trigger cs-p"\x3e\x3cimg class\x3d"j_im-group-member-avatar-trigger" title\x3d"" src\x3d"/static/images/avatar.png"\x3e\x3cp class\x3d"j_name ellipsis"\x3e\x3c/p\x3e\x3c/li\x3e\x3cdiv id\x3d"chat-at-notify-clone" class\x3d"content ellipsis j_chat-at-read"\x3e\x3cspan class\x3d"avatar"\x3e\x3cimg class\x3d"j_im-chat-sender-avatar-trigger" alt\x3d"avatar" src\x3d"/static/img/global/service.png"\x3e\x3c/span\x3e\x3cspan class\x3d"message"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_chatBox_clone" class\x3d"chat-message j_chat-message j_markback"\x3e\x3cdiv class\x3d"j_avatar avatar cs-p"\x3e\x3cimg class\x3d"j_im-user-avatar-trigger" src\x3d"/static/images/avatar.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-content"\x3e\x3cdiv class\x3d"j_avatar_te name  cs-p"\x3e\x3cspan class\x3d\'j_name\'\x3e\x3c/span\x3e\x3cimg class\x3d"im-chat-name-at j_im-chat-name-at" src\x3d"/static/img/im/pc/im-chat-name-at.png"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_chat-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-time j_chat-time"\x3e\x3ci class\x3d"icon-time mr-3"\x3e\x3c/i\x3e\x3ctime\x3e\x3c/time\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"j_chat-back-msg-clone" class\x3d"im-chat-back-msg"\x3e\x3cspan\x3e\u64a4\u56de\u4e86\u4e00\u6761\u6d88\u606f\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"tpl-im-msg-sys" class\x3d"im-msg-sys"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_addGroupClone" class\x3d"chat-system-hint"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_exitGroupClone" class\x3d"chat-system-hint"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_noSpeakGroupClone" class\x3d"chat-system-hint"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-content-clone" class\x3d"hide"\x3e\x3cdiv id\x3d"chat-text-clone"\x3e\x3cspan class\x3d"j_im-singlemsg-readStatus read-status unread hide-im"\x3e\u672a\u8bfb\x3c/span\x3e\x3ci class\x3d"icon-exclamation-sign mark-sign hide j_send-msg-again"   title\x3d"\u91cd\u65b0\u53d1\u9001"\x3e\x3c/i\x3e\x3cdiv class\x3d"bubble j_im-chat-msg-opt"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-attachment-clone"\x3e\x3cspan class\x3d"j_im-singlemsg-readStatus read-status unread hide-im"\x3e\u672a\u8bfb\x3c/span\x3e\x3ci class\x3d"icon-exclamation-sign mark-sign hide j_send-msg-again" title\x3d"\u91cd\u65b0\u53d1\u9001"\x3e\x3c/i\x3e\x3cdiv class\x3d"bubble j_im-chat-msg-opt mc-chat-speed"\x3e\x3cspan class\x3d"j_download"\x3e\x3c/span\x3e\x3cspan class\x3d"c_preview j_preview" style\x3d"margin-left:5px;"\x3e\x3cspan class\x3d\'hide\'\x3e\x3c/span\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  id\x3d"chat-entity-clone"\x3e\x3cspan class\x3d"j_im-singlemsg-readStatus read-status unread hide-im"\x3e\u672a\u8bfb\x3c/span\x3e\x3cdiv class\x3d"bubble j_im-chat-msg-opt bubble-records entitybox-toggle j_entity-msg-content"\x3e\x3cdiv class\x3d"info clearfix"\x3e\x3cimg class\x3d"j_im-stype-img graph" src\x3d""/\x3e\x3cdiv class\x3d"title"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"extra"\x3e\x3cspan class\x3d"italic mr-30 fl j_chat-entity-bubble-module"\x3e\u4efb\u52a1\x3c/span\x3e\x3cspan class\x3d"fr j_chat-entity-bubble-detail"\x3e\u67e5\u770b\u8be6\u60c5\x3ci\x3e\x26gt;\x3c/i\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  id\x3d"chat-location-clone"\x3e\x3cspan class\x3d"j_im-singlemsg-readStatus read-status unread hide-im"\x3e\u672a\u8bfb\x3c/span\x3e\x3cdiv class\x3d"bubble bubble-position j_location-msg-content"\x3e\x3cdiv class\x3d"hd"\x3e\x3cdiv class\x3d"title hide"\x3e\u54c8\u58eb\u5947\u56fd\u9645\u9152\u5e97\x3c/div\x3e\x3cdiv class\x3d"info"\x3e\u4e0a\u6d77\u5e02\u95f5\u884c\u533a\u4e09\u9c81\u8def5588\u53f7\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"content"\x3e\x3ca class\x3d\'j_check-addr\'\x3e\x3cimg src\x3d""/\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-video-clone"\x3e\x3cspan class\x3d"j_im-singlemsg-readStatus read-status unread hide-im"\x3e\u672a\u8bfb\x3c/span\x3e\x3cdiv  class\x3d"chat-video-content j_video-msg-content"\x3e\x3cp class\x3d"weixinAudio j_weixinAudio"\x3e\x3caudio src\x3d""status\x3d"off"width\x3d"1" height\x3d"1" preload\x3e\x3c/audio\x3e\x3cspan class\x3d"db audio_area j_audio_area"\x3e\x3cspan class\x3d"db bubble dur-width j_im-chat-msg-opt j_im-video-play"\x3e\x3cspan class\x3d"audio_play_area"\x3e\x3ci class\x3d"icon_audio_default"\x3e\x3c/i\x3e\x3ci class\x3d"icon_audio_playing"\x3e\x3c/i\x3e\x3c/span\x3e\x3cspan class\x3d"time j_time"\x3e\x3cspan\x3e10\x3c/span\x3e"\x3c/span\x3e\x3c/span\x3e\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-chat-view-ext" class\x3d"hide"\x3e\x3c/div\x3e',
"im.portal.imconnectarea":'\x3cdiv id\x3d"im-reconnect-area" class\x3d"im-member-panel bg-transparent j_im-reconnect"\x3e\x3cdiv class\x3d"im-nodata-holder"\x3e\x3cdiv\x3e\x3ci class\x3d"ico message"\x3e\x3c/i\x3e\x3cp class\x3d"small j_im-reconnect-tip"\x3e\u53ef\u80fd\u7531\u4e8e\u7f51\u7edc\u539f\u56e0\x3cbr/\x3e\u94fe\u63a5\x3cspan\x3eIM\x3c/span\x3e\u5931\u8d25\x3c/p\x3e\x3cdiv class\x3d"btn-div"\x3e\x3ca class\x3d"btn btn-sm btn-primary a-submit j_im-connect-start"\x3e\u91cd\u65b0\u94fe\u63a5\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"minichat.pasteimage":'\x3cdiv id\x3d"pasteimg" class\x3d"pasteimg-modal j_im-frame-show-panel modal fade form-horizontal"\x3e\x3cdiv class\x3d"modal-dialog"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"modal-header"\x3e\x3cbutton type\x3d"button" class\x3d"close j_im-close-pasteimg" data-dismiss\x3d"modal" aria-hidden\x3d"true"\x3e\u00d7\x3c/button\x3e\x3ch5 class\x3d"modal-title"\x3e\u53d1\u9001\u56fe\u7247\x3c/h5\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-body"\x3e\x3cdiv class\x3d"paste-img ta-c"\x3e\x3cimg src\x3d"" style\x3d"vertical-align: middle;" /\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-footer ta-c"\x3e\x3ca id\x3d"testoiu" class\x3d"btn btn-sm btn-success w-60"\x3e\u53d1\u9001\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"imchat.minichat":'\x3cdiv id\x3d"im-frame-container" class\x3d"im-frame off j_im-frame-container j_im-resize-window j_im-frame-show-panel"\x3e\x3cdiv id\x3d"im-shake-div" style\x3d"    position: relative;"\x3e\x3cdiv class\x3d"frame-panel j_im-size-sideview" style\x3d"height: 100%;"\x3e\x3cdiv id\x3d"im-addrlist-container"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-wincom-container" class\x3d"frame-mainview hide-im j_im-size-mainview"\x3e\x3c/div\x3e\x3cdiv id\x3d"im-noresult-container" class\x3d"frame-mainview j_im-size-mainview"\x3e\x3cdiv class\x3d"view-head j_view-head"\x3e\x3cdiv class\x3d"head-actions"\x3e\x3ca class\x3d"action-mini j_mini-chat-index-to-min "\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"guide-div" class\x3d"im-nodata-holder mt-70 j_noMesInfo"\x3e\x3cdiv\x3e\x3ci class\x3d"ico message"\x3e\x3c/i\x3e\x3cp class\x3d"small"\x3e\u6d88\u606f\uff0c\u8ba9\u60a8\u53ca\u65f6\u63a5\u6536\u5e76\u5904\u7406\u4e8b\u9879\uff0c\u63d0\u9ad8\u5185\u90e8\u5de5\u4f5c\u6548\u7387\uff01\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-trigger j_im-trigger j_im-frame-show-panel" id\x3d"imTriggerBtns"\x3e\x3cdiv class\x3d"im-reminds j_im-reminds"\x3e\x3cdiv class\x3d"im-reminds-list j_im-reminds-list"\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"112"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u672a\u8bfb\u65e5\u62a5\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"106"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u672a\u8bfb\u4e8b\u9879\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"107"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u65b0\u5b8c\u6210\u4e8b\u9879\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"108"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u4e8b\u9879\u65b0\u53cd\u9988\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"109"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e@\u6211\u7684\u65b0\u53cd\u9988\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"110"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u63d0\u9192\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"101"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u5173\u6ce8\u7533\u8bf7\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge "\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"102"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u52a0\u5165\u7533\u8bf7\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"103"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u5171\u4eab\u7533\u8bf7\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"list-item j_im-remind-item" sgroup\x3d"chat"\x3e\x3cdiv class\x3d"item-brand j_item-brand"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"item-name"\x3e\u5de5\u4f5c\u6d88\u606f\x3c/div\x3e\x3cdiv class\x3d"item-badge j_item-badge"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-mini-member-trigger trigger-item j_open-im-frame"   data-toggle\x3d"tooltip" data-placement\x3d"left" title\x3d"\u60a8\u53ef\u4ee5\u4f7f\u7528\u7ec4\u5408\u952e\uff08Alt + Z\uff09\u8fdb\u884c\u7a97\u53e3\u7684\u5c55\u5f00\u548c\u6700\u5c0f\u5316"\x3e\x3ci class\x3d"icon-comments"\x3e\x3c/i\x3e\x3cspan class\x3d"text"\x3e\u5de5\u4f5c\u6d88\u606f\x3c/span\x3e\x3cspan class\x3d"count j_im-mini-msg-number"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',
"imchat.imaddrlist":'\x3cdiv class\x3d"panel-search j_panel-search"\x3e\x3cinput type\x3d"text" placeholder\x3d"\u641c\u7d22" class\x3d"form-control form-control-block j_im-addrlist-search-input"/\x3e\x3ci class\x3d"icon-search"\x3e\x3c/i\x3e\x3ci class\x3d"icon-remove-sign j_im-clear-search-value cs-p" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6e05\u7a7a\u641c\u7d22\u5185\u5bb9\u5e76\u8fd4\u56de\u4e0a\u7ea7\u5217\u8868"\x3e\x3c/i\x3e\x3cdiv class\x3d"im-group-trigger j_create-chat-group"\x3e\x3ca class\x3d"" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u521b\u5efa\u7fa4\u7ec4"\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-tabbar j_im-addrlist-tab-container"\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab" type\x3d"session"\x3e\x3cdiv class\x3d"tab-block active"\x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6700\u8fd1\u4f1a\u8bdd"\x3e\x3c/i\x3e\x3cspan class\x3d"count j_session-allcount"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab user" type\x3d"user"\x3e\x3cdiv class\x3d"tab-block"\x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u901a\u8baf\u5f55"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab group" type\x3d"group"\x3e\x3cdiv class\x3d"tab-block"\x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u7fa4\u7ec4"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-list  j_im-addrlist-scrollbar j_im-list-body scrollwrapper"\x3e\x3cdiv class\x3d"im-recent-list j_im-member-list j_im-session-container" type\x3d"session"\x3e\x3cdiv class\x3d"j_im-session-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-recent-list j_im-member-list j_im-service-container hide-im" type\x3d"service"\x3e\x3cdiv class\x3d"list-header clearfix"\x3e\x3cdiv class\x3d"action"\x3e\x3ca class\x3d"j_im-return-service-session"\x3e\x3ci class\x3d"icon-reply" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u8fd4\u56de"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"title"\x3e\u5ba2\u670d\u7fa4\u5217\u8868\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-service-session-container scrollwrapper j_im-addrlist-scrollbar"\x3e\x3cdiv class\x3d"im-no-result j_no-result"\x3e\u65e0\u6570\u636e\x3c/div\x3e\x3cdiv class\x3d"j_im-service-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-member-list j_im-member-list hide-im j_im-addruser-container" type\x3d"user"\x3e\x3cdiv class\x3d"j_im-addruser-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-member-list j_im-member-list hide-im j_im-addrgroup-container" type\x3d"group"\x3e\x3cdiv class\x3d\'im-no-result j_no-result hide-im\'\x3e\u60a8\u8fd8\u6ca1\u6709\u52a0\u5165\u6216\u521b\u5efa\u8fc7\u7fa4\u7ec4\uff0c\u82e5\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u5728\u4e0e\u540c\u4e8b\u7684\u5bf9\u8bdd\u754c\u9762\u76f4\u63a5\u6dfb\u52a0\u6210\u5458\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5efa\u7acb\u65b0\u7fa4\u7ec4\x3c/div\x3e\x3cdiv class\x3d"j_im-addrgroup-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-member-list j_im-member-list hide-im j_im-addrsearch-container" type\x3d"search"\x3e\x3cdiv class\x3d"j_im-addrsearch-list"\x3e\x3c/div\x3e\x3cdiv class\x3d"im-no-result j_no-result hide-im"\x3e\u65e0\u641c\u7d22\u7ed3\u679c\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-addrlist-clone-field" class\x3d"hide-im"\x3e\x3cdiv id\x3d"im-session-one-clone" class\x3d"list-item list-item-entity j_list-item j_im-session-opt" order\x3d100\x3e\x3cdiv class\x3d"avatar j_avatar"\x3e\x3cimg src\x3d"/static/images/avatar.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"info"\x3e\x3cdiv class\x3d"name"\x3e\x3cdiv class\x3d"text j_name"\x3e\x3c/div\x3e\x3cdiv class\x3d"mark-tag j_entity-mark-tag hide-im"\x3e\u4e8b\u9879\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"msg"\x3e\x3cspan class\x3d"hide-im sp-atme j_draft"\x3e[\u8349\u7a3f]\x3c/span\x3e\x3cspan class\x3d"hide-im sp-atme j_atme"\x3e[\u6709\u4eba@\u6211]\x3c/span\x3e\x3cspan class\x3d"hide-im sp-atme j_replyme"\x3e[\u6709\u65b0\u56de\u590d]\x3c/span\x3e\x3cspan class\x3d"sp-txt j_info"\x3e\x3c/span\x3e\x3cspan class\x3d"sp-txt j_draft-text hide-im"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"date j_date"\x3e\x3c/div\x3e\x3cdiv class\x3d"count j_count"\x3e\x3c/div\x3e\x3cspan class\x3d"j_im-not-remind-mark nodisturb-mark hide-im"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"im-pinyin-clone" class\x3d"list-group"\x3e\x3cdiv class\x3d"group-head j_group-head"\x3e#\x3c/div\x3e\x3cdiv class\x3d"group-body"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-address-user-clone" class\x3d"list-item im-list-addruser-item j_list-item j_im-singleChat im-cp"\x3e\x3cdiv class\x3d"avatar j_avatar"\x3e\x3cimg src\x3d"/static/images/avatar.png"/\x3e\x3ci class\x3d"j_user-status-dev im-user-status hide-im" data-toggle\x3d"tooltip" data-html\x3d"true"data-placement\x3d"bottom" title\x3d"\u8be5\u7528\u6237\u4e0d\u5728\u7ebf"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"name j_name"\x3e\u738b\u51b2\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-address-group-clone" class\x3d"list-item j_list-item j_im-groupChat im-cp"\x3e\x3cdiv class\x3d"avatar j_avatar"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"name j_name"\x3e\u8ba8\u8bba\u7ec4\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"imchat.imwincom":'\x3cdiv id\x3d"im-chatwin-container"\x3e\x3c/div\x3e\x3cdiv id\x3d"im-syswin-container"\x3e\x3c/div\x3e\x3cdiv id\x3d"im-thirdwin-container"\x3e\x3c/div\x3e',"imchat.imchatwin":'\x3cdiv class\x3d"view-head j_view-head"\x3e\x3cdiv class\x3d"j_im-user-avatar-trigger head-name j_name j_im-chat-name-input" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d""\x3e\u540d\u79f0\x3c/div\x3e\x3cdiv class\x3d"j_im-group-exit-tag exit-tag hide-im"\x3e\u5df2\u9000\u51fa\x3c/div\x3e\x3cdiv class\x3d"j_im-group-entity-tag entity-tag hide-im"\x3e\u4e8b\u9879\x3c/div\x3e\x3ci class\x3d"j_user-status-dev im-user-status hide-im" data-toggle\x3d"tooltip" data-html\x3d"true" data-placement\x3d"bottom" title\x3d""\x3e\x3c/i\x3e\x3cdiv class\x3d"head-actions"\x3e\x3ca class\x3d"action-add j_im-group-add-member" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6dfb\u52a0\u7fa4\u6210\u5458"\x3e\x3c/a\x3e\x3ca class\x3d"action-cog j_im-open-group-detail  hide-im" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6253\u5f00\u7fa4\u8be6\u60c5"\x3e\x3c/a\x3e\x3ca class\x3d"action-quit j_im-open-group-panel" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6253\u5f00\u6210\u5458\u5217\u8868"\x3e\x3c/a\x3e\x3ca class\x3d"action-mini j_mini-chat-index-to-min"  data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6700\u5c0f\u5316"\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"view-body"\x3e\x3cdiv class\x3d"im-chat-view"\x3e\x3cdiv class\x3d"chat-tabbar"\x3e\x3cdiv class\x3d" j_chat-tabbar im-re-inline"\x3e\x3cdiv class\x3d"tab-item active j_im-chat-tab j_im-chat-kind-tab"\x3e\u804a\u5929\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-chat-head-tab-more-tag ds-ib im-re-inline hide-im"\x3e\x3cli class\x3d"dropdown dropdown-menu-toggle ls-n"\x3e\x3ca class\x3d"dropdown-toggle tab-more-item"\x3e\u66f4\u591a\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d"j_im-chat-head-tab-more-list dropdown-menu border-dropdown hide"\x3e\x3c/ul\x3e\x3c/li\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-message-view scrollwrapper j_im-chatwin-msg-container j_im-chatwin-msg-scrollbar" marginbottom\x3d"149"\x3e\x3cdiv class\x3d"chat-list-more"\x3e\x3ca class\x3d"j_im-more-chatMessage hide"\x3e\x3ci class\x3d"icon-time"\x3e\x3c/i\x3e\u67e5\u770b\u66f4\u591a\u6d88\u606f\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-message-list j_im-chatwin-msg-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-message-view scrollwrapper j_im-chatwin-msg-ext-container j_im-chatwin-msg-scrollbar hide"\x3e\x3cdiv class\x3d"chat-list-more"\x3e\x3ca class\x3d"j_im-more-chatMessage hide"\x3e\x3ci class\x3d"icon-time"\x3e\x3c/i\x3e\u67e5\u770b\u66f4\u591a\u6d88\u606f\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-message-list j_im-chatwin-msg-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-message-view j_im-chatwin-kind-msg-container j_im-chatwin-msg-scrollbar scrollwrapper hide"\x3e\x3cdiv class\x3d"chat-list-more"\x3e\x3ca class\x3d"j_im-more-chatMessage hide"\x3e\x3ci class\x3d"icon-time"\x3e\x3c/i\x3e\u67e5\u770b\u66f4\u591a\u6d88\u606f\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-message-list j_im-chatwin-msg-list"\x3e\x3c/div\x3e\x3cdiv id\x3d"guide-div" class\x3d"im-nodata-holder mt-70 j_noMesInfo hide"\x3e\x3cdiv\x3e\x3ci class\x3d"ico message"\x3e\x3c/i\x3e\x3ch4\x3e\u6682\u65f6\u6ca1\u6709\u6d88\u606f\u54e6\uff01\x3c/h4\x3e\x3cp class\x3d"small"\x3e\u6d88\u606f\uff0c\u8ba9\u60a8\u53ca\u65f6\u63a5\u6536\u5e76\u5904\u7406\u4e8b\u9879\uff0c\u63d0\u9ad8\u5185\u90e8\u5de5\u4f5c\u6548\u7387\uff01\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-editor-div" class\x3d"chat-editor j_im-size-editor"\x3e\x3cdiv class\x3d"tool-bar"\x3e\x3cdiv class\x3d"tools-unit fl j_im-chatwin-toolbar"\x3e\x3cdiv class\x3d"tool-item j_tool-item"\x3e\x3ca id\x3d"chat-attachment" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u8bf7\u9009\u62e9\u9644\u4ef6" class\x3d"a-attach"\x3e\x3ci class\x3d"icon-attachment"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"tool-item j_tool-item-emoji"\x3e\x3c/div\x3e\x3cdiv class\x3d"tool-item j_tool-item"\x3e\x3ca id\x3d"chat-image-mini" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u8bf7\u9009\u62e9\u56fe\u7247\uff0c\u53ef\u4f7f\u7528 ctrl+v \u7684\u5feb\u6377\u952e\u622a\u56fe\u9ecf\u8d34\uff0c\u6682\u65f6\u53ea\u652f\u6301chrome\u6d4f\u89c8\u5668\u3002" class\x3d"a-pic"\x3e\x3ci class\x3d"icon-image2"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"tool-item j_tool-item j_im-send-shakemsg-item"\x3e\x3ca\x3e\x3ci class\x3d"im-icon-shake  j_im-send-shakemsg" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u53d1\u9001\u7a97\u53e3\u6296\u52a8" \x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"tool-item j_tool-item"\x3e\x3ca id\x3d"chat-entity" data-toggle\x3d"tooltip" component-type\x3d"chat" data-placement\x3d"top" title\x3d"\u8bf7\u9009\u62e9\u4e8b\u9879"  class\x3d"j_im-entity-selector-toggle chat-relevance" inputor-id\x3d"#im-chatwin-textarea"\x3e\x3ci class\x3d"icon-share2"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"tool-item j_tool-item-at"\x3e\x3c/div\x3e\x3c/div\x3e\x3ca id\x3d"im-chatwin-history" class\x3d"a-his fr"\x3e\x3ci class\x3d"icon-history" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u804a\u5929\u8bb0\u5f55"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"content"\x3e\x3cdiv class\x3d"reply-info j_input-reply-content-field j_reply-info-trigger hide-im"\x3e\x3cdiv class\x3d"info-base j_info-base"\x3e\x3cspan class\x3d"name j_name"\x3e\x3c/span\x3e\x3cspan class\x3d"date j_date"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"info-detail j_info-detail"\x3e\x3c/div\x3e\x3c/div\x3e\x3ctextarea id\x3d"im-chatwin-textarea" class\x3d"area j_im-chatwin-textarea eui-scroll"\x3e\x3c/textarea\x3e\x3c/div\x3e\x3cdiv class\x3d"action-bar clearfix j_actionbar"\x3e\x3cdiv class\x3d"hint-key"\x3e\x3cspan class\x3d"j_key-tip"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"toolkit-list send-btns fr j_im-chatwin-send-btns"\x3e\x3cli class\x3d"toolkit-item dropdown-arrow fr last"\x3e\x3cdiv class\x3d"btn-group dropdown dropdown-menu-toggle"\x3e\x3ca class\x3d"dropdown-toggle btn btn-sm btn-primary"\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cul class\x3d"dropdown-menu dropdown-menu-right border-dropdown j_sendType_menu" data-type\x3d"CtrlEnter"\x3e\x3cli data-type\x3d"Enter" class\x3d"j_sendType_li"\x3e\x3ca class\x3d"sendType"\x3e\x3ci class\x3d"icon-checkmark"\x3e\x3c/i\x3e\x3cspan\x3e\u6309Enter\u53d1\u9001\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e\x3cli data-type\x3d"CtrlEnter" class\x3d"j_sendType_li active"\x3e\x3ca class\x3d"sendType"\x3e\x3ci class\x3d"icon-checkmark"\x3e\x3c/i\x3e\x3cspan\x3e\u6309Ctrl+Enter\u53d1\u9001\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e\x3cli class\x3d"toolkit-item fr dropdown-arrow-pre"\x3e\x3ca class\x3d"btn btn-sm btn-primary send-btn j_btn-send j_im-chat-send"\x3e\u53d1\u9001\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv id\x3d"limitTip" class\x3d"hint-limit"\x3e\u8fd8\u53ef\u4ee5\u8f93\u51651000\u5b57\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-call j_chat-call  j_chat-head-at-read hide-im"\x3e\x3ca class\x3d"close j_close-chat-top-tip"\x3e\u00d7\x3c/a\x3e\x3cdiv class\x3d"content j_content-box"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-call j_chat-call j_im-notify-tip hide-im"\x3e\x3ca class\x3d"close j_close-chat-top-tip"\x3e\u00d7\x3c/a\x3e\x3cdiv class\x3d"content j_content-box"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-push-top  j_im-chat-unread-top hide"\x3e\x3ci class\x3d"icon-angle-up"\x3e\x3c/i\x3e\x3cspan class\x3d"content j_text"\x3e\u6d88\u606f\u901a\u77e5\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-push-bottom  j_im-chat-bottom-push hide"\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3cspan class\x3d"content j_text" number\x3d"0"\x3e2 \u6761\u6d88\u606f\x3c/span\x3e\x3ca class\x3d"close j_im-chat-scroll-remove"\x3e\u00d7\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  class\x3d"im-chatgroup-view j_im-chatgroup-view off"\x3e\x3cdiv class\x3d"chatgroup-info j_chatgroup-info"\x3e\x3cdiv class\x3d"title"\x3e\u7fa4\u516c\u544a\x3c/div\x3e\x3cdiv class\x3d"explain j_explain" auto-scroll\x3d"yes" \x3e\x3cdiv class\x3d"j_value"\x3e\u6682\u65e0\u7fa4\u516c\u544a\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"chatgroup-member j_im-group-member-panel"\x3e\x3cdiv class\x3d"member-search j_member-search"\x3e\x3cspan class\x3d"status"\x3e\u6210\u5458\x3c/span\x3e\x3cspan class\x3d"status j_group-member-online" style\x3d"margin-left: 5px;"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"groupMemberScroll scrollwrapper"\x3e\x3cdiv class\x3d"member-list j_im-group-member-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-chatwin-clone-field" class\x3d"hide"\x3e\x3cdiv class\x3d"j_im-chat-tab-clone  j_im-chat-tab tab-item" type\x3d"chat"\x3e\u804a\u5929\x3c/div\x3e\x3cli class\x3d"j_im-chat-tab-more-clone j_im-chat-tab-more " type\x3d"chat"\x3e\x3ca\x3e\u8bed\u97f3\x3c/a\x3e\x3c/li\x3e\x3ca class\x3d"at-user c-blue j_at-obj-trigger"\x3e\x3c/a\x3e\x3cli id\x3d"group-member-clone" class\x3d"j_im-user-avatar-trigger cs-p"\x3e\x3cimg class\x3d"j_im-group-member-avatar-trigger" src\x3d"/static/images/avatar.png"\x3e\x3cp class\x3d"j_name ellipsis"\x3e\x3c/p\x3e\x3c/li\x3e\x3cdiv id\x3d"chat-at-notify-clone" class\x3d"content ellipsis j_chat-at-read"\x3e\x3cspan class\x3d"avatar"\x3e\x3cimg class\x3d"j_im-chat-sender-avatar-trigger" alt\x3d"avatar" src\x3d"/static/img/global/service.png"\x3e\x3c/span\x3e\x3cspan class\x3d"message"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"im-chat-message-clone" class\x3d"chat-message j_chat-message j_markback"\x3e\x3cdiv class\x3d"j_avatar avatar"\x3e\x3cimg class\x3d"j_im-user-avatar-trigger im-cp" src\x3d"/static/images/avatar.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-content j_im-chat-content"\x3e\x3cdiv class\x3d"name usercard-toggle"\x3e\x3cspan class\x3d\'j_name im-cp\'\x3e\x3c/span\x3e\x3cimg class\x3d"im-chat-name-at j_im-chat-name-at" src\x3d"/static/img/im/pc/im-chat-name-at.png"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_chat-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"chat-time"\x3e\x3ctime\x3e\x3c/time\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"j_chat-back-msg-clone" class\x3d"im-chat-back-msg"\x3e\x3cspan\x3e\u64a4\u56de\u4e86\u4e00\u6761\u6d88\u606f\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_chat-member-msg-clone" class\x3d"j_im-chat-member-msg im-chat-back-msg"\x3e\x3cspan\x3e\u64a4\u56de\u4e86\u4e00\u6761\u6d88\u606f\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"tpl-im-msg-sys" class\x3d"im-msg-sys"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_addGroupClone" class\x3d"chat-system-hint"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_exitGroupClone" class\x3d"chat-system-hint"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"j_noSpeakGroupClone" class\x3d"chat-system-hint"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-content-clone" class\x3d"hide"\x3e\x3cdiv id\x3d"chat-text-clone"\x3e\x3cspan class\x3d"j_im-chatmsg-readStatus read-status unread hide-im"\x3e\x3c/span\x3e\x3ci class\x3d"icon-exclamation-sign mark-sign hide j_send-msg-again" title\x3d"\u91cd\u65b0\u53d1\u9001"\x3e\x3c/i\x3e\x3cdiv class\x3d"bubble j_bubble j_im-chat-msg-opt"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-image-clone"\x3e\x3cspan class\x3d"j_im-chatmsg-readStatus read-status unread hide-im"\x3e\x3c/span\x3e\x3ci class\x3d"icon-exclamation-sign mark-sign hide j_send-msg-again" title\x3d"\u91cd\u65b0\u53d1\u9001"\x3e\x3c/i\x3e\x3cdiv class\x3d"bubble j_bubble j_im-chat-msg-opt"\x3e\x3ca onclick\x3d"$.openPhotoGallery(this)" imghref\x3d"" class\x3d"gallery-pic" \x3e\x3cimg src\x3d""/\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-attachment-clone"\x3e\x3cspan class\x3d"j_im-chatmsg-readStatus read-status unread hide-im"\x3e\x3c/span\x3e\x3ci class\x3d"icon-exclamation-sign mark-sign hide j_send-msg-again" title\x3d"\u91cd\u65b0\u53d1\u9001"\x3e\x3c/i\x3e\x3cdiv class\x3d"bubble j_im-chat-msg-opt mc-chat-speed"\x3e\x3cspan class\x3d"j_download "\x3e\x3c/span\x3e\x3cspan class\x3d"c_preview j_preview" style\x3d"margin-left:5px;"\x3e\x3cspan class\x3d\'hide\'\x3e\x3c/span\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  id\x3d"chat-entity-clone"\x3e\x3cspan class\x3d"j_im-chatmsg-readStatus read-status unread hide-im"\x3e\x3c/span\x3e\x3cdiv class\x3d"bubble j_im-chat-msg-opt bubble-records entitybox-toggle j_entity-msg-content"\x3e\x3cdiv class\x3d"info clearfix"\x3e\x3cimg class\x3d"j_im-stype-img graph" src\x3d""/\x3e\x3cdiv class\x3d"title"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"extra"\x3e\x3cspan class\x3d"fl j_chat-entity-bubble-module im-chat-entity-bubble-module"\x3e\u4efb\u52a1\x3c/span\x3e\x3cspan class\x3d"fr j_chat-entity-bubble-detail"\x3e\u8be6\u60c5\x3ci\x3e\x26gt;\x3c/i\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv  id\x3d"chat-location-clone"\x3e\x3cspan class\x3d"j_im-chatmsg-readStatus read-status unread hide-im"\x3e\x3c/span\x3e\x3cdiv  class\x3d"bubble bubble-position j_im-chat-msg-opt"\x3e\x3cdiv class\x3d"hd"\x3e\x3cdiv class\x3d"title hide"\x3e\u54c8\u58eb\u5947\u56fd\u9645\u9152\u5e97\x3c/div\x3e\x3cdiv class\x3d"info"\x3e\u4e0a\u6d77\u5e02\u95f5\u884c\u533a\u4e09\u9c81\u8def5588\u53f7\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"content "\x3e\x3ca class\x3d\'j_check-addr\'\x3e\x3cimg src\x3d""/\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"chat-video-clone"\x3e\x3cspan class\x3d"j_im-chatmsg-readStatus read-status unread hide-im"\x3e\x3c/span\x3e\x3cdiv  class\x3d"hide chat-video-content"\x3e\x3cp class\x3d"weixinAudio j_weixinAudio"\x3e\x3caudio src\x3d""status\x3d"off"width\x3d"1" height\x3d"1" preload\x3e\x3c/audio\x3e\x3cspan class\x3d"db audio_area j_audio_area"\x3e\x3cspan class\x3d"db bubble dur-width j_im-chat-msg-opt j_im-video-play"\x3e\x3cspan class\x3d"audio_play_area"\x3e\x3ci class\x3d"icon_audio_default"\x3e\x3c/i\x3e\x3ci class\x3d"icon_audio_playing"\x3e\x3c/i\x3e\x3c/span\x3e\x3cspan class\x3d"time j_time"\x3e\x3cspan\x3e10\x3c/span\x3e"\x3c/span\x3e\x3c/span\x3e\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-chatwin-group-clone" class\x3d"list-item j_im-chatwin-group-item j_im-user-avatar-trigger "\x3e\x3cdiv class\x3d"avatar j_avatar"\x3e\x3cimg src\x3d"/static/images/avatar.png"/\x3e\x3ci class\x3d"j_user-status-dev im-user-status hide-im" data-toggle\x3d"tooltip" data-html\x3d"true"data-placement\x3d"bottom" title\x3d"\u8be5\u7528\u6237\u4e0d\u5728\u7ebf"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"name j_name"\x3e\u738b\u51b2\x3c/div\x3e\x3cdiv class\x3d"j_im-group-member-role role hide-im"  \x3e\x3cimg src\x3d"" data-toggle\x3d"tooltip" data-placement\x3d"top"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"reply-info j_im-chat-reply-info-clone"\x3e\x3cdiv class\x3d"info-base j_info-base"\x3e\x3cspan class\x3d"name j_name"\x3e\x3c/span\x3e\x3cspan class\x3d"date j_date"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"info-detail j_info-detail"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"bubble bubble-reply j_chatmsg-reply-bubble-clone"\x3e\x3cdiv class\x3d"reply-info j_reply-info j_reply-info-trigger"\x3e\x3cp\x3e\x3cspan class\x3d"username j_name"\x3e\x3c/span\x3e\x3cspan class\x3d"date j_date"\x3e\x3c/span\x3e\x3c/p\x3e\x3cp class\x3d"details j_reply-details"\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"reply-content j_reply-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"imchat.imsyswin":'\x3cdiv class\x3d"view-head j_view-head"\x3e\x3cdiv class\x3d"head-name j_name"\x3e\u5173\u6ce8\u7533\u8bf7\x3c/div\x3e\x3cdiv class\x3d"head-actions"\x3e\x3ca class\x3d"action-mini j_mini-chat-index-to-min"  data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6700\u5c0f\u5316"\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"view-body"\x3e\x3cdiv class\x3d"im-chat-view"\x3e\x3cdiv class\x3d"chat-tabbar j_im-sysmsg-list-switch"\x3e\x3cdiv class\x3d"tab-item j_unread active"\x3e\u672a\u8bfb\x3c/div\x3e\x3cdiv class\x3d"tab-item j_readed"\x3e\u5df2\u8bfb\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"imapp-message-actions j_syswin-filter-container"\x3e\x3cdiv class\x3d"j_sysmsg-stype-selector action-item dropdown dropdown-menu-toggle hide-im"\x3e\x3ca class\x3d"dropdown-toggle"\x3e\x3cspan class\x3d"j_select-result"\x3e\u5168\u90e8\x3c/span\x3e\x3ci class\x3d"icon-angle-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cdiv class\x3d"dropdown-menu action-dropdown dropdown-div"\x3e\x3cdiv class\x3d"action-dropmenus j_filter-selector"\x3e\x3cdiv class\x3d"j_sysmsg-toolbar-stype menu-item"\x3e\u5168\u90e8\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"action-item j_im-sysmsg-read-btn"\x3e\x3ca class\x3d"j_im-sysmsg-read-all"\x3e\x3ci class\x3d"graph graph-markall"  data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u5168\u90e8\u6807\u8bb0\u5df2\u8bfb"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"imapp-message-view j_im-syswin-msg-container j_im-syswin-msg-scrollbar scrollwrapper"\x3e\x3cdiv class\x3d"imapp-message-list j_im-syswin-msg-list "\x3e\x3c/div\x3e\x3cdiv id\x3d"guide-div" class\x3d"im-nodata-holder mt-70 j_noMesInfo hide"\x3e\x3cdiv\x3e\x3ci class\x3d"ico message"\x3e\x3c/i\x3e\x3ch4\x3e\u6682\u65f6\u6ca1\u6709\u6d88\u606f\u54e6\uff01\x3c/h4\x3e\x3cp class\x3d"small"\x3e\u6d88\u606f\uff0c\u8ba9\u60a8\u53ca\u65f6\u63a5\u6536\u5e76\u5904\u7406\u4e8b\u9879\uff0c\u63d0\u9ad8\u5185\u90e8\u5de5\u4f5c\u6548\u7387\uff01\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-syswin-clone-field" class\x3d"hide"\x3e\x3cdiv id\x3d"im-sys-msg-clone" class\x3d"message-item j_sysmsg-item j_read-sysmsg-item"\x3e\x3cdiv class\x3d"avatar j_avatar j_im-user-avatar-trigger cs-p"\x3e\x3cimg src\x3d"/static/images/avatar.png"\x3e\x3c/div\x3e\x3cem class\x3d"j_status status"\x3e\x3ci class\x3d"icon-envelope-alt im-cp" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6807\u8bb0\u5df2\u8bfb"\x3e\x3c/i\x3e\x3c/em\x3e\x3cdiv class\x3d"message-box"\x3e\x3cdiv class\x3d"box-hd"\x3e\x3cspan class\x3d"username j_im-user-avatar-trigger j_user cs-p"\x3e\u6797\u4f73\u5b87\x3c/span\x3e\x3cspan class\x3d"event j_text"\x3e\u5411\u60a8\u53d1\u9001\u4e86\u4e00\u6761\u7cfb\u7edf\u6d88\u606f\x3c/span\x3e\x3cspan class\x3d"getmore j_entity"\x3e\x3ca class\x3d"j_im-sysmsg-entity-toggle"\x3e\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"box-content j_content"\x3e\x3ca class\x3d"j_im-sysmsg-entity-toggle"\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"box-ft"\x3e\x3cspan class\x3d"date j_time"\x3e09-30 12:34:56\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"box-btns j_im-sysmsg-option hide"\x3e\x3ca class\x3d"btn btn-sm j_refuse"\x3e\u62d2\u7edd\x3c/a\x3e\x3ca class\x3d"btn btn-sm btn-primary j_agree"\x3e\u63a5\u53d7\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"hide"\x3e\x3cdiv stype\x3d"all" class\x3d"j_sysmsg-toolbar-stype menu-item"\x3e\x3c/div\x3e\x3c/div\x3e\x3ca class\x3d"at-user c-blue j_at-obj-trigger"\x3e\x3c/a\x3e\x3c/div\x3e',
"imchat.imthirdwin":'\x3cdiv class\x3d"view-head j_view-head"\x3e\x3cdiv class\x3d"head-name j_name"\x3e\u5173\u6ce8\u7533\u8bf7\x3c/div\x3e\x3cdiv class\x3d"head-actions"\x3e\x3ca class\x3d"j_im-thirdMsg-read-all action-readAll" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u5168\u90e8\u6807\u8bb0\u5df2\u8bfb"\x3e\x3c/a\x3e\x3ca class\x3d"action-mini j_mini-chat-index-to-min"  data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6700\u5c0f\u5316"\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-thirdwin-content" style\x3d"border-top: 1px solid #eee;"\x3e\x3c/div\x3e',
"imchat.immsgreadstatus":'\x3cdiv id\x3d"im-chat-msgreadstatus-modal" class\x3d"modal fade j_im-chat-msgreadstatus-modal-show"\x3e\x3cdiv class\x3d"modal-dialog im-chat-readstatus-modal"\x3e\x3cdiv class\x3d"modal-content im-chat-readstatus-modal-content"\x3e\x3cdiv class\x3d"modal-header im-chat-readstatus-modal-header"\x3e\x3cspan\x3e\u6d88\u606f\u63a5\u6536\u4eba\u5217\u8868\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-body im-chat-readstatus-modal-body"\x3e\x3cdiv class\x3d"j_msg-unread-container hide"\x3e\x3cdiv class\x3d"title"\x3e\x3cspan\x3e\u672a\u8bfb\u6210\u5458\x3c/span\x3e\x3cspan class\x3d"j_count"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"j_msg-unread-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_msg-readed-container hide"\x3e\x3cdiv class\x3d"title"\x3e\x3cspan\x3e\u5df2\u8bfb\u6210\u5458\x3c/span\x3e\x3cspan class\x3d"j_count"\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"j_msg-readed-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "im-chat-msgreadstatus-modal-clone-field" class\x3d"hide"\x3e\x3cdiv id\x3d"group-member-clone" class\x3d"group-member j_group-member" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d""\x3e\x3cimg class\x3d"j_im-group-member-avatar-trigger avatar j_avatar im-cp" title\x3d"" src\x3d"/static/images/avatar.png"\x3e\x3cp class\x3d"j_name name ellipsis j_im-group-member-avatar-trigger\tim-cp"\x3e\u5c0f\u52a9\u624b\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"imchat.imgroupdetail":'\x3cdiv id\x3d"im-chat-imgroupdetail-modal" class\x3d"modal fade im-groupsetting-modal "\x3e\x3cdiv class\x3d"modal-dialog "\x3e\x3cdiv class\x3d"modal-content j_closeImGroupDetailPanel j_im-frame-show-panel j_im-chat-imgroupdetail-modal-content"\x3e\x3cdiv class\x3d"j_main-content"\x3e\x3cdiv class\x3d"modal-header"\x3e\x3ch5 class\x3d"modal-title"\x3e\u7fa4\u7ec4\u4fe1\u606f\x3c/h5\x3e\x3ca id\x3d"closebox" class\x3d"close" data-dismiss\x3d"modal" aria-hidden\x3d"true" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u5173\u95ed"\x3e\u00d7\x3c/a\x3e\x3cul class\x3d"j_im-group-detail-tab-field group-detail-tab"\x3e\x3cli class\x3d"j_im-group-detail-tab active" type\x3d"detail"\x3e\u57fa\u672c\u4fe1\u606f\x3c/li\x3e\x3cli class\x3d"j_im-group-detail-tab" type\x3d"member"\x3e\u7fa4\u6210\u5458\u7ba1\u7406\x3c/li\x3e\x3cli class\x3d"j_im-group-detail-tab" type\x3d"groupNote"\x3e\u7fa4\u52a8\u6001\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-body j_modal-body"\x3e\x3cdiv class\x3d"j_chat-imgroupdetailScr groupsetting-box" auto-scroll\x3d"no" height\x3d"510"\x3e\x3cdiv class\x3d"j_im-group-detail-list j_im-group-detail-container"\x3e\x3cdiv class\x3d"entity-info detail-list"\x3e\x3cdiv class\x3d"j_im-group-detail"\x3e\x3cdiv class\x3d"card card-corner"\x3e\x3cdiv class\x3d"j_group-avatar control-group group-avatar"\x3e\x3clabel class\x3d"control-label"\x3e\u7fa4\u7ec4\u5934\u50cf\uff1a\x3c/label\x3e\x3cdiv class\x3d"controls"\x3e\x3cimg src\x3d"/static/img/global/demo-v3/avatar_demo6.jpg"/\x3e\x3ca class\x3d"j_im-upload-group-avatar font-button"\x3e\u4e0a\u4f20\u5934\u50cf\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"control-group"\x3e\x3clabel class\x3d"control-label" \x3e\u7fa4\u7ec4\u540d\u79f0\uff1a\x3c/label\x3e\x3cdiv class\x3d"controls"\x3e\x3cinput class\x3d"group-name j_name j_im-chat-name-input form-control" contenteditable\x3d"true" groupname\x3d""  data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d""/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_group-master control-group group-master "\x3e\x3clabel class\x3d"control-label"\x3e\u7fa4\u4e3b\uff1a\x3c/label\x3e\x3cdiv class\x3d"controls"\x3e\x3cdiv class\x3d"j_group-master-member j_im-group-member-avatar-trigger im-cp"\x3e\x3cimg  src\x3d"/static/images/avatar.png"  class\x3d"j_avatar"/\x3e\x3cspan class\x3d"name"\x3e\x3c/span\x3e\x3c/div\x3e\x3ca class\x3d"j_im-change-groupmaster font-button"\x3e\u8f6c\u7fa4\u4e3b\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_group-manager control-group group-manager"\x3e\x3clabel class\x3d"control-label"\x3e\u7fa4\u7ba1\u7406\u5458\uff1a\x3c/label\x3e\x3cdiv class\x3d"j_group-manager-list controls"\x3e\x3cspan id\x3d"editParticipant" class\x3d"control-btn entity-item-add acl-hide j_im-set-group-manager" title\x3d"\u6dfb\u52a0\u53c2\u4e0e\u4eba\uff0c\u53ef\u6dfb\u52a0\u591a\u4e2a"\x3e\x3ci title\x3d"" data-placement\x3d"top" data-toggle\x3d"tooltip" class\x3d"icon-plus-thin" data-original-title\x3d"\u6dfb\u52a0"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"card card-corner"\x3e\x3cdiv class\x3d"j_group-announce control-group control-group-nohover control-group-nobd"\x3e\x3clabel class\x3d"control-label"\x3e\u7fa4\u516c\u544a\x3c/label\x3e\x3cdiv class\x3d"im-hint-limit j_im-hint-limit"\x3e\x3c/div\x3e\x3cdiv class\x3d"controls controls-block"\x3e\x3ctextarea class\x3d"form-control im-notice-input j_group-announce-content im-annouce-input"\x3e\x3c/textarea\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"card card-corner"\x3e\x3cdiv class\x3d"j_group-switch-filed control-group control-group-nobd"\x3e\x3cdiv class\x3d"im-msg-noremind j_im-msg-noremind"\x3e\x3clabel class\x3d"control-label"\x3e\u6d88\u606f\u514d\u6253\u6270\x3c/label\x3e\x3cdiv class\x3d"e-range e-range-sm top fr j_switch" flag\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_group-switch-filed control-group"\x3e\x3cdiv class\x3d"im-msg-noremind j_im-msg-readstatus"\x3e\x3clabel class\x3d"control-label"\x3e\u6d88\u606f\u9605\u8bfb\x3c/label\x3e\x3cdiv class\x3d"e-range e-range-sm top fr j_switch" flag\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"pt-15 ta-c"\x3e\x3ca class\x3d"btn btn-sm btn-danger w-200 j_im-exit-group"\x3e\u9000\u51fa\u7fa4\u7ec4\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-group-member-container j_im-group-detail-list hide"\x3e\x3cdiv class\x3d"member-container"\x3e\x3cdiv class\x3d"j_group-member-func"\x3e\x3cul class\x3d"member-list"\x3e\x3cli class\x3d"nobg"\x3e\x3cspan class\x3d"entity-item-add j_im-group-add-member"\x3e\x3ci title\x3d"\u6dfb\u52a0" data-placement\x3d"top" data-toggle\x3d"tooltip" class\x3d"icon-plus-thin"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/li\x3e\x3cdiv class\x3d"j_group-member-list"\x3e\x3c/div\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-group-note-container j_im-group-detail-list hide"\x3e\x3cdiv class\x3d"im-no-result j_no-result"\x3e\u65e0\u5386\u53f2\u6570\u636e\x3c/div\x3e\x3cdiv class\x3d"note-container j_im-groupnote-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_other-content hide"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "im-chat-imgroupdetail-modal-clone-field" class\x3d"hide"\x3e\x3cli id\x3d"im-group-member-clone" class\x3d"j_im-group-member"\x3e\x3cimg class\x3d"j_avatar j_im-group-member-avatar-trigger im-cp" src\x3d"/static/images/avatar.png"/\x3e\x3cspan class\x3d"txt j_name j_im-group-member-avatar-trigger im-cp"\x3e\x3c/span\x3e\x3ca class\x3d"member-close j_im-group-kickout"\x3e\u00d7\x3c/a\x3e\x3cspan class\x3d"leader-mark j_leader-mark"\x3e\u7fa4\u4e3b\x3c/span\x3e\x3c/li\x3e\x3cdiv id\x3d"im-group-manager-clone" class\x3d"j_im-chatgroup-member j_im-group-member-avatar-trigger im-cp"\x3e\x3cimg src\x3d"/static/images/avatar.png"  class\x3d"j_avatar"/\x3e\x3cspan class\x3d"j_name name"\x3e\x3c/span\x3e\x3c/div\x3e\x3cspan id\x3d"im-group-new-member-clone" class\x3d"j_group-new-member item j_im-group-member-avatar-trigger im-cp"\x3e\x3cimg class\x3d"j_avatar" src\x3d"/static/images/avatar.png"/\x3e\x3cspan class\x3d"j_name"\x3e\u5f20\u4e09\x3c/span\x3e\x3c/span\x3e\x3cdiv id\x3d"im-groupnote-clone" class\x3d"note-box  j_im-note-box"\x3e\x3cdiv class\x3d"box-img j_avatar j_im-group-member-avatar-trigger im-cp"\x3e\x3cimg src\x3d"/static/images/avatar.png"/\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"box-hd j_title"\x3e\x3cspan class\x3d"username j_optuser-name j_im-group-member-avatar-trigger im-cp"\x3e\x3c/span\x3e\x3cspan class\x3d"event j_event"\x3e\u9080\u8bf7\u4e86\u65b0\u540c\u4e8b\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"box-content j_box-content hide"\x3e\x3cdiv class\x3d"members j_invite-member-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"box-date j_box-date"\x3e10-19 09:18:54\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.component.imavataruploader":'\x3cdiv id\x3d"im-avataruploader-modal" class\x3d"im-avataruploader-view j_closeImGroupDetailPanel j_im-frame-show-panel"\x3e\x3cdiv class\x3d"p-20 clearfix"\x3e\x3cinput type\x3d"hidden" class\x3d"j_im-avatar-imageArea"  name\x3d"imageArea.id" /\x3e\x3cdiv class\x3d"avatar-wrapper"  style\x3d"width: 510px;height: 560px;"\x3e\x3cdiv id\x3d"avatar-img-container"\x3e\x3c/div\x3e\x3cdiv  style\x3d"width: 500px; height:500px;"\x3e\x3cimg class\x3d"avatar-img j_im-avatar-imageArea-img hide" alt\x3d"\u5934\u50cf"  style\x3d"max-width: 400px; max-height: 400px; "\x3e\x3cdiv class\x3d"avatar-img avatar-note"\x3e\x3cp\x3e\u4f60\u8fd8\u6ca1\u6709\u8bbe\u7f6e\u7fa4\u7ec4\u5934\u50cf\uff0c\u8bf7\u6309\u4e0b\u9762\u7684\u6b65\u9aa4\u8bbe\u7f6e\uff1a\x3c/p\x3e\x3cp\x3e\u7b2c\u4e00\u6b65\uff1a\u4ece\u672c\u5730\u9009\u62e9\u7167\u7247\u4e0a\u4f20\x3c/p\x3e\x3cp\x3e\u7b2c\u4e8c\u6b65\uff1a\u5bf9\u7167\u7247\u8fdb\u884c\u526a\u88c1\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"btn-groups"\x3e\x3ca id\x3d"avatar-upload" class\x3d"avatar-upload btn btn-sm btn-primary" title\x3d"\u4e0a\u4f20\u5934\u50cf"\x3e\x3ci class\x3d"icon-upload-alt"\x3e\x3c/i\x3e \u4e0a\u4f20\u5934\u50cf\x3c/a\x3e\x3ca id\x3d"avatar-cut" class\x3d"btn btn-sm btn-info hide" title\x3d"\u88c1\u526a"\x3e\x3ci class\x3d"icon-cut"\x3e\x3c/i\x3e\u88c1\u526a\x3c/a\x3e\x3ca class\x3d"btn btn-sm btn-info j_returnGroupDetail"\x3e\x3ci class\x3d"icon-cut"\x3e\x3c/i\x3e\u8fd4\u56de\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"avatar-preview-wrapper hide"\x3e\x3cp\x3e\u5934\u50cf\u9884\u89c8(100*100):\x3c/p\x3e\x3cdiv class\x3d"avatar-preview" style\x3d"border-radius: 50%;"\x3e\x3cimg class\x3d"avatar-img-preview" alt\x3d"\u5934\u50cf\u9884\u89c8" /\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.component.imuserselector":'\x3cdiv id\x3d"im-userselector-modal" class\x3d"group-add-box j_closeImGroupDetailPanel j_im-frame-show-panel j_im-userselector-modal-show"\x3e\x3cdiv class\x3d"table-tray selector-body"\x3e\x3cdiv class\x3d"tray-cell selector-panel"\x3e\x3cdiv class\x3d"sch-input j_sch-input"\x3e\x3cinput class\x3d"form-control form-control-block j_im-member-search-input" type\x3d"text" placeholder\x3d"\u641c\u7d22"\x3e\x3ci class\x3d"icon-search"\x3e\x3c/i\x3e\x3ci class\x3d"icon-remove-sign cs-p j_im-clear-search-value" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"\u6e05\u7a7a\u641c\u7d22\u5185\u5bb9" style\x3d"display: block;"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-org-header hide-im"\x3e\x3cdiv class\x3d"selector-guide"\x3e\x3cdiv class\x3d"j_im-org-list-return a-back"\x3e\x3ci class\x3d"icon-angle-left"\x3e\x3c/i\x3e\u8fd4\u56de\x3c/div\x3e\x3cdiv class\x3d"j_im-org-header-title title"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-org-tree selector-breadcrumb"\x3e\x3cspan class\x3d"item"\x3e\x3ca\x3e\u4e0a\u6d77\u6cdb\u5fae\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d"item"\x3e\x3ca\x3eSME\u4e8b\u4e1a\u90e8\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d"item"\x3e\x3ca\x3eeteams\u7814\u53d1\u90e8\x3c/a\x3e\x3c/span\x3e\x3cspan class\x3d"item"\x3e\u6d4b\u8bd5\u90e8\u95e8\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"selector-list j_im-org-select-container hide-im"\x3e\x3cul class\x3d"j_im-org-select-list j_im-select-left-list"\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"selector-list j_im-groupmember-select-container hide-im"\x3e\x3cul class\x3d"j_im-groupmember-select-list j_im-select-left-list"\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-addrlist-select-container"\x3e\x3cdiv class\x3d"panel-tabbar j_im-addrlist-tab-container hide-im"\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab" type\x3d"session"\x3e\x3cdiv class\x3d"tab-block active" \x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"" data-original-title\x3d"\u6700\u8fd1\u4f1a\u8bdd"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab user" type\x3d"user"\x3e\x3cdiv class\x3d"tab-block" \x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"" data-original-title\x3d"\u901a\u8baf\u5f55"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab group" type\x3d"group"\x3e\x3cdiv class\x3d"tab-block" \x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"" data-original-title\x3d"\u7fa4\u7ec4"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"tab-item j_im-addrlist-tab org" type\x3d"org"\x3e\x3cdiv class\x3d"tab-block" \x3e\x3ci data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d"" data-original-title\x3d"\u7ec4\u7ec7\u67b6\u6784"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_im-addr-user-list j_im-addr-user-list-scroll hide-im"  height\x3d"423"\x3e\x3cdiv class\x3d"selector-list j_im-selectuser-list j_im-select-left-list" auto-scroll\x3d"no"\x3e\x3cdiv class\x3d"im-no-result j_no-result im-hide"\x3e\u65e0\u6570\u636e\x3c/div\x3e\x3cul class\x3d"j_selector-list-container"\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"selector-list j_selectorSearch-container j_im-addr-search-list hide-im j_im-select-left-list" auto-scroll\x3d"no" height\x3d"460"\x3e\x3cdiv class\x3d"im-no-result j_no-result im-hide"\x3e\u65e0\u6570\u636e\x3c/div\x3e\x3cdiv class\x3d"j_im-selectuser-search-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"hide-im j_im-selectuser-list-container"\x3e\x3cdiv class\x3d"selector-list j_selectorNavScr j_im-selectuser-list j_im-select-left-list" auto-scroll\x3d"no" height\x3d"425"\x3e\x3cdiv class\x3d"im-no-result j_no-result im-hide"\x3e\u65e0\u6570\u636e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"selector-list j_selectorSearch-container j_im-selectuser-search-scrollbar hide-im" auto-scroll\x3d"no" height\x3d"425"\x3e\x3cdiv class\x3d"im-no-result j_no-result im-hide"\x3e\u65e0\u6570\u636e\x3c/div\x3e\x3cdiv class\x3d"j_im-selectuser-search-list j_im-select-left-list"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"tray-cell selector-main"\x3e\x3cdiv class\x3d"selector-list j_selector-list j_selectorMainScr" auto-scroll\x3d"no"\x3e\x3cdiv class\x3d"selector-amount"\x3e\x3cdiv class\x3d"tips"\x3e\u5df2\u9009\u62e9\x3cspan class\x3d"j_limit-count"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"j_im-selected-list"\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"opt-box"\x3e\x3ca class\x3d"btn btn-sm j_cancel-button"\x3e\u53d6\u6d88\x3c/a\x3e\x3ca class\x3d"btn btn-sm btn-success j_confirm-button"\x3e\u786e\u5b9a\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-userselector-modal-clone-field" class\x3d"hide"\x3e\x3cdiv id\x3d"im-pinyin-clone" class\x3d"item"\x3e\x3cdiv class\x3d"hd j_index hide-im"\x3e\x3c/div\x3e\x3cul class\x3d"j_user-list"\x3e\x3c/ul\x3e\x3c/div\x3e\x3cli id\x3d"im-selectuser-clone" class\x3d"j_im-select-li j_im-selectuser j_im-select-item clearfix"\x3e\x3cspan class\x3d"check j_opt"\x3e\x3c/span\x3e\x3cimg class\x3d"j_avatar avatar" src\x3d"/static/images/avatar.png"/\x3e\x3cdiv class\x3d"j_info name"\x3e\x3cdiv class\x3d"j_name name"\x3e\x3c/div\x3e\x3cdiv class\x3d"work-title j_work-title"\x3e\x3c/div\x3e\x3c/div\x3e\x3ca class\x3d"remove hide j_remove-select im-cp"\x3e\x3ci class\x3d"icon-cross"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli id\x3d"im-selectdept-clone" class\x3d"j_im-selectdept j_im-select-li clearfix"\x3e\x3cdiv class\x3d"name j_name"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_dept-count"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_org-department level"\x3e\x3ci class\x3d"icon-topology "\x3e\x3c/i\x3e\u4e0b\u7ea7\x3c/div\x3e\x3ca class\x3d"remove hide j_remove-select im-cp"\x3e\x3ci class\x3d"icon-cross"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli id\x3d"im-selectgroup-clone" class\x3d"j_im-select-li j_im-selectgroup j_im-select-item clearfix"\x3e\x3cspan class\x3d"check j_opt"\x3e\x3c/span\x3e\x3cimg class\x3d"j_avatar avatar" src\x3d"/static/images/avatar.png"/\x3e\x3cdiv class\x3d"name j_name"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_dept-count"\x3e\x3c/div\x3e\x3cdiv class\x3d"j_group-member-level level"\x3e\x3ci class\x3d"icon-topology "\x3e\x3c/i\x3e\u6210\u5458\x3c/div\x3e\x3ca class\x3d"remove hide j_remove-select im-cp"\x3e\x3ci class\x3d"icon-cross"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cspan id\x3d"im-head-choose-item-clone" class\x3d"item j_org-item"\x3e\x3ca class\x3d"j_choose-org-index j_org-name"\x3e\x3c/a\x3e\x3c/span\x3e\x3cdiv class\x3d"selector-checkall j_selector-checkall"\x3e\x3cspan class\x3d"check j_opt"\x3e\x3c/span\x3e\x3cspan class\x3d"font-name"\x3e\u5168\u9009\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.component.imuserselectorpanel":'\x3cdiv id\x3d"im-userselector-panel-modal" class\x3d" modal fade im-relay-modal j_im-chat-imgroupdetail-modal-show"\x3e\x3cdiv class\x3d"modal-dialog j_closeImSelectorPanel"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"j_main-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id \x3d "im-chat-msgreadstatus-modal-clone-field" class\x3d"hide"\x3e\x3cdiv id\x3d"group-member-clone" class\x3d"group-member j_group-member" data-toggle\x3d"tooltip" data-placement\x3d"top" title\x3d""\x3e\x3cimg class\x3d"j_im-group-member-avatar-trigger avatar j_avatar im-cp" title\x3d"" src\x3d"/static/images/avatar.png"\x3e\x3cp class\x3d"j_name name ellipsis j_im-group-member-avatar-trigger\tim-cp"\x3e\u5c0f\u52a9\u624b\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.component.imusercard":'\x3cdiv id\x3d"im-usercard" class\x3d"im-usercard j_im-frame-show-panel j_im-usercard-show j_entityslider-show-event j_im-chat-msgreadstatus-modal-show j_im-open-group-panel-show"\x3e\x3cdiv class\x3d"im-usercard-header"\x3e\x3cdiv class\x3d"title ellipsis j_card-title"\x3e\u5ba2\u6237\u5361\u7247\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"im-usercard-content"\x3e\x3cdiv class\x3d"usersummary" id\x3d"userSummary-info"\x3e\x3cdiv class\x3d"usersummary-base"\x3e\x3cimg src\x3d"/static/images/avatar.png" class\x3d"avatar j_avatar"/\x3e\x3cp class\x3d"name ellipsis j_name"\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"usersummary-extra"\x3e\x3cdiv class\x3d"j_extra-item extra-item "\x3e\x3clabel\x3e\u56e2\u961f\uff1a\x3c/label\x3e\x3cdiv class\x3d"ellipsis email j_corp-name"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_extra-item extra-item "\x3e\x3clabel\x3e\u5730\u5740\uff1a\x3c/label\x3e\x3cdiv class\x3d"ellipsis telephone j_address"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_extra-item extra-item "\x3e\x3clabel\x3e\u624b\u673a\uff1a\x3c/label\x3e\x3cdiv class\x3d"ellipsis email j_mobile"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_extra-item extra-item "\x3e\x3clabel\x3e\u7535\u8bdd\uff1a\x3c/label\x3e\x3cdiv class\x3d"ellipsis email j_tel"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"j_extra-item extra-item "\x3e\x3clabel\x3e\u90ae\u7bb1\uff1a\x3c/label\x3e\x3cdiv class\x3d"ellipsis telephone j_email"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.pc.component.imfuncpanel":'\x3cdiv id\x3d"imFuncPanel" class\x3d"hide-im im-chat-func-panel j_im-chat-func-panel j_im-frame-show-panel j_closeImSelectorPanel panel border-dropdown"\x3e\x3cdiv class\x3d"j_im-func-list"\x3e\x3c/div\x3e\x3cdiv id\x3d"imFuncPanel-clone" class\x3d"hide"\x3e\x3cp class\x3d"j_im-chat-opt-button j_im-chat-opt-button-clone"\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e',"im.pc.component.atselector":'\x3cdiv id\x3d"im-atselector-container" class\x3d"atselector-suggestion atselector-border-dropdown filterSlip_js j_im-frame-show-panel"\x3e\x3cdiv class\x3d"atselector-wrapper j_atselect-tab hide"\x3e\x3cul class\x3d"atselector-tab"\x3e\x3cli class\x3d"tab-item j_employee active" \x3e\x3ca type\x3d"employee"\x3e\u4eba\u5458\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"tab-item j_department"\x3e\x3ca  type\x3d"department"\x3e\u90e8\u95e8\x3c/a\x3e\x3c/li\x3e\x3cli class\x3d"tab-item j_group" \x3e\x3ca type\x3d"group"\x3e\u7fa4\u7ec4\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d"atselector-search"\x3e\x3ci class\x3d"icon-search mr-3"\x3e\x3c/i\x3e\x3cinput class\x3d"j_search form-control" type\x3d"text" placeholder\x3d"\u641c\u7d22"/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"loading_small"\x3e\u6b63\u5728\u52a0\u8f7d\u6570\u636e ... \x3c/div\x3e\x3cdiv id\x3d"im-atselector-list" class\x3d"atselector-list"\x3e\x3cdiv class\x3d"j_up-list" \x3e\x3cp class\x3d"current employee j_at_group" at-type\x3d"group" title\x3d"\u7fa4\u7ec4"\x3e\x3cimg class\x3d"avatar" src\x3d"https://www.eteams.cn/static/images/avatar.png"\x3e\x3cspan\x3e\u7fa4\u7ec4\x3c/span\x3e\x3c/p\x3e\x3cp class\x3d"current employee j_at_department" at-type\x3d"department" title\x3d"JasonTeams"\x3e\x3cimg class\x3d"avatar" src\x3d"https://www.eteams.cn/static/images/avatar.png"\x3e\x3cspan\x3eJasonTeams\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"j_buttom-list"\x3e\x3cdiv class\x3d"at-bottom-boder"\x3e\x3c/div\x3e\x3cp class\x3d"all-user j_target" at-type\x3d"targetMember" title\x3d"\u53ea\u5305\u542b\u4e8b\u9879\u8d1f\u8d23\u4eba\u548c\u53c2\u4e0e\u4eba"\x3e\x3ci class\x3d"target-people"\x3e\x3c/i\x3e\x3cspan\x3e\u4e8b\u9879\u6210\u5458\x3c/span\x3e\x3c/p\x3e\x3cp class\x3d"all-user j_chat hide" at-type\x3d"channelMember" title\x3d"\u7fa4\u7ec4\u5185\u7684\u5168\u4f53\u6210\u5458"\x3e\x3ci class\x3d"target-people"\x3e\x3c/i\x3e\x3cspan\x3e\u5168\u4f53\u6210\u5458\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"im-atselector-container-clone-field" class\x3d"hide"\x3e\x3cdiv class\x3d"j_department-list"\x3e\x3cp class\x3d"department j_at_user" at-type\x3d"department"\x3e\x3cspan\x3e\u9700\u6c42\u8fd0\u7ef4\u90e8\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"j_group-list"\x3e\x3cp class\x3d"group j_at_user" at-type\x3d"group"\x3e\x3cspan\x3e\u9700\u6c42\u8fd0\u7ef4\u90e8\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"j_employee-list"\x3e\x3cp class\x3d"employee j_at_user" at-type\x3d"user" \x3e\x3cimg class\x3d"avatar" src\x3d"https://www.eteams.cn/static/images/avatar.png"\x3e\x3cspan\x3e\u4eba\u5458\x3c/span\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.pc.component.mapwindow":'\x3cdiv id\x3d"im-mapwindow-modal" class\x3d"modal fade modal-grey" tabindex\x3d"-1" role\x3d"dialog" aria-hidden\x3d"true"\x3e\x3cdiv class\x3d"modal-dialog modal-lg"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"module-detail-view"\x3e\x3cdiv class\x3d"detail-header"\x3e\x3cdiv class\x3d"detail-brand"\x3e\x3ci class\x3d"graph graph-attend"\x3e\x3c/i\x3e\u4f4d\u7f6e\u4fe1\u606f\x3c/div\x3e\x3cdiv class\x3d"detail-actions"\x3e\x3cul\x3e\x3cli\x3e\x3ca title\x3d"\u5173\u95ed" id\x3d"im-mapwindow-close" class\x3d"detail-slide-close"\x3e\u00d7\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"js_mapContentScr mapcontentscr"\x3e\x3cdiv class\x3d"p-20"\x3e\x3cdiv id\x3d"j_mapArea" class\x3d"map-content b-d5" style\x3d"height:400px; width:758px;"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
"im.pc.component.imkickoffnotify":'\x3cdiv id\x3d"im-kickoff-notify-modal" data-backdrop\x3d"static" class\x3d"modal modal-gray im-kickout-modal fade"\x3e\x3cdiv class\x3d"modal-dialog"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"modal-header"\x3e\x3ch5 class\x3d"modal-title"\x3e\u4e0b\u7ebf\u901a\u77e5\x3c/h5\x3e\x3c/div\x3e\x3cdiv class\x3d"im-kickoff-wrapper"\x3e\x3cdiv class\x3d""\x3e\x3cdiv class\x3d"kickout-graph"\x3e\x3cimg src\x3d""/\x3e\x3c/div\x3e\x3cdiv class\x3d"kickout-tip j_kickout-tip"\x3e\u60a8\u7684\u8d26\u53f7\u767b\u5f55\u4e86\u4e00\u4e2a\u65b0\u8bbe\u5907\uff0c\u672c\u8bbe\u5907im\u5df2\u88ab\u5f3a\u5236\u4e0b\u7ebf\uff01\x3c/div\x3e\x3cdiv class\x3d"kickout-btn"\x3e\x3ca class\x3d"btn btn-sm btn-success j_logout-account"\x3e\u8fd4\u56de\u767b\u5165\u754c\u9762\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'}});
define("im/component/imChatComponent",["im/component/imUtils","im/component/imContants","im/component/mapWindowView"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/component/mapWindowView");p.exports={imViewsElConfig:{imPortalRecentList:"#im-recent-list"},buildImageMsgParams:function(g){var f=g.fileObj;g={};f.smallImgHeight||(f.smallImgHeight=50);f.smallImgWidth||(f.smallImgWidth=50);f={type:"1",height:f.smallImgHeight.toString(),name:f.name,width:f.smallImgWidth.toString(),
size:f.size,src:f.id.toString()};g.msgType="2";g.image=f;return g},buildAttachMsgParams:function(g){var f=g.fileObj;g={};f={id:f.id,type:"1",name:f.name,extName:f.extName,size:f.size,docType:f.docType,src:TEAMS.service.base+"/base/download/"+f.url};g.msgType="4";g.attachment=f;return g},initImSessionCache:function(){$("body").data("imCacheData",{})},setImSysMsgConfig:function(g,f){var a=$("body").data("imCacheData").imSysMsgConfig;f?a[g]=f:TEAMS.imLogSwitch&&console.log("value is null")},getImSysMsgConfig:function(g,
f){var a=window.imCacheData.sysConfigMap,d={};switch(f){case "stype":d=a.stypeMap;break;case "sgroup":d=a.sgroupMap}return d},setImMsgNoReadCounts:function(g,f,a){var d=$("body").data("imCacheData");if(f){var b=d.sessionCacheDatas;"7"==a&&(b=d.serviceSessionCacheDatas);b&&b.sessionMap&&(d=b.sessionMap)&&d[g]&&(d[g].unread_count=f.count);"7"==a?this.setImSessionCache("serviceSessionCacheDatas",b):this.setImSessionCache("sessionCacheDatas",b)}else TEAMS.imLogSwitch&&console.log("value is null")},getImChatNoReadCounts:function(g,
f){var a=void 0,d=$("body").data("imCacheData").sessionCacheDatas;"7"==f&&(d=$("body").data("imCacheData").serviceSessionCacheDatas);d&&(d=d.sessionMap[g])&&(a={type:d.session_type,count:d.unread_count,group_id:d.group_id,user:d.fuser});return a},getImServiceGroupNoReadCounts:function(g,f){var a=void 0,d=$("body").data("imCacheData").serviceSessionCacheDatas;d&&(d=d.sessionMap[g])&&(a={type:d.session_type,count:d.unread_count,group_id:d.group_id,user:d.fuser});return a},getImChatNoReadAllCounts:function(){var g=
{},f=$("body").data("imCacheData").sessionCacheDatas;if(f&&(f=f.sessionMap))for(var a in f){var d=f[a];"4"!=d.session_type&&(g[a]={type:d.session_type,count:d.unread_count,group_id:d.group_id,user:d.fuser,reminder:d.reminder})}return g},getImSysMsgNoReadCounts:function(g){var f=void 0,a=$("body").data("imCacheData").sessionCacheDatas;a&&(g=a.sessionMap[g])&&(f={type:g.session_type,count:g.unread_count,group_id:g.group_id,user:g.fuser,sgroup:g.group});return f},getImMsgNoReadCountsAll:function(){var g=
{},f=$("body").data("imCacheData").sessionCacheDatas;if(f&&(f=f.sessionMap))for(var a in f){var d=f[a];g[a]={type:d.session_type,count:d.unread_count,group_id:d.group_id,user:d.fuser,sgroup:d.group}}return g},getImSysMsgAllConfig:function(){return $("body").data("imCacheData").imSysMsgConfig},setImChatUserCache:function(g,f){var a=this.queryImSessionCacheByKey("imChatUserCacheMap");a||(a={});g?(a[g.toString()]=f,this.setImSessionCache("imChatUserCacheMap",a)):TEAMS.imLogSwitch&&console.log("key or value is null")},
setImChatUserCacheList:function(g){var f=this.queryImSessionCacheByKey("imChatUserCacheMap");f||(f={});if(g&&0<g.length){for(var a=0;a<g.length;a++)f["imChatUser-"+g[a].id]=g[a];this.setImSessionCache("imChatUserCacheMap",f)}else TEAMS.imLogSwitch&&console.log("key or value is null")},setImGroupMemberCache:function(g,f){var a=this.queryImSessionCacheByKey("imGroupMemberCache");a||(a={});g?(a[g.toString()]=f,this.setImSessionCache("imGroupMemberCache",a)):TEAMS.imLogSwitch&&console.log("key or value is null")},
setImGroupMemberMapCache:function(g,f){var a=this.queryImSessionCacheByKey("imGroupMemberMapCache");a||(a={});g?(a[("imGroupMemberListCache-"+g).toString()]=f,this.setImSessionCache("imGroupMemberMapCache",a)):TEAMS.imLogSwitch&&console.log("key or value is null")},setImChatGroupCache:function(g,f){var a=this.queryImSessionCacheByKey("imChatGroupCacheMap");a||(a={});g?(a["imChatGroup-"+g.toString()]=f,this.setImSessionCache("imChatGroupCacheMap",a)):TEAMS.imLogSwitch&&console.log("key or value is null")},
setImChatGroupCacheList:function(g){var f=this.queryImSessionCacheByKey("imChatGroupCacheMap");f||(f={});if(g&&0<g.length){for(var a=0;a<g.length;a++)f["imChatGroup-"+g[a].id]=g[a];this.setImSessionCache("imChatGroupCacheMap",f)}else TEAMS.imLogSwitch&&console.log("key or value is null")},getImGroupMemberCache:function(g){var f=this.queryImSessionCacheByKey("imGroupMemberCache");return f?f[g.toString()]:null},getImChatGroupCache:function(g){var f=this.queryImSessionCacheByKey("imChatGroupCacheMap");
return f?f["imChatGroup-"+g.toString()]:null},getImChatGroupBatchCache:function(g){var f=this.queryImSessionCacheByKey("imChatGroupCacheMap");if(f&&g&&0<g.length){var a={};g.forEach(function(d){a[d.toString()]});return f[key.toString()]}return null},getImChatGroupAllCache:function(){var g=this.queryImSessionCacheByKey("imChatGroupCacheMap");return g?g:{}},delImChatGroupCache:function(g){var f=this.queryImSessionCacheByKey("imChatGroupCacheMap");f&&(f["imChatGroup-"+g.toString()]=void 0)},getImChatUserCache:function(g){var f=
this.queryImSessionCacheByKey("imChatUserCacheMap");return f?f[g.toString()]:null},getImCorpCache:function(g){var f=this.queryImSessionCacheByKey("imCorpCacheMap");f||(f={},this.setImSessionCache("imCorpCacheMap",f));return f["imCorpCache-"+g.toString()]},setImCorpCache:function(g,f){g="imCorpCache-"+g;var a=this.queryImSessionCacheByKey("imCorpCacheMap");a||(a={});g?(a[g]=f,this.setImSessionCache("imCorpCacheMap",a)):TEAMS.imLogSwitch&&console.log("key or value is null")},setImSessionCache:function(g,
f){var a=$("body").data("imCacheData");g&&f?a[g.toString()]=f:TEAMS.imLogSwitch&&console.log("key or value is null")},queryImSessionCacheByKey:function(g){var f=$("body").data("imCacheData");if(g)return f[g.toString()]},getImUserInfo:function(g,f){var a=this,d=a.getImChatUserCache("imUserCache-"+g.uid+"-"+g.cid);d?f&&f(d):window.imWebsocketSdk.imJsonRequestMethods.syncUserInfoReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,mask:l.kMaskUserInfo.MASK_USER_NAME|l.kMaskUserInfo.MASK_USER_PINYIN|
l.kMaskUserInfo.MASK_USER_HEAD_PIC|l.kMaskUserInfo.MASK_USER_MOBILE|l.kMaskUserInfo.MASK_USER_EMAIL|l.kMaskUserInfo.MASK_USER_TEL,users:[g]},function(b){if(b.message.datas&&b.message.datas[0]){b=b.message.datas[0];var c={id:b.user.uid,uid:b.user.uid,cid:b.user.cid,name:b.name,pinyin:b.pinyin,avatar:b.head_pic,mobile:b.mobile,email:b.email,tel:b.tel};a.setImChatUserCache("imUserCache-"+b.user.uid+"-"+b.user.cid,c);f&&f(c)}})},getImCorpInfo:function(g,f){var a=this,d=a.getImCorpCache(g);d?f&&f(d):window.imWebsocketSdk.imJsonRequestMethods.syncCorpInfoReq({uid:window.imCurrentUser.uid,
cid:window.imCurrentUser.cid,mask:l.kMaskCorpInfo.MASK_CORP_CID|l.kMaskCorpInfo.MASK_CORP_NAME|l.kMaskCorpInfo.MASK_CORP_ADDRESS,cids:[g]},function(b){b.message.datas&&b.message.datas[0]&&(b=b.message.datas[0],b={cid:b.cid,name:b.name,address:b.address},a.setImCorpCache(b.cid,b),f&&f(b))})},getBatchImUserInfo:function(g,f){var a=this,d=[],b=[],c=this.queryImSessionCacheByKey("imChatUserCacheMap");g.forEach(function(a){var e=c["imUserCache-"+a.uid+"-"+a.cid];e?b.push(e):d.push(a)});if(0<d.length){for(var h=
[],e=1,m=0;m<d.length;m++)h["userArray-"+e]||(h["userArray-"+e]=[]),h["userArray-"+e].push(d[m]),30==h["userArray-"+e].length&&e++;for(m=1;m<e+1;m++)window.imWebsocketSdk.imJsonRequestMethods.syncUserInfoReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,mask:l.kMaskUserInfo.MASK_USER_NAME|l.kMaskUserInfo.MASK_USER_PINYIN|l.kMaskUserInfo.MASK_USER_HEAD_PIC|l.kMaskUserInfo.MASK_USER_MOBILE|l.kMaskUserInfo.MASK_USER_EMAIL|l.kMaskUserInfo.MASK_USER_TEL,users:h["userArray-"+m]},function(c){c.message.datas&&
0<c.message.datas.length&&(c.message.datas.forEach(function(c){var d={id:c.user.uid,uid:c.user.uid,cid:c.user.cid,name:c.name,pinyin:c.pinyin,avatar:c.head_pic,mobile:c.mobile,email:c.email,tel:c.tel};a.setImChatUserCache("imUserCache-"+c.user.uid+"-"+c.user.cid,d);b.push(d)}),f&&0<b.length&&(TEAMS.imLogSwitch&&console.log("\u89e6\u53d1\u5206\u6279\u540c\u6b65"),f(b)))})}else 0<b.length&&f&&0<b.length&&(TEAMS.imLogSwitch&&console.log("\u89e6\u53d1\u5206\u6279\u540c\u6b65"),f(b))},dealWithAtMessage:function(g,
f){var a=g,d=[];if(f)for(var b=0;b<f.length;b++){var c=f[b],h="@"+c.userName+" ";if(-1!=a.indexOf(h)){-1!=a.indexOf(c.userName)&&(h="@"+c.userName+" ",a=a.replace(h,":@"+c.userId+"; "));switch(c.atType){case "user":c.atType="1";break;case "channelMember":c.atType="2"}d.push({id:c.userId,nm:c.userName,t:c.atType})}}return{msg:a,aus:d}},bindFileUploader:function(g,f){var a=g.bindButtonClass,d=g.containerClass,b=g.refId;b||(b=0);var c=g.failTip,h=m.getImUploadUrl()+"?module\x3dim\x26refId\x3d"+b+"\x26ETEAMSID\x3d"+
ETEAMSID,b=g.filters,a=new plupload.Uploader({runtimes:"html5,flash",file_data_name:"data",browse_button:a,max_file_size:g.maxFileSize,container:d,url:h,flash_swf_url:"/static/swf/plupload.swf",failTip:c});b&&(a.filters=b);a.init();a.bind("FilesAdded",function(a,b){if(5<b.length){m.notify("\u4e00\u6b21\u6700\u591a\u53ef\u4ee5\u4e0a\u4f205\u4e2a\u6587\u4ef6","\u6587\u4ef6\u4e2a\u6570\u8d85\u8fc7\u9650\u5236","error");for(var c=0;c<b.length;c++)a.removeFile(b[c])}else a.refresh(),a.start()});a.bind("UploadProgress",
function(a,b){});a.bind("Error",function(a,b){-601==b.code?m.notify("\u53ea\u80fd\u4e0a\u4f20\u56fe\u7247","\u6587\u4ef6\u7c7b\u578b\u9519\u8bef","error"):-600==b.code&&m.notify("\u53ea\u80fd\u4e0a\u4f20\u6700\u5927\u4e0d\u8d85\u8fc710M\u7684\u6587\u4ef6","\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u9650\u5236","error");a.refresh()});a.bind("FileUploaded",function(a,b,d){var g={};g.file=b;200==d.status&&2<d.response.length?(m.notify("\u6587\u4ef6\u4e0a\u4f20\u6210\u529f"),d=jQuery.parseJSON(d.response),
g.jsonData=d,a.removeFile(b)):m.notify(c);f&&f(g)});return a},buildReplyMsgTitle:function(g,f,a){if("1"==a&&g)return this.completeAtContent(g,f,f,void 0,window.imCurrentUser.perLang,!0,f).txtValueName},completeAtContent:function(g,f,a,d,b,c,h){var e={},l={},m=!1;b||(b="zh_CN");for(var n=0;n<g.length;n++)if(g[n]){var p=g[n],r=p.id,x=p.t;r==TEAMS.currentUser.id?m=!0:"2"==p.t&&(m=!0);var v=p.nm;if("2"==x&&c)switch(b){case "zh_CN":v="\u5168\u4f53\u6210\u5458";break;case "zh_TW":v="\u5168\u9ad4\u6210\u54e1";
break;case "en_US":v="all"}if("4"==x)switch(b){case "zh_CN":v="\u4e8b\u9879\u6210\u5458";break;case "zh_TW":v="\u4e8b\u9805\u6210\u54e1";break;case "en_US":v="item member"}if(d){var q=d.clone();"3"==x&&q.removeClass("j_at-obj-trigger");q.text("@"+v+" ");q.attr("objId",r);q.attr("objType",p.t);q.attr("objName",v);e[":@"+r+"; "]=q[0].outerHTML}l[":@"+r+"; "]="@"+v+" "}for(n in l)d&&(a=a.replace(new RegExp(n,"gm"),e[n])),f=f.replace(new RegExp(n,"gm"),l[n]),h&&(h=h.replace(new RegExp(n,"gm"),l[n]));
return{originContent:h,txtValueName:f,txtValue:a,isAtme:m}},changeListToMap:function(g,f){var a={};if(g&&0<g.length)for(var d=0;d<g.length;d++)a[g[d][f].toString()]=g[d];return a},optAudioMsg:function(g,f,a){var d=f.attr("status");switch(a){case "open":window.lastPlayAudioMsg&&(this.optAudioMsg(window.lastPlayAudioMsg.$button,window.lastPlayAudioMsg.$video,"close"),window.lastPlayAudioMsg=void 0);g.addClass("playing");f.attr("status","on");f[0].play();g.timer=setInterval(function(){f[0].ended&&(f.attr("status",
"off"),g.removeClass("playing"),f[0].pause(),clearInterval(g.timer))},50);window.lastPlayAudioMsg={$button:g,$video:f};break;case "close":"on"==d&&(g.removeClass("playing"),f[0].currentTime=0,f.attr("status","off"),f[0].pause())}},openChatMap:function(g){g=new h({longitude:g.lng,latitude:g.lat,address:g.addr,level:18});g.render();return g},removeChatMap:function(g){g&&g.remove()},createImGroup:function(g,f){var a=g.users,d=g.groupName,b={};b.uid=window.imCurrentUser.uid;b.cid=window.imCurrentUser.cid;
b.groupName=window.imCurrentUser.cid;b.createSource="0";b.type="0";b.transfer="create demo";for(var c=[],h=window.imCurrentUser.name,e=0;e<a.length;e++){var l=a[e],n={uid:l.uid,cid:l.cid};5>e&&(h+="\u3001"+l.name);c.push(n)}d||(d=h);d&&60<d.length&&(d=d.substring(0,60));d=m.replaceSpecialMark(d);b.name=d;b.users=c;30<c.length?m.notify({zh_CN:"\u521b\u5efa\u7fa4\u7ec4\u65f6\u6700\u591a\u9009\u62e930\u4e2a\u4eba",zh_TW:"\u5275\u5efa\u7fa4\u7d44\u6642\u6700\u591a\u9078\u64c730\u500b\u4eba",en_US:"A maximum of 30 people when you creat group"}[TEAMS.perLang]):
window.imWebsocketSdk.imJsonRequestMethods.createGroupReq(b,function(a){f&&f(a)})},sendForwardMsgBase:function(g){var f=g.selectedObjArray,a=g.msgObjOrigin,d=g.msgType,b=g.sendParams,c=g.imChatGroup;g=g.imChatUser;b||(b={uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid});var h="1001",e={},m=!1,n={};a&&$.extend(n,a);var p={sname:window.imCurrentUser.name};d&&(d=d.toString(),"1"==d&&n.typeBak&&(d=n.typeBak.toString()),p.type=d);b.container=$("#"+l.IM_CHATWIN_EL);b.$listContainer=$("#"+l.IM_CHATWIN_EL).find(".j_im-chatwin-msg-container .j_im-chatwin-msg-list");
b.$scrollBar=$("#"+l.IM_CHATWIN_EL).find(".j_im-chatwin-msg-container.j_im-chatwin-msg-scrollbar");switch(d){case "1":var h="1001",d=n.dt[0].txt,y=d.aus;if(y&&0<y.length){for(var r=d.v,x={},r=r.replace(RegExp(":@88; ","gm"),"@\u5168\u4f53\u6210\u5458 "),v=0;v<y.length;v++)if(y[v]){var q=y[v],s=q.id,C=q.t,q=q.nm;"2"!=C&&"4"!=C&&(x[":@"+s+"; "]="@"+q+" ")}for(v in x)r=r.replace(new RegExp(v,"gm"),x[v]);d.v=r;b.clitxt=r}else b.clitxt=d.v;r&&26<r.length&&(r=r.substring(0,25));r=[];r.push({txt:{v:r}});
p.dt=r;d.aus=void 0;b.msgType="1";b.msgTypeConf="1001";b.ver="1.0";b.dev="4";b.imChatGroup||(b.imChatGroup=c);b.imChatUser||(b.imChatUser=g);break;case "2":h="2001";d=n.dt[0].img;d={type:"1",height:d.h,name:d.nm,width:d.w,size:d.s,src:d.src};b.msgType="2";b.image=d;b.msgTypeConf="2001";break;case "3":h="3001";b.msgType="3";b.msgTypeConf="3001";b.forwardMsgObj=n;b.isForwardMsg=!0;break;case "4":h="4001";d=n.dt[0].file;d={id:d.id,type:d.t,name:d.nm,extName:d.ext,size:d.s,docType:d.dt,src:d.src};b.msgType=
"4";b.attachment=d;b.msgTypeConf="4001";break;case "5":h="5001";b.msgType="5";b.msgTypeConf="5001";b.forwardMsgObj=n;b.isForwardMsg=!0;break;case "8":h="8000",m=!0,d=b.entity,b.entity||(d=n.dt[0].entity,d={id:d.id,name:d.nm,module:d.me,etype:d.etype,stype:d.etype,ups:d.ups},d.etype=d.stype,d.ups={},d.ups.targetId=d.id,b.entity=d),e.imEntity=d,b.msgType="8",b.msgTypeConf="8000",a||(a=window.imWebsocketSdk.imJsonRequestMethods.buildJsonChatMsg(b).msg)}for(d=0;d<f.length;d++){var D={};$.extend(D,n);
r=!1;y=f[d];e.chatType=y.chatType;e.imCurrentUser=window.imCurrentUser;x=y.imChatUser;v=y.imChatGroup;switch(y.chatType){case "singleChat":x.id||(x.id=x.uid);e.imChatUser=x;b.imChatUser=x;b.toUid=x.uid;b.toCid=x.cid;b.kind=h;b.msg=a;g&&g.id==x.id&&(r=!0);break;case "groupChat":e.imChatGroup=v,b.groupId=v.id,b.kind=h,b.msg=a,c&&c.id==v.id&&(r=!0)}if(r)$("#"+l.IM_CHATWIN_EL).trigger("sendChatMsgAndBack.ImChatWin",b);else switch(y.chatType){case "singleChat":window.imWebsocketSdk.imJsonRequestMethods.sendSingleMsgForwardReq(b,
function(a){a=a.message;a={msgObj:{msg:D,subtitle:p,from_uid:window.imCurrentUser.uid,from_cid:window.imCurrentUser.cid,to_uid:a.to_uid,to_cid:a.to_cid,ser_msgid:a.ser_msgid,msgtime:a.msgtime},type:"1"};var b=$("#"+l.IM_ADDRLIST_EL);0<b.length&&b.trigger("updateLastMessage.ImAddrList",a)});break;case "groupChat":window.imWebsocketSdk.imJsonRequestMethods.sendGroupMsgForwardReq(b,function(a){a=a.message;a={msgObj:{msg:D,subtitle:p,from_uid:window.imCurrentUser.uid,from_cid:window.imCurrentUser.cid,
ser_msgid:a.ser_msgid,msgtime:a.msgtime},groupId:a.group_id,type:"2"};var b=$("#"+l.IM_ADDRLIST_EL);0<b.length&&b.trigger("updateLastMessage.ImAddrList",a)})}m&&window.imEteamsJsService.ImChatMsgCBService.sendEntityMsgPre(e)}},msgTypeConf:{MSG_TYPE_TXT_NORMAL:1001}}});
define("im/component/imPCcomponent","im/component/imUtils teams/component/entitybox teams/component/entityselector teams/component/userselector teams/component/usercard im/client/client".split(" "),function(n,s,p){var m=n("im/component/imUtils"),l=n("teams/component/entitybox"),h=n("teams/component/entityselector"),g=n("teams/component/userselector"),f=n("teams/component/usercard"),a=n("im/client/client");n=Backbone.View.extend({initialize:function(d){this.imWebReqMethods=window.imWebsocketSdk.imJsonRequestMethods;
this.imChatMsgCBService=window.imEteamsJsService.ImChatMsgCBService;this.implementsService="statusChangeReq openEntitySelector openUnreadBlogDiv openUserSelector openSysMsgEntity openPlacardDetail openEntitySlider openUsercard getEteamsId controlMainView triggerDomFunc excutendPcJsExtend openDynaChannelView routerToModule triggerBlogMarkAll onCommonJump".split(" ");window.imPCcomponent=function(){};window.imPCcomponent.imUtils=m;a.init()},delegateEvents:function(){},render:function(){for(var a=0;a<
this.implementsService.length;a++)window.imPCcomponent[this.implementsService[a]]=this[this.implementsService[a]]},statusChangeReq:function(a){var b={dev:window.imClientDev,status:"0"};a&&(b.status=a);window.imWebsocketSdk.imJsonRequestMethods.statusChangeReq({uid:window.imCurrentUser.uid,cid:window.imCurrentUser.cid,dev:window.imClientDev,data:b},function(a){})},openEntitySelector:function(){$("#selector-relevance").remove();window.isEteamsClientExt=!0;window.document.title="entity selector view";
(new h({toggleType:"entity-toggle-selector",module:"task",componentType:"pcClient",isClient:!0})).render();$("#selector-relevance").find(".modal-dialog").css("margin","0px");$("#selector-relevance").find(".modal-content").css("border-radius","0px");$("#selector-relevance").find(".detail-actions").addClass("hide");$("#selector-relevance").find(".selector-btns, .selector-fastcreate-btns").addClass("hide")},openUserSelector:function(a){window.isEteamsClientExt=!0;window.document.title="user selector view";
a||(a={});var b=$('\x3ca id\x3d"tempA"\x3e\x3c/a\x3e');b.attr("data-multi",!0);b.attr("data-entity","employee");a.$target=b;a.isClient=!0;$("#selector-employee")&&0<$("#selector-employee").length?($("#selector-employee").trigger("closeUserWin.user-win"),setTimeout(function(){(new g(a)).open();$("#selector-employee").find(".modal-dialog").css("margin","0px")},300)):((new g(a)).open(),$("#selector-employee").find(".modal-dialog").css("margin","0px"),$("#selector-employee").find(".modal-content").css("border-radius",
"0px"),$("#selector-employee").find(".modal-header .close").addClass("hide"),$("#selector-employee").find("#addUserToGroup").remove())},openUnreadBlogDiv:function(){window.isEteamsClientExt=!0;window.document.title="unread blog";$("#header").css("display","none");$("#mainContainer").css("display","none");var a=$("body #im-unreadBlog-div");(!a||1>a.length)&&$("body").append('\x3cdiv id\x3d"im-unreadBlog-div" class\x3d"module-blog-view"\x3e\x3c/div\x3e');a.empty();a={sgroup:"112",userId:window.imCurrentUser.uid,
type:"myblog",parentEl:"#im-unreadBlog-div",isClient:!0};$("html").css("min-width","0px");$("body").css("min-width","0px");window.imEteamsJsService.ImRecentListCBService.openThirdWin(a)},openDynaChannelView:function(a){window.isEteamsClientExt=!0;window.document.title="dynamic view";a.el="#im-dynaChannel-div";$("#header").css("display","none");$("#mainContainer").css("display","none");$("#im-dynaChannel-div").length&&$("#im-dynaChannel-div").remove();$("body").append('\x3cdiv id\x3d"im-dynaChannel-div" class\x3d"module-blog-view"\x3e\x3c/div\x3e');
var b=$("body #im-dynaChannel-div");(!b||1>b.length)&&$("body").append('\x3cdiv id\x3d"im-dynaChannel-div" class\x3d"module-blog-view"\x3e\x3c/div\x3e');b.empty();m.loadAsyncView("portal","eteams/portal/dynachannelview",a,this,"tempView");$("html").css("min-width","0px");$("body").css("min-width","0px")},openSysMsgEntity:function(a){window.isEteamsClientExt=!0;window.document.title="entity sys window view";var b=a.imEntity,c=a.ups;a=a.$msgDom;var f=b.me;if(0>["placard","hruserinfo"].indexOf(f)){switch(f){case "calendar":f=
"agenda";break;case "kpiSchemeSetting":f="kpiScheme"}var e=b.id,g="subscribe"==f?c.subModule:"";if(f&&e){if("blog"==f){var f="dayblog",h=a.attr("sender-id"),b=b.nm.match(/[0-9][0-9]*/g);3!=b.length&&(b=b.slice(b.length-3));var m=b.join("-")}var n=new l({entityModule:f,entityId:e,renderType:g,target:a,ups:c,dataTime:m,userId:h,isClient:!0,callbacks:{afterOpen:function(){},afterOperate:function(){n.close();"agenda"==f&&(1==$("#portal-container #calendar-list").size()&&$("#portal-container #calendar-list").trigger("refresh"),
$("#calendar").trigger("refetch"))}}});n.render();$("#entitybox").find(".modal-dialog").css("margin","0px");$("#entitybox").find(".modal-dialog").css("left","0px");$("#entitybox").find(".modal-dialog").css("top","0px");$("#entitybox").find(".modal-dialog").css("bottom","0px");$("#entitybox").find(".modal-content").css("border-radius","0px");setTimeout(function(){$("#entitybox").find(".detail-close-li").addClass("hide");$("#entitybox").find(".detail-slide-close").addClass("hide")},1E3)}}},openEntitySlider:function(a){var b=
a.imEntity;a=a.ups;var c={id:b.id,module:b.me};"subscribe"==b.me&&(c.renderType=a.subModule);switch(b.me){case "mycontactremind":c.remindManagerId=a.remindManagerId,c.remindModule=a.remindModule}$("body").trigger("slideOpen",c)},openUsercard:function(a){window.isEteamsClientExt=!0;window.document.title="user card view";var b=$("#usercard");0<b.length&&b.trigger("closeUsercard");(new f({targetEl:$("\x3cdiv\x3e\x3c/div\x3e"),userId:a,isClient:!0})).render();setTimeout(function(){$("#usercard").find(".j_panel-head .close").remove()},
500);$("#header").css("display","none");$("#usercard").css("border-radius","0px");$("#usercard").css("right","0px");$("#mainContainer").css("display","none")},getEteamsId:function(){if(window.EteamsClient){var a={EteamsId:{GlobalEteamsId:ETEAMSID,CookieEteamsId:m.modCookie("ETEAMSID")}};window.EteamsClient.OnGetExtInfo(JSON.stringify(a))}},controlMainView:function(a){window.isEteamsClientExt=!0;switch(a){case "show":$("#header").css("display","block");$("#mainContainer").css("display","block");break;
case "hide":$("#header").css("display","none"),$("#mainContainer").css("display","none")}},triggerBlogMarkAll:function(){window.isEteamsClientExt=!0;$("#im-unreadBlog-div").trigger("readAllBlog.BlogView",{blogEl:"#im-unreadBlog-div"})},triggerDomFunc:function(a,b,c){$(a).trigger(b,c)},routerToModule:function(a){ROUTER.navigate(a,{trigger:!0})},excutendPcJsExtend:function(a,b){a&&(this.tempPcFunc=a,this.tempPcFunc(this,b))},onCommonJump:function(a){a=JSON.parse(a);console.log(a);switch(a.type){case "101":m.loadAsyncView("attend",
"eteams/attend/myworkcalendarview",{userId:window.imCurrentUser.uid,viewDate:new Date},this,function(a,c,d){(new d(c)).render()})}},remove:function(){}});p.exports=n});
define("im/component/imUsercard",["im/component/imUtils","im/component/imContants","im/component/imChatComponent"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants"),h=n("im/component/imChatComponent");n=Backbone.View.extend({initialize:function(g){this.el="#"+l.IM_USERCARD;this.uidCid=g.uidCid;this.chatType=g.chatType;this.pointX=g.pointX;this.pointY=g.pointY;$("body").append(m.template("im.component.imusercard"))},delegateEvents:function(){var g=this,f=$("body"),a=$(g.el);
f.on("keyup.ImUsercard",function(a){27==a.which&&g.remove()});a.on("closePanel.ImUsercard",function(a){g.remove()});f.on("click.ImUsercard",function(a){a=$(a.target);a.hasClass("j_im-usercard-show")||0<a.parents(".j_im-usercard-show").length||g.remove()})},render:function(){var g=this,f=g.pointY,a=g.pointX,d=$(window).height()-f-$(g.el).height(),b=$(window).width()-a-$(g.el).width();0>d&&(f-=$(g.el).height());0>b&&(a-=$(g.el).width());d={};d.left=a+"px";d.top=f+"px";$(g.el).css(d);h.getImUserInfo(g.uidCid,
function(a){g.renderUserDetail(a)})},renderUserDetail:function(g){var f=$(this.el);f.find(".j_name").text(g.name);var a="/static/images/avatar.png";g.avatar&&(a=crmContext.remoteDownloadUrl+"/noauth/"+g.avatar+"?type\x3dsmall");f.find(".j_avatar").attr("src",a);var d={corpName:!0,email:!0,mobile:!0,tel:!0,address:!0};f.find(".j_extra-item").addClass("hide-im");if("10000"==g.uid&&"10000"==g.cid)f.find(".j_card-title").text("\u5c0f\u52a9\u624b\u5361\u7247"),d={email:!0,tel:!0,address:!0};else switch(this.chatType){case "singleChat":f.find(".j_card-title").text("\u5ba2\u670d\u5361\u7247");
d={email:!0,mobile:!0,tel:!0};break;case "groupChat":f.find(".j_card-title").text("\u5ba2\u6237\u5361\u7247"),d={corpName:!0,email:!0,mobile:!0,tel:!0}}h.getImCorpInfo(g.cid,function(a){d.corpName&&f.find(".j_corp-name").text(a.name).parents(".j_extra-item").removeClass("hide-im");d.address&&f.find(".j_address").text(a.address).parents(".j_extra-item").removeClass("hide-im")});d.email&&f.find(".j_email").text(g.email).parents(".j_extra-item").removeClass("hide-im");d.mobile&&f.find(".j_mobile").text(g.mobile).parents(".j_extra-item").removeClass("hide-im");
d.tel&&f.find(".j_tel").text(g.tel).parents(".j_extra-item").removeClass("hide-im")},remove:function(){var g=$(this.el);g.off(".ImUsercard");g.remove()}});p.exports=n});
define("im/component/imReminder","im/minichat/miniChatPage teams/feed/eteamscounter im/core/imWebsocket teams/imextra/imChatMsgCBService teams/imextra/imSysMsgCBService teams/imextra/imRecentListCBService teams/imextra/imMiniChatCBService im/component/imChatComponent teams/component/kickOutNotifyView".split(" "),function(n,s,p){n("im/minichat/miniChatPage");var m=n("teams/feed/eteamscounter"),l=n("im/core/imWebsocket"),h=n("teams/imextra/imChatMsgCBService"),g=n("teams/imextra/imSysMsgCBService"),
f=n("teams/imextra/imRecentListCBService"),a=n("teams/imextra/imMiniChatCBService"),d=n("im/component/imChatComponent"),b=n("teams/component/kickOutNotifyView");n=Backbone.View.extend({initialize:function(){this.remindFlag=0;this.topHomeEl="#j_message.j_homeli";this.initImWebSocketLink()},delegateEvents:function(){var a=this;$("body").off("singleChatNotifyBell").on("singleChatNotifyBell",function(b,d){b.stopPropagation();var f=!1,g=d.message.datas;g&&window.imCurrentUser.uid==g.from_uid&&(f=!0);f||
a.show()});$("body").off("groupChatNotifyBell").on("groupChatNotifyBell",function(b,d){var f=!1,g=d.message.datas;g&&window.imCurrentUser.uid==g.from_uid&&(f=!0);f||a.show()});$("body").off("sysMsgNotifyBell").on("sysMsgNotifyBell",function(b,d){var f=!1,g=d.message.datas;g&&window.imCurrentUser.uid==g.from_uid&&(f=!0);f||a.show()});$("body").off("updateImChatCount").on("updateImChatCount",function(b){a.updateImChatHome()});$("body").off("updateImSysMsgCount").on("updateImSysMsgCount",function(b){a.updateImSysMsgHome()});
$("body").off("imRefresh").on("imRefresh",function(b){a.refreshImHome()});$("body").on("mouseenter",".j_messageCount",function(){$(a.el).find(".message-count").removeClass("hint");a.clear()});$("body").on("imKickOutNotify",function(){a.kickOutNotifyView=new b;a.kickOutNotifyView.render()})},render:function(){},initImWebSocketLink:function(){l&&(this.imWebsocket=new l({imAppKey:window.iminfoMap.imAppKey}),this.imSysMsgCBService=new g,this.imRecentListCBService=new f,this.imChatMsgCBService=new h,this.imMiniChatCBService=
new a)},refreshImHome:function(){var a=d.getImMsgNoReadCountsAll();if(a)for(var b in a){var e=a[b];this.updateImHomeListOne(".j_im-sgroup-"+e.sgroup,e.count)}if(a=d.getImChatNoReadAllCounts()){var f=0;for(b in a)e=a[b],f+=parseInt(e.count);this.updateImHomeListOne(".j_im-chat",f)}m.totaling()},updateImChatHome:function(){var a=d.getImChatNoReadAllCounts();if(a){var b=0,e;for(e in a)b+=parseInt(a[e].count);a=b;99<b&&(a="99+");this.updateImHomeListOne(".j_im-chat",a)}m.totaling()},updateImSysMsgHome:function(){var a=
d.getImMsgNoReadCountsAll();if(a)for(var b in a){var e=a[b];this.updateImHomeListOne(".j_im-sgroup-"+e.sgroup,e.count)}m.totaling()},updateImHomeListOne:function(a,b){var d=$(this.topHomeEl).find("#j_dropMessage").find(a);if(d&&0<d.length)if(b&&0<parseInt(b)){var f=b;99<parseInt(b)&&(f="99+");d.find(".j_badge").text(f)}else d.find(".j_badge").text("")},show:function(){var a=this;window.newMsgRemindId||"5"!=window.imClientDev||(window.newMsgRemindId=setInterval(function(){var b=document.title.replace("\u3010\u3000\u3000\u3000\u3011",
"").replace("\u3010\u65b0\u6d88\u606f\u3011","");switch(a.remindFlag){case 0:document.title="\u3010\u3000\u3000\u3000\u3011"+b;a.remindFlag=1;break;case 1:document.title="\u3010\u65b0\u6d88\u606f\u3011"+b,a.remindFlag=0}},800))},clear:function(){window.clearInterval(window.newMsgRemindId);window.newMsgRemindId=void 0;0==document.title.indexOf("\u3010")&&(document.title=document.title.slice(document.title.indexOf("\u3011")+1))},remove:function(){}});p.exports=n});
define("im/component/imKickOffNotifyView",["im/component/imUtils"],function(n,s,p){var m=n("im/component/imUtils");n=Backbone.View.extend({initialize:function(l){this.el="#im-kickoff-notify-modal";$(this.el).remove();this.isRetina=window.devicePixelRatio&&1<window.devicePixelRatio;$("body").append(m.template("im.pc.component.imkickoffnotify"));var h=TEAMS.perLang,g=Date.create(1E3*l.login_time).format("{HH}:{mm}:{ss}"),f={zh_CN:"\u6d4f\u89c8\u5668",en_US:"web browser",zh_TW:"\u700f\u89bd\u5668"};
switch(l.dev){case "0":f={zh_CN:"PC\u5ba2\u6237\u7aef",en_US:"PC client",zh_TW:"PC\u5ba2\u6236\u7aef"};break;case "1":f={zh_CN:"Android\u624b\u673a",en_US:"Android mobile",zh_TW:"Android\u624b\u6a5f"};break;case "2":f={zh_CN:"Iphone\u624b\u673a",en_US:"Iphone mobile",zh_TW:"Iphone\u624b\u6a5f"};break;case "5":f={zh_CN:"\u6d4f\u89c8\u5668",en_US:"web browser",zh_TW:"\u700f\u89bd\u5668"};break;case "6":f={zh_CN:"\u624b\u6a5f\u6d4f\u89c8\u5668",en_US:"H5 browser",zh_TW:"\u624b\u6a5f\u700f\u89bd\u5668"};
break;case "7":f={zh_CN:"MAC\u5ba2\u6237\u7aef",en_US:"MAC client",zh_TW:"MAC\u5ba2\u6236\u7aef"}}switch(h){case "zh_CN":$(this.el).find(".j_kickout-tip").text("\u60a8\u7684\u8d26\u53f7\u4e8e"+g+"\u5728\u53e6\u4e00\u4e2a"+f[h]+"\u767b\u5165\uff0c\u5982\u975e\u672c\u4eba\u64cd\u4f5c\uff0c\u5219\u5bc6\u7801\u53ef\u80fd\u5df2\u6cc4\u6f0f\uff0c\u5efa\u8bae\u4fee\u6539\u5bc6\u7801\u3002");break;case "en_US":$(this.el).find(".j_kickout-tip").text("You account have logged via another "+f[h]+" at "+g+", If not yourself, the password may have been stolen. You'd better to change the password as soon as possible.");
break;case "zh_TW":$(this.el).find(".j_kickout-tip").text("\u60a8\u7684\u8cec\u865f\u4e8e"+g+"\u5728\u53e6\u4e00\u500b"+f[h]+"\u767b\u5165\u3001\u5982\u975e\u672c\u4eba\u64cd\u4f5c\uff0c\u5247\u5bc6\u78bc\u53ef\u80fd\u5df2\u6d29\u6f0f\uff0c\u5efa\u8b70\u4fee\u6539\u5bc6\u78bc\u3002")}switch(l.flag){case "0":switch(h){case "zh_CN":$(this.el).find(".j_kickout-tip").text("\u60a8\u5df2\u9000\u51fa\u56e2\u961f\u3002");break;case "en_US":$(this.el).find(".j_kickout-tip").text("You have been logged out");
break;case "zh_TW":$(this.el).find(".j_kickout-tip").text("\u60a8\u5df2\u9000\u51fa\u5718\u968a\u3002")}break;case "3":switch(h){case "zh_CN":$(this.el).find(".j_kickout-tip").text("\u60a8\u5df2\u901a\u8fc7"+f[h]+"\u9000\u51faeteams\uff0c\u5982\u975e\u672c\u4eba\u64cd\u4f5c\uff0c\u8bf7\u5c3d\u5feb\u4fee\u6539\u5bc6\u7801\u3002");break;case "en_US":$(this.el).find(".j_kickout-tip").text("You have been logged out via "+f[h]+",If not yourself,  You'd better to change the password as soon as possible.");
break;case "zh_TW":$(this.el).find(".j_kickout-tip").text("\u60a8\u5df2\u901a\u904e"+f[h]+"\u9000\u51faeteams\uff0c\u5982\u975e\u672c\u4eba\u64cd\u4f5c\uff0c\u8acb\u76e1\u5feb\u4fee\u6539\u5bc6\u78bc\u3002");break}case "4":window.location="/logout"}$(this.el).find("img").attr("src","/static/img/im/pc/im_kickout_ico"+(this.isRetina?"@2x":"")+".png")},delegateEvents:function(){$(this.el).off("click.imKickOffNotify",".j_logout-account").on("click.imKickOffNotify",".j_logout-account",function(l){window.location.reload(!0)})},
render:function(){$(this.el).modal("toggle")},remove:function(){}});p.exports=n});
define("im/component/imAvatarUploader",["im/component/imUtils","im/component/imContants","teams/models/profilemodel"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants");n=Backbone.View.extend({initialize:function(h){this.userId=window.imCurrentUser.uid;this.el="#"+l.IM_GROUP_DETAIL_MODAL;this.imChatGroup=h.imChatGroup;this.originImageId;this.imageArea={x:0,y:0,width:100,height:100};$(this.el).find(".j_other-content").append(m.template("im.component.imavataruploader")).removeClass("hide");$(this.el).addClass("im-avataruploader-modal")},
delegateEvents:function(){var h=this,g=$(h.el);h.initUploader();$("body").off("click.ImAvatarUploader").on("click.ImAvatarUploader",function(f){f.stopPropagation();$(f.target)});g.on("keydown.uploadAvatar",function(f){});g.off("click.uploadAvatar",".j_returnGroupDetail").on("click.uploadAvatar",".j_returnGroupDetail",function(f){h.remove();$(h.el).trigger("returnGroupDetail.ImGroupDetail")});g.on("click.uploadAvatar","#avatar-cut",function(f){var a=$(this);a.hasClass("disabled")||(a.addClass("disabled").text("\u88c1\u526a\u4e2d..."),
f.stopPropagation(),h.cutAvatarImage(!1,function(){h.remove();$(h.el).trigger("returnGroupDetail.ImGroupDetail")}))});$("body").on("keydown.uploadAvatar",function(f){27==f.which&&container.find("img.avatar-img").imgAreaSelect({instance:!0}).cancelSelection()})},render:function(){$(this.el).modal();this.renderAvatar();this.initImgSelect()},renderAvatar:function(h,g){this.originImageId=this.imChatGroup.avatar=h;var f=$(this.el);f.find(".avatar-img-preview").attr("src","/static/images/avatar.png");if(this.imChatGroup.avatar){var a=
"/base/download/"+h+"?type\x3dbig\x26ETEAMSID\x3d"+ETEAMSID,d="/base/download/"+h+"?type\x3dbig\x26ETEAMSID\x3d"+ETEAMSID;f.find(".avatar-preview-wrapper").removeClass("hide");f.find(".avatar-note").addClass("hide");f.find(".j_im-avatar-imageArea-img").removeClass("hide").attr("src",a);f.find(".avatar-img-preview").attr("src",d)}},initUploader:function(h){var g=this;h=m.getImUploadUrl()+"?module\x3dim\x26ETEAMSID\x3d"+ETEAMSID;h=new plupload.Uploader({runtimes:"html5,flash",file_data_name:"data",
container:g.el+" .j_im-chat-imgroupdetail-modal-content",max_file_size:"2mb",multi_selection:!1,browse_button:g.el+" .avatar-upload",url:h,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}],flash_swf_url:"/static/swf/plupload.swf"});h.init();h.bind("FilesAdded",function(f,a){f.refresh();f.start()});h.bind("UploadProgress",function(f,a){});h.bind("Error",function(f,a){-600==a.code&&m.notify("\u53ea\u80fd\u4e0a\u4f20\u6700\u5927\u4e0d\u8d85\u8fc72M,\u6700\u5c0f5b,\u540e\u7f00\u4e3ajpg,jpeg,png,gif\u7684\u56fe\u7247\u6587\u4ef6",
"\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u9650\u5236","error");f.refresh()});h.bind("FileUploaded",function(f,a,d){f=jQuery.parseJSON(d.response).fileObj;g.originImageId=f.id;48>f.imgHeight||48>f.imgWidth?m.notify("\u60a8\u4e0a\u4f20\u7684\u5934\u50cf\u5bbd\u5ea6\u6216\u8005\u9ad8\u5ea6\u5c0f\u4e8e48\u50cf\u7d20\uff0c\u8bf7\u9009\u62e9\u5176\u4ed6\u56fe\u7247\u4e0a\u4f20"):5<f.imgHeight/f.imgWidth||5<f.imgWidth/f.imgHeight?m.notify("\u60a8\u4e0a\u4f20\u7684\u5934\u50cf\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u7684\u6bd4\u4f8b\u8fc7\u5927\uff0c\u8bf7\u9009\u62e9\u5176\u4ed6\u56fe\u7247\u4e0a\u4f20"):
(g.renderAvatar(g.originImageId),g.cutAvatarImage(!0),g.initImgSelect())})},initImgSelect:function(){var h=this,g=$(h.el),f=g.find(".j_im-avatar-imageArea-img");h.ias=f.imgAreaSelect({parent:h.el+" .j_im-chat-imgroupdetail-modal-content",minHeight:100,minWidth:100,aspectRatio:"1:1",handles:!0,fadeSpeed:200,classPrefix:"imgareaselect",movable:!0,resizable:!0,resizeMargin:10,onSelectStart:function(){100>f.height()||100>f.width()?(m.notify("\u60a8\u4e0a\u4f20\u7684\u56fe\u7247\u7684\u5bbd\u5ea6\u6216\u8005\u9ad8\u5ea6\u5c0f\u4e8e100\u50cf\u7d20\uff0c\u4e0d\u652f\u6301\u88c1\u526a"),
f.imgAreaSelect({instance:!0}).remove()):(g.find(".avatar-preview-wrapper").removeClass("hide"),g.find("#avatar-cut").removeClass("hide"))},onSelectChange:function(a,d){if(!(100>f.height()||100>f.width())&&d.width&&d.height){g.find("img.avatar-img-preview").attr("src",g.find(".j_im-avatar-imageArea-img").attr("src"));var b=100/(d.width||1),c=100/(d.height||1),h=g.find(".j_im-avatar-imageArea-img").width(),e=g.find(".j_im-avatar-imageArea-img").height();g.find("img.avatar-img-preview").css({width:Math.round(b*
h)+"px",height:Math.round(c*e)+"px",marginLeft:"-"+Math.round(b*d.x1)+"px",marginTop:"-"+Math.round(c*d.y1)+"px"})}},onSelectEnd:function(a,d){100>f.height()||100>f.width()||(h.imageArea.x=d.x1,h.imageArea.y=d.y1,h.imageArea.width=d.width,h.imageArea.height=d.height)}});h.initImg=!0},cutAvatarImage:function(h,g){var f=this;f.imageArea.id=f.originImageId;$.ajax({contentType:"application/json;charset\x3dUTF-8",type:"post",url:"/profile/cutImage.json",dataType:"json",data:JSON.stringify({imageArea:f.imageArea}),
success:function(a){$(f.el).find("#avatar-cut").removeClass("disabled").text("\u88c1\u526a");a=a.cutImage;f.initImgSelect();f.imChatGroup.avatar=a.id;h?m.notify("\u4e0a\u4f20\u6210\u529f\uff0c\u8bf7\u62d6\u52a8\u56fe\u7247\u88c1\u526a"):m.notify("\u526a\u88c1\u6210\u529f!");$("#"+l.IM_GROUP_DETAIL_MODAL).trigger("updateGroupAvatar",{groupAvatar:a.id});g&&g()}})},remove:function(){var h=$(this.el),g=h.find(".j_im-avatar-imageArea-img").imgAreaSelect({instance:!0});g?g.remove():"";$("body").off(".uploadAvatar");
h.off(".uploadAvatar")}});p.exports=n});
define("im/component/imUserSelector",["im/component/imUtils","im/component/imChatComponent","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imChatComponent"),h=n("im/component/imContants");n=Backbone.View.extend({initialize:function(g){this.userId=window.imCurrentUser.uid;this.selectType=g.selectType;this.limitUserCount=g.limitUserCount;this.selectedUserArray=g.selectedUserArray;this.selectedUserArray||(this.selectedUserArray=[]);this.confirmFunc=g.confirmFunc;
this.el="#"+h.IM_GROUP_DETAIL_MODAL;this.imChatGroup=g.imChatGroup;$(this.el).find(".j_other-content").append(m.template("im.component.imuserselector")).removeClass("hide");$(this.el).addClass("im-groupadd-modal");$(this.el+" .j_im-selectuser-list-container").removeClass("hide-im")},delegateEvents:function(){var g=this,f=$(g.el);$("body").off("click.ImAvatarUploader").on("click.ImAvatarUploader",function(a){a.stopPropagation()});f.off("click.uploadAvatar",".j_returnGroupDetail").on("click.uploadAvatar",
".j_returnGroupDetail",function(a){$(g.el).trigger("returnGroupDetail.ImGroupDetail")});f.off("click.uploadAvatar",".j_confirm-button").on("click.uploadAvatar",".j_confirm-button",function(a){g.confirmFunc(g.selectedUserArray)});f.off("click.uploadAvatar",".j_cancel-button").on("click.uploadAvatar",".j_cancel-button",function(a){$(g.el).trigger("returnGroupDetail.ImGroupDetail")});f.off("click.uploadAvatar",".j_im-selectuser").on("click.uploadAvatar",".j_im-selectuser",function(a){a.stopPropagation();
a=$(this);a.find(".j_opt").hasClass("hide-im")||(a.hasClass("selected")?g.removeUserInSelect(a.attr("id")):g.addUserToSelect(a))});f.off("click.uploadAvatar",".j_remove-select").on("click.uploadAvatar",".j_remove-select",function(a){a.stopPropagation();a=$(this).parents(".j_im-selectuser");g.removeUserInSelect(a.attr("id"))});$("body").on("keydown.uploadAvatar",function(a){27==a.which&&container.find("img.avatar-img").imgAreaSelect({instance:!0}).cancelSelection()});f.off("click.ImAddrList",".j_im-clear-search-value").on("click.ImAddrList",
".j_im-clear-search-value",function(a,d){a.stopPropagation();a.preventDefault();var b=$(this),c=$(g.el).find(".j_im-member-search-input");c.val("");c.text("");b.css("display","none");g.returnMemberList()});f.off("click.uploadAvatar",".j_im-member-search-input").on("click.uploadAvatar",".j_im-member-search-input",function(a,d){a.stopPropagation();a.preventDefault();$(g.el).find(".j_im-clear-search-value").css("display","block")});f.off("keyup.uploadAvatar",".j_im-member-search-input").on("keyup.uploadAvatar",
".j_im-member-search-input",function(a){var d=$(this),d=$.trim(d.val());0<d.length&&g.renderSearchList(d);a=a.keyCode;8!=a&&46!=a||0!=d.length||g.returnMemberList()})},render:function(){var g=$(this.el);g.modal();this.renderGroupMember();$(this.el).find(".j_selector-list .j_limit-count").text(this.selectedUserArray.length+"/"+this.limitUserCount);m.layout(this.el+" .j_im-selectuser-list.j_selectorNavScr",[{scrollInertia:500,gotoTopButton:!1,mouseWheel:{scrollAmount:350}}]);m.layout(this.el+" .j_im-selectuser-search-scrollbar.j_selectorSearch-container",
[{scrollInertia:500,gotoTopButton:!1,mouseWheel:{scrollAmount:350}}]);g.find(".j_selectorMainScr").attr("height","420");m.layout(this.el+" .j_selector-list.j_selectorMainScr",[{scrollInertia:500,gotoTopButton:!1,mouseWheel:{scrollAmount:350}}])},renderGroupMember:function(){var g=$(this.el),f=g.find(".j_im-selectuser-list");f.empty();var a=l.getImGroupMemberCache("groupMemberKeyArray-"+this.imChatGroup.id);a&&a.groupMemberKeyArray&&0<a.groupMemberKeyArray.length&&a.groupMemberKeyArray.forEach(function(a){if((a=
l.getImChatUserCache("imChatUserNameKey-"+a))&&"3"!=a.role_type){var c=$.trim(a.pinyin);if(c&&0<c.length){var d=c.substring(0,1).toLocaleUpperCase();/[a-zA-Z]$/.test(d)||(d="degit");var e="pinyin-"+d}else d="degit",e="pinyin-"+d;c=f.find("#"+e);c.removeClass("hide");d&&1>c.length&&(c=g.find("#im-userselector-modal-clone-field #im-pinyin-clone").clone().attr("id",e),c.find(".j_index").text(d),"degit"==d&&c.find(".j_index").text("#"),f.append(c));d=g.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone().attr("id",
a.id);d.data("imChatUser",a);d.data("chatType","singleChat");d.find(".j_name").text(a.name).attr("title",a.name);a.avatar&&(e="/base/download/"+a.avatar,d.find(".j_avatar").attr("src",e),a.imgSrc=e);d.attr({id:a.uid,"data-entity":"employee"});c&&c.find(".j_user-list").append(d)}});if(this.selectedUserArray&&0<this.selectedUserArray.length){var d=$(this.el).find(".j_im-selected-list"),f=g.find(".j_im-selectuser-list");this.selectedUserArray.forEach(function(a){f.find("#"+a.uid).addClass("selected");
var c=g.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone().attr("id",a.uid);c.data("imChatUser",a);c.data("chatType","singleChat");c.find(".j_name").text(a.name).attr("title",a.name);if(a.avatar){var h="/base/download/"+a.avatar;c.find(".j_avatar").attr("src",h);a.imgSrc=h}c.attr({id:a.uid,"data-entity":"employee"});c.find(".j_opt").addClass("hide-im");c.find(".j_remove-select").removeClass("hide");d.append(c)})}},addUserToSelect:function(g){if(1==this.selectType&&0<this.selectedUserArray.length)m.notify("\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u6210\u5458");
else if(0==this.selectType&&this.selectedUserArray&&this.selectedUserArray.length>this.limitUserCount-1)m.notify("\u8d85\u51fa\u9009\u62e9\u4e0a\u9650");else{g.addClass("selected");var f=g.data("imChatUser");g=g.clone();g.data("imChatUser",f);g.find(".j_opt").addClass("hide-im");g.find(".j_remove-select").removeClass("hide");var a=$(this.el).find(".j_im-selected-list"),f=g.data("imChatUser");this.selectedUserArray.push(f);$(this.el).find(".j_selector-list .j_limit-count").text(this.selectedUserArray.length+
"/"+this.limitUserCount);a.append(g)}},removeUserInSelect:function(g){var f=this,a=$(f.el).find(".j_im-selected-list"),d=$(f.el).find(".j_im-selectuser-list"),b=$(f.el).find(".j_im-selectuser-search-list"),d=d.find("#"+g);b.find("#"+g).removeClass("selected");d.removeClass("selected");g=a.find("#"+g);if(0<g.length){a=g.data("imChatUser");if(f.selectedUserArray&&0<f.selectedUserArray.length){b=[];for(d=0;d<f.selectedUserArray.length;d++){var c=f.selectedUserArray[d];a.uid==c.uid&&a.cid==c.cid&&b.push(c)}0<
b.length&&(b.forEach(function(a){f.selectedUserArray.remove(a)}),$(f.el).find(".j_selector-list .j_limit-count").text(f.selectedUserArray.length+"/"+f.limitUserCount))}g.detach()}},renderSearchList:function(g){var f=this,a=$(f.el);window.imCacheData.imGroupCacheManager.searchMemberByName({id:f.imChatGroup.id},g,function(d){$(f.el).find(".j_im-selectuser-list-container .j_im-selectuser-list").addClass("hide-im");$(f.el).find(".j_im-selectuser-list-container .j_selectorSearch-container").removeClass("hide-im");
$(f.el).find(".j_im-selectuser-list-container .j_selectorSearch-container .j_no-result").removeClass("hide-im");var b=$(f.el).find(".j_im-selectuser-search-list");b.empty();var c=a.find("#im-userselector-modal-clone-field #im-pinyin-clone").clone().attr("id","search");b.append(c);if(d&&0<d.length){var g="";f.selectedUserArray&&0<f.selectedUserArray.length&&f.selectedUserArray.forEach(function(a){g+=","+a.uid});0<d.length&&$(f.el).find(".j_im-selectuser-list-container .j_selectorSearch-container .j_no-result").addClass("hide-im");
for(c=0;c<d.length;c++){var e=d[c];if(e.id!=window.imCurrentUser.uid||e.cid!=window.imCurrentUser.cid){var h=a.find("#im-userselector-modal-clone-field #im-selectuser-clone").clone().attr("id",e.id);h.data("imChatUser",e);h.data("chatType","singleChat");h.find(".j_name").text(e.name).attr("title",e.name);if(e.avatar){var l="/base/download/"+e.avatar;h.find(".j_avatar").attr("src",l);e.imgSrc=l}h.attr({id:e.uid,"data-entity":"employee"});0<g.indexOf(e.uid)&&h.addClass("selected");b.find("ul").append(h)}}}})},
returnMemberList:function(){$(this.el).find(".j_im-selectuser-list").removeClass("hide-im");$(this.el).find(".j_selectorSearch-container").addClass("hide-im");var g=$(this.el).find(".j_im-selectuser-list");g.find("li.selected").removeClass("selected");this.selectedUserArray&&0<this.selectedUserArray.length&&this.selectedUserArray.forEach(function(f){g.find("#"+f.uid+".j_im-selectuser").addClass("selected")})},remove:function(){var g=this.container;this.uploaderimg?this.uploaderimg.destroy():"";var f=
g.find("img.avatar-img").imgAreaSelect({instance:!0});f?f.remove():"";$("body").off(".uploadAvatar");g.off(".uploadAvatar");g?g.remove():""}});p.exports=n});
define("im/component/emojiarea",["im/component/imUtils"],function(n,s,p){return function(m){(function(l,h,g){var f=n("im/component/imUtils"),a={":smile:":"smile.png",":smirk:":"smirk.png",":sweat_smile:":"sweat_smile.png",":laughing:":"laughing.png",":angry:":"angry.png",":anguished:":"anguished.png",":astonished:":"astonished.png",":blush:":"blush.png",":cold_sweat:":"cold_sweat.png",":confounded:":"confounded.png",":confused:":"confused.png",":cry:":"cry.png",":relaxed:":"relaxed.png",":satisfied:":"satisfied.png",
":scream:":"scream.png",":disappointed:":"disappointed.png",":dizzy_face:":"dizzy_face.png",":expressionless:":"expressionless.png",":fearful:":"fearful.png",":flushed:":"flushed.png",":wink:":"wink.png",":grin:":"grin.png",":grinning:":"grinning.png",":triumph:":"triumph.png",":unamused:":"unamused.png",":sleepy:":"sleepy.png",":heart_eyes:":"heart_eyes.png",":heart:":"heart.png",":hushed:":"hushed.png",":innocent:":"innocent.png",":joy:":"joy.png",":kiss:":"kiss.png",":kissing_heart:":"kissing_heart.png",
":sweat:":"sweat.png",":mask:":"mask.png",":moon:":"moon.png",":pensive:":"pensive.png",":persevere:":"persevere.png",":birthday:":"birthday.png",":sob:":"sob.png",":sleeping:":"sleeping.png",":weary:":"weary.png",":sunglasses:":"sunglasses.png",":sunny:":"sunny.png",":thumbsup:":"thumbsup.png",":thumbsdown:":"thumbsdown.png",":v:":"v.png",":dog:":"dog.png",":watermelon:":"watermelon.png",":strawberry:":"strawberry.png",":rage:":"rage.png",":relieved:":"relieved.png",":worried:":"worried.png",":yum:":"yum.png",
":smiling_imp:":"smiling_imp.png",":imp:":"imp.png",":zap:":"zap.png",":zzz:":"zzz.png",":punch:":"punch.png",":girl:":"girl.png",":rocket:":"rocket.png",":man:":"man.png",":woman:":"woman.png",":rice:":"rice.png",":ring:":"ring.png",":pig:":"pig.png",":soccer:":"soccer.png",":hand:":"hand.png",":bomb:":"bomb.png",":books:":"books.png",":boy:":"boy.png",":bug:":"bug.png",":bulb:":"bulb.png",":cat:":"cat.png",":cherries:":"cherries.png",":chicken:":"chicken.png",":clap:":"clap.png",":cloud:":"cloud.png",
":coffee:":"coffee.png",":cow:":"cow.png",":watch:":"watch.png",":eyeglasses:":"eyeglasses.png",":eyes:":"eyes.png",":facepunch:":"facepunch.png",":fire:":"fire.png",":four_leaf_clover:":"four_leaf_clover.png",":gem:":"gem.png",":ghost:":"ghost.png",":gift:":"gift.png",":key:":"key.png",":baby:":"baby.png",":basketball:":"basketball.png",":bear:":"bear.png",":koala:":"koala.png",":beer:":"beer.png",":beetle:":"beetle.png",":tada:":"tada.png",":tiger:":"tiger.png",":train:":"train.png",":mouse:":"mouse.png",
":muscle:":"muscle.png",":ok_hand:":"ok_hand.png",":pear:":"pear.png",":skull:":"skull.png",":pill:":"pill.png",":poop:":"poop.png",":pray:":"pray.png",":snake:":"snake.png",":snowman:":"snowman.png",":alien:":"alien.png"},d={":smile:":"\u5f00\u5fc3",":smirk:":"\u5f97\u610f",":sweat_smile:":"\u5c34\u5c2c",":laughing:":"\u5927\u7b11",":angry:":"\u751f\u6c14",":anguished:":"\u60ca\u8bb6",":astonished:":"\u60ca\u5446",":blush:":"\u5bb3\u7f9e",":cold_sweat:":"\u51b7\u6c57",":confounded:":"\u60ca\u614c",
":confused:":"\u56f0\u60d1",":cry:":"\u54ed",":relaxed:":"\u653e\u677e",":satisfied:":"\u6ee1\u610f",":scream:":"\u60ca\u58f0\u5c16\u53eb",":disappointed:":"\u5931\u671b",":dizzy_face:":"\u6655\u7729",":expressionless:":"\u5446\u677f",":fearful:":"\u53ef\u6015",":flushed:":"\u6fc0\u52a8",":wink:":"\u7728\u773c",":grin:":"\u9732\u9f7f\u7b11",":grinning:":"\u54a7\u5634\u7b11",":triumph:":"\u51ef\u65cb",":unamused:":"\u4e0d\u6109\u5feb",":sleepy:":"\u7761\u89c9",":heart_eyes:":"\u7fa1\u6155",":heart:":"\u5fc3",
":hushed:":"\u8083\u9759",":innocent:":"\u5929\u771f",":joy:":"\u6b22\u6b23",":kiss:":"\u4eb2\u4eb2",":kissing_heart:":"\u98de\u543b",":sweat:":"\u51b7\u6c57",":mask:":"\u6234\u53e3\u7f69",":moon:":"\u6708\u4eae",":pensive:":"\u5fe7\u90c1",":persevere:":"\u575a\u6301\u5df1\u89c1",":birthday:":"\u751f\u65e5\u86cb\u7cd5",":sob:":"\u6cea\u6d41\u6ee1\u9762",":sleeping:":"\u7761\u7740\u4e86",":weary:":"\u538c\u70e6",":sunglasses:":"\u9177\u70ab",":sunny:":"\u592a\u9633",":thumbsup:":"\u5f3a",":thumbsdown:":"\u5f31",
":v:":"\u80dc\u5229",":dog:":"\u72d7",":watermelon:":"\u897f\u74dc",":strawberry:":"\u8349\u8393",":rage:":"\u6124\u6012",":relieved:":"\u5bbd\u6170",":worried:":"\u62c5\u5fc3",":yum:":"\u7f8e\u5473",":smiling_imp:":"\u53e4\u7075\u7cbe\u602a",":imp:":"\u987d\u76ae",":zap:":"\u95ea\u7535",":zzz:":"\u7761\u7720",":punch:":"\u62f3\u5934",":girl:":"\u5973\u5b69",":rocket:":"\u706b\u7bad",":man:":"\u7537\u4eba",":woman:":"\u5973\u4eba",":rice:":"\u7c73\u996d",":ring:":"\u6212\u6307",":pig:":"\u732a\u5934",
":soccer:":"\u8db3\u7403",":hand:":"\u624b\u638c",":bomb:":"\u70b8\u5f39",":books:":"\u4e66\u7c4d",":boy:":"\u7537\u5b69",":bug:":"\u722c\u866b",":bulb:":"\u7535\u706f\u6ce1",":cat:":"\u732b",":cherries:":"\u6a31\u6843",":chicken:":"\u9e21",":clap:":"\u9f13\u638c",":cloud:":"\u4e91",":coffee:":"\u5496\u5561",":cow:":"\u5976\u725b",":watch:":"\u624b\u8868",":eyeglasses:":"\u773c\u955c",":eyes:":"\u773c\u775b",":facepunch:":"\u63e1\u62f3",":fire:":"\u706b",":four_leaf_clover:":"\u56db\u53f6\u8349",
":gem:":"\u5b9d\u77f3",":ghost:":"\u5e7d\u7075",":gift:":"\u793c\u7269",":key:":"\u94a5\u5319",":baby:":"\u5a74\u513f",":basketball:":"\u7bee\u7403",":bear:":"\u718a",":koala:":"\u8003\u62c9",":beer:":"\u5564\u9152",":beetle:":"\u7532\u58f3\u866b",":tada:":"\u5e86\u529f",":tiger:":"\u8001\u864e",":train:":"\u706b\u8f66",":mouse:":"\u8001\u9f20",":muscle:":"\u808c\u8089",":ok_hand:":"OK",":pear:":"\u68a8\u5b50",":skull:":"\u9ab7\u9ac5",":pill:":"\u836f\u4e38",":poop:":"\u4fbf\u4fbf",":pray:":"\u7948\u7977",
":snake:":"\u86c7",":snowman:":"\u96ea\u4eba",":alien:":"\u5916\u661f\u4eba"},b={":smile:":"smile.png",":smirk:":"smirk.png",":sweat_smile:":"sweat_smile.png",":laughing:":"laughing.png",":angry:":"angry.png",":anguished:":"anguished.png",":astonished:":"astonished.png",":blush:":"blush.png",":cold_sweat:":"cold_sweat.png",":confounded:":"confounded.png",":confused:":"confused.png",":cry:":"cry.png",":relaxed:":"relaxed.png",":satisfied:":"satisfied.png",":scream:":"scream.png",":disappointed:":"disappointed.png",
":dizzy_face:":"dizzy_face.png",":expressionless:":"expressionless.png",":fearful:":"fearful.png",":flushed:":"flushed.png",":wink:":"wink.png",":grin:":"grin.png",":grinning:":"grinning.png",":triumph:":"triumph.png",":unamused:":"unamused.png",":sleepy:":"sleepy.png",":heart_eyes:":"heart_eyes.png",":heart:":"heart.png",":hushed:":"hushed.png",":innocent:":"innocent.png",":joy:":"joy.png",":kiss:":"kiss.png",":kissing_heart:":"kissing_heart.png",":sweat:":"sweat.png",":mask:":"mask.png",":moon:":"moon.png",
":pensive:":"pensive.png",":persevere:":"persevere.png",":birthday:":"birthday.png",":sob:":"sob.png",":sleeping:":"sleeping.png",":weary:":"weary.png",":sunglasses:":"sunglasses.png",":sunny:":"sunny.png",":thumbsup:":"thumbsup.png",":thumbsdown:":"thumbsdown.png",":v:":"v.png",":dog:":"dog.png",":watermelon:":"watermelon.png",":strawberry:":"strawberry.png",":rage:":"rage.png",":relieved:":"relieved.png",":worried:":"worried.png",":yum:":"yum.png",":smiling_imp:":"smiling_imp.png",":imp:":"imp.png",
":zap:":"zap.png",":zzz:":"zzz.png",":punch:":"punch.png",":girl:":"girl.png",":rocket:":"rocket.png",":man:":"man.png",":woman:":"woman.png",":rice:":"rice.png",":ring:":"ring.png",":pig:":"pig.png",":soccer:":"soccer.png",":hand:":"hand.png",":bomb:":"bomb.png",":books:":"books.png",":boy:":"boy.png",":bug:":"bug.png",":bulb:":"bulb.png",":cat:":"cat.png",":cherries:":"cherries.png",":chicken:":"chicken.png",":clap:":"clap.png",":cloud:":"cloud.png",":coffee:":"coffee.png",":cow:":"cow.png",":watch:":"watch.png",
":eyeglasses:":"eyeglasses.png",":eyes:":"eyes.png",":facepunch:":"facepunch.png",":fire:":"fire.png",":four_leaf_clover:":"four_leaf_clover.png",":gem:":"gem.png",":ghost:":"ghost.png",":gift:":"gift.png",":key:":"key.png",":baby:":"baby.png",":basketball:":"basketball.png",":bear:":"bear.png",":koala:":"koala.png",":beer:":"beer.png",":beetle:":"beetle.png",":tada:":"tada.png",":tiger:":"tiger.png",":train:":"train.png",":mouse:":"mouse.png",":muscle:":"muscle.png",":ok_hand:":"ok_hand.png",":pear:":"pear.png",
":skull:":"skull.png",":pill:":"pill.png",":poop:":"poop.png",":pray:":"pray.png",":snake:":"snake.png",":snowman:":"snowman.png",":alien:":"alien.png",":hide_face1:":"hide_face1.png",":hide_face2:":"hide_face2.png",":hide_face3:":"hide_face3.png",":hide_face4:":"hide_face4.png",":hide_face5:":"hide_face5.png",":hide_face6:":"hide_face6.png",":hide_face7:":"hide_face7.png",":hide_face8:":"hide_face8.png",":hide_face9:":"hide_face9.png",":hide_face11:":"hide_face11.png",":hide_face12:":"hide_face12.png",
":hide_face13:":"hide_face13.png",":hide_face14:":"hide_face14.png",":hide_face15:":"hide_face15.png",":hide_face16:":"hide_face16.png",":hide_food1:":"hide_food1.png",":hide_food2:":"hide_food2.png",":hide_food3:":"hide_food3.png",":hide_food4:":"hide_food4.png",":hide_food5:":"hide_food5.png",":hide_food6:":"hide_food6.png",":hide_food7:":"hide_food7.png",":hide_food8:":"hide_food8.png",":hide_food9:":"hide_food9.png",":hide_food11:":"hide_food11.png",":hide_food12:":"hide_food12.png",":hide_food13:":"hide_food13.png",
":hide_food14:":"hide_food14.png",":hide_food15:":"hide_food15.png",":hide_food16:":"hide_food16.png",":hide_food17:":"hide_food17.png",":hide_food18:":"hide_food18.png",":hide_food19:":"hide_food19.png",":hide_food21:":"hide_food21.png",":hide_food22:":"hide_food22.png",":hide_food23:":"hide_food23.png",":hide_food24:":"hide_food24.png",":hide_food25:":"hide_food25.png",":hide_food26:":"hide_food26.png",":hide_food27:":"hide_food27.png",":hide_food28:":"hide_food28.png",":hide_food29:":"hide_food29.png",
":hide_food31:":"hide_food31.png",":hide_food32:":"hide_food32.png",":hide_food33:":"hide_food33.png",":hide_food34:":"hide_food34.png",":hide_food35:":"hide_food35.png",":hide_food36:":"hide_food36.png",":hide_food37:":"hide_food37.png",":hide_food38:":"hide_food38.png",":hide_food39:":"hide_food39.png",":hide_food41:":"hide_food41.png",":hide_food42:":"hide_food42.png",":hide_food43:":"hide_food43.png",":hide_food44:":"hide_food44.png",":hide_food45:":"hide_food45.png",":hide_food46:":"hide_food46.png",
":hide_food47:":"hide_food47.png",":hide_food48:":"hide_food48.png",":hide_food49:":"hide_food49.png",":hide_food51:":"hide_food51.png",":hide_food52:":"hide_food52.png",":hide_food53:":"hide_food53.png",":hide_food54:":"hide_food54.png",":hide_food55:":"hide_food55.png",":hide_food56:":"hide_food56.png",":hide_cat1:":"hide_cat1.png",":hide_cat2:":"hide_cat2.png",":hide_cat3:":"hide_cat3.png",":hide_cat4:":"hide_cat4.png",":hide_cat5:":"hide_cat5.png",":hide_cat6:":"hide_cat6.png",":hide_cat7:":"hide_cat7.png",
":hide_cat8:":"hide_cat8.png",":hide_cat9:":"hide_cat9.png",":hide_man1:":"hide_man1.png",":hide_man2:":"hide_man2.png",":hide_man3:":"hide_man3.png",":hide_man4:":"hide_man4.png",":hide_man5:":"hide_man5.png",":hide_man6:":"hide_man6.png",":hide_man7:":"hide_man7.png",":hide_man8:":"hide_man8.png",":hide_man9:":"hide_man9.png",":hide_man11:":"hide_man11.png",":hide_man12:":"hide_man12.png",":hide_man13:":"hide_man13.png",":hide_man14:":"hide_man14.png",":hide_man15:":"hide_man15.png",":hide_man16:":"hide_man16.png",
":hide_man17:":"hide_man17.png",":hide_man18:":"hide_man18.png",":hide_man19:":"hide_man19.png",":hide_man21:":"hide_man21.png",":hide_man22:":"hide_man22.png",":hide_man23:":"hide_man23.png",":hide_man24:":"hide_man24.png",":hide_man25:":"hide_man25.png",":hide_man26:":"hide_man26.png",":hide_man27:":"hide_man27.png",":hide_man28:":"hide_man28.png",":hide_man29:":"hide_man29.png",":hide_man31:":"hide_man31.png",":hide_man32:":"hide_man32.png",":hide_interesting1:":"hide_interesting1.png",":hide_interesting2:":"hide_interesting2.png",
":hide_interesting3:":"hide_interesting3.png",":hide_interesting4:":"hide_interesting4.png",":hide_interesting5:":"hide_interesting5.png",":hide_interesting6:":"hide_interesting6.png",":hide_interesting7:":"hide_interesting7.png",":hide_interesting8:":"hide_interesting8.png",":hide_interesting9:":"hide_interesting9.png",":hide_interesting11:":"hide_interesting11.png",":hide_interesting12:":"hide_interesting12.png",":hide_interesting13:":"hide_interesting13.png",":hide_interesting14:":"hide_interesting14.png",
":hide_interesting15:":"hide_interesting15.png",":hide_interesting16:":"hide_interesting16.png",":hide_interesting17:":"hide_interesting17.png",":hide_interesting18:":"hide_interesting18.png",":hide_interesting19:":"hide_interesting19.png",":hide_interesting21:":"hide_interesting21.png",":hide_interesting22:":"hide_interesting22.png",":hide_interesting23:":"hide_interesting23.png",":hide_interesting24:":"hide_interesting24.png",":hide_interesting25:":"hide_interesting25.png",":hide_interesting26:":"hide_interesting26.png",
":hide_interesting27:":"hide_interesting27.png",":hide_interesting28:":"hide_interesting28.png",":hide_interesting29:":"hide_interesting29.png",":hide_interesting31:":"hide_interesting31.png",":hide_interesting32:":"hide_interesting32.png",":hide_interesting33:":"hide_interesting33.png",":hide_interesting34:":"hide_interesting34.png",":hide_animal1:":"hide_animal1.png",":hide_animal2:":"hide_animal2.png",":hide_animal3:":"hide_animal3.png",":hide_animal4:":"hide_animal4.png",":hide_animal5:":"hide_animal5.png",
":hide_animal6:":"hide_animal6.png",":hide_animal7:":"hide_animal7.png",":hide_animal8:":"hide_animal8.png",":hide_animal9:":"hide_animal9.png",":hide_animal11:":"hide_animal11.png",":hide_animal12:":"hide_animal12.png",":hide_animal13:":"hide_animal13.png",":hide_animal14:":"hide_animal14.png",":hide_animal15:":"hide_animal15.png",":hide_animal16:":"hide_animal16.png",":hide_animal17:":"hide_animal17.png",":hide_animal18:":"hide_animal18.png",":hide_animal19:":"hide_animal19.png",":hide_animal21:":"hide_animal21.png",
":hide_animal22:":"hide_animal22.png",":hide_animal23:":"hide_animal23.png",":hide_animal24:":"hide_animal24.png",":hide_animal25:":"hide_animal25.png",":hide_animal26:":"hide_animal26.png",":hide_animal27:":"hide_animal27.png",":hide_animal28:":"hide_animal28.png",":hide_animal29:":"hide_animal29.png",":hide_animal31:":"hide_animal31.png",":hide_animal32:":"hide_animal32.png",":hide_animal33:":"hide_animal33.png",":hide_animal34:":"hide_animal34.png",":hide_animal35:":"hide_animal35.png",":hide_animal36:":"hide_animal36.png",
":hide_animal37:":"hide_animal37.png",":hide_animal38:":"hide_animal38.png",":hide_animal39:":"hide_animal39.png",":hide_animal41:":"hide_animal41.png",":hide_animal42:":"hide_animal42.png",":hide_animal43:":"hide_animal43.png",":hide_animal44:":"hide_animal44.png",":hide_animal45:":"hide_animal45.png",":hide_animal46:":"hide_animal46.png",":hide_animal47:":"hide_animal47.png",":hide_animal48:":"hide_animal48.png",":hide_animal49:":"hide_animal49.png",":hide_animal51:":"hide_animal51.png",":hide_animal52:":"hide_animal52.png",
":hide_animal53:":"hide_animal53.png",":hide_animal54:":"hide_animal54.png",":hide_animal55:":"hide_animal55.png",":hide_animal56:":"hide_animal56.png",":hide_nature1:":"hide_nature1.png",":hide_nature2:":"hide_nature2.png",":hide_nature3:":"hide_nature3.png",":hide_nature4:":"hide_nature4.png",":hide_nature5:":"hide_nature5.png",":hide_nature6:":"hide_nature6.png",":hide_nature7:":"hide_nature7.png",":hide_nature8:":"hide_nature8.png",":hide_nature9:":"hide_nature9.png",":hide_nature11:":"hide_nature11.png",
":hide_nature12:":"hide_nature12.png",":hide_nature13:":"hide_nature13.png",":hide_nature14:":"hide_nature14.png",":hide_nature15:":"hide_nature15.png",":hide_nature16:":"hide_nature16.png",":hide_nature17:":"hide_nature17.png",":hide_nature18:":"hide_nature18.png",":hide_nature19:":"hide_nature19.png",":hide_nature21:":"hide_nature21.png",":hide_nature22:":"hide_nature22.png",":hide_nature23:":"hide_nature23.png",":hide_nature24:":"hide_nature24.png",":hide_nature25:":"hide_nature25.png",":hide_nature26:":"hide_nature26.png",
":hide_nature27:":"hide_nature27.png",":hide_nature28:":"hide_nature28.png",":hide_nature29:":"hide_nature29.png",":hide_nature31:":"hide_nature31.png",":hide_nature32:":"hide_nature32.png",":hide_nature33:":"hide_nature33.png",":hide_nature34:":"hide_nature34.png",":hide_nature35:":"hide_nature35.png",":hide_nature36:":"hide_nature36.png",":hide_nature37:":"hide_nature37.png",":hide_nature38:":"hide_nature38.png",":hide_nature39:":"hide_nature39.png",":hide_nature41:":"hide_nature41.png",":hide_nature42:":"hide_nature42.png",
":hide_nature43:":"hide_nature43.png",":hide_nature44:":"hide_nature44.png",":hide_nature45:":"hide_nature45.png",":hide_nature46:":"hide_nature46.png",":hide_travel1:":"hide_travel1.png",":hide_travel2:":"hide_travel2.png",":hide_travel3:":"hide_travel3.png",":hide_travel4:":"hide_travel4.png",":hide_travel5:":"hide_travel5.png",":hide_travel6:":"hide_travel6.png",":hide_travel7:":"hide_travel7.png",":hide_travel8:":"hide_travel8.png",":hide_travel9:":"hide_travel9.png",":hide_travel11:":"hide_travel11.png",
":hide_travel12:":"hide_travel12.png",":hide_travel13:":"hide_travel13.png",":hide_travel14:":"hide_travel14.png",":hide_travel15:":"hide_travel15.png",":hide_travel16:":"hide_travel16.png",":hide_travel17:":"hide_travel17.png",":hide_travel18:":"hide_travel18.png",":hide_travel19:":"hide_travel19.png",":hide_travel21:":"hide_travel21.png",":hide_travel22:":"hide_travel22.png",":hide_travel23:":"hide_travel23.png",":hide_travel24:":"hide_travel24.png",":hide_travel25:":"hide_travel25.png",":hide_travel26:":"hide_travel26.png",
":hide_travel27:":"hide_travel27.png",":hide_travel28:":"hide_travel28.png",":hide_travel29:":"hide_travel29.png",":hide_travel31:":"hide_travel31.png",":hide_travel32:":"hide_travel32.png",":hide_travel33:":"hide_travel33.png",":hide_travel34:":"hide_travel34.png",":hide_travel35:":"hide_travel35.png",":hide_travel36:":"hide_travel36.png",":hide_travel37:":"hide_travel37.png",":hide_travel38:":"hide_travel38.png",":hide_travel39:":"hide_travel39.png",":hide_travel41:":"hide_travel41.png",":hide_travel42:":"hide_travel42.png",
":hide_travel43:":"hide_travel43.png",":hide_travel44:":"hide_travel44.png",":hide_travel45:":"hide_travel45.png",":hide_travel46:":"hide_travel46.png",":hide_travel47:":"hide_travel47.png",":hide_travel48:":"hide_travel48.png",":hide_travel49:":"hide_travel49.png",":hide_travel51:":"hide_travel51.png",":hide_travel52:":"hide_travel52.png",":hide_travel53:":"hide_travel53.png",":hide_travel54:":"hide_travel54.png",":hide_travel55:":"hide_travel55.png",":hide_palace1:":"hide_palace1.png",":hide_palace2:":"hide_palace2.png",
":hide_palace3:":"hide_palace3.png",":hide_palace4:":"hide_palace4.png",":hide_palace5:":"hide_palace5.png",":hide_palace6:":"hide_palace6.png",":hide_palace7:":"hide_palace7.png",":hide_palace8:":"hide_palace8.png",":hide_palace9:":"hide_palace9.png",":hide_palace11:":"hide_palace11.png",":hide_palace12:":"hide_palace12.png",":hide_palace13:":"hide_palace13.png",":hide_palace14:":"hide_palace14.png",":hide_palace15:":"hide_palace15.png",":hide_palace16:":"hide_palace16.png",":hide_palace17:":"hide_palace17.png",
":hide_palace18:":"hide_palace18.png",":hide_palace19:":"hide_palace19.png",":hide_palace21:":"hide_palace21.png",":hide_palace22:":"hide_palace22.png",":hide_palace23:":"hide_palace23.png",":hide_palace24:":"hide_palace24.png",":hide_palace25:":"hide_palace25.png",":hide_palace26:":"hide_palace26.png",":hide_palace27:":"hide_palace27.png",":hide_palace28:":"hide_palace28.png",":hide_palace29:":"hide_palace29.png",":hide_palace31:":"hide_palace31.png",":hide_palace32:":"hide_palace32.png",":hide_palace33:":"hide_palace33.png",
":hide_palace34:":"hide_palace34.png",":hide_palace35:":"hide_palace35.png",":hide_palace36:":"hide_palace36.png",":hide_palace37:":"hide_palace37.png",":hide_palace38:":"hide_palace38.png",":hide_palace39:":"hide_palace39.png",":hide_palace41:":"hide_palace41.png",":hide_palace42:":"hide_palace42.png",":hide_palace43:":"hide_palace43.png",":hide_palace44:":"hide_palace44.png",":hide_palace45:":"hide_palace45.png",":hide_palace46:":"hide_palace46.png",":hide_palace47:":"hide_palace47.png",":hide_palace48:":"hide_palace48.png",
":hide_palace49:":"hide_palace49.png",":hide_object1:":"hide_object1.png",":hide_object2:":"hide_object2.png",":hide_object3:":"hide_object3.png",":hide_object4:":"hide_object4.png",":hide_object5:":"hide_object5.png",":hide_object6:":"hide_object6.png",":hide_object7:":"hide_object7.png",":hide_object8:":"hide_object8.png",":hide_object9:":"hide_object9.png",":hide_object11:":"hide_object11.png",":hide_object12:":"hide_object12.png",":hide_object13:":"hide_object13.png",":hide_object14:":"hide_object14.png",
":hide_object15:":"hide_object15.png",":hide_object16:":"hide_object16.png",":hide_object17:":"hide_object17.png",":hide_object18:":"hide_object18.png",":hide_object19:":"hide_object19.png",":hide_object21:":"hide_object21.png",":hide_object22:":"hide_object22.png",":hide_object23:":"hide_object23.png",":hide_object24:":"hide_object24.png",":hide_object25:":"hide_object25.png",":hide_object26:":"hide_object26.png",":hide_object27:":"hide_object27.png",":hide_object28:":"hide_object28.png",":hide_object29:":"hide_object29.png",
":hide_object31:":"hide_object31.png",":hide_object32:":"hide_object32.png",":hide_object33:":"hide_object33.png",":hide_object34:":"hide_object34.png",":hide_object35:":"hide_object35.png",":hide_object36:":"hide_object36.png",":hide_object37:":"hide_object37.png",":hide_object38:":"hide_object38.png",":hide_object39:":"hide_object39.png",":hide_object41:":"hide_object41.png",":hide_object42:":"hide_object42.png",":hide_object43:":"hide_object43.png",":hide_object44:":"hide_object44.png",":hide_object45:":"hide_object45.png",
":hide_object46:":"hide_object46.png",":hide_object47:":"hide_object47.png",":hide_object48:":"hide_object48.png",":hide_object49:":"hide_object49.png",":hide_object51:":"hide_object51.png",":hide_object52:":"hide_object52.png",":hide_object53:":"hide_object53.png",":hide_object54:":"hide_object54.png",":hide_object55:":"hide_object55.png",":hide_object56:":"hide_object56.png",":hide_object57:":"hide_object57.png",":hide_object58:":"hide_object58.png",":hide_object59:":"hide_object59.png",":hide_object61:":"hide_object61.png",
":hide_object62:":"hide_object62.png",":hide_object63:":"hide_object63.png",":hide_object64:":"hide_object64.png",":hide_object65:":"hide_object65.png",":hide_object66:":"hide_object66.png",":hide_object67:":"hide_object67.png",":hide_object68:":"hide_object68.png",":hide_object69:":"hide_object69.png",":hide_object71:":"hide_object71.png",":hide_object72:":"hide_object72.png",":hide_object73:":"hide_object73.png",":hide_object74:":"hide_object74.png",":hide_object75:":"hide_object75.png",":hide_object76:":"hide_object76.png",
":hide_object77:":"hide_object77.png",":hide_object78:":"hide_object78.png",":hide_object79:":"hide_object79.png",":hide_object81:":"hide_object81.png",":hide_object82:":"hide_object82.png",":hide_object83:":"hide_object83.png",":hide_object84:":"hide_object84.png",":hide_object85:":"hide_object85.png",":hide_object86:":"hide_object86.png",":hide_object87:":"hide_object87.png",":hide_object88:":"hide_object88.png",":hide_object89:":"hide_object89.png",":hide_object91:":"hide_object91.png",":hide_object92:":"hide_object92.png",
":hide_object93:":"hide_object93.png",":hide_object94:":"hide_object94.png",":hide_object95:":"hide_object95.png",":hide_object96:":"hide_object96.png",":hide_object97:":"hide_object97.png",":hide_object98:":"hide_object98.png",":hide_object99:":"hide_object99.png",":hide_object101:":"hide_object101.png",":hide_object102:":"hide_object102.png",":hide_object103:":"hide_object103.png",":hide_object104:":"hide_object104.png",":hide_object105:":"hide_object105.png",":hide_object106:":"hide_object106.png",
":hide_object107:":"hide_object107.png",":hide_object108:":"hide_object108.png",":hide_object109:":"hide_object109.png",":hide_object111:":"hide_object111.png",":hide_object112:":"hide_object112.png",":hide_object113:":"hide_object113.png",":hide_object114:":"hide_object114.png",":hide_object115:":"hide_object115.png",":hide_object116:":"hide_object116.png",":hide_object117:":"hide_object117.png",":hide_object118:":"hide_object118.png",":hide_object119:":"hide_object119.png",":hide_object121:":"hide_object121.png",
":hide_object122:":"hide_object122.png",":hide_object123:":"hide_object123.png",":hide_object124:":"hide_object124.png",":hide_object125:":"hide_object125.png",":hide_object126:":"hide_object126.png",":hide_object127:":"hide_object127.png",":hide_object128:":"hide_object128.png",":hide_object129:":"hide_object129.png",":hide_object131:":"hide_object131.png",":hide_object132:":"hide_object132.png",":hide_object133:":"hide_object133.png",":hide_object134:":"hide_object134.png",":hide_object135:":"hide_object135.png",
":hide_object136:":"hide_object136.png",":hide_object137:":"hide_object137.png",":hide_object138:":"hide_object138.png",":hide_object139:":"hide_object139.png",":hide_object141:":"hide_object141.png",":hide_object142:":"hide_object142.png",":hide_object143:":"hide_object143.png",":hide_object144:":"hide_object144.png",":hide_object145:":"hide_object145.png",":hide_object146:":"hide_object146.png",":hide_object147:":"hide_object147.png",":hide_object148:":"hide_object148.png",":hide_object149:":"hide_object149.png",
":hide_object151:":"hide_object151.png",":hide_object152:":"hide_object152.png",":hide_object153:":"hide_object153.png",":hide_object154:":"hide_object154.png",":hide_object155:":"hide_object155.png",":hide_object156:":"hide_object156.png",":hide_object157:":"hide_object157.png",":hide_object158:":"hide_object158.png",":hide_object159:":"hide_object159.png",":hide_object161:":"hide_object161.png",":hide_object162:":"hide_object162.png",":hide_object163:":"hide_object163.png",":hide_object164:":"hide_object164.png",
":hide_object165:":"hide_object165.png",":hide_object166:":"hide_object166.png",":hide_object167:":"hide_object167.png",":hide_object168:":"hide_object168.png",":hide_object169:":"hide_object169.png",":hide_object171:":"hide_object171.png",":hide_object172:":"hide_object172.png",":hide_object173:":"hide_object173.png",":hide_object174:":"hide_object174.png",":hide_object175:":"hide_object175.png",":hide_object176:":"hide_object176.png",":hide_object177:":"hide_object177.png",":hide_object178:":"hide_object178.png",
":hide_object179:":"hide_object179.png",":hide_object181:":"hide_object181.png",":hide_object182:":"hide_object182.png",":hide_object183:":"hide_object183.png",":hide_object184:":"hide_object184.png",":hide_object185:":"hide_object185.png",":hide_object186:":"hide_object186.png",":hide_object187:":"hide_object187.png",":hide_object188:":"hide_object188.png",":hide_object189:":"hide_object189.png",":hide_object191:":"hide_object191.png",":hide_object192:":"hide_object192.png",":hide_object193:":"hide_object193.png",
":hide_object194:":"hide_object194.png",":hide_object195:":"hide_object195.png",":hide_object196:":"hide_object196.png",":hide_object197:":"hide_object197.png",":hide_object198:":"hide_object198.png",":hide_object199:":"hide_object199.png",":hide_object201:":"hide_object201.png",":hide_object202:":"hide_object202.png",":hide_object203:":"hide_object203.png",":hide_object204:":"hide_object204.png",":hide_object205:":"hide_object205.png",":hide_object206:":"hide_object206.png",":hide_object207:":"hide_object207.png",
":hide_object208:":"hide_object208.png",":hide_object209:":"hide_object209.png",":hide_object211:":"hide_object211.png",":hide_object212:":"hide_object212.png",":hide_object213:":"hide_object213.png",":hide_object214:":"hide_object214.png",":hide_object215:":"hide_object215.png",":hide_object216:":"hide_object216.png",":hide_object217:":"hide_object217.png",":hide_object218:":"hide_object218.png",":hide_object219:":"hide_object219.png",":hide_object221:":"hide_object221.png",":hide_object222:":"hide_object222.png",
":hide_object223:":"hide_object223.png",":hide_object224:":"hide_object224.png",":hide_object225:":"hide_object225.png",":hide_object226:":"hide_object226.png",":hide_object227:":"hide_object227.png",":hide_object228:":"hide_object228.png",":hide_object229:":"hide_object229.png",":hide_object231:":"hide_object231.png",":hide_object232:":"hide_object232.png",":hide_object233:":"hide_object233.png",":hide_object234:":"hide_object234.png",":hide_object235:":"hide_object235.png",":hide_object236:":"hide_object236.png",
":hide_object237:":"hide_object237.png",":hide_object238:":"hide_object238.png",":hide_object239:":"hide_object239.png",":hide_object241:":"hide_object241.png",":hide_object242:":"hide_object242.png",":hide_object243:":"hide_object243.png",":hide_object244:":"hide_object244.png",":hide_object245:":"hide_object245.png",":hide_object246:":"hide_object246.png",":hide_object247:":"hide_object247.png",":hide_object248:":"hide_object248.png",":hide_object249:":"hide_object249.png"};l.emojiarea={path:"",
icons:{},defaults:{button:null,buttonLabel:'\x3ci class\x3d"icon-smiley"\x3e\x3c/i\x3e',buttonPosition:"after",emojiHeight:0,emojiLeft:0,buttonClass:null,buttonParent:null,buttonRoot:null,buttonChild:null}};l.fn.emojiarea=function(a){a=l.extend({},l.emojiarea.defaults,a);return this.each(function(){var b=l(this);new m(b,a)})};var c={};c.restoreSelection=function(){if(h.getSelection)return function(a){var b=h.getSelection();b.removeAllRanges();for(var c=0,d=a.length;c<d;++c)b.addRange(a[c])};if(g.selection&&
g.selection.createRange)return function(a){a&&a.select()}}();c.saveSelection=function(){if(h.getSelection)return function(){var a=h.getSelection(),b=[];if(a.rangeCount)for(var c=0,d=a.rangeCount;c<d;++c)b.push(a.getRangeAt(c));return b};if(g.selection&&g.selection.createRange)return function(){var a=g.selection;return"none"!==a.type.toLowerCase()?a.createRange():null}}();c.replaceSelection=function(){if(h.getSelection)return function(a){var b,c=h.getSelection(),d="string"===typeof a?g.createTextNode(a):
a;c.getRangeAt&&c.rangeCount&&(b=c.getRangeAt(0),b.deleteContents(),b.insertNode(g.createTextNode(" ")),b.insertNode(d),b.setStart(d,0),h.setTimeout(function(){b=g.createRange();b.setStartAfter(d);b.collapse(!0);c.removeAllRanges();c.addRange(b)},0))};if(g.selection&&g.selection.createRange)return function(a){var b=g.selection.createRange();"string"===typeof a?b.text=a:b.pasteHTML(a.outerHTML)}}();c.insertAtCursor=function(a,b){a=" "+a+" ";var c=b.value,d;if(d=l(b).data("simditor"))if(l(d.selection._selection.focusNode).closest(".simditor-body").length)d.trigger("selectionchanged"),
d.selection.insertNode(g.createTextNode(a)),d.trigger("valuechanged"),d.trigger("selectionchanged");else{var e=d.getValue(),f=e;l(e).last().is("p")?(e=l(e).last().append(a),f=l("\x3cdiv/\x3e").append(e).html()):f=e+a;d.setValue(f)}"undefined"!=typeof b.selectionStart&&"undefined"!=typeof b.selectionEnd?(d=b.selectionStart,b.value=c.substring(0,d)+a+c.substring(b.selectionEnd),b.selectionStart=b.selectionEnd=d+a.length):"undefined"!=typeof g.selection&&"undefined"!=typeof g.selection.createRange&&
(b.focus(),c=g.selection.createRange(),c.text=a,c.select());b.focus();l("#im-chatwin-container").trigger("modifyLimitNum")};c.extend=function(a,b){"undefined"!==typeof a&&a||(a={});if("object"===typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};c.escapeRegex=function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};c.htmlEntities=function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;")};l.extend({faceConvert:function(a){for(var d in b)b.hasOwnProperty(d)&&
(a=a.replace(new RegExp(c.escapeRegex(d),"g"),k.createIcon(d)));return a}});var k=function(){};k.prototype.setup=function(){var a=this;this.$editor.on("focus",function(){a.hasFocus=!0});this.$editor.on("blur",function(){a.hasFocus=!1});this.setupButton()};k.prototype.setupButton=function(){var a=this,b;if(this.options.button)b=l(this.options.button);else if(!1!==this.options.button)if(b=l('\x3ca href\x3d"javascript:void(0)" data-original-title\x3d"\u70b9\u51fb\u6dfb\u52a0\u8868\u60c5" title\x3d"" data-toggle\x3d"tooltip" data-placement\x3d"top"\x3e'),
b.html(this.options.buttonLabel),null!==this.options.buttonClass?b.addClass(this.options.buttonClass):b.addClass("emoji-button"),b.attr({title:"\u70b9\u51fb\u6dfb\u52a0\u8868\u60c5"}),null!==this.options.buttonRoot&&null!==this.options.buttonChild){var c="."+this.options.buttonClass;l(this.options.buttonRoot).find(this.options.buttonChild).each(function(){if(0<l(this).find(c).length)return!0;l(this).prepend(b);return!1})}else if(null!==this.options.buttonParent)l(this.options.buttonParent).prepend(b);
else this.$editor[this.options.buttonPosition](b);else b=l("");b.on("click",function(b){0!=l(".emoji-menu").length?l(".emoji-menu").hide():((new e(a)).reposition(),b.stopPropagation())});this.$button=b};k.createIcon=function(a){var d=b[a],e="/static/images/face/emojipng";e.length&&"/"!==e.charAt(e.length-1)&&(e+="/");return'\x3cimg src\x3d"'+e+d+'" alt\x3d"'+c.htmlEntities(a)+'" class\x3d"emoji-png"\x3e'};var e=function(a){var b=this,c=l(g.body),d=l(h);this.visible=!1;this.emojiarea=a;this.$menu=
l("\x3cdiv\x3e");null!==a.options.buttonClass?this.$menu.addClass("emoji-menu filterSlip_js "+a.options.buttonClass):this.$menu.addClass("emoji-menu filterSlip_js");this.$items=l("\x3ctbody\x3e").appendTo(this.$menu);this.$items.wrap('\x3cdiv class\x3d"j_emojiMenuScr" auto-scroll\x3d"yes"\x3e\x3c/div\x3e');this.$menu.wrap('\x3cdiv class\x3d"emoji-menudiv"\x3e\x3c/div\x3e');c.append(this.$menu);f.layout("body .emoji-menu .j_emojiMenuScr",[{gotoTopButton:!1}]);c.mouseover(function(a){a=l(a.target);
0==a.closest(".emoji-menu").length&&null==a.parents(".emoji-menu").get(0)&&a.mousewheel(function(a,d,e,f){null!=c.find(".emoji-menu").get(0)&&b.remove()})});c.on("click",function(a){a=l(a.target);0==a.closest(".emoji-menu").length&&null==a.parents(".emoji-menu").get(0)&&b.remove()});d.on("resize",function(){b.visible&&b.reposition()});this.$menu.on("mouseup","a",function(a){a.stopPropagation();return!1});this.$menu.on("click","a",function(a){var c=l(".label",l(this)).text();h.setTimeout(function(){b.onItemSelected.apply(b,
[c])},0);a.stopPropagation();return!1});this.load()};e.prototype.remove=function(){l(".emoji-menu .j_emojiMenuScr").hasClass("mCustomScrollbar")&&f.destroyLayout(".emoji-menu .j_emojiMenuScr");l(".emoji-menu").remove()};e.prototype.onItemSelected=function(a){this.emojiarea.insert(a);l(".emoji-menu").remove()};e.prototype.load=function(){var b=[],e=0,f;for(f in a)0==e&&b.push("\x3ctr\x3e"),a.hasOwnProperty(f)&&(b.push('\x3ctd\x3e\x3ca href\x3d"javascript:void(0)" title\x3d"'+d[f]+'"\x3e'+k.createIcon(f)+
'\x3cspan class\x3d"label"\x3e'+c.htmlEntities(f)+"\x3c/span\x3e\x3c/a\x3e\x3c/td\x3e"),e+=1),10==e&&(b.push("\x3c/tr\x3e"),e=0);this.$items.html(b.join(""))};e.prototype.reposition=function(){var a=this.emojiarea.$button,b=this.emojiarea.options,c=a.offset();c.top=parseInt(c.top-a.outerHeight())+parseInt(b.emojiHeight)+"px";c.left=parseInt(c.left-a.outerWidth())+parseInt(b.emojiLeft)+"px";this.$menu.css({top:c.top,left:c.left})};e.prototype.hide=function(a){this.emojiarea&&(this.emojiarea.menu=null,
this.emojiarea.$button.removeClass("on"),this.emojiarea=null);this.visible=!1;this.$menu.hide()};var m=function(a,b){this.options=b;this.$editor=this.$textarea=a;this.setup()};m.prototype.insert=function(b){a.hasOwnProperty(b)&&(c.insertAtCursor(b,this.$textarea[0]),this.$textarea.trigger("change"),(b=this.$textarea.data("simditor"))&&b.focus())};m.prototype.val=function(){return this.$textarea.val()};c.extend(m.prototype,k.prototype)})(jQuery,window,document)}});
define("im/recentlist/imReconnectView",["im/component/imUtils","im/component/imContants"],function(n,s,p){var m=n("im/component/imUtils"),l=n("im/component/imContants");n=Backbone.View.extend({initialize:function(h){this.el="#im-reconnect-area";this.parentEl=h.parentEl;this.countdown=60;1>$(this.el).length&&$("#"+l.IM_ADDRLIST_EL).html(m.template("im.portal.imconnectarea",TEAMS));var g="zh_CN";TEAMS.perLang&&(g=TEAMS.perLang);switch(g){case "en_US":h="Maybe the network is error\x3cbr/\x3e\x3cspan\x3eIM disconnect\x3c/span\x3e";
$(this.el).find(".j_im-reconnect-tip").html(h);$(this.el).find(".j_im-connect-start").html("Reconnect");break;case "zh_TW":h="\u53ef\u80fd\u7531\u65bc\u7db2\u7d61\u539f\u56e0\x3cbr/\x3e\u93c8\u63a5\x3cspan\x3eIM\x3c/span\x3e\u5931\u6557",$(this.el).find(".j_im-reconnect-tip").html(h),$(this.el).find(".j_im-connect-start").html("\u91cd\u65b0\u9023\u63a5")}this.perLang=g},delegateEvents:function(){var h=this;$(this.el).off("click.ImReconnectView",".j_im-connect-start").on("click.ImReconnectView",".j_im-connect-start",
function(g){$("body").trigger("imLoginAndConnect.imWebsocket");h.downCount($(this))})},downCount:function(h){var g=this;if(0==g.countdown){h.removeClass("im-disabled");switch(g.perLang){case "en_US":h.text("Reconnect");break;case "zh_TW":h.text("\u91cd\u65b0\u9023\u63a5");break;default:h.text("\u91cd\u65b0\u8fde\u63a5")}g.countdown=60}else{h.addClass("im-disabled");switch(g.perLang){case "en_US":h.text("Reconnecting\uff08"+g.countdown+")");break;case "zh_TW":h.text("\u91cd\u65b0\u9023\u63a5\uff08"+
g.countdown+")");break;default:h.text("\u91cd\u65b0\u8fde\u63a5\uff08"+g.countdown+")")}g.countdown--;setTimeout(function(){g.downCount(h)},1E3)}},render:function(h){},remove:function(){$(this.el).off(".ImReconnectView")}});p.exports=n});define("im/recentlist/imRecentListView",function(n,s,p){n=Backbone.View.extend({initialize:function(m){},delegateEvents:function(){},remove:function(){}});p.exports=n});var imConfig={version:"20180726-1"};
